<!DOCTYPE html>
<html>
  <head>
    <script>
      (function(){
  const {protocol:proto, host:hostName, pathname:path, search:srch, hash:hsh} = window.location;
  if (!(path.endsWith("/") || path.endsWith(".html"))) {
    window.location.replace(`${proto}//${hostName}${path}/${srch}${hsh}`);
  }
})()</script>
    <base href="./../../"><meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <title>One API, Many Applications</title><link rel="stylesheet" href="book.css">
    <script>
      const __versoSiteRoot = document.baseURI;</script>
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js" integrity="sha384-zbcZAIxlvJtNE3Dp5nxLXdXtXyxwOdnILY1TDPVmKFhl4r4nSUG1r8bcFXGVa4Te" crossorigin="anonymous"></script>
    <script src="-verso-data/katex/katex.js"></script>
    <script src="-verso-data/katex/math.js"></script>
    <script src="-verso-data/popper.js"></script>
    <script src="-verso-data/tippy.js"></script>
    <link rel="stylesheet" href="static/theme.css">
    <link rel="stylesheet" href="static/fonts/source-serif/source-serif-text.css">
    <link rel="stylesheet" href="static/fonts/source-code-pro/source-code-pro.css">
    <link rel="stylesheet" href="static/fonts/source-sans/source-sans-3.css">
    <link rel="stylesheet" href="static/fonts/noto-sans-mono/noto-sans-mono.css">
    <link rel="stylesheet" href="-verso-data/katex/katex.css">
    <link rel="stylesheet" href="-verso-data/tippy-border.css">
    <style>
div.paragraph > .eval-steps:not(:first-child), div.paragraph > .eval-steps:not(:first-child) > * {
  margin-top: 0.5rem;
}

div.paragraph > .eval-steps:not(:last-child), div.paragraph > .eval-steps:not(:last-child) > * {
  margin-bottom: 0.5rem;
}

.eval-steps .hl.lean.block {
  margin-top: 0.25em;
  margin-bottom: 0.25em;
}
</style><style>
.shell-command {

}
.shell-command.inline > * {
  display: inline;
  white-space: pre;
}
.shell-command.inline .command::before {
  content: "$ ";
  font-weight: 600;
}
</style><style>
.shell-command {

}
.shell-command.block > * {
  display: block;
  white-space: pre;
}
.shell-command .command .prompt {
  font-weight: 600;
}

div.paragraph > .shell-command:not(:first-child) {
  margin-top: 0.5rem;
}

div.paragraph > .shell-command:not(:last-child) {
  margin-bottom: 0.5rem;
}
</style><style>

.hl.lean {
  white-space: pre;
  font-weight: normal;
  font-style: normal;
}

.hl.lean .keyword {
  font-weight : bold;
}

.hl.lean .var {
  font-style: italic;
  position: relative;
}

.hover-container {
  width: 0;
  height: 0;
  position: relative;
  display: inline;
}

.hl.lean a {
  color: inherit;
  text-decoration: currentcolor underline dotted;
}

.hl.lean a:hover {
  text-decoration: currentcolor underline solid;
}

.hl.lean .hover-info {
  white-space: normal;
}

.hl.lean .token .hover-info {
  display: none;
  position: absolute;
  background-color: #e5e5e5;
  border: 1px solid black;
  padding: 0.5rem;
  z-index: 300;
  font-size: inherit;
}

.hl.lean .hover-info.messages {
  max-height: 10rem;
  overflow-y: auto;
  overflow-x: hidden;
  scrollbar-gutter: stable;
  padding: 0 0.5rem 0 0;
  display: block;
}

.hl.lean .hover-info code {
  white-space: pre-wrap;
}

.hl.lean .hover-info.messages > code {
  padding: 0.5rem;
  display: block;
  width: fit-content;
}

.hl.lean .hover-info.messages > code:only-child {
  margin: 0;
}

.hl.lean .hover-info.messages > code {
  margin: 0.1rem;
}

.hl.lean .hover-info.messages > code:not(:first-child) {
  margin-top: 0rem;
}

/*
@media (hover: hover) {
  .hl.lean .has-info:hover > .hover-container > .hover-info:not(.tactic *),
  .hl.lean .tactic:has(> .tactic-toggle:checked) .has-info:hover > .hover-container > .hover-info,
  .hl.lean .token:hover > .hover-container > .hover-info:not(.has-info *):not(.tactic *),
  .hl.lean .tactic:has(> .tactic-toggle:checked) .token:hover > .hover-container > .hover-info:not(.has-info *) {
    display: inline-block;
    position: absolute;
    top: 1rem;
    font-weight: normal;
    font-style: normal;
    width: min-content;
  }
}
*/

.hl.lean.block {
  display: block;
}

.hl.lean.inline {
  display: inline;
  white-space: pre-wrap;
}

.hl.lean .token {
  transition: all 0.25s; /* Slight fade for highlights */
}

@media (hover: hover) {
  .hl.lean .token.binding-hl, .hl.lean .literal.string:hover, .hl.lean .token.typed:hover {
    background-color: #eee;
    border-radius: 2px;
    transition: none;
  }
}


.hl.lean .has-info .token:not(.tactic-state):not(.tactic-state *), .hl.lean .has-info .inter-text:not(.tactic-state):not(.tactic-state *) {
  text-decoration-style: wavy;
  text-decoration-line: underline;
  text-decoration-thickness: from-font;
}

.hl.lean .has-info .hover-info {
  display: none;
  position: absolute;
  transform: translate(0.25rem, 0.3rem);
  border: 1px solid black;
  padding: 0.5rem;
  z-index: 400;
  text-align: left;
}

.hl.lean .has-info.error :not(.tactic-state):not(.tactic-state *){
  text-decoration-color: red;
}

@media (hover: hover) {
  .hl.lean .has-info.error:hover {
    background-color: #ffb3b3;
  }
}

.hl.lean .hover-info.messages > code.error {
  background-color: #e5e5e5;
  border-left: 0.2rem solid #ffb3b3;
}

.tippy-box[data-theme~='error'] .hl.lean .hover-info.messages > code.error {
  background: none;
  border: none;
}

.error pre {
    color: red;
}

.hl.lean .has-info.warning :not(.tactic-state):not(.tactic-state *) {
  text-decoration-color: var(--verso-warning-color);
}

@media (hover: hover) {
  .hl.lean .has-info.warning:hover {
    background-color:var(--verso-warning-color);
  }
}

.hl.lean .hover-info.messages > code.warning {
  background-color: var(--verso-warning-color);
}

.hl.lean .hover-info.messages > code.error {
  background-color: #e5e5e5;
  border-left: 0.2rem solid var(--verso-warning-color);
}

.tippy-box[data-theme~='warning'] .hl.lean .hover-info.messages > code.warning {
  background: none;
  border: none;
}


.hl.lean .has-info.info :not(.tactic-state):not(.tactic-state *) {
  text-decoration-color: blue;
}

@media (hover: hover) {
  .hl.lean .has-info.info:hover {
    background-color: #4777ff;
  }
}


.hl.lean .hover-info.messages > code.info {
  background-color: #e5e5e5;
  border-left: 0.2rem solid #4777ff;
}

.tippy-box[data-theme~='info'] .hl.lean .hover-info.messages > code.info {
  background: none;
  border: none;
}

.hl.lean div.docstring {
  font-family: sans-serif;
  white-space: normal;
  max-width: 40rem;
  width: max-content;
}

.hl.lean div.docstring > :last-child {
  margin-bottom: 0;
}

.hl.lean div.docstring > :first-child {
  margin-top: 0;
}

.hl.lean .hover-info .sep {
  display: block;
  width: auto;
  margin-left: 1rem;
  margin-right: 1rem;
  margin-top: 0.5rem;
  margin-bottom: 0.5rem;
  padding: 0;
  height: 1px;
  border-top: 1px solid #ccc;
}

.hl.lean code {
  font-family: monospace;
}

.hl.lean .tactic-state {
  display: none;
  position: relative;
  left: 2rem;
  width: fit-content;
  border: 1px solid #888888;
  border-radius: 0.1rem;
  padding: 0.5rem;
  font-family: sans-serif;
  background-color: #ffffff;
  z-index: 200;
}

.hl.lean.popup .tactic-state {
  position: static;
  display: block;
  width: auto;
  border: none;
  padding: 0.5rem;
  font-family: sans-serif;
  background-color: #ffffff;
}


.hl.lean .tactic {
  position: relative;
}

.hl.lean .tactic-toggle:checked ~ .tactic-state {
  display: block;
}

/*
@media (hover: hover) {
  .hl.lean .tactic:hover > .tactic-toggle:not(:checked) ~ .tactic-state {
    display: block;
    position: absolute;
    left: 0;
    transform: translate(0.25rem, 0);
    z-index: 250;
  }
}
*/

.hl.lean .tactic > label {
  position: relative;
  transition: all 0.5s;
}

@media (hover: hover) {
  .hl.lean .tactic > label:hover {
    border-bottom: 1px dotted #bbbbbb;
  }
}

.hl.lean .tactic-toggle {
  position: absolute;
  top: 0;
  left: 0;
  opacity: 0;
  height: 0;
  width: 0;
  z-index: -10;
}

.hl.lean .tactic > label::after {
  content: "";
  border: 1px solid #bbbbbb;
  border-radius: 1rem;
  height: 0.25rem;
  vertical-align: middle;
  width: 0.6rem;
  margin-left: 0.1rem;
  margin-right: 0.1rem;
  display: inline-block;
  transition: all 0.5s;
}

/*
@media (hover: hover) {
  .hl.lean .tactic > label:hover::after {
    border: 1px solid #aaaaaa;
    background-color: #aaaaaa;
    transition: all 0.5s;
  }
}
*/

.hl.lean .tactic > label:has(+ .tactic-toggle:checked)::after {
  border: 1px solid #999999;
  background-color: #999999;
  transition: all 0.5s;
}

.hl.lean .tactic-state .goal + .goal {
  margin-top: 1.5rem;
}

.hl.lean .tactic-state summary {
  margin-left: -0.5rem;
}

.hl.lean .tactic-state details {
  padding-left: 0.5rem;
}

.hl.lean .case-label {
  display: block;
  position: relative;
}

.hl.lean .case-label input[type="checkbox"] {
  position: absolute;
  top: 0;
  left: 0;
  opacity: 0;
  height: 0;
  width: 0;
  z-index: -10;
}

.hl.lean .case-label:has(input[type="checkbox"])::before {
  width: 1rem;
  height: 1rem;
  display: inline-block;
  background-color: black;
  content: ' ';
  transition: ease 0.2s;
  margin-right: 0.7rem;
  clip-path: polygon(100% 0, 0 0, 50% 100%);
  width: 0.6rem;
  height: 0.6rem;
}

.hl.lean .case-label:has(input[type="checkbox"]:not(:checked))::before {
  transform: rotate(-90deg);
}

.hl.lean .case-label:has(input[type="checkbox"]) {

}

.hl.lean .case-label:has(input[type="checkbox"]:checked) {

}


.hl.lean .tactic-state .labeled-case > :not(:first-child) {
  max-height: 0px;
  display: block;
  overflow: hidden;
  transition: max-height 0.1s ease-in;
  margin-left: 0.5rem;
  margin-top: 0.1rem;
}

.hl.lean .labeled-case:has(.case-label input[type="checkbox"]:checked) > :not(:first-child) {
  max-height: 100%;
}


.hl.lean .tactic-state .goal-name::before {
  font-style: normal;
  content: "case ";
}

.hl.lean .tactic-state .goal-name {
  font-style: italic;
  font-family: monospace;
}

.hl.lean .tactic-state .hypotheses {
  display: table;
}

.hl.lean .tactic-state .hypothesis {
  display: table-row;
}

.hl.lean .tactic-state .hypothesis > * {
  display: table-cell;
}


.hl.lean .tactic-state .hypotheses .colon {
  text-align: center;
  min-width: 1rem;
}

.hl.lean .tactic-state .hypotheses .name {
  text-align: right;
}

.hl.lean .tactic-state .hypotheses .name,
.hl.lean .tactic-state .hypotheses .type,
.hl.lean .tactic-state .conclusion .type {
  font-family: monospace;
}

.tippy-box[data-theme~='lean'] {
  background-color: #e5e5e5;
  color: black;
  border: 1px solid black;
}
.tippy-box[data-theme~='lean'][data-placement^='top'] > .tippy-arrow::before {
  border-top-color: #e5e5e5;
}
.tippy-box[data-theme~='lean'][data-placement^='bottom'] > .tippy-arrow::before {
  border-bottom-color: #e5e5e5;
}
.tippy-box[data-theme~='lean'][data-placement^='left'] > .tippy-arrow::before {
  border-left-color: #e5e5e5;
}
.tippy-box[data-theme~='lean'][data-placement^='right'] > .tippy-arrow::before {
  border-right-color: #e5e5e5;
}

.tippy-box[data-theme~='message'][data-placement^='top'] > .tippy-arrow::before {
  border-top-color: #e5e5e5;
  border-width: 11px 11px 0;
}
.tippy-box[data-theme~='message'][data-placement^='top'] > .tippy-arrow::after {
  bottom: -11px;
  border-width: 11px 11px 0;
}
.tippy-box[data-theme~='message'][data-placement^='bottom'] > .tippy-arrow::before {
  border-width: 0 11px 11px;
}
.tippy-box[data-theme~='message'][data-placement^='bottom'] > .tippy-arrow::after {
  top: -11px;
  border-width: 0 11px 11px;
}
.tippy-box[data-theme~='message'][data-placement^='left'] > .tippy-arrow::before {
  border-left-color: #e5e5e5;
  border-width: 11px 0 11px 11px;
}
.tippy-box[data-theme~='message'][data-placement^='left'] > .tippy-arrow::after {
  right: -11px;
  border-width: 11px 0 11px 11px;
}

.tippy-box[data-theme~='message'][data-placement^='right'] > .tippy-arrow::before {
  border-right-color: #e5e5e5;
  border-width: 11px 11px 11px 0;
}
.tippy-box[data-theme~='message'][data-placement^='right'] > .tippy-arrow::after {
  left: -11px;
  border-width: 11px 11px 11px 0;
}



.tippy-box[data-theme~='warning'] {
  background-color: #e5e5e5;
  color: black;
  border: 3px solid var(--verso-warning-color);
}

.tippy-box[data-theme~='error'] {
  background-color: #e5e5e5;
  color: black;
  border: 3px solid #f7a7af;
}

.tippy-box[data-theme~='info'] {
  background-color: #e5e5e5;
  color: black;
  border: 3px solid #99b3c2;
}

.tippy-box[data-theme~='tactic'] {
  background-color: white;
  color: black;
  border: 1px solid black;
}
.tippy-box[data-theme~='tactic'][data-placement^='top'] > .tippy-arrow::before {
  border-top-color: white;
}
.tippy-box[data-theme~='tactic'][data-placement^='bottom'] > .tippy-arrow::before {
  border-bottom-color: white;
}
.tippy-box[data-theme~='tactic'][data-placement^='left'] > .tippy-arrow::before {
  border-left-color: white;
}
.tippy-box[data-theme~='tactic'][data-placement^='right'] > .tippy-arrow::before {
  border-right-color: white;
}

</style><style>
.example-file {
  white-space: normal;
  font-family: var(--verso-structure-font-family);
  margin: 1rem;
  width: fit-content;
  border: 1px solid #ddd;
  padding: 0.5rem;

  /* These are necessary for the container to behave nicely on mobile */
  overflow-x: auto;
  max-width: 100%;
  box-sizing: border-box;
}
.example-file::before {
  counter-reset: linenumber;
}
.example-file > .line {
  display: block;
  white-space: pre;
  counter-increment: linenumber;
  font-family: var(--verso-code-font-family);
}
.example-file > .line::before {
  -webkit-user-select: none;
  display: inline-block;
  content: counter(linenumber);
  border-right: 1px solid #ddd;
  width: 2em;
  padding-right: 0.25em;
  margin-right: 0.25em;
  font-family: var(--verso-code-font-family);
  text-align: right;
}
.example-file > .line::after {
  -webkit-user-select: none;
  display: inline-block;
  content: "⏎";
  opacity: 0;
}
.example-file > .line:hover::after {
  opacity: 1;
}
.example-file > .line:hover, .example-file > .line:hover::before {
  background-color: #eee;
}
.example-file > .empty {
  display: block;
  white-space: pre;
  font-family: var(--verso-code-font-family);
  font-style: italic;
}
.example-file > .empty::before {
  -webkit-user-select: none;
  display: inline-block;
  content: "";
  border-right: 1px solid #ddd;
  width: 2em;
  padding-right: 0.25em;
  margin-right: 0.25em;
  font-family: var(--verso-code-font-family);
  text-align: right;
}
</style><style>
table.tabular {
  margin: auto;
  border-spacing: 1rem;
}
table.tabular.left-align {
  margin-right: auto;
  margin-left: 0;
}
table.tabular.center-align {
  margin: auto;
}
table.tabular.right-align {
  margin-left auto;
  margin-right: 0;
}
table.tabular td, table.tabular th {
  text-align: left;
  vertical-align: top;
}
table.tabular td > p:first-child, table.tabular th > p:first-child {
  margin-top: 0;
}
table.tabular td > p:last-child, table.tabular th > p:first-child {
  margin-bottom: 0;
}
</style><style>
.shell-commands {

}
.shell-commands > * {
  display: block;
  white-space: pre;
}
.shell-commands .command::before {
  content: "$ ";
  font-weight: 600;
}

div.paragraph > .shell-commands:not(:first-child) {
  margin-top: 0.5rem;
}

div.paragraph > .shell-commands:not(:last-child) {
  margin-bottom: 0.5rem;
}
</style><style>
.eq-steps .hl.lean.block {
  background-color: #f6f7f6;
  padding: 1rem;
  margin-top: 0.25rem;
  margin-bottom: 0.25rem;
}
.eq-steps .reason {
  font-style: italic;
  margin-left: 2.5em;
  display: flex;
}
.eq-steps .reason::before {
  content: "={";
  font-family: var(--verso-code-font-family);
  font-style: normal;
  font-weight: 600;
  margin-right: 0.5em;
  align-self: center;
}
.eq-steps .reason > p {
  margin: 0;
  max-width: 25em;
  align-self: center;
}
.eq-steps .reason::after {
  content: "}=";
  font-family: var(--verso-code-font-family);
  font-style: normal;
  font-weight: 600;
  margin-left: 1em;
  align-self: center;
}
</style><style>
div.paragraph > .eq-steps:not(:first-child) {
  margin-top: 0.5rem;
}

div.paragraph > .eq-steps:not(:last-child) {
  margin-bottom: 0.5rem;
}
</style><script>
      
window.onload = () => {

    // Don't show hovers inside of closed tactic states
    function blockedByTactic(elem) {
      let parent = elem.parentNode;
      while (parent && "classList" in parent) {
        if (parent.classList.contains("tactic")) {
          const toggle = parent.querySelector("input.tactic-toggle");
          if (toggle) {
            return !toggle.checked;
          }
        }
        parent = parent.parentNode;
      }
      return false;
    }

    function blockedByTippy(elem) {
      // Don't show a new hover until the old ones are all closed.
      // Scoped to the nearest "top-level block" to avoid being O(n) in the size of the document.
      var block = elem;
      const topLevel = new Set(["section", "body", "html", "nav", "header"]);
      while (block.parentNode && !topLevel.has(block.parentNode.nodeName.toLowerCase())) {
        block = block.parentNode;
      }
      for (const child of block.querySelectorAll(".token, .has-info")) {
        if (child._tippy && child._tippy.state.isVisible) { return true };
      }
      return false;
    }

    for (const c of document.querySelectorAll(".hl.lean .token")) {
        if (c.dataset.binding != "") {
            c.addEventListener("mouseover", (event) => {
                if (blockedByTactic(c)) {return;}
                const context = c.closest(".hl.lean").dataset.leanContext;
                for (const example of document.querySelectorAll(".hl.lean")) {
                    if (example.dataset.leanContext == context) {
                        for (const tok of example.querySelectorAll(".token")) {
                            if (c.dataset.binding == tok.dataset.binding) {
                                tok.classList.add("binding-hl");
                            }
                        }
                    }
                }
            });
        }
        c.addEventListener("mouseout", (event) => {
            for (const tok of document.querySelectorAll(".hl.lean .token")) {
                tok.classList.remove("binding-hl");
            }
        });
    }
    /* Render docstrings */
    if ('undefined' !== typeof marked) {
        for (const d of document.querySelectorAll("code.docstring, pre.docstring")) {
            const str = d.innerText;
            const html = marked.parse(str);
            const rendered = document.createElement("div");
            rendered.classList.add("docstring");
            rendered.innerHTML = html;
            d.parentNode.replaceChild(rendered, d);
        }
    }
    // Add hovers
    let siteRoot = typeof __versoSiteRoot !== 'undefined' ? __versoSiteRoot : "/";
    let docsJson = siteRoot + "-verso-docs.json";
    fetch(docsJson).then((resp) => resp.json()).then((versoDocData) => {

      function hideParentTooltips(element) {
        let parent = element.parentElement;
        while (parent) {
          const tippyInstance = parent._tippy;
          if (tippyInstance) {
            tippyInstance.hide();
          }
          parent = parent.parentElement;
        }
      }



      const defaultTippyProps = {
        /* DEBUG -- remove the space: * /
        onHide(any) { return false; },
        trigger: "click",
        // */
        /* theme: "lean", */
        maxWidth: "none",
        appendTo: () => document.body,
        interactive: true,
        delay: [100, null],
        /* ignoreAttributes: true, */
        followCursor: 'initial',
        onShow(inst) {
          if (inst.reference.className == 'tactic') {

            const toggle = inst.reference.querySelector("input.tactic-toggle");
            if (toggle && toggle.checked) {
              return false;
            }
            hideParentTooltips(inst.reference);
            //if (blockedByTippy(inst.reference)) { return false; }

          } else if (inst.reference.querySelector(".hover-info") || "versoHover" in inst.reference.dataset) {
            if (blockedByTactic(inst.reference)) { return false };
            if (blockedByTippy(inst.reference)) { return false; }
          } else { // Nothing to show here!
            return false;
          }
        },
        content (tgt) {
          const content = document.createElement("span");
          if (tgt.className == 'tactic') {
            const state = tgt.querySelector(".tactic-state").cloneNode(true);
            state.style.display = "block";
            content.appendChild(state);
            content.style.display = "block";
            content.className = "hl lean popup";
          } else {
            content.className = "hl lean";
            content.style.display = "block";
            content.style.maxHeight = "300px";
            content.style.overflowY = "auto";
            content.style.overflowX = "hidden";
            const hoverId = tgt.dataset.versoHover;
            const hoverInfo = tgt.querySelector(".hover-info");
            if (hoverId) { // Docstrings from the table
              // TODO stop doing an implicit conversion from string to number here
              let data = versoDocData[hoverId];
              if (data) {
                const info = document.createElement("span");
                info.className = "hover-info";
                info.style.display = "block";
                info.innerHTML = data;
                content.appendChild(info);
                /* Render docstrings - TODO server-side */
                if ('undefined' !== typeof marked) {
                    for (const d of content.querySelectorAll("code.docstring, pre.docstring")) {
                        const str = d.innerText;
                        const html = marked.parse(str);
                        const rendered = document.createElement("div");
                        rendered.classList.add("docstring");
                        rendered.innerHTML = html;
                        d.parentNode.replaceChild(rendered, d);
                    }
                }
              } else {
                content.innerHTML = "Failed to load doc ID: " + hoverId;
              }
            } else if (hoverInfo) { // The inline info, still used for compiler messages
              content.appendChild(hoverInfo.cloneNode(true));
            }
          }
          return content;
        }
      };



      const addTippy = (selector, props) => {
        tippy(selector, Object.assign({}, defaultTippyProps, props));
      };
      document.querySelectorAll('.hl.lean .const.token, .hl.lean .keyword.token, .hl.lean .literal.token, .hl.lean .option.token, .hl.lean .var.token, .hl.lean .typed.token').forEach(element => {
        element.setAttribute('data-tippy-theme', 'lean');
      });
      document.querySelectorAll('.hl.lean .has-info.warning').forEach(element => {
        element.setAttribute('data-tippy-theme', 'warning message');
      });
      document.querySelectorAll('.hl.lean .has-info.info').forEach(element => {
        element.setAttribute('data-tippy-theme', 'info message');
      });
      document.querySelectorAll('.hl.lean .has-info.error').forEach(element => {
        element.setAttribute('data-tippy-theme', 'error message');
      });
      document.querySelectorAll('.hl.lean .tactic').forEach(element => {
        element.setAttribute('data-tippy-theme', 'tactic');
      });
      let insts = tippy('.hl.lean .const.token, .hl.lean .keyword.token, .hl.lean .literal.token, .hl.lean .option.token, .hl.lean .var.token, .hl.lean .typed.token, .hl.lean .has-info, .hl.lean .tactic', defaultTippyProps);



      /*
      tippy('.hl.lean .tactic', {
        allowHtml: true,

        onHide(any) { return false; },
        trigger: "click",

        maxWidth: "none",
        onShow(inst) {
          const toggle = inst.reference.querySelector("input.tactic-toggle");
          if (toggle && toggle.checked) {
            return false;
          }
          if (blockedByTippy(inst.reference)) { return false; }
        },
        content (tgt) {
          const content = document.createElement("span");
          const state = tgt.querySelector(".tactic-state").cloneNode(true);
          state.style.display = "block";
          content.appendChild(state);
          content.style.display = "block";
          content.className = "hl lean popup";
          return content;
        }
      });
      */
  });
}
</script>
    </head>
  <body>
    <header>
      <div class="header-logo-wrapper">
        <a href="" id="logo"><img src="static/lean_logo.svg"></a></div>
      <div class="header-title-wrapper">
        <a href="" class="header-title"><h1>
            Functional Programming in Lean</h1>
          </a></div>
      </header>
    <label for="toggle-toc" id="toggle-toc-click"><span class="line line1"></span><span class="line line2"></span><span class="line line3"></span></label><div class="with-toc">
      <div class="toc-backdrop" onclick="document.getElementById('toggle-toc-click')?.click()"></div>
      <nav id="toc">
        <input type="checkbox" id="toggle-toc"><div class="first">
          <a href="" class="toc-title"><h1>
              Functional Programming in Lean</h1>
            </a><div class="split-tocs">
            <div class="split-toc book">
              <div class="title">
                <label for="--verso-manual-toc-----bookRoot" class="toggle-split-toc"><input type="checkbox" class="toggle-split-toc" id="--verso-manual-toc-----bookRoot"></label><span class="">Table of Contents</span></div>
              <table><tr class="unnumbered"><td class="num"><td><a href="Introduction/#Functional-Programming-in-Lean--Introduction">Introduction</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="Acknowledgments/#Functional-Programming-in-Lean--Acknowledgments">Acknowledgments</a></td></tr><tr class="numbered"><td class="num">1.</td><td><a href="Getting-to-Know-Lean/#getting-to-know">Getting to Know Lean</a></td></tr><tr class="numbered"><td class="num">2.</td><td><a href="Hello___-World___/#hello-world">Hello, World!</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="Interlude___-Propositions___-Proofs___-and-Indexing/#props-proofs-indexing">Interlude: Propositions, Proofs, and Indexing</a></td></tr><tr class="numbered"><td class="num">3.</td><td><a href="Overloading-and-Type-Classes/#Functional-Programming-in-Lean--Overloading-and-Type-Classes">Overloading and Type Classes</a></td></tr><tr class="current numbered"><td class="num">4.</td><td><a href="Monads/#Functional-Programming-in-Lean--Monads">Monads</a></td></tr><tr class="numbered"><td class="num">5.</td><td><a href="Functors___-Applicative-Functors___-and-Monads/#Functional-Programming-in-Lean--Functors___-Applicative-Functors___-and-Monads">Functors, Applicative Functors, and Monads</a></td></tr><tr class="numbered"><td class="num">6.</td><td><a href="Monad-Transformers/#Functional-Programming-in-Lean--Monad-Transformers">Monad Transformers</a></td></tr><tr class="numbered"><td class="num">7.</td><td><a href="Programming-with-Dependent-Types/#Functional-Programming-in-Lean--Programming-with-Dependent-Types">Programming with Dependent Types</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="Interlude___-Tactics___-Induction___-and-Proofs/#Functional-Programming-in-Lean--Interlude___-Tactics___-Induction___-and-Proofs">Interlude: Tactics, Induction, and Proofs</a></td></tr><tr class="numbered"><td class="num">8.</td><td><a href="Programming___-Proving___-and-Performance/#Functional-Programming-in-Lean--Programming___-Proving___-and-Performance">Programming, Proving, and Performance</a></td></tr><tr class="numbered"><td class="num">9.</td><td><a href="Next-Steps/#next-steps">Next Steps</a></td></tr></table></div>
            <div class="split-toc">
              <div class="title">
                <label for="--verso-manual-toc-Functional-Programming-in-Lean--Monads" class="toggle-split-toc"><input type="checkbox" class="toggle-split-toc" id="--verso-manual-toc-Functional-Programming-in-Lean--Monads" checked="checked"></label><span class="number">4.</span> <span class=""><a href="Monads/#Functional-Programming-in-Lean--Monads">Monads</a></span></div>
              <table><tr class="current numbered"><td class="num">4.1.</td><td><a href="Monads/One-API___-Many-Applications/#Functional-Programming-in-Lean--Monads--One-API___-Many-Applications">One API, Many Applications</a></td></tr><tr class="numbered"><td class="num">4.2.</td><td><a href="Monads/The-Monad-Type-Class/#Functional-Programming-in-Lean--Monads--The-Monad-Type-Class">The Monad Type Class</a></td></tr><tr class="numbered"><td class="num">4.3.</td><td><a href="Monads/Example___-Arithmetic-in-Monads/#Functional-Programming-in-Lean--Monads--Example___-Arithmetic-in-Monads">Example: Arithmetic in Monads</a></td></tr><tr class="numbered"><td class="num">4.4.</td><td><a href="Monads/do--Notation-for-Monads/#Functional-Programming-in-Lean--Monads--do--Notation-for-Monads"><code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code>-Notation for Monads</a></td></tr><tr class="numbered"><td class="num">4.5.</td><td><a href="Monads/The-IO-Monad/#Functional-Programming-in-Lean--Monads--The-IO-Monad">The IO Monad</a></td></tr><tr class="numbered"><td class="num">4.6.</td><td><a href="Monads/Additional-Conveniences/#Functional-Programming-in-Lean--Monads--Additional-Conveniences">Additional Conveniences</a></td></tr><tr class="numbered"><td class="num">4.7.</td><td><a href="Monads/Summary/#Functional-Programming-in-Lean--Monads--Summary">Summary</a></td></tr></table></div>
            <div class="split-toc">
              <div class="title">
                <label for="--verso-manual-toc-Functional-Programming-in-Lean--Monads--One-API___-Many-Applications" class="toggle-split-toc"><input type="checkbox" class="toggle-split-toc" id="--verso-manual-toc-Functional-Programming-in-Lean--Monads--One-API___-Many-Applications" checked="checked"></label><span class="number">4.1.</span> <span class="current"><a href="Monads/One-API___-Many-Applications/#Functional-Programming-in-Lean--Monads--One-API___-Many-Applications">One API, Many Applications</a></span></div>
              <table><tr class="numbered"><td class="num">4.1.1.</td><td><a href="Monads/One-API___-Many-Applications/#Functional-Programming-in-Lean--Monads--One-API___-Many-Applications--Checking-for--none-___-Don___t-Repeat-Yourself">Checking for <code>none</code>: Don't Repeat Yourself</a></td></tr><tr class="numbered"><td class="num">4.1.2.</td><td><a href="Monads/One-API___-Many-Applications/#Functional-Programming-in-Lean--Monads--One-API___-Many-Applications--Propagating-Error-Messages">Propagating Error Messages</a></td></tr><tr class="numbered"><td class="num">4.1.3.</td><td><a href="Monads/One-API___-Many-Applications/#logging">Logging</a></td></tr><tr class="numbered"><td class="num">4.1.4.</td><td><a href="Monads/One-API___-Many-Applications/#numbering-tree-nodes">Numbering Tree Nodes</a></td></tr><tr class="numbered"><td class="num">4.1.5.</td><td><a href="Monads/One-API___-Many-Applications/#Functional-Programming-in-Lean--Monads--One-API___-Many-Applications--Monads___-A-Functional-Design-Pattern">Monads: A Functional Design Pattern</a></td></tr></table></div>
            </div>
          </div>
        <div class="last">
          <ul id="meta-links">
            <li>
              <a href="https://github.com/leanprover/fp-lean">Source Code</a></li>
            <li>
              <a href="https://github.com/leanprover/fp-lean/issues">Report Issues</a></li>
            </ul>
          </div>
        </nav>
      <main><div class="content-wrapper">
          <nav class="prev-next-buttons">
            <a class="local-button active" href="Monads/#Functional-Programming-in-Lean--Monads" rel="prev" title="4. Monads"><span class="arrow">←</span><span class="where">4. Monads</span></a><a class="local-button active" href="Monads/The-Monad-Type-Class/#Functional-Programming-in-Lean--Monads--The-Monad-Type-Class" rel="next" title="4.2. The Monad Type Class"><span class="where">4.2. The Monad Type Class</span><span class="arrow">→</span></a></nav>
          <section>
            <h1>
              4.1. One API, Many Applications</h1>
            <p>
              All these features and more can be implemented in library code as instances of a common API called <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monad" data-verso-hover="724">Monad</span></code>.
Lean provides dedicated syntax that makes this API convenient to use, but can also get in the way of understanding what is going on behind the scenes.
This chapter begins with the nitty-gritty presentation of manually nesting null checks, and builds from there to the convenient, general API.
Please suspend your disbelief in the meantime.</p>
            <section>
              <h2 id="Functional-Programming-in-Lean--Monads--One-API___-Many-Applications--Checking-for--none-___-Don___t-Repeat-Yourself">
                4.1.1. Checking for <code>none</code>: Don't Repeat Yourself</h2>
              <div class="paragraph">
                <p>
                  In Lean, pattern matching can be used to chain checks for null.
Getting the first entry from a list can just use the optional indexing notation:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-316">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Option.first" data-verso-hover="725">first</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.69" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4928" data-verso-hover="113">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option" data-verso-hover="142">Option</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4928" data-verso-hover="113">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="var token" data-binding="var-_uniq.69" data-verso-hover="137">xs</span><span class="unknown token" data-binding="">[</span><span class="typed token" data-binding="" data-verso-hover="5">0</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">?</span></code></div>
              <div class="paragraph">
                <p>
                  The result must be an <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Option" data-verso-hover="142">Option</span></code> because empty lists have no first entry.
Extracting the first and third entries requires a check that each is not <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span></code>:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-410">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Option.firstThird" data-verso-hover="726">firstThird</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.236" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4928" data-verso-hover="113">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option" data-verso-hover="142">Option</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.4928" data-verso-hover="113">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">×</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4928" data-verso-hover="113">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-465" data-verso-hover="100">match</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.236" data-verso-hover="137">xs</span><span class="unknown token" data-binding="">[</span><span class="typed token" data-binding="" data-verso-hover="5">0</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">?</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-465" data-verso-hover="100">with</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.309" data-verso-hover="121">first</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-522" data-verso-hover="100">match</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.236" data-verso-hover="137">xs</span><span class="unknown token" data-binding="">[</span><span class="typed token" data-binding="" data-verso-hover="5">2</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">?</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-522" data-verso-hover="100">with</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.373" data-verso-hover="121">third</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.309" data-verso-hover="121">first</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.373" data-verso-hover="121">third</span><span class="unknown token" data-binding="">)</span></code><p>
                  Similarly, extracting the first, third, and fifth entries requires more checks that the values are not <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span></code>:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-660">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Option.firstThirdFifth" data-verso-hover="727">firstThirdFifth</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.629" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4928" data-verso-hover="113">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option" data-verso-hover="142">Option</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.4928" data-verso-hover="113">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">×</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4928" data-verso-hover="113">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">×</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4928" data-verso-hover="113">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-726" data-verso-hover="100">match</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.629" data-verso-hover="137">xs</span><span class="unknown token" data-binding="">[</span><span class="typed token" data-binding="" data-verso-hover="5">0</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">?</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-726" data-verso-hover="100">with</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.704" data-verso-hover="121">first</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-783" data-verso-hover="100">match</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.629" data-verso-hover="137">xs</span><span class="unknown token" data-binding="">[</span><span class="typed token" data-binding="" data-verso-hover="5">2</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">?</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-783" data-verso-hover="100">with</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.768" data-verso-hover="121">third</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-846" data-verso-hover="100">match</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.629" data-verso-hover="137">xs</span><span class="unknown token" data-binding="">[</span><span class="typed token" data-binding="" data-verso-hover="5">4</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">?</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-846" data-verso-hover="100">with</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.832" data-verso-hover="121">fifth</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">        </span><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.704" data-verso-hover="121">first</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.768" data-verso-hover="121">third</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.832" data-verso-hover="121">fifth</span><span class="unknown token" data-binding="">)</span></code><p>
                  And adding the seventh entry to this sequence begins to become quite unmanageable:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-1009">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Option.firstThirdFifthSeventh" data-verso-hover="728">firstThirdFifthSeventh</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.1231" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4928" data-verso-hover="113">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option" data-verso-hover="142">Option</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.4928" data-verso-hover="113">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">×</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4928" data-verso-hover="113">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">×</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4928" data-verso-hover="113">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">×</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4928" data-verso-hover="113">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-1088" data-verso-hover="100">match</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1231" data-verso-hover="137">xs</span><span class="unknown token" data-binding="">[</span><span class="typed token" data-binding="" data-verso-hover="5">0</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">?</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-1088" data-verso-hover="100">with</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1308" data-verso-hover="121">first</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-1145" data-verso-hover="100">match</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1231" data-verso-hover="137">xs</span><span class="unknown token" data-binding="">[</span><span class="typed token" data-binding="" data-verso-hover="5">2</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">?</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-1145" data-verso-hover="100">with</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1372" data-verso-hover="121">third</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-1208" data-verso-hover="100">match</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1231" data-verso-hover="137">xs</span><span class="unknown token" data-binding="">[</span><span class="typed token" data-binding="" data-verso-hover="5">4</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">?</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-1208" data-verso-hover="100">with</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1436" data-verso-hover="121">fifth</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">        </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-1277" data-verso-hover="100">match</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1231" data-verso-hover="137">xs</span><span class="unknown token" data-binding="">[</span><span class="typed token" data-binding="" data-verso-hover="5">6</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">?</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-1277" data-verso-hover="100">with</span><span class="inter-text">
</span><span class="inter-text">        </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span><span class="inter-text">
</span><span class="inter-text">        </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1500" data-verso-hover="121">seventh</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">          </span><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.1308" data-verso-hover="121">first</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1372" data-verso-hover="121">third</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1436" data-verso-hover="121">fifth</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1500" data-verso-hover="121">seventh</span><span class="unknown token" data-binding="">)</span></code></div>
              <div class="paragraph">
                <p>
                  The fundamental problem with this code is that it addresses two concerns: extracting the numbers and checking that all of them are present.
The second concern is addressed by copying and pasting the code that handles the <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span></code> case.
It is often good style to lift a repetitive segment into a helper function:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-1466">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Option.M.andThen" data-verso-hover="729">andThen</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.2078" data-verso-hover="730">opt</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option" data-verso-hover="142">Option</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4928" data-verso-hover="113">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.2083" data-verso-hover="731">next</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4928" data-verso-hover="113">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option" data-verso-hover="142">Option</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2075" data-verso-hover="369">β</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option" data-verso-hover="142">Option</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2075" data-verso-hover="369">β</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-1539" data-verso-hover="100">match</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2078" data-verso-hover="730">opt</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-1539" data-verso-hover="100">with</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2116" data-verso-hover="121">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2083" data-verso-hover="731">next</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2116" data-verso-hover="121">x</span></code><p>
                  This helper, which is used similarly to <code>?.</code> in C# and Kotlin, takes care of propagating <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span></code> values.
It takes two arguments: an optional value and a function to apply when the value is not <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span></code>.
If the first argument is <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span></code>, then the helper returns <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span></code>.
If the first argument is not <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span></code>, then the function is applied to the contents of the <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span></code> constructor.</p>
                </div>
              <div class="paragraph">
                <p>
                  Now, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Option.M.firstThird" data-verso-hover="732">firstThird</span></code> can be rewritten to use <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Option.M.andThen" data-verso-hover="729">andThen</span></code> instead of pattern matching:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-1652">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Option.M.firstThird" data-verso-hover="732">firstThird</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.2184" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4928" data-verso-hover="113">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option" data-verso-hover="142">Option</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.4928" data-verso-hover="113">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">×</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4928" data-verso-hover="113">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Monads.Option.M.andThen" data-verso-hover="729">andThen</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2184" data-verso-hover="137">xs</span><span class="unknown token" data-binding="">[</span><span class="typed token" data-binding="" data-verso-hover="5">0</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">?</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-1722">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2275" data-verso-hover="121">first</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Monads.Option.M.andThen" data-verso-hover="729">andThen</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2184" data-verso-hover="137">xs</span><span class="unknown token" data-binding="">[</span><span class="typed token" data-binding="" data-verso-hover="5">2</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">?</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-1752">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2357" data-verso-hover="121">third</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.2275" data-verso-hover="121">first</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2357" data-verso-hover="121">third</span><span class="unknown token" data-binding="">)</span></code><p>
                  In Lean, functions don't need to be enclosed in parentheses when passed as arguments.
The following equivalent definition uses more parentheses and indents the bodies of functions:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-1879">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Option.M.ExplicitParens.firstThird" data-verso-hover="733">firstThird</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.2547" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4928" data-verso-hover="113">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option" data-verso-hover="142">Option</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.4928" data-verso-hover="113">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">×</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4928" data-verso-hover="113">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Monads.Option.M.andThen" data-verso-hover="729">andThen</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2547" data-verso-hover="137">xs</span><span class="unknown token" data-binding="">[</span><span class="typed token" data-binding="" data-verso-hover="5">0</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">?</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-1950">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2638" data-verso-hover="121">first</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-Monads.Option.M.andThen" data-verso-hover="729">andThen</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2547" data-verso-hover="137">xs</span><span class="unknown token" data-binding="">[</span><span class="typed token" data-binding="" data-verso-hover="5">2</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">?</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-1983">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2720" data-verso-hover="121">third</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.2638" data-verso-hover="121">first</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2720" data-verso-hover="121">third</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span></code><p>
                  The <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Option.M.andThen" data-verso-hover="729">andThen</span></code> helper provides a sort of “pipeline” through which values flow, and the version with the somewhat unusual indentation is more suggestive of this fact.
Improving the syntax used to write <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Option.M.andThen" data-verso-hover="729">andThen</span></code> can make these computations even easier to understand.</p>
                </div>
              <section>
                <h3 id="Functional-Programming-in-Lean--Monads--One-API___-Many-Applications--Checking-for--none-___-Don___t-Repeat-Yourself--Infix-Operators">
                  4.1.1.1. Infix Operators</h3>
                <p>
                  In Lean, infix operators can be declared using the <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">infix</span></code>, <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">infixl</span></code>, and <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">infixr</span></code> commands, which create (respectively) non-associative, left-associative, and right-associative operators.
When used multiple times in a row, a <span id="--tech-term-left-associative" class="def-technical-term"><em>left associative</em></span> operator stacks up the opening parentheses on the left side of the expression.
The addition operator <code>+</code> is left associative, so <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Option.M.Fixity.w" data-verso-hover="734">w</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Option.M.Fixity.x" data-verso-hover="735">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Option.M.Fixity.y" data-verso-hover="736">y</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Option.M.Fixity.z" data-verso-hover="737">z</span></code> is equivalent to <code class="hl lean inline" data-lean-context="examples"><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Monads.Option.M.Fixity.w" data-verso-hover="734">w</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Option.M.Fixity.x" data-verso-hover="735">x</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Option.M.Fixity.y" data-verso-hover="736">y</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Option.M.Fixity.z" data-verso-hover="737">z</span><span class="unknown token" data-binding="">)</span></code>.
The exponentiation operator <code>^</code> is right associative, so <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Option.M.Fixity.w" data-verso-hover="734">w</span><span class="inter-text"> </span><span class="unknown token" data-binding="">^</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Option.M.Fixity.x" data-verso-hover="735">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">^</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Option.M.Fixity.y" data-verso-hover="736">y</span><span class="inter-text"> </span><span class="unknown token" data-binding="">^</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Option.M.Fixity.z" data-verso-hover="737">z</span></code> is equivalent to <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Option.M.Fixity.w" data-verso-hover="734">w</span><span class="inter-text"> </span><span class="unknown token" data-binding="">^</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Monads.Option.M.Fixity.x" data-verso-hover="735">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">^</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Monads.Option.M.Fixity.y" data-verso-hover="736">y</span><span class="inter-text"> </span><span class="unknown token" data-binding="">^</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Option.M.Fixity.z" data-verso-hover="737">z</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span></code>.
Comparison operators such as <code>&lt;</code> are non-associative, so <code>x &lt; y &lt; z</code> is a syntax error and requires manual parentheses.</p>
                <div class="paragraph">
                  <p>
                    The following declaration makes <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Option.M.andThen" data-verso-hover="729">andThen</span></code> into an infix operator:</p>
                  <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.infixl-2493">infixl</span><span class="unknown token" data-binding="">:</span><span class="unknown token" data-binding="">55</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="738">" ~~&gt; "</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Option.M.andThen" data-verso-hover="729">andThen</span></code><p>
                    The number following the colon declares the <span id="--tech-term-precedence" class="def-technical-term"><em>precedence</em></span> of the new infix operator.
In ordinary mathematical notation, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Option.M.Fixity.x" data-verso-hover="735">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Option.M.Fixity.y" data-verso-hover="736">y</span><span class="inter-text"> </span><span class="unknown token" data-binding="">*</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Option.M.Fixity.z" data-verso-hover="737">z</span></code> is equivalent to <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Option.M.Fixity.x" data-verso-hover="735">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Monads.Option.M.Fixity.y" data-verso-hover="736">y</span><span class="inter-text"> </span><span class="unknown token" data-binding="">*</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Option.M.Fixity.z" data-verso-hover="737">z</span><span class="unknown token" data-binding="">)</span></code> even though both <code>+</code> and <code>*</code> are left associative.
In Lean, <code>+</code> has precedence 65 and <code>*</code> has precedence 70.
Higher-precedence operators are applied before lower-precedence operators.
According to the declaration of <code>~~&gt;</code>, both <code>+</code> and <code>*</code> have higher precedence, and thus apply first.
Typically, figuring out the most convenient precedences for a group of operators requires some experimentation and a large collection of examples.</p>
                  </div>
                <p>
                  Following the new infix operator is a double arrow <code>=&gt;</code>, which specifies the named function to be used for the infix operator.
Lean's standard library uses this feature to define <code>+</code> and <code>*</code> as infix operators that point at <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-HAdd.hAdd" data-verso-hover="341">HAdd.hAdd</span></code> and <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-HMul.hMul" data-verso-hover="409">HMul.hMul</span></code>, respectively, allowing type classes to be used to overload the infix operators.
Here, however, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Option.M.andThen" data-verso-hover="729">andThen</span></code> is just an ordinary function.</p>
                <div class="paragraph">
                  <p>
                    Having defined an infix operator for <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Option.M.andThen" data-verso-hover="729">andThen</span></code>, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Option.M.firstThirdInfix" data-verso-hover="739">firstThird</span></code> can be rewritten in a way that brings the “pipeline” feeling of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span></code>-checks front and center:</p>
                  <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-2581">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Option.M.firstThirdInfix" data-verso-hover="739">firstThirdInfix</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.4931" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4928" data-verso-hover="113">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option" data-verso-hover="142">Option</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.4928" data-verso-hover="113">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">×</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4928" data-verso-hover="113">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="var token" data-binding="var-_uniq.4931" data-verso-hover="137">xs</span><span class="unknown token" data-binding="">[</span><span class="typed token" data-binding="" data-verso-hover="5">0</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">?</span><span class="inter-text"> </span><span class="unknown token" data-binding="">~~&gt;</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-2652">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.5022" data-verso-hover="121">first</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="var token" data-binding="var-_uniq.4931" data-verso-hover="137">xs</span><span class="unknown token" data-binding="">[</span><span class="typed token" data-binding="" data-verso-hover="5">2</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">?</span><span class="inter-text"> </span><span class="unknown token" data-binding="">~~&gt;</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-2678">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.5104" data-verso-hover="121">third</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.5022" data-verso-hover="121">first</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.5104" data-verso-hover="121">third</span><span class="unknown token" data-binding="">)</span></code><p>
                    This style is much more concise when writing larger functions:</p>
                  <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-2784">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Option.M.firstThirdFifthSeventh" data-verso-hover="740">firstThirdFifthSeventh</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.5294" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4928" data-verso-hover="113">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option" data-verso-hover="142">Option</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.4928" data-verso-hover="113">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">×</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4928" data-verso-hover="113">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">×</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4928" data-verso-hover="113">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">×</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4928" data-verso-hover="113">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="var token" data-binding="var-_uniq.5294" data-verso-hover="137">xs</span><span class="unknown token" data-binding="">[</span><span class="typed token" data-binding="" data-verso-hover="5">0</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">?</span><span class="inter-text"> </span><span class="unknown token" data-binding="">~~&gt;</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-2874">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.5389" data-verso-hover="121">first</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="var token" data-binding="var-_uniq.5294" data-verso-hover="137">xs</span><span class="unknown token" data-binding="">[</span><span class="typed token" data-binding="" data-verso-hover="5">2</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">?</span><span class="inter-text"> </span><span class="unknown token" data-binding="">~~&gt;</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-2900">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.5471" data-verso-hover="121">third</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="var token" data-binding="var-_uniq.5294" data-verso-hover="137">xs</span><span class="unknown token" data-binding="">[</span><span class="typed token" data-binding="" data-verso-hover="5">4</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">?</span><span class="inter-text"> </span><span class="unknown token" data-binding="">~~&gt;</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-2926">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.5553" data-verso-hover="121">fifth</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="var token" data-binding="var-_uniq.5294" data-verso-hover="137">xs</span><span class="unknown token" data-binding="">[</span><span class="typed token" data-binding="" data-verso-hover="5">6</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">?</span><span class="inter-text"> </span><span class="unknown token" data-binding="">~~&gt;</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-2952">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.5635" data-verso-hover="121">seventh</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.5389" data-verso-hover="121">first</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.5471" data-verso-hover="121">third</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.5553" data-verso-hover="121">fifth</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.5635" data-verso-hover="121">seventh</span><span class="unknown token" data-binding="">)</span></code></div>
                </section>
              </section>
            <section>
              <h2 id="Functional-Programming-in-Lean--Monads--One-API___-Many-Applications--Propagating-Error-Messages">
                4.1.2. Propagating Error Messages</h2>
              <p>
                Pure functional languages such as Lean have no built-in exception mechanism for error handling, because throwing or catching an exception is outside of the step-by-step evaluation model for expressions.
However, functional programs certainly need to handle errors.
In the case of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Option.M.firstThirdFifthSeventh" data-verso-hover="740">firstThirdFifthSeventh</span></code>, it is likely relevant for a user to know just how long the list was and where the lookup failed.</p>
              <div class="paragraph">
                <p>
                  This is typically accomplished by defining a datatype that can be either an error or a result, and translating functions with exceptions into functions that return this datatype:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.inductive-3112" data-verso-hover="96">inductive</span><span class="inter-text"> </span><span class="const token" data-binding="const-FakeExcept.Except" data-verso-hover="741">Except</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.6176" data-verso-hover="113">ε</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="sort token" data-binding="" data-verso-hover="50">Type</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.6178" data-verso-hover="113">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="sort token" data-binding="" data-verso-hover="50">Type</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-3153">where</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-FakeExcept.Except.error" data-verso-hover="742">error</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6176" data-verso-hover="113">ε</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-FakeExcept.Except" data-verso-hover="741">Except</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6176" data-verso-hover="113">ε</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6178" data-verso-hover="113">α</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-FakeExcept.Except.ok" data-verso-hover="743">ok</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6178" data-verso-hover="113">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-FakeExcept.Except" data-verso-hover="741">Except</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6176" data-verso-hover="113">ε</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6178" data-verso-hover="113">α</span><span class="inter-text">
</span><span class="keyword token" data-binding="kw-occ-null-3220">deriving</span><span class="inter-text"> </span><span class="const token" data-binding="const-BEq" data-verso-hover="516">BEq</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-Hashable" data-verso-hover="542">Hashable</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-Repr" data-verso-hover="64">Repr</span></code><p>
                  The type variable <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.6176" data-verso-hover="113">ε</span></code> stands for the type of errors that can be produced by the function.
Callers are expected to handle both errors and successes, which makes the type variable <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.6176" data-verso-hover="113">ε</span></code> play a role that is a bit like that of a list of checked exceptions in Java.</p>
                </div>
              <div class="paragraph">
                <p>
                  Similarly to <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Option" data-verso-hover="142">Option</span></code>, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-FakeExcept.Except" data-verso-hover="741">Except</span></code> can be used to indicate a failure to find an entry in a list.
In this case, the error type is a <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-String" data-verso-hover="35">String</span></code>:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-3622">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Err.get" data-verso-hover="744">get</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.7895" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7892" data-verso-hover="369">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.7897" data-verso-hover="5">i</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except" data-verso-hover="745">Except</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7892" data-verso-hover="369">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-3679" data-verso-hover="100">match</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7895" data-verso-hover="137">xs</span><span class="unknown token" data-binding="">[</span><span class="var token" data-binding="var-_uniq.7897" data-verso-hover="5">i</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">?</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-3679" data-verso-hover="100">with</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.error" data-verso-hover="746">Except.error</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-termS!_-3722">s!</span><span class="unknown token" data-binding="">"Index {</span><span class="var token" data-binding="var-_uniq.7897" data-verso-hover="5">i</span><span class="unknown token" data-binding="">} not found (maximum is {</span><span class="var token" data-binding="var-_uniq.7895" data-verso-hover="137">xs</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-List.length" data-verso-hover="140">length</span><span class="inter-text"> </span><span class="unknown token" data-binding="">-</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">1</span><span class="unknown token" data-binding="">})"</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.8167" data-verso-hover="121">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.ok" data-verso-hover="747">Except.ok</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.8167" data-verso-hover="121">x</span></code><p>
                  Looking up an in-bounds value yields an <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-FakeExcept.Except.ok" data-verso-hover="743">Except.ok</span></code>:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-3852">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Err.ediblePlants" data-verso-hover="748">ediblePlants</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">[</span><span class="literal string token" data-binding="" data-verso-hover="749">"ramsons"</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="750">"sea plantain"</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="751">"sea buckthorn"</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="752">"garden nasturtium"</span><span class="unknown token" data-binding="">]</span></code><code class="hl lean block" data-lean-context="examples"><span class="has-info info"><span class="hover-container"><span class="hover-info messages"><code class="message info">Except.ok "sea buckthorn"</code></span></span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.eval-4056" data-verso-hover="7">#eval</span></span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Err.get" data-verso-hover="744">get</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Err.ediblePlants" data-verso-hover="748">ediblePlants</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">2</span></code><div class="information">
                  <pre>Except.ok "sea buckthorn"</pre></div>
                <p>
                  Looking up an out-of-bounds value yields an <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-FakeExcept.Except.error" data-verso-hover="742">Except.error</span></code>:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="has-info info"><span class="hover-container"><span class="hover-info messages"><code class="message info">Except.error "Index 4 not found (maximum is 3)"</code></span></span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.eval-4200" data-verso-hover="7">#eval</span></span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Err.get" data-verso-hover="744">get</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Err.ediblePlants" data-verso-hover="748">ediblePlants</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">4</span></code><div class="information">
                  <pre>Except.error "Index 4 not found (maximum is 3)"</pre></div>
                </div>
              <div class="paragraph">
                <p>
                  A single list lookup can conveniently return a value or an error:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-4273">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Err.first" data-verso-hover="753">first</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.13153" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13150" data-verso-hover="369">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except" data-verso-hover="745">Except</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13150" data-verso-hover="369">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Monads.Err.get" data-verso-hover="744">get</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13153" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">0</span></code><p>
                  However, performing two list lookups requires handling potential failures:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-4388">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Err.firstThird" data-verso-hover="754">firstThird</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.13184" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13181" data-verso-hover="369">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except" data-verso-hover="745">Except</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.13181" data-verso-hover="369">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">×</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13181" data-verso-hover="369">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-4450" data-verso-hover="100">match</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Err.get" data-verso-hover="744">get</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13184" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">0</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-4450" data-verso-hover="100">with</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.error" data-verso-hover="746">Except.error</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13227" data-verso-hover="39">msg</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.error" data-verso-hover="746">Except.error</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13227" data-verso-hover="39">msg</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.ok" data-verso-hover="747">Except.ok</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13250" data-verso-hover="121">first</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-4538" data-verso-hover="100">match</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Err.get" data-verso-hover="744">get</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13184" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">2</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-4538" data-verso-hover="100">with</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.error" data-verso-hover="746">Except.error</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13277" data-verso-hover="39">msg</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.error" data-verso-hover="746">Except.error</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13277" data-verso-hover="39">msg</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.ok" data-verso-hover="747">Except.ok</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13299" data-verso-hover="121">third</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-Except.ok" data-verso-hover="747">Except.ok</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.13250" data-verso-hover="121">first</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13299" data-verso-hover="121">third</span><span class="unknown token" data-binding="">)</span></code><p>
                  Adding another list lookup to the function requires still more error handling:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-4724">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Err.firstThirdFifth" data-verso-hover="755">firstThirdFifth</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.13443" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13440" data-verso-hover="369">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except" data-verso-hover="745">Except</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.13440" data-verso-hover="369">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">×</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13440" data-verso-hover="369">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">×</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13440" data-verso-hover="369">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-4797" data-verso-hover="100">match</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Err.get" data-verso-hover="744">get</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13443" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">0</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-4797" data-verso-hover="100">with</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.error" data-verso-hover="746">Except.error</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13488" data-verso-hover="39">msg</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.error" data-verso-hover="746">Except.error</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13488" data-verso-hover="39">msg</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.ok" data-verso-hover="747">Except.ok</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13511" data-verso-hover="121">first</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-4885" data-verso-hover="100">match</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Err.get" data-verso-hover="744">get</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13443" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">2</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-4885" data-verso-hover="100">with</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.error" data-verso-hover="746">Except.error</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13538" data-verso-hover="39">msg</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.error" data-verso-hover="746">Except.error</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13538" data-verso-hover="39">msg</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.ok" data-verso-hover="747">Except.ok</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13560" data-verso-hover="121">third</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-4979" data-verso-hover="100">match</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Err.get" data-verso-hover="744">get</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13443" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">4</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-4979" data-verso-hover="100">with</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.error" data-verso-hover="746">Except.error</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13587" data-verso-hover="39">msg</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.error" data-verso-hover="746">Except.error</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13587" data-verso-hover="39">msg</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.ok" data-verso-hover="747">Except.ok</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13609" data-verso-hover="121">fifth</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">        </span><span class="const token" data-binding="const-Except.ok" data-verso-hover="747">Except.ok</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.13511" data-verso-hover="121">first</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13560" data-verso-hover="121">third</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13609" data-verso-hover="121">fifth</span><span class="unknown token" data-binding="">)</span></code><p>
                  And one more list lookup begins to become quite unmanageable:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-5190">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Err.firstThirdFifthSeventh" data-verso-hover="756">firstThirdFifthSeventh</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.13818" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13815" data-verso-hover="369">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except" data-verso-hover="745">Except</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.13815" data-verso-hover="369">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">×</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13815" data-verso-hover="369">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">×</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13815" data-verso-hover="369">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">×</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13815" data-verso-hover="369">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-5276" data-verso-hover="100">match</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Err.get" data-verso-hover="744">get</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13818" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">0</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-5276" data-verso-hover="100">with</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.error" data-verso-hover="746">Except.error</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13865" data-verso-hover="39">msg</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.error" data-verso-hover="746">Except.error</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13865" data-verso-hover="39">msg</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.ok" data-verso-hover="747">Except.ok</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13888" data-verso-hover="121">first</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-5364" data-verso-hover="100">match</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Err.get" data-verso-hover="744">get</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13818" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">2</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-5364" data-verso-hover="100">with</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.error" data-verso-hover="746">Except.error</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13915" data-verso-hover="39">msg</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.error" data-verso-hover="746">Except.error</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13915" data-verso-hover="39">msg</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.ok" data-verso-hover="747">Except.ok</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13937" data-verso-hover="121">third</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-5458" data-verso-hover="100">match</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Err.get" data-verso-hover="744">get</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13818" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">4</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-5458" data-verso-hover="100">with</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.error" data-verso-hover="746">Except.error</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13964" data-verso-hover="39">msg</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.error" data-verso-hover="746">Except.error</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13964" data-verso-hover="39">msg</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.ok" data-verso-hover="747">Except.ok</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13986" data-verso-hover="121">fifth</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">        </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-5558" data-verso-hover="100">match</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Err.get" data-verso-hover="744">get</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13818" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">6</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-5558" data-verso-hover="100">with</span><span class="inter-text">
</span><span class="inter-text">        </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.error" data-verso-hover="746">Except.error</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.14013" data-verso-hover="39">msg</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.error" data-verso-hover="746">Except.error</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.14013" data-verso-hover="39">msg</span><span class="inter-text">
</span><span class="inter-text">        </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.ok" data-verso-hover="747">Except.ok</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.14035" data-verso-hover="121">seventh</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">          </span><span class="const token" data-binding="const-Except.ok" data-verso-hover="747">Except.ok</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.13888" data-verso-hover="121">first</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13937" data-verso-hover="121">third</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13986" data-verso-hover="121">fifth</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.14035" data-verso-hover="121">seventh</span><span class="unknown token" data-binding="">)</span></code></div>
              <div class="paragraph">
                <p>
                  Once again, a common pattern can be factored out into a helper.
Each step through the function checks for an error, and only proceeds with the rest of the computation if the result was a success.
A new version of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Err.andThen" data-verso-hover="757">andThen</span></code> can be defined for <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Except" data-verso-hover="745">Except</span></code>:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-5778">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Err.andThen" data-verso-hover="757">andThen</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.14329" data-verso-hover="758">attempt</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except" data-verso-hover="745">Except</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.14307" data-verso-hover="369">e</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.14313" data-verso-hover="759">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.14335" data-verso-hover="760">next</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.14313" data-verso-hover="759">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except" data-verso-hover="745">Except</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.14307" data-verso-hover="369">e</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.14325" data-verso-hover="761">β</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except" data-verso-hover="745">Except</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.14307" data-verso-hover="369">e</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.14325" data-verso-hover="761">β</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-5861" data-verso-hover="100">match</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.14329" data-verso-hover="758">attempt</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-5861" data-verso-hover="100">with</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.error" data-verso-hover="746">Except.error</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.14364" data-verso-hover="762">msg</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.error" data-verso-hover="746">Except.error</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.14364" data-verso-hover="762">msg</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.ok" data-verso-hover="747">Except.ok</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.14388" data-verso-hover="121">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.14335" data-verso-hover="760">next</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.14388" data-verso-hover="121">x</span></code><p>
                  Just as with <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Option" data-verso-hover="142">Option</span></code>, this version of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Err.andThen" data-verso-hover="757">andThen</span></code> allows a more concise definition of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Err.AndThen.firstThird'" data-verso-hover="763">firstThird'</span></code>:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-6030">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Err.AndThen.firstThird'" data-verso-hover="763">firstThird'</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.14469" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.14466" data-verso-hover="369">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except" data-verso-hover="745">Except</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.14466" data-verso-hover="369">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">×</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.14466" data-verso-hover="369">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Monads.Err.andThen" data-verso-hover="757">andThen</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Monads.Err.get" data-verso-hover="744">get</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.14469" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">0</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-6112">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.14504" data-verso-hover="121">first</span><span class="inter-text">  </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Monads.Err.andThen" data-verso-hover="757">andThen</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Monads.Err.get" data-verso-hover="744">get</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.14469" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">2</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-6147">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.14523" data-verso-hover="121">third</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Except.ok" data-verso-hover="747">Except.ok</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.14504" data-verso-hover="121">first</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.14523" data-verso-hover="121">third</span><span class="unknown token" data-binding="">)</span></code></div>
              <div class="paragraph">
                <p>
                  In both the <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Option" data-verso-hover="142">Option</span></code> and <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Except" data-verso-hover="745">Except</span></code> case, there are two repeating patterns: there is the checking of intermediate results at each step, which has been factored out into <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Err.andThen" data-verso-hover="757">andThen</span></code>, and there is the final successful result, which is <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span></code> or <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Except.ok" data-verso-hover="747">Except.ok</span></code>, respectively.
For the sake of convenience, success can be factored out into a helper called <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Err.ok" data-verso-hover="764">ok</span></code>:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-6355">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Err.ok" data-verso-hover="764">ok</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.16108" data-verso-hover="121">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.16098" data-verso-hover="369">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except" data-verso-hover="745">Except</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.16106" data-verso-hover="759">ε</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.16098" data-verso-hover="369">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.ok" data-verso-hover="747">Except.ok</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.16108" data-verso-hover="121">x</span></code><p>
                  Similarly, failure can be factored out into a helper called <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Err.fail" data-verso-hover="765">fail</span></code>:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-6448">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Err.fail" data-verso-hover="765">fail</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.16138" data-verso-hover="766">err</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.16128" data-verso-hover="369">ε</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except" data-verso-hover="745">Except</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.16128" data-verso-hover="369">ε</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.16136" data-verso-hover="759">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.error" data-verso-hover="746">Except.error</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.16138" data-verso-hover="766">err</span></code><p>
                  Using <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Err.ok" data-verso-hover="764">ok</span></code> and <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Err.fail" data-verso-hover="765">fail</span></code> makes <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Err.Eff.get" data-verso-hover="767">get</span></code> a little more readable:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-6572">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Err.Eff.get" data-verso-hover="767">get</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.16162" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.16159" data-verso-hover="369">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.16164" data-verso-hover="5">i</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except" data-verso-hover="745">Except</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.16159" data-verso-hover="369">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-6629" data-verso-hover="100">match</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.16162" data-verso-hover="137">xs</span><span class="unknown token" data-binding="">[</span><span class="var token" data-binding="var-_uniq.16164" data-verso-hover="5">i</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">?</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-6629" data-verso-hover="100">with</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Err.fail" data-verso-hover="765">fail</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-termS!_-6664">s!</span><span class="unknown token" data-binding="">"Index {</span><span class="var token" data-binding="var-_uniq.16164" data-verso-hover="5">i</span><span class="unknown token" data-binding="">} not found (maximum is {</span><span class="var token" data-binding="var-_uniq.16162" data-verso-hover="137">xs</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-List.length" data-verso-hover="140">length</span><span class="inter-text"> </span><span class="unknown token" data-binding="">-</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">1</span><span class="unknown token" data-binding="">})"</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.16434" data-verso-hover="121">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Err.ok" data-verso-hover="764">ok</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.16434" data-verso-hover="121">x</span></code></div>
              <div class="paragraph">
                <p>
                  After adding the infix declaration for <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Err.andThen" data-verso-hover="757">andThen</span></code>, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Err.WithInfix.firstThird" data-verso-hover="768">firstThird</span></code> can be just as concise as the version that returns an <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Option" data-verso-hover="142">Option</span></code>:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.infixl-6271">infixl</span><span class="unknown token" data-binding="">:</span><span class="unknown token" data-binding="">55</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="738">" ~~&gt; "</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Err.andThen" data-verso-hover="757">andThen</span></code><code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-6830">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Err.WithInfix.firstThird" data-verso-hover="768">firstThird</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.16508" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.16505" data-verso-hover="369">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except" data-verso-hover="745">Except</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.16505" data-verso-hover="369">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">×</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.16505" data-verso-hover="369">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Monads.Err.get" data-verso-hover="744">get</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.16508" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">0</span><span class="inter-text"> </span><span class="unknown token" data-binding="">~~&gt;</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-6905">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.16543" data-verso-hover="121">first</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Monads.Err.get" data-verso-hover="744">get</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.16508" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">2</span><span class="inter-text"> </span><span class="unknown token" data-binding="">~~&gt;</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-6933">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.16562" data-verso-hover="121">third</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Monads.Err.ok" data-verso-hover="764">ok</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.16543" data-verso-hover="121">first</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.16562" data-verso-hover="121">third</span><span class="unknown token" data-binding="">)</span></code><p>
                  The technique scales similarly to larger functions:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-7048">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Err.WithInfix.firstThirdFifthSeventh" data-verso-hover="769">firstThirdFifthSeventh</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.17516" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.17513" data-verso-hover="369">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except" data-verso-hover="745">Except</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.17513" data-verso-hover="369">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">×</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.17513" data-verso-hover="369">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">×</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.17513" data-verso-hover="369">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">×</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.17513" data-verso-hover="369">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Monads.Err.get" data-verso-hover="744">get</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.17516" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">0</span><span class="inter-text"> </span><span class="unknown token" data-binding="">~~&gt;</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-7147">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.17555" data-verso-hover="121">first</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Monads.Err.get" data-verso-hover="744">get</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.17516" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">2</span><span class="inter-text"> </span><span class="unknown token" data-binding="">~~&gt;</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-7175">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.17574" data-verso-hover="121">third</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Monads.Err.get" data-verso-hover="744">get</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.17516" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">4</span><span class="inter-text"> </span><span class="unknown token" data-binding="">~~&gt;</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-7203">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.17593" data-verso-hover="121">fifth</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Monads.Err.get" data-verso-hover="744">get</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.17516" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">6</span><span class="inter-text"> </span><span class="unknown token" data-binding="">~~&gt;</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-7231">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.17612" data-verso-hover="121">seventh</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Monads.Err.ok" data-verso-hover="764">ok</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.17555" data-verso-hover="121">first</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.17574" data-verso-hover="121">third</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.17593" data-verso-hover="121">fifth</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.17612" data-verso-hover="121">seventh</span><span class="unknown token" data-binding="">)</span></code></div>
              </section>
            <section>
              <h2 id="logging">
                4.1.3. Logging<span class="permalink-widget inline"><a href="find/?domain=Verso.Genre.Manual.section&name=logging" title="Permalink">🔗</a></span></h2>
              <div class="paragraph">
                <p>
                  A number is even if dividing it by 2 leaves no remainder:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-7411">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.isEven" data-verso-hover="770">isEven</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.22566" data-verso-hover="27">i</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Int" data-verso-hover="28">Int</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Bool" data-verso-hover="40">Bool</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="var token" data-binding="var-_uniq.22566" data-verso-hover="27">i</span><span class="inter-text"> </span><span class="unknown token" data-binding="">%</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="27">2</span><span class="inter-text"> </span><span class="unknown token" data-binding="">==</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="27">0</span></code><p>
                  The function <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Writer.sumAndFindEvens" data-verso-hover="771">sumAndFindEvens</span></code> computes the sum of a list while remembering the even numbers encountered along the way:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-7581">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.sumAndFindEvens" data-verso-hover="771">sumAndFindEvens</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="const token" data-binding="const-Int" data-verso-hover="28">Int</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="const token" data-binding="const-Int" data-verso-hover="28">Int</span><span class="inter-text"> </span><span class="unknown token" data-binding="">×</span><span class="inter-text"> </span><span class="const token" data-binding="const-Int" data-verso-hover="28">Int</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="27">0</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.22983" data-verso-hover="27">i</span><span class="inter-text"> </span><span class="unknown token" data-binding="">::</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.22984" data-verso-hover="772">is</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.let-7669" data-verso-hover="212">let</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.23008" data-verso-hover="772">moreEven</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23009" data-verso-hover="27">sum</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.sumAndFindEvens" data-verso-hover="771">sumAndFindEvens</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.22984" data-verso-hover="772">is</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-termIfThenElse-7716" data-verso-hover="16">if</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.isEven" data-verso-hover="770">isEven</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.22983" data-verso-hover="27">i</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-termIfThenElse-7716" data-verso-hover="16">then</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.22983" data-verso-hover="27">i</span><span class="inter-text"> </span><span class="unknown token" data-binding="">::</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23008" data-verso-hover="772">moreEven</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-termIfThenElse-7716" data-verso-hover="16">else</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23008" data-verso-hover="772">moreEven</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23009" data-verso-hover="27">sum</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.22983" data-verso-hover="27">i</span><span class="unknown token" data-binding="">)</span></code></div>
              <div class="paragraph">
                <p>
                  This function is a simplified example of a common pattern.
Many programs need to traverse a data structure once, while both computing a main result and accumulating some kind of tertiary extra result.
One example of this is logging: a program that is an <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span></code> action can always log to a file on disk, but because the disk is outside of the mathematical world of Lean functions, it becomes much more difficult to prove things about logs based on <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span></code>.
Another example is a function that computes the sum of all the nodes in a tree with an inorder traversal, while simultaneously recording each nodes visited:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-8173">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.inorderSum" data-verso-hover="773">inorderSum</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-BinTree" data-verso-hover="547">BinTree</span><span class="inter-text"> </span><span class="const token" data-binding="const-Int" data-verso-hover="28">Int</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="const token" data-binding="const-Int" data-verso-hover="28">Int</span><span class="inter-text"> </span><span class="unknown token" data-binding="">×</span><span class="inter-text"> </span><span class="const token" data-binding="const-Int" data-verso-hover="28">Int</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-BinTree.leaf" data-verso-hover="548">BinTree.leaf</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="27">0</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-BinTree.branch" data-verso-hover="549">BinTree.branch</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23959" data-verso-hover="774">l</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23960" data-verso-hover="27">x</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23961" data-verso-hover="774">r</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.let-8282" data-verso-hover="212">let</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.23985" data-verso-hover="772">leftVisited</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23986" data-verso-hover="27">leftSum</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.inorderSum" data-verso-hover="773">inorderSum</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23959" data-verso-hover="774">l</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.let-8329" data-verso-hover="212">let</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.24018" data-verso-hover="772">hereVisited</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.24019" data-verso-hover="27">hereSum</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">[</span><span class="var token" data-binding="var-_uniq.23960" data-verso-hover="27">x</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23960" data-verso-hover="27">x</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.let-8372" data-verso-hover="212">let</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.24043" data-verso-hover="772">rightVisited</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.24044" data-verso-hover="27">rightSum</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.inorderSum" data-verso-hover="773">inorderSum</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23961" data-verso-hover="774">r</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.23985" data-verso-hover="772">leftVisited</span><span class="inter-text"> </span><span class="unknown token" data-binding="">++</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.24018" data-verso-hover="772">hereVisited</span><span class="inter-text"> </span><span class="unknown token" data-binding="">++</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.24043" data-verso-hover="772">rightVisited</span><span class="unknown token" data-binding="">,</span><span class="inter-text">
</span><span class="inter-text">     </span><span class="var token" data-binding="var-_uniq.23986" data-verso-hover="27">leftSum</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.24019" data-verso-hover="27">hereSum</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.24044" data-verso-hover="27">rightSum</span><span class="unknown token" data-binding="">)</span></code></div>
              <p>
                Both <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Writer.sumAndFindEvens" data-verso-hover="771">sumAndFindEvens</span></code> and <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Writer.inorderSum" data-verso-hover="773">inorderSum</span></code> have a common repetitive structure.
Each step of computation returns a pair that consists of a list of data that have been saved along with the primary result.
The lists are then appended, and the primary result is computed and paired with the appended lists.
The common structure becomes more apparent with a small rewrite of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Writer.MoreMonadic.sumAndFindEvens" data-verso-hover="775">sumAndFindEvens</span></code> that more cleanly separates the concerns of saving even numbers and computing the sum:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-7867">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.MoreMonadic.sumAndFindEvens" data-verso-hover="775">sumAndFindEvens</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="const token" data-binding="const-Int" data-verso-hover="28">Int</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="const token" data-binding="const-Int" data-verso-hover="28">Int</span><span class="inter-text"> </span><span class="unknown token" data-binding="">×</span><span class="inter-text"> </span><span class="const token" data-binding="const-Int" data-verso-hover="28">Int</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="27">0</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23399" data-verso-hover="27">i</span><span class="inter-text"> </span><span class="unknown token" data-binding="">::</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23400" data-verso-hover="772">is</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.let-7955" data-verso-hover="212">let</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.23424" data-verso-hover="772">moreEven</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23425" data-verso-hover="27">sum</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.MoreMonadic.sumAndFindEvens" data-verso-hover="775">sumAndFindEvens</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23400" data-verso-hover="772">is</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.let-8001" data-verso-hover="212">let</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.23545" data-verso-hover="772">evenHere</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-termIfThenElse-8024" data-verso-hover="16">if</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.isEven" data-verso-hover="770">isEven</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23399" data-verso-hover="27">i</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-termIfThenElse-8024" data-verso-hover="16">then</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="var token" data-binding="var-_uniq.23399" data-verso-hover="27">i</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-termIfThenElse-8024" data-verso-hover="16">else</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.23545" data-verso-hover="772">evenHere</span><span class="inter-text"> </span><span class="unknown token" data-binding="">++</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23424" data-verso-hover="772">moreEven</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23425" data-verso-hover="27">sum</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23399" data-verso-hover="27">i</span><span class="unknown token" data-binding="">)</span></code><p>
                For the sake of clarity, a pair that consists of an accumulated result together with a value can be given its own name:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.structureTk-8548">structure</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.WithLog" data-verso-hover="776">WithLog</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.24534" data-verso-hover="113">logged</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="sort token" data-binding="" data-verso-hover="50">Type</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.24536" data-verso-hover="113">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="sort token" data-binding="" data-verso-hover="50">Type</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-8594">where</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Monads.Writer.WithLog.log" data-verso-hover="777">log</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.24534" data-verso-hover="113">logged</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Monads.Writer.WithLog.val" data-verso-hover="778">val</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.24536" data-verso-hover="113">α</span></code><p>
                Similarly, the process of saving a list of accumulated results while passing a value on to the next step of a computation can be factored out into a helper, once again named <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Writer.andThen" data-verso-hover="779">andThen</span></code>:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-8781">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.andThen" data-verso-hover="779">andThen</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.26090" data-verso-hover="780">result</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.WithLog" data-verso-hover="776">WithLog</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26076" data-verso-hover="113">α</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26080" data-verso-hover="113">β</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.26094" data-verso-hover="781">next</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26080" data-verso-hover="113">β</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.WithLog" data-verso-hover="776">WithLog</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26076" data-verso-hover="113">α</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26088" data-verso-hover="113">γ</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.WithLog" data-verso-hover="776">WithLog</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26076" data-verso-hover="113">α</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26088" data-verso-hover="113">γ</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.let-8869" data-verso-hover="212">let</span><span class="inter-text"> </span><span class="unknown token" data-binding="">{</span><span class="const token" data-binding="const-Monads.Writer.WithLog.log" data-verso-hover="473">log</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26119" data-verso-hover="137">thisOut</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.WithLog.val" data-verso-hover="782">val</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26120" data-verso-hover="190">thisRes</span><span class="unknown token" data-binding="">}</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26090" data-verso-hover="780">result</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.let-8918" data-verso-hover="212">let</span><span class="inter-text"> </span><span class="unknown token" data-binding="">{</span><span class="const token" data-binding="const-Monads.Writer.WithLog.log" data-verso-hover="473">log</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26136" data-verso-hover="137">nextOut</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.WithLog.val" data-verso-hover="783">val</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26137" data-verso-hover="784">nextRes</span><span class="unknown token" data-binding="">}</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26094" data-verso-hover="781">next</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26120" data-verso-hover="190">thisRes</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">{</span><span class="const token" data-binding="const-Monads.Writer.WithLog.log" data-verso-hover="473">log</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26119" data-verso-hover="137">thisOut</span><span class="inter-text"> </span><span class="unknown token" data-binding="">++</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26136" data-verso-hover="137">nextOut</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.WithLog.val" data-verso-hover="783">val</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26137" data-verso-hover="784">nextRes</span><span class="unknown token" data-binding="">}</span></code><p>
                In the case of errors, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Writer.ok" data-verso-hover="785">ok</span></code> represents an operation that always succeeds.
Here, however, it is an operation that simply returns a value without logging anything:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-9070">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.ok" data-verso-hover="785">ok</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.26314" data-verso-hover="190">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26306" data-verso-hover="113">β</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.WithLog" data-verso-hover="776">WithLog</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26312" data-verso-hover="113">α</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26306" data-verso-hover="113">β</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="unknown token" data-binding="">{</span><span class="const token" data-binding="const-Monads.Writer.WithLog.log" data-verso-hover="473">log</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.WithLog.val" data-verso-hover="782">val</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26314" data-verso-hover="190">x</span><span class="unknown token" data-binding="">}</span></code><p>
                Just as <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-FakeExcept.Except" data-verso-hover="741">Except</span></code> provides <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Err.fail" data-verso-hover="765">fail</span></code> as a possibility, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Writer.WithLog" data-verso-hover="776">WithLog</span></code> should allow items to be added to a log.
This has no interesting return value associated with it, so it returns <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span></code>:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-9170">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.save" data-verso-hover="786">save</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.26335" data-verso-hover="121">data</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26333" data-verso-hover="113">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.WithLog" data-verso-hover="776">WithLog</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26333" data-verso-hover="113">α</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">{</span><span class="const token" data-binding="const-Monads.Writer.WithLog.log" data-verso-hover="473">log</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="var token" data-binding="var-_uniq.26335" data-verso-hover="121">data</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.WithLog.val" data-verso-hover="787">val</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">}</span></code><p>
                <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Writer.WithLog" data-verso-hover="776">WithLog</span></code>, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Writer.andThen" data-verso-hover="779">andThen</span></code>, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Writer.ok" data-verso-hover="785">ok</span></code>, and <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Writer.save" data-verso-hover="786">save</span></code> can be used to separate the logging concern from the summing concern in both programs:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-9320">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.WithAndThen.sumAndFindEvens" data-verso-hover="788">sumAndFindEvens</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="const token" data-binding="const-Int" data-verso-hover="28">Int</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.WithLog" data-verso-hover="776">WithLog</span><span class="inter-text"> </span><span class="const token" data-binding="const-Int" data-verso-hover="28">Int</span><span class="inter-text"> </span><span class="const token" data-binding="const-Int" data-verso-hover="28">Int</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.ok" data-verso-hover="785">ok</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="27">0</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26401" data-verso-hover="27">i</span><span class="inter-text"> </span><span class="unknown token" data-binding="">::</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26402" data-verso-hover="772">is</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-Monads.Writer.andThen" data-verso-hover="779">andThen</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-termIfThenElse-9414" data-verso-hover="16">if</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.isEven" data-verso-hover="770">isEven</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26401" data-verso-hover="27">i</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-termIfThenElse-9414" data-verso-hover="16">then</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.save" data-verso-hover="786">save</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26401" data-verso-hover="27">i</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-termIfThenElse-9414" data-verso-hover="16">else</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.ok" data-verso-hover="785">ok</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-9450">fun</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-Monads.Writer.andThen" data-verso-hover="779">andThen</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Monads.Writer.WithAndThen.sumAndFindEvens" data-verso-hover="788">sumAndFindEvens</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26402" data-verso-hover="772">is</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-9493">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26511" data-verso-hover="27">sum</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-Monads.Writer.ok" data-verso-hover="785">ok</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.26401" data-verso-hover="27">i</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26511" data-verso-hover="27">sum</span><span class="unknown token" data-binding="">)</span></code><code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-9590">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.WithAndThen.inorderSum" data-verso-hover="789">inorderSum</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-BinTree" data-verso-hover="547">BinTree</span><span class="inter-text"> </span><span class="const token" data-binding="const-Int" data-verso-hover="28">Int</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.WithLog" data-verso-hover="776">WithLog</span><span class="inter-text"> </span><span class="const token" data-binding="const-Int" data-verso-hover="28">Int</span><span class="inter-text"> </span><span class="const token" data-binding="const-Int" data-verso-hover="28">Int</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-BinTree.leaf" data-verso-hover="548">BinTree.leaf</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.ok" data-verso-hover="785">ok</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="27">0</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-BinTree.branch" data-verso-hover="549">BinTree.branch</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26743" data-verso-hover="774">l</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26744" data-verso-hover="27">x</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26745" data-verso-hover="774">r</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-Monads.Writer.andThen" data-verso-hover="779">andThen</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Monads.Writer.WithAndThen.inorderSum" data-verso-hover="789">inorderSum</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26743" data-verso-hover="774">l</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-9719">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26751" data-verso-hover="27">leftSum</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-Monads.Writer.andThen" data-verso-hover="779">andThen</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Monads.Writer.save" data-verso-hover="786">save</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26744" data-verso-hover="27">x</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-9755">fun</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-Monads.Writer.andThen" data-verso-hover="779">andThen</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Monads.Writer.WithAndThen.inorderSum" data-verso-hover="789">inorderSum</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26745" data-verso-hover="774">r</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-9792">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26768" data-verso-hover="27">rightSum</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-Monads.Writer.ok" data-verso-hover="785">ok</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.26751" data-verso-hover="27">leftSum</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26744" data-verso-hover="27">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26768" data-verso-hover="27">rightSum</span><span class="unknown token" data-binding="">)</span></code><p>
                And, once again, the infix operator helps put focus on the correct steps:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.infixl-9920">infixl</span><span class="unknown token" data-binding="">:</span><span class="unknown token" data-binding="">55</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="738">" ~~&gt; "</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.andThen" data-verso-hover="779">andThen</span></code><code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-10031">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.WithInfix.sumAndFindEvens" data-verso-hover="790">sumAndFindEvens</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="const token" data-binding="const-Int" data-verso-hover="28">Int</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.WithLog" data-verso-hover="776">WithLog</span><span class="inter-text"> </span><span class="const token" data-binding="const-Int" data-verso-hover="28">Int</span><span class="inter-text"> </span><span class="const token" data-binding="const-Int" data-verso-hover="28">Int</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.ok" data-verso-hover="785">ok</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="27">0</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.28600" data-verso-hover="27">i</span><span class="inter-text"> </span><span class="unknown token" data-binding="">::</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.28601" data-verso-hover="772">is</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-termIfThenElse-10117" data-verso-hover="16">if</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.isEven" data-verso-hover="770">isEven</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.28600" data-verso-hover="27">i</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-termIfThenElse-10117" data-verso-hover="16">then</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.save" data-verso-hover="786">save</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.28600" data-verso-hover="27">i</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-termIfThenElse-10117" data-verso-hover="16">else</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.ok" data-verso-hover="785">ok</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">~~&gt;</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-10157">fun</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-Monads.Writer.WithInfix.sumAndFindEvens" data-verso-hover="790">sumAndFindEvens</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.28601" data-verso-hover="772">is</span><span class="inter-text"> </span><span class="unknown token" data-binding="">~~&gt;</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-10194">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.28710" data-verso-hover="27">sum</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-Monads.Writer.ok" data-verso-hover="785">ok</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.28600" data-verso-hover="27">i</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.28710" data-verso-hover="27">sum</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">
</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-10223">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.WithInfix.inorderSum" data-verso-hover="791">inorderSum</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-BinTree" data-verso-hover="547">BinTree</span><span class="inter-text"> </span><span class="const token" data-binding="const-Int" data-verso-hover="28">Int</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.WithLog" data-verso-hover="776">WithLog</span><span class="inter-text"> </span><span class="const token" data-binding="const-Int" data-verso-hover="28">Int</span><span class="inter-text"> </span><span class="const token" data-binding="const-Int" data-verso-hover="28">Int</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-BinTree.leaf" data-verso-hover="548">BinTree.leaf</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.Writer.ok" data-verso-hover="785">ok</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="27">0</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-BinTree.branch" data-verso-hover="549">BinTree.branch</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.29865" data-verso-hover="774">l</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.29866" data-verso-hover="27">x</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.29867" data-verso-hover="774">r</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-Monads.Writer.WithInfix.inorderSum" data-verso-hover="791">inorderSum</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.29865" data-verso-hover="774">l</span><span class="inter-text"> </span><span class="unknown token" data-binding="">~~&gt;</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-10346">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.29873" data-verso-hover="27">leftSum</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-Monads.Writer.save" data-verso-hover="786">save</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.29866" data-verso-hover="27">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">~~&gt;</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-10376">fun</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-Monads.Writer.WithInfix.inorderSum" data-verso-hover="791">inorderSum</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.29867" data-verso-hover="774">r</span><span class="inter-text"> </span><span class="unknown token" data-binding="">~~&gt;</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-10407">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.29890" data-verso-hover="27">rightSum</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-Monads.Writer.ok" data-verso-hover="785">ok</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.29873" data-verso-hover="27">leftSum</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.29866" data-verso-hover="27">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.29890" data-verso-hover="27">rightSum</span><span class="unknown token" data-binding="">)</span></code></section>
            <section>
              <h2 id="numbering-tree-nodes">
                4.1.4. Numbering Tree Nodes<span class="permalink-widget inline"><a href="find/?domain=Verso.Genre.Manual.section&name=numbering-tree-nodes" title="Permalink">🔗</a></span></h2>
              <p>
                An <span id="--tech-term-inorder-numbering" class="def-technical-term"><em>inorder numbering</em></span> of a tree associates each data point in the tree with the step it would be visited at in an inorder traversal of the tree.
For example, consider <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.State.aTree" data-verso-hover="792">aTree</span></code>:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.open-10564" data-verso-hover="240">open</span><span class="inter-text"> </span><span class="unknown token" data-binding="">BinTree</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.in-10564">in</span><span class="inter-text">
</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-10580">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.State.aTree" data-verso-hover="792">aTree</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-BinTree.branch" data-verso-hover="549">branch</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-BinTree.branch" data-verso-hover="549">branch</span><span class="inter-text">
</span><span class="inter-text">       </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-BinTree.branch" data-verso-hover="549">branch</span><span class="inter-text"> </span><span class="const token" data-binding="const-BinTree.leaf" data-verso-hover="548">leaf</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="793">"a"</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-BinTree.branch" data-verso-hover="549">branch</span><span class="inter-text"> </span><span class="const token" data-binding="const-BinTree.leaf" data-verso-hover="548">leaf</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="794">"b"</span><span class="inter-text"> </span><span class="const token" data-binding="const-BinTree.leaf" data-verso-hover="548">leaf</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">       </span><span class="literal string token" data-binding="" data-verso-hover="795">"c"</span><span class="inter-text">
</span><span class="inter-text">       </span><span class="const token" data-binding="const-BinTree.leaf" data-verso-hover="548">leaf</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="literal string token" data-binding="" data-verso-hover="796">"d"</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-BinTree.branch" data-verso-hover="549">branch</span><span class="inter-text"> </span><span class="const token" data-binding="const-BinTree.leaf" data-verso-hover="548">leaf</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="797">"e"</span><span class="inter-text"> </span><span class="const token" data-binding="const-BinTree.leaf" data-verso-hover="548">leaf</span><span class="unknown token" data-binding="">)</span></code><p>
                Its inorder numbering is:</p>
              <div class="information">
                <pre>BinTree.branch
  (BinTree.branch
    (BinTree.branch (BinTree.leaf) (0, "a") (BinTree.branch (BinTree.leaf) (1, "b") (BinTree.leaf)))
    (2, "c")
    (BinTree.leaf))
  (3, "d")
  (BinTree.branch (BinTree.leaf) (4, "e") (BinTree.leaf))</pre></div>
              <div class="paragraph">
                <p>
                  Trees are most naturally processed with recursive functions, but the usual pattern of recursion on trees makes it difficult to compute an inorder numbering.
This is because the highest number assigned anywhere in the left subtree is used to determine the numbering of a node's data value, and then again to determine the starting point for numbering the right subtree.
In an imperative language, this issue can be worked around by using a mutable variable that contains the next number to be assigned.
The following Python program computes an inorder numbering using a mutable variable:</p>
                <pre>class Branch:
    def __init__(self, value, left=None, right=None):
        self.left = left
        self.value = value
        self.right = right
    def __repr__(self):
        return f'Branch({self.value!r}, left={self.left!r}, right={self.right!r})'

def number(tree):
    num = 0
    def helper(t):
        nonlocal num
        if t is None:
            return None
        else:
            new_left = helper(t.left)
            new_value = (num, t.value)
            num += 1
            new_right = helper(t.right)
            return Branch(left=new_left, value=new_value, right=new_right)

    return helper(tree)
</pre><p>
                  The numbering of the Python equivalent of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.State.aTree" data-verso-hover="792">aTree</span></code> is:</p>
                <pre>a_tree = Branch("d",
                left=Branch("c",
                            left=Branch("a", left=None, right=Branch("b")),
                            right=None),
                right=Branch("e"))
</pre><p>
                  and its numbering is:</p>
                <div class="shell-command block">
                  <code class="command"><code class="prompt">&gt;&gt;&gt; </code>number(a_tree)</code></div>
                <pre>Branch((3, 'd'), left=Branch((2, 'c'), left=Branch((0, 'a'), left=None, right=Branch((1, 'b'), left=None, right=None)), right=None), right=Branch((4, 'e'), left=None, right=None))
</pre></div>
              <p>
                Even though Lean does not have mutable variables, a workaround exists.
From the point of view of the rest of the world, the mutable variable can be thought of as having two relevant aspects: its value when the function is called, and its value when the function returns.
In other words, a function that uses a mutable variable can be seen as a function that takes the mutable variable's starting value as an argument, returning a pair of the variable's final value and the function's result.
This final value can then be passed as an argument to the next step.</p>
              <div class="paragraph">
                <p>
                  Just as the Python example uses an outer function that establishes a mutable variable and an inner helper function that changes the variable, a Lean version of the function uses an outer function that provides the variable's starting value and explicitly returns the function's result along with an inner helper function that threads the variable's value while computing the numbered tree:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-10827">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.State.number" data-verso-hover="798">number</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.33065" data-verso-hover="551">t</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-BinTree" data-verso-hover="547">BinTree</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.33063" data-verso-hover="113">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-BinTree" data-verso-hover="547">BinTree</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span><span class="inter-text"> </span><span class="unknown token" data-binding="">×</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.33063" data-verso-hover="113">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-group-10882">let</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-group-10882">rec</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.State.number.helper" data-verso-hover="799">helper</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.33073" data-verso-hover="5">n</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-BinTree" data-verso-hover="547">BinTree</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.33070" data-verso-hover="113">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span><span class="inter-text"> </span><span class="unknown token" data-binding="">×</span><span class="inter-text"> </span><span class="const token" data-binding="const-BinTree" data-verso-hover="547">BinTree</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span><span class="inter-text"> </span><span class="unknown token" data-binding="">×</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.33070" data-verso-hover="113">α</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-BinTree.leaf" data-verso-hover="548">BinTree.leaf</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.33073" data-verso-hover="5">n</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-BinTree.leaf" data-verso-hover="548">BinTree.leaf</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-BinTree.branch" data-verso-hover="549">BinTree.branch</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.33122" data-verso-hover="551">left</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.33123" data-verso-hover="121">x</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.33124" data-verso-hover="551">right</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.let-11036" data-verso-hover="212">let</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.33148" data-verso-hover="5">k</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.33149" data-verso-hover="800">numberedLeft</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.State.number.helper" data-verso-hover="799">helper</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.33073" data-verso-hover="5">n</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.33122" data-verso-hover="551">left</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.let-11081" data-verso-hover="212">let</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.33222" data-verso-hover="5">i</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.33223" data-verso-hover="800">numberedRight</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.State.number.helper" data-verso-hover="799">helper</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.33148" data-verso-hover="5">k</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">1</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.33124" data-verso-hover="551">right</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.33222" data-verso-hover="5">i</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-BinTree.branch" data-verso-hover="549">BinTree.branch</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.33149" data-verso-hover="800">numberedLeft</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.33148" data-verso-hover="5">k</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.33123" data-verso-hover="121">x</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.33223" data-verso-hover="800">numberedRight</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Monads.State.number.helper" data-verso-hover="799">helper</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">0</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.33065" data-verso-hover="551">t</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Prod.snd" data-verso-hover="211">snd</span></code><p>
                  This code, like the <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span></code>-propagating <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Option" data-verso-hover="142">Option</span></code> code, the <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Except.error" data-verso-hover="746">error</span></code>-propagating <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Except" data-verso-hover="745">Except</span></code> code, and the log-accumulating <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Writer.WithLog" data-verso-hover="776">WithLog</span></code> code, commingles two concerns: propagating the value of the counter, and actually traversing the tree to find the result.
Just as in those cases, an <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.State.andThen" data-verso-hover="801">andThen</span></code> helper can be defined to propagate state from one step of a computation to another.
The first step is to give a name to the pattern of taking an input state as an argument and returning an output state together with a value:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-11590">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.State.State" data-verso-hover="802">State</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.36112" data-verso-hover="113">σ</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="sort token" data-binding="" data-verso-hover="50">Type</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.36114" data-verso-hover="113">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="sort token" data-binding="" data-verso-hover="50">Type</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="sort token" data-binding="" data-verso-hover="50">Type</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="var token" data-binding="var-_uniq.36112" data-verso-hover="113">σ</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.36112" data-verso-hover="113">σ</span><span class="inter-text"> </span><span class="unknown token" data-binding="">×</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.36114" data-verso-hover="113">α</span><span class="unknown token" data-binding="">)</span></code></div>
              <div class="paragraph">
                <p>
                  In the case of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.State.State" data-verso-hover="802">State</span></code>, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.State.ok" data-verso-hover="803">ok</span></code> is a function that returns the input state unchanged, along with the provided value:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-12081">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.State.ok" data-verso-hover="803">ok</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.37874" data-verso-hover="121">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37866" data-verso-hover="113">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.State.State" data-verso-hover="802">State</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37872" data-verso-hover="113">σ</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37866" data-verso-hover="113">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-12116">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37885" data-verso-hover="804">s</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.37885" data-verso-hover="804">s</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37874" data-verso-hover="121">x</span><span class="unknown token" data-binding="">)</span></code></div>
              <div class="paragraph">
                <p>
                  When working with a mutable variable, there are two fundamental operations: reading the value and replacing it with a new one.
Reading the current value is accomplished with a function that places the input state unmodified into the output state, and also places it into the value field:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-11692">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.State.get" data-verso-hover="805">get</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.State.State" data-verso-hover="802">State</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.36130" data-verso-hover="113">σ</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.36130" data-verso-hover="113">σ</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-11719">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.36137" data-verso-hover="804">s</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.36137" data-verso-hover="804">s</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.36137" data-verso-hover="804">s</span><span class="unknown token" data-binding="">)</span></code><p>
                  Writing a new value consists of ignoring the input state, and placing the provided new value into the output state:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-11771">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.State.set" data-verso-hover="806">set</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.36152" data-verso-hover="804">s</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.36150" data-verso-hover="113">σ</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.State.State" data-verso-hover="802">State</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.36150" data-verso-hover="113">σ</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-11809">fun</span><span class="inter-text"> </span><span class="unknown token" data-binding="">_</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.36152" data-verso-hover="804">s</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span></code></div>
              <div class="paragraph">
                <p>
                  Finally, two computations that use state can be sequenced by finding both the output state and return value of the first function, then passing them both into the next function:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-11871">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.State.andThen" data-verso-hover="801">andThen</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.36189" data-verso-hover="807">first</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.State.State" data-verso-hover="802">State</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.36175" data-verso-hover="113">σ</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.36179" data-verso-hover="113">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.36193" data-verso-hover="808">next</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.36179" data-verso-hover="113">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.State.State" data-verso-hover="802">State</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.36175" data-verso-hover="113">σ</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.36187" data-verso-hover="113">β</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.State.State" data-verso-hover="802">State</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.36175" data-verso-hover="113">σ</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.36187" data-verso-hover="113">β</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-11952">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.36210" data-verso-hover="804">s</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.let-11965" data-verso-hover="212">let</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.36236" data-verso-hover="804">s'</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.36237" data-verso-hover="121">x</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.36189" data-verso-hover="807">first</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.36210" data-verso-hover="804">s</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="var token" data-binding="var-_uniq.36193" data-verso-hover="808">next</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.36237" data-verso-hover="121">x</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.36236" data-verso-hover="804">s'</span><span class="inter-text">
</span><span class="inter-text">
</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.infixl-12003">infixl</span><span class="unknown token" data-binding="">:</span><span class="unknown token" data-binding="">55</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="738">" ~~&gt; "</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.State.andThen" data-verso-hover="801">andThen</span></code></div>
              <div class="paragraph">
                <p>
                  Using <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.State.State" data-verso-hover="802">State</span></code> and its helpers, local mutable state can be simulated:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-12208">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.State.Monadicish.number" data-verso-hover="809">number</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.37902" data-verso-hover="551">t</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-BinTree" data-verso-hover="547">BinTree</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37900" data-verso-hover="113">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-BinTree" data-verso-hover="547">BinTree</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span><span class="inter-text"> </span><span class="unknown token" data-binding="">×</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37900" data-verso-hover="113">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-group-12263">let</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-group-12263">rec</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.State.Monadicish.number.helper" data-verso-hover="810">helper</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-BinTree" data-verso-hover="547">BinTree</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37907" data-verso-hover="113">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.State.State" data-verso-hover="802">State</span><span class="inter-text"> </span><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-BinTree" data-verso-hover="547">BinTree</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span><span class="inter-text"> </span><span class="unknown token" data-binding="">×</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37907" data-verso-hover="113">α</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-BinTree.leaf" data-verso-hover="548">BinTree.leaf</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monads.State.ok" data-verso-hover="803">ok</span><span class="inter-text"> </span><span class="const token" data-binding="const-BinTree.leaf" data-verso-hover="548">BinTree.leaf</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-BinTree.branch" data-verso-hover="549">BinTree.branch</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37955" data-verso-hover="551">left</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37956" data-verso-hover="121">x</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37957" data-verso-hover="551">right</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-Monads.State.Monadicish.number.helper" data-verso-hover="810">helper</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37955" data-verso-hover="551">left</span><span class="inter-text"> </span><span class="unknown token" data-binding="">~~&gt;</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-12424">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37966" data-verso-hover="800">numberedLeft</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-Monads.State.get" data-verso-hover="805">get</span><span class="inter-text"> </span><span class="unknown token" data-binding="">~~&gt;</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-12458">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37975" data-verso-hover="5">n</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-Monads.State.set" data-verso-hover="806">set</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.37975" data-verso-hover="5">n</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">1</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">~~&gt;</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-12489">fun</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-Monads.State.Monadicish.number.helper" data-verso-hover="810">helper</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37957" data-verso-hover="551">right</span><span class="inter-text"> </span><span class="unknown token" data-binding="">~~&gt;</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-12522">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.38047" data-verso-hover="800">numberedRight</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-Monads.State.ok" data-verso-hover="803">ok</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-BinTree.branch" data-verso-hover="549">BinTree.branch</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37966" data-verso-hover="800">numberedLeft</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.37975" data-verso-hover="5">n</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37956" data-verso-hover="121">x</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.38047" data-verso-hover="800">numberedRight</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Monads.State.Monadicish.number.helper" data-verso-hover="810">helper</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37902" data-verso-hover="551">t</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">0</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">.</span><span class="unknown token" data-binding="">snd</span></code><p>
                  Because <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.State.State" data-verso-hover="802">State</span></code> simulates only a single local variable, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.State.get" data-verso-hover="805">get</span></code> and <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.State.set" data-verso-hover="806">set</span></code> don't need to refer to any particular variable name.</p>
                </div>
              </section>
            <section>
              <h2 id="Functional-Programming-in-Lean--Monads--One-API___-Many-Applications--Monads___-A-Functional-Design-Pattern">
                4.1.5. Monads: A Functional Design Pattern</h2>
              <p>
                Each of these examples has consisted of:</p>
              <ul>
                <li>
                  <p>
                    A polymorphic type, such as <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Option" data-verso-hover="142">Option</span></code>, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-FakeExcept.Except" data-verso-hover="741">Except</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6176" data-verso-hover="113">ε</span></code>, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Writer.WithLog" data-verso-hover="776">WithLog</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.24993" data-verso-hover="113">logged</span></code>, or <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.State.State" data-verso-hover="802">State</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.36130" data-verso-hover="113">σ</span></code></p>
                  </li>
                <li>
                  <p>
                    An operator <code>andThen</code> that takes care of some repetitive aspect of sequencing programs that have this type</p>
                  </li>
                <li>
                  <p>
                    An operator <code>ok</code> that is (in some sense) the most boring way to use the type</p>
                  </li>
                <li>
                  <p>
                    A collection of other operations, such as <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span></code>, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Err.fail" data-verso-hover="765">fail</span></code>, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Writer.save" data-verso-hover="786">save</span></code>, and <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.State.get" data-verso-hover="805">get</span></code>, that name ways of using the type</p>
                  </li>
                </ul>
              <p>
                This style of API is called a <span id="--tech-term-monad" class="def-technical-term"><em>monad</em></span>.
While the idea of monads is derived from a branch of mathematics called category theory, no understanding of category theory is needed in order to use them for programming.
The key idea of monads is that each monad encodes a particular kind of side effect using the tools provided by the pure functional language Lean.
For example, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Option" data-verso-hover="142">Option</span></code> represents programs that can fail by returning <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span></code>, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Except" data-verso-hover="745">Except</span></code> represents programs that can throw exceptions, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.Writer.WithLog" data-verso-hover="776">WithLog</span></code> represents programs that accumulate a log while running, and <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monads.State.State" data-verso-hover="802">State</span></code> represents programs with a single mutable variable.</p>
              </section>
            </section>
          <nav class="prev-next-buttons">
            <a class="local-button active" href="Monads/#Functional-Programming-in-Lean--Monads" rel="prev" title="4. Monads"><span class="arrow">←</span><span class="where">4. Monads</span></a><a class="local-button active" href="Monads/The-Monad-Type-Class/#Functional-Programming-in-Lean--Monads--The-Monad-Type-Class" rel="next" title="4.2. The Monad Type Class"><span class="where">4.2. The Monad Type Class</span><span class="arrow">→</span></a></nav>
          </div>
        </main></div>
    </body>
  </html>

