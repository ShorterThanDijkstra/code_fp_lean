<!DOCTYPE html>
<html>
  <head>
    <script>
      (function(){
  const {protocol:proto, host:hostName, pathname:path, search:srch, hash:hsh} = window.location;
  if (!(path.endsWith("/") || path.endsWith(".html"))) {
    window.location.replace(`${proto}//${hostName}${path}/${srch}${hsh}`);
  }
})()</script>
    <base href="./../../"><meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <title>Combining IO and Reader</title><link rel="stylesheet" href="book.css">
    <script>
      const __versoSiteRoot = document.baseURI;</script>
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js" integrity="sha384-zbcZAIxlvJtNE3Dp5nxLXdXtXyxwOdnILY1TDPVmKFhl4r4nSUG1r8bcFXGVa4Te" crossorigin="anonymous"></script>
    <script src="-verso-data/katex/katex.js"></script>
    <script src="-verso-data/katex/math.js"></script>
    <script src="-verso-data/popper.js"></script>
    <script src="-verso-data/tippy.js"></script>
    <link rel="stylesheet" href="static/theme.css">
    <link rel="stylesheet" href="static/fonts/source-serif/source-serif-text.css">
    <link rel="stylesheet" href="static/fonts/source-code-pro/source-code-pro.css">
    <link rel="stylesheet" href="static/fonts/source-sans/source-sans-3.css">
    <link rel="stylesheet" href="static/fonts/noto-sans-mono/noto-sans-mono.css">
    <link rel="stylesheet" href="-verso-data/katex/katex.css">
    <link rel="stylesheet" href="-verso-data/tippy-border.css">
    <style>
div.paragraph > .eval-steps:not(:first-child), div.paragraph > .eval-steps:not(:first-child) > * {
  margin-top: 0.5rem;
}

div.paragraph > .eval-steps:not(:last-child), div.paragraph > .eval-steps:not(:last-child) > * {
  margin-bottom: 0.5rem;
}

.eval-steps .hl.lean.block {
  margin-top: 0.25em;
  margin-bottom: 0.25em;
}
</style><style>
.shell-command {

}
.shell-command.inline > * {
  display: inline;
  white-space: pre;
}
.shell-command.inline .command::before {
  content: "$ ";
  font-weight: 600;
}
</style><style>
.shell-command {

}
.shell-command.block > * {
  display: block;
  white-space: pre;
}
.shell-command .command .prompt {
  font-weight: 600;
}

div.paragraph > .shell-command:not(:first-child) {
  margin-top: 0.5rem;
}

div.paragraph > .shell-command:not(:last-child) {
  margin-bottom: 0.5rem;
}
</style><style>

.hl.lean {
  white-space: pre;
  font-weight: normal;
  font-style: normal;
}

.hl.lean .keyword {
  font-weight : bold;
}

.hl.lean .var {
  font-style: italic;
  position: relative;
}

.hover-container {
  width: 0;
  height: 0;
  position: relative;
  display: inline;
}

.hl.lean a {
  color: inherit;
  text-decoration: currentcolor underline dotted;
}

.hl.lean a:hover {
  text-decoration: currentcolor underline solid;
}

.hl.lean .hover-info {
  white-space: normal;
}

.hl.lean .token .hover-info {
  display: none;
  position: absolute;
  background-color: #e5e5e5;
  border: 1px solid black;
  padding: 0.5rem;
  z-index: 300;
  font-size: inherit;
}

.hl.lean .hover-info.messages {
  max-height: 10rem;
  overflow-y: auto;
  overflow-x: hidden;
  scrollbar-gutter: stable;
  padding: 0 0.5rem 0 0;
  display: block;
}

.hl.lean .hover-info code {
  white-space: pre-wrap;
}

.hl.lean .hover-info.messages > code {
  padding: 0.5rem;
  display: block;
  width: fit-content;
}

.hl.lean .hover-info.messages > code:only-child {
  margin: 0;
}

.hl.lean .hover-info.messages > code {
  margin: 0.1rem;
}

.hl.lean .hover-info.messages > code:not(:first-child) {
  margin-top: 0rem;
}

/*
@media (hover: hover) {
  .hl.lean .has-info:hover > .hover-container > .hover-info:not(.tactic *),
  .hl.lean .tactic:has(> .tactic-toggle:checked) .has-info:hover > .hover-container > .hover-info,
  .hl.lean .token:hover > .hover-container > .hover-info:not(.has-info *):not(.tactic *),
  .hl.lean .tactic:has(> .tactic-toggle:checked) .token:hover > .hover-container > .hover-info:not(.has-info *) {
    display: inline-block;
    position: absolute;
    top: 1rem;
    font-weight: normal;
    font-style: normal;
    width: min-content;
  }
}
*/

.hl.lean.block {
  display: block;
}

.hl.lean.inline {
  display: inline;
  white-space: pre-wrap;
}

.hl.lean .token {
  transition: all 0.25s; /* Slight fade for highlights */
}

@media (hover: hover) {
  .hl.lean .token.binding-hl, .hl.lean .literal.string:hover, .hl.lean .token.typed:hover {
    background-color: #eee;
    border-radius: 2px;
    transition: none;
  }
}


.hl.lean .has-info .token:not(.tactic-state):not(.tactic-state *), .hl.lean .has-info .inter-text:not(.tactic-state):not(.tactic-state *) {
  text-decoration-style: wavy;
  text-decoration-line: underline;
  text-decoration-thickness: from-font;
}

.hl.lean .has-info .hover-info {
  display: none;
  position: absolute;
  transform: translate(0.25rem, 0.3rem);
  border: 1px solid black;
  padding: 0.5rem;
  z-index: 400;
  text-align: left;
}

.hl.lean .has-info.error :not(.tactic-state):not(.tactic-state *){
  text-decoration-color: red;
}

@media (hover: hover) {
  .hl.lean .has-info.error:hover {
    background-color: #ffb3b3;
  }
}

.hl.lean .hover-info.messages > code.error {
  background-color: #e5e5e5;
  border-left: 0.2rem solid #ffb3b3;
}

.tippy-box[data-theme~='error'] .hl.lean .hover-info.messages > code.error {
  background: none;
  border: none;
}

.error pre {
    color: red;
}

.hl.lean .has-info.warning :not(.tactic-state):not(.tactic-state *) {
  text-decoration-color: var(--verso-warning-color);
}

@media (hover: hover) {
  .hl.lean .has-info.warning:hover {
    background-color:var(--verso-warning-color);
  }
}

.hl.lean .hover-info.messages > code.warning {
  background-color: var(--verso-warning-color);
}

.hl.lean .hover-info.messages > code.error {
  background-color: #e5e5e5;
  border-left: 0.2rem solid var(--verso-warning-color);
}

.tippy-box[data-theme~='warning'] .hl.lean .hover-info.messages > code.warning {
  background: none;
  border: none;
}


.hl.lean .has-info.info :not(.tactic-state):not(.tactic-state *) {
  text-decoration-color: blue;
}

@media (hover: hover) {
  .hl.lean .has-info.info:hover {
    background-color: #4777ff;
  }
}


.hl.lean .hover-info.messages > code.info {
  background-color: #e5e5e5;
  border-left: 0.2rem solid #4777ff;
}

.tippy-box[data-theme~='info'] .hl.lean .hover-info.messages > code.info {
  background: none;
  border: none;
}

.hl.lean div.docstring {
  font-family: sans-serif;
  white-space: normal;
  max-width: 40rem;
  width: max-content;
}

.hl.lean div.docstring > :last-child {
  margin-bottom: 0;
}

.hl.lean div.docstring > :first-child {
  margin-top: 0;
}

.hl.lean .hover-info .sep {
  display: block;
  width: auto;
  margin-left: 1rem;
  margin-right: 1rem;
  margin-top: 0.5rem;
  margin-bottom: 0.5rem;
  padding: 0;
  height: 1px;
  border-top: 1px solid #ccc;
}

.hl.lean code {
  font-family: monospace;
}

.hl.lean .tactic-state {
  display: none;
  position: relative;
  left: 2rem;
  width: fit-content;
  border: 1px solid #888888;
  border-radius: 0.1rem;
  padding: 0.5rem;
  font-family: sans-serif;
  background-color: #ffffff;
  z-index: 200;
}

.hl.lean.popup .tactic-state {
  position: static;
  display: block;
  width: auto;
  border: none;
  padding: 0.5rem;
  font-family: sans-serif;
  background-color: #ffffff;
}


.hl.lean .tactic {
  position: relative;
}

.hl.lean .tactic-toggle:checked ~ .tactic-state {
  display: block;
}

/*
@media (hover: hover) {
  .hl.lean .tactic:hover > .tactic-toggle:not(:checked) ~ .tactic-state {
    display: block;
    position: absolute;
    left: 0;
    transform: translate(0.25rem, 0);
    z-index: 250;
  }
}
*/

.hl.lean .tactic > label {
  position: relative;
  transition: all 0.5s;
}

@media (hover: hover) {
  .hl.lean .tactic > label:hover {
    border-bottom: 1px dotted #bbbbbb;
  }
}

.hl.lean .tactic-toggle {
  position: absolute;
  top: 0;
  left: 0;
  opacity: 0;
  height: 0;
  width: 0;
  z-index: -10;
}

.hl.lean .tactic > label::after {
  content: "";
  border: 1px solid #bbbbbb;
  border-radius: 1rem;
  height: 0.25rem;
  vertical-align: middle;
  width: 0.6rem;
  margin-left: 0.1rem;
  margin-right: 0.1rem;
  display: inline-block;
  transition: all 0.5s;
}

/*
@media (hover: hover) {
  .hl.lean .tactic > label:hover::after {
    border: 1px solid #aaaaaa;
    background-color: #aaaaaa;
    transition: all 0.5s;
  }
}
*/

.hl.lean .tactic > label:has(+ .tactic-toggle:checked)::after {
  border: 1px solid #999999;
  background-color: #999999;
  transition: all 0.5s;
}

.hl.lean .tactic-state .goal + .goal {
  margin-top: 1.5rem;
}

.hl.lean .tactic-state summary {
  margin-left: -0.5rem;
}

.hl.lean .tactic-state details {
  padding-left: 0.5rem;
}

.hl.lean .case-label {
  display: block;
  position: relative;
}

.hl.lean .case-label input[type="checkbox"] {
  position: absolute;
  top: 0;
  left: 0;
  opacity: 0;
  height: 0;
  width: 0;
  z-index: -10;
}

.hl.lean .case-label:has(input[type="checkbox"])::before {
  width: 1rem;
  height: 1rem;
  display: inline-block;
  background-color: black;
  content: ' ';
  transition: ease 0.2s;
  margin-right: 0.7rem;
  clip-path: polygon(100% 0, 0 0, 50% 100%);
  width: 0.6rem;
  height: 0.6rem;
}

.hl.lean .case-label:has(input[type="checkbox"]:not(:checked))::before {
  transform: rotate(-90deg);
}

.hl.lean .case-label:has(input[type="checkbox"]) {

}

.hl.lean .case-label:has(input[type="checkbox"]:checked) {

}


.hl.lean .tactic-state .labeled-case > :not(:first-child) {
  max-height: 0px;
  display: block;
  overflow: hidden;
  transition: max-height 0.1s ease-in;
  margin-left: 0.5rem;
  margin-top: 0.1rem;
}

.hl.lean .labeled-case:has(.case-label input[type="checkbox"]:checked) > :not(:first-child) {
  max-height: 100%;
}


.hl.lean .tactic-state .goal-name::before {
  font-style: normal;
  content: "case ";
}

.hl.lean .tactic-state .goal-name {
  font-style: italic;
  font-family: monospace;
}

.hl.lean .tactic-state .hypotheses {
  display: table;
}

.hl.lean .tactic-state .hypothesis {
  display: table-row;
}

.hl.lean .tactic-state .hypothesis > * {
  display: table-cell;
}


.hl.lean .tactic-state .hypotheses .colon {
  text-align: center;
  min-width: 1rem;
}

.hl.lean .tactic-state .hypotheses .name {
  text-align: right;
}

.hl.lean .tactic-state .hypotheses .name,
.hl.lean .tactic-state .hypotheses .type,
.hl.lean .tactic-state .conclusion .type {
  font-family: monospace;
}

.tippy-box[data-theme~='lean'] {
  background-color: #e5e5e5;
  color: black;
  border: 1px solid black;
}
.tippy-box[data-theme~='lean'][data-placement^='top'] > .tippy-arrow::before {
  border-top-color: #e5e5e5;
}
.tippy-box[data-theme~='lean'][data-placement^='bottom'] > .tippy-arrow::before {
  border-bottom-color: #e5e5e5;
}
.tippy-box[data-theme~='lean'][data-placement^='left'] > .tippy-arrow::before {
  border-left-color: #e5e5e5;
}
.tippy-box[data-theme~='lean'][data-placement^='right'] > .tippy-arrow::before {
  border-right-color: #e5e5e5;
}

.tippy-box[data-theme~='message'][data-placement^='top'] > .tippy-arrow::before {
  border-top-color: #e5e5e5;
  border-width: 11px 11px 0;
}
.tippy-box[data-theme~='message'][data-placement^='top'] > .tippy-arrow::after {
  bottom: -11px;
  border-width: 11px 11px 0;
}
.tippy-box[data-theme~='message'][data-placement^='bottom'] > .tippy-arrow::before {
  border-width: 0 11px 11px;
}
.tippy-box[data-theme~='message'][data-placement^='bottom'] > .tippy-arrow::after {
  top: -11px;
  border-width: 0 11px 11px;
}
.tippy-box[data-theme~='message'][data-placement^='left'] > .tippy-arrow::before {
  border-left-color: #e5e5e5;
  border-width: 11px 0 11px 11px;
}
.tippy-box[data-theme~='message'][data-placement^='left'] > .tippy-arrow::after {
  right: -11px;
  border-width: 11px 0 11px 11px;
}

.tippy-box[data-theme~='message'][data-placement^='right'] > .tippy-arrow::before {
  border-right-color: #e5e5e5;
  border-width: 11px 11px 11px 0;
}
.tippy-box[data-theme~='message'][data-placement^='right'] > .tippy-arrow::after {
  left: -11px;
  border-width: 11px 11px 11px 0;
}



.tippy-box[data-theme~='warning'] {
  background-color: #e5e5e5;
  color: black;
  border: 3px solid var(--verso-warning-color);
}

.tippy-box[data-theme~='error'] {
  background-color: #e5e5e5;
  color: black;
  border: 3px solid #f7a7af;
}

.tippy-box[data-theme~='info'] {
  background-color: #e5e5e5;
  color: black;
  border: 3px solid #99b3c2;
}

.tippy-box[data-theme~='tactic'] {
  background-color: white;
  color: black;
  border: 1px solid black;
}
.tippy-box[data-theme~='tactic'][data-placement^='top'] > .tippy-arrow::before {
  border-top-color: white;
}
.tippy-box[data-theme~='tactic'][data-placement^='bottom'] > .tippy-arrow::before {
  border-bottom-color: white;
}
.tippy-box[data-theme~='tactic'][data-placement^='left'] > .tippy-arrow::before {
  border-left-color: white;
}
.tippy-box[data-theme~='tactic'][data-placement^='right'] > .tippy-arrow::before {
  border-right-color: white;
}

</style><style>
.example-file {
  white-space: normal;
  font-family: var(--verso-structure-font-family);
  margin: 1rem;
  width: fit-content;
  border: 1px solid #ddd;
  padding: 0.5rem;

  /* These are necessary for the container to behave nicely on mobile */
  overflow-x: auto;
  max-width: 100%;
  box-sizing: border-box;
}
.example-file::before {
  counter-reset: linenumber;
}
.example-file > .line {
  display: block;
  white-space: pre;
  counter-increment: linenumber;
  font-family: var(--verso-code-font-family);
}
.example-file > .line::before {
  -webkit-user-select: none;
  display: inline-block;
  content: counter(linenumber);
  border-right: 1px solid #ddd;
  width: 2em;
  padding-right: 0.25em;
  margin-right: 0.25em;
  font-family: var(--verso-code-font-family);
  text-align: right;
}
.example-file > .line::after {
  -webkit-user-select: none;
  display: inline-block;
  content: "‚èé";
  opacity: 0;
}
.example-file > .line:hover::after {
  opacity: 1;
}
.example-file > .line:hover, .example-file > .line:hover::before {
  background-color: #eee;
}
.example-file > .empty {
  display: block;
  white-space: pre;
  font-family: var(--verso-code-font-family);
  font-style: italic;
}
.example-file > .empty::before {
  -webkit-user-select: none;
  display: inline-block;
  content: "";
  border-right: 1px solid #ddd;
  width: 2em;
  padding-right: 0.25em;
  margin-right: 0.25em;
  font-family: var(--verso-code-font-family);
  text-align: right;
}
</style><style>
table.tabular {
  margin: auto;
  border-spacing: 1rem;
}
table.tabular.left-align {
  margin-right: auto;
  margin-left: 0;
}
table.tabular.center-align {
  margin: auto;
}
table.tabular.right-align {
  margin-left auto;
  margin-right: 0;
}
table.tabular td, table.tabular th {
  text-align: left;
  vertical-align: top;
}
table.tabular td > p:first-child, table.tabular th > p:first-child {
  margin-top: 0;
}
table.tabular td > p:last-child, table.tabular th > p:first-child {
  margin-bottom: 0;
}
</style><style>
.shell-commands {

}
.shell-commands > * {
  display: block;
  white-space: pre;
}
.shell-commands .command::before {
  content: "$ ";
  font-weight: 600;
}

div.paragraph > .shell-commands:not(:first-child) {
  margin-top: 0.5rem;
}

div.paragraph > .shell-commands:not(:last-child) {
  margin-bottom: 0.5rem;
}
</style><style>
.eq-steps .hl.lean.block {
  background-color: #f6f7f6;
  padding: 1rem;
  margin-top: 0.25rem;
  margin-bottom: 0.25rem;
}
.eq-steps .reason {
  font-style: italic;
  margin-left: 2.5em;
  display: flex;
}
.eq-steps .reason::before {
  content: "={";
  font-family: var(--verso-code-font-family);
  font-style: normal;
  font-weight: 600;
  margin-right: 0.5em;
  align-self: center;
}
.eq-steps .reason > p {
  margin: 0;
  max-width: 25em;
  align-self: center;
}
.eq-steps .reason::after {
  content: "}=";
  font-family: var(--verso-code-font-family);
  font-style: normal;
  font-weight: 600;
  margin-left: 1em;
  align-self: center;
}
</style><style>
div.paragraph > .eq-steps:not(:first-child) {
  margin-top: 0.5rem;
}

div.paragraph > .eq-steps:not(:last-child) {
  margin-bottom: 0.5rem;
}
</style><script>
      
window.onload = () => {

    // Don't show hovers inside of closed tactic states
    function blockedByTactic(elem) {
      let parent = elem.parentNode;
      while (parent && "classList" in parent) {
        if (parent.classList.contains("tactic")) {
          const toggle = parent.querySelector("input.tactic-toggle");
          if (toggle) {
            return !toggle.checked;
          }
        }
        parent = parent.parentNode;
      }
      return false;
    }

    function blockedByTippy(elem) {
      // Don't show a new hover until the old ones are all closed.
      // Scoped to the nearest "top-level block" to avoid being O(n) in the size of the document.
      var block = elem;
      const topLevel = new Set(["section", "body", "html", "nav", "header"]);
      while (block.parentNode && !topLevel.has(block.parentNode.nodeName.toLowerCase())) {
        block = block.parentNode;
      }
      for (const child of block.querySelectorAll(".token, .has-info")) {
        if (child._tippy && child._tippy.state.isVisible) { return true };
      }
      return false;
    }

    for (const c of document.querySelectorAll(".hl.lean .token")) {
        if (c.dataset.binding != "") {
            c.addEventListener("mouseover", (event) => {
                if (blockedByTactic(c)) {return;}
                const context = c.closest(".hl.lean").dataset.leanContext;
                for (const example of document.querySelectorAll(".hl.lean")) {
                    if (example.dataset.leanContext == context) {
                        for (const tok of example.querySelectorAll(".token")) {
                            if (c.dataset.binding == tok.dataset.binding) {
                                tok.classList.add("binding-hl");
                            }
                        }
                    }
                }
            });
        }
        c.addEventListener("mouseout", (event) => {
            for (const tok of document.querySelectorAll(".hl.lean .token")) {
                tok.classList.remove("binding-hl");
            }
        });
    }
    /* Render docstrings */
    if ('undefined' !== typeof marked) {
        for (const d of document.querySelectorAll("code.docstring, pre.docstring")) {
            const str = d.innerText;
            const html = marked.parse(str);
            const rendered = document.createElement("div");
            rendered.classList.add("docstring");
            rendered.innerHTML = html;
            d.parentNode.replaceChild(rendered, d);
        }
    }
    // Add hovers
    let siteRoot = typeof __versoSiteRoot !== 'undefined' ? __versoSiteRoot : "/";
    let docsJson = siteRoot + "-verso-docs.json";
    fetch(docsJson).then((resp) => resp.json()).then((versoDocData) => {

      function hideParentTooltips(element) {
        let parent = element.parentElement;
        while (parent) {
          const tippyInstance = parent._tippy;
          if (tippyInstance) {
            tippyInstance.hide();
          }
          parent = parent.parentElement;
        }
      }



      const defaultTippyProps = {
        /* DEBUG -- remove the space: * /
        onHide(any) { return false; },
        trigger: "click",
        // */
        /* theme: "lean", */
        maxWidth: "none",
        appendTo: () => document.body,
        interactive: true,
        delay: [100, null],
        /* ignoreAttributes: true, */
        followCursor: 'initial',
        onShow(inst) {
          if (inst.reference.className == 'tactic') {

            const toggle = inst.reference.querySelector("input.tactic-toggle");
            if (toggle && toggle.checked) {
              return false;
            }
            hideParentTooltips(inst.reference);
            //if (blockedByTippy(inst.reference)) { return false; }

          } else if (inst.reference.querySelector(".hover-info") || "versoHover" in inst.reference.dataset) {
            if (blockedByTactic(inst.reference)) { return false };
            if (blockedByTippy(inst.reference)) { return false; }
          } else { // Nothing to show here!
            return false;
          }
        },
        content (tgt) {
          const content = document.createElement("span");
          if (tgt.className == 'tactic') {
            const state = tgt.querySelector(".tactic-state").cloneNode(true);
            state.style.display = "block";
            content.appendChild(state);
            content.style.display = "block";
            content.className = "hl lean popup";
          } else {
            content.className = "hl lean";
            content.style.display = "block";
            content.style.maxHeight = "300px";
            content.style.overflowY = "auto";
            content.style.overflowX = "hidden";
            const hoverId = tgt.dataset.versoHover;
            const hoverInfo = tgt.querySelector(".hover-info");
            if (hoverId) { // Docstrings from the table
              // TODO stop doing an implicit conversion from string to number here
              let data = versoDocData[hoverId];
              if (data) {
                const info = document.createElement("span");
                info.className = "hover-info";
                info.style.display = "block";
                info.innerHTML = data;
                content.appendChild(info);
                /* Render docstrings - TODO server-side */
                if ('undefined' !== typeof marked) {
                    for (const d of content.querySelectorAll("code.docstring, pre.docstring")) {
                        const str = d.innerText;
                        const html = marked.parse(str);
                        const rendered = document.createElement("div");
                        rendered.classList.add("docstring");
                        rendered.innerHTML = html;
                        d.parentNode.replaceChild(rendered, d);
                    }
                }
              } else {
                content.innerHTML = "Failed to load doc ID: " + hoverId;
              }
            } else if (hoverInfo) { // The inline info, still used for compiler messages
              content.appendChild(hoverInfo.cloneNode(true));
            }
          }
          return content;
        }
      };



      const addTippy = (selector, props) => {
        tippy(selector, Object.assign({}, defaultTippyProps, props));
      };
      document.querySelectorAll('.hl.lean .const.token, .hl.lean .keyword.token, .hl.lean .literal.token, .hl.lean .option.token, .hl.lean .var.token, .hl.lean .typed.token').forEach(element => {
        element.setAttribute('data-tippy-theme', 'lean');
      });
      document.querySelectorAll('.hl.lean .has-info.warning').forEach(element => {
        element.setAttribute('data-tippy-theme', 'warning message');
      });
      document.querySelectorAll('.hl.lean .has-info.info').forEach(element => {
        element.setAttribute('data-tippy-theme', 'info message');
      });
      document.querySelectorAll('.hl.lean .has-info.error').forEach(element => {
        element.setAttribute('data-tippy-theme', 'error message');
      });
      document.querySelectorAll('.hl.lean .tactic').forEach(element => {
        element.setAttribute('data-tippy-theme', 'tactic');
      });
      let insts = tippy('.hl.lean .const.token, .hl.lean .keyword.token, .hl.lean .literal.token, .hl.lean .option.token, .hl.lean .var.token, .hl.lean .typed.token, .hl.lean .has-info, .hl.lean .tactic', defaultTippyProps);



      /*
      tippy('.hl.lean .tactic', {
        allowHtml: true,

        onHide(any) { return false; },
        trigger: "click",

        maxWidth: "none",
        onShow(inst) {
          const toggle = inst.reference.querySelector("input.tactic-toggle");
          if (toggle && toggle.checked) {
            return false;
          }
          if (blockedByTippy(inst.reference)) { return false; }
        },
        content (tgt) {
          const content = document.createElement("span");
          const state = tgt.querySelector(".tactic-state").cloneNode(true);
          state.style.display = "block";
          content.appendChild(state);
          content.style.display = "block";
          content.className = "hl lean popup";
          return content;
        }
      });
      */
  });
}
</script>
    </head>
  <body>
    <header>
      <div class="header-logo-wrapper">
        <a href="" id="logo"><img src="static/lean_logo.svg"></a></div>
      <div class="header-title-wrapper">
        <a href="" class="header-title"><h1>
            Functional Programming in Lean</h1>
          </a></div>
      </header>
    <label for="toggle-toc" id="toggle-toc-click"><span class="line line1"></span><span class="line line2"></span><span class="line line3"></span></label><div class="with-toc">
      <div class="toc-backdrop" onclick="document.getElementById('toggle-toc-click')?.click()"></div>
      <nav id="toc">
        <input type="checkbox" id="toggle-toc"><div class="first">
          <a href="" class="toc-title"><h1>
              Functional Programming in Lean</h1>
            </a><div class="split-tocs">
            <div class="split-toc book">
              <div class="title">
                <label for="--verso-manual-toc-----bookRoot" class="toggle-split-toc"><input type="checkbox" class="toggle-split-toc" id="--verso-manual-toc-----bookRoot"></label><span class="">Table of Contents</span></div>
              <table><tr class="unnumbered"><td class="num"><td><a href="Introduction/#Functional-Programming-in-Lean--Introduction">Introduction</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="Acknowledgments/#Functional-Programming-in-Lean--Acknowledgments">Acknowledgments</a></td></tr><tr class="numbered"><td class="num">1.</td><td><a href="Getting-to-Know-Lean/#getting-to-know">Getting to Know Lean</a></td></tr><tr class="numbered"><td class="num">2.</td><td><a href="Hello___-World___/#hello-world">Hello, World!</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="Interlude___-Propositions___-Proofs___-and-Indexing/#props-proofs-indexing">Interlude: Propositions, Proofs, and Indexing</a></td></tr><tr class="numbered"><td class="num">3.</td><td><a href="Overloading-and-Type-Classes/#Functional-Programming-in-Lean--Overloading-and-Type-Classes">Overloading and Type Classes</a></td></tr><tr class="numbered"><td class="num">4.</td><td><a href="Monads/#Functional-Programming-in-Lean--Monads">Monads</a></td></tr><tr class="numbered"><td class="num">5.</td><td><a href="Functors___-Applicative-Functors___-and-Monads/#Functional-Programming-in-Lean--Functors___-Applicative-Functors___-and-Monads">Functors, Applicative Functors, and Monads</a></td></tr><tr class="current numbered"><td class="num">6.</td><td><a href="Monad-Transformers/#Functional-Programming-in-Lean--Monad-Transformers">Monad Transformers</a></td></tr><tr class="numbered"><td class="num">7.</td><td><a href="Programming-with-Dependent-Types/#Functional-Programming-in-Lean--Programming-with-Dependent-Types">Programming with Dependent Types</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="Interlude___-Tactics___-Induction___-and-Proofs/#Functional-Programming-in-Lean--Interlude___-Tactics___-Induction___-and-Proofs">Interlude: Tactics, Induction, and Proofs</a></td></tr><tr class="numbered"><td class="num">8.</td><td><a href="Programming___-Proving___-and-Performance/#Functional-Programming-in-Lean--Programming___-Proving___-and-Performance">Programming, Proving, and Performance</a></td></tr><tr class="numbered"><td class="num">9.</td><td><a href="Next-Steps/#next-steps">Next Steps</a></td></tr></table></div>
            <div class="split-toc">
              <div class="title">
                <label for="--verso-manual-toc-Functional-Programming-in-Lean--Monad-Transformers" class="toggle-split-toc"><input type="checkbox" class="toggle-split-toc" id="--verso-manual-toc-Functional-Programming-in-Lean--Monad-Transformers" checked="checked"></label><span class="number">6.</span>¬†<span class=""><a href="Monad-Transformers/#Functional-Programming-in-Lean--Monad-Transformers">Monad Transformers</a></span></div>
              <table><tr class="current numbered"><td class="num">6.1.</td><td><a href="Monad-Transformers/Combining-IO-and-Reader/#Functional-Programming-in-Lean--Monad-Transformers--Combining-IO-and-Reader">Combining IO and Reader</a></td></tr><tr class="numbered"><td class="num">6.2.</td><td><a href="Monad-Transformers/A-Monad-Construction-Kit/#Functional-Programming-in-Lean--Monad-Transformers--A-Monad-Construction-Kit">A Monad Construction Kit</a></td></tr><tr class="numbered"><td class="num">6.3.</td><td><a href="Monad-Transformers/Ordering-Monad-Transformers/#Functional-Programming-in-Lean--Monad-Transformers--Ordering-Monad-Transformers">Ordering Monad Transformers</a></td></tr><tr class="numbered"><td class="num">6.4.</td><td><a href="Monad-Transformers/More-do-Features/#Functional-Programming-in-Lean--Monad-Transformers--More-do-Features">More do Features</a></td></tr><tr class="numbered"><td class="num">6.5.</td><td><a href="Monad-Transformers/Additional-Conveniences/#Functional-Programming-in-Lean--Monad-Transformers--Additional-Conveniences">Additional Conveniences</a></td></tr><tr class="numbered"><td class="num">6.6.</td><td><a href="Monad-Transformers/Summary/#Functional-Programming-in-Lean--Monad-Transformers--Summary">Summary</a></td></tr></table></div>
            <div class="split-toc">
              <div class="title">
                <label for="--verso-manual-toc-Functional-Programming-in-Lean--Monad-Transformers--Combining-IO-and-Reader" class="toggle-split-toc"><input type="checkbox" class="toggle-split-toc" id="--verso-manual-toc-Functional-Programming-in-Lean--Monad-Transformers--Combining-IO-and-Reader" checked="checked"></label><span class="number">6.1.</span>¬†<span class="current"><a href="Monad-Transformers/Combining-IO-and-Reader/#Functional-Programming-in-Lean--Monad-Transformers--Combining-IO-and-Reader">Combining IO and Reader</a></span></div>
              <table><tr class="numbered"><td class="num">6.1.1.</td><td><a href="Monad-Transformers/Combining-IO-and-Reader/#reader-io-implementation">Implementation</a></td></tr><tr class="numbered"><td class="num">6.1.2.</td><td><a href="Monad-Transformers/Combining-IO-and-Reader/#Functional-Programming-in-Lean--Monad-Transformers--Combining-IO-and-Reader--Using-a-Custom-Monad">Using a Custom Monad</a></td></tr><tr class="numbered"><td class="num">6.1.3.</td><td><a href="Monad-Transformers/Combining-IO-and-Reader/#Functional-Programming-in-Lean--Monad-Transformers--Combining-IO-and-Reader--Adding-a-Reader-to-Any-Monad">Adding a Reader to Any Monad</a></td></tr><tr class="numbered"><td class="num">6.1.4.</td><td><a href="Monad-Transformers/Combining-IO-and-Reader/#Functional-Programming-in-Lean--Monad-Transformers--Combining-IO-and-Reader--Exercises">Exercises</a></td></tr></table></div>
            </div>
          </div>
        <div class="last">
          <ul id="meta-links">
            <li>
              <a href="https://github.com/leanprover/fp-lean">Source Code</a></li>
            <li>
              <a href="https://github.com/leanprover/fp-lean/issues">Report Issues</a></li>
            </ul>
          </div>
        </nav>
      <main><div class="content-wrapper">
          <nav class="prev-next-buttons">
            <a class="local-button active" href="Monad-Transformers/#Functional-Programming-in-Lean--Monad-Transformers" rel="prev" title="6. Monad Transformers"><span class="arrow">‚Üê</span><span class="where">6. Monad Transformers</span></a><a class="local-button active" href="Monad-Transformers/A-Monad-Construction-Kit/#Functional-Programming-in-Lean--Monad-Transformers--A-Monad-Construction-Kit" rel="next" title="6.2. A Monad Construction Kit"><span class="where">6.2. A Monad Construction Kit</span><span class="arrow">‚Üí</span></a></nav>
          <section>
            <h1>
              6.1.¬†Combining IO and Reader</h1>
            <p>
              One case where a reader monad can be useful is when there is some notion of the ‚Äúcurrent configuration‚Äù of the application that is passed through many recursive calls.
An example of such a program is <code>tree</code>, which recursively prints the files in the current directory and its subdirectories, indicating their tree structure using characters.
The version of <code>tree</code> in this chapter, called <code>doug</code> after the mighty Douglas Fir tree that adorns the west coast of North America, provides the option of Unicode box-drawing characters or their ASCII equivalents when indicating directory structure.</p>
            <p>
              For example, the following commands create a directory structure and some empty files in a directory called <code>doug-demo</code>:</p>
            <div class="shell-commands">
              <code class="command">cd doug-demo</code><code class="command">mkdir -p a/b/c</code><code class="command">mkdir -p a/d</code><code class="command">mkdir -p a/e/f</code><code class="command">touch a/b/hello</code><code class="command">touch a/d/another-file</code><code class="command">touch a/e/still-another-file-again</code></div>
            <p>
              Running <code>doug</code> results in the following:</p>
            <div class="shell-commands">
              <code class="command">doug</code><code class="output">‚îú‚îÄ‚îÄ doug-demo/
‚îÇ   ‚îú‚îÄ‚îÄ a/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ b/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ c/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hello
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ d/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ another-file
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ e/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ f/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ still-another-file-again
</code></div>
            <section>
              <h2 id="reader-io-implementation">
                6.1.1.¬†Implementation<span class="permalink-widget inline"><a href="find/?domain=Verso.Genre.Manual.section&name=reader-io-implementation" title="Permalink">üîó</a></span></h2>
              <p>
                Internally, <code>doug</code> passes a configuration value downwards as it recursively traverses the directory structure.
This configuration contains two fields: <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Config.useASCII" data-verso-hover="1273">useASCII</span></code> determines whether to use Unicode box-drawing characters or ASCII vertical line and dash characters to indicate structure, and <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Config.currentPrefix" data-verso-hover="1274">currentPrefix</span></code> contains a string to prepend to each line of output.
As the current directory deepens, the prefix string accumulates indicators of being in a directory.
The configuration is a structure:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.structureTk-180">structure</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Config" data-verso-hover="1275">Config</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-197">where</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-DirTree.Config.useASCII" data-verso-hover="1273">useASCII</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Bool" data-verso-hover="40">Bool</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="const token" data-binding="const-Bool.false" data-verso-hover="19">false</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-DirTree.Config.currentPrefix" data-verso-hover="1274">currentPrefix</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="207">""</span></code><p>
                This structure has default definitions for both fields.
The default <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Config" data-verso-hover="1275">Config</span></code> uses Unicode display with no prefix.</p>
              <div class="paragraph">
                <p>
                  Users who invoke <code>doug</code> will need to be able to provide command-line arguments.
The usage information is as follows:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-1107">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.usage" data-verso-hover="1276">usage</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="literal string token" data-binding="" data-verso-hover="1277">"Usage: doug [--ascii]
Options:
\t--ascii\tUse ASCII characters to display the directory structure"</span></code><p>
                  Accordingly, a configuration can be constructed by examining a list of command-line arguments:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-909">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.configFromArgs" data-verso-hover="1278">configFromArgs</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="inter-text"> </span><span class="unknown token" data-binding="">‚Üí</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option" data-verso-hover="142">Option</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Config" data-verso-hover="1275">Config</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span><span class="inter-text"> </span><span class="unknown token" data-binding="">{</span><span class="unknown token" data-binding="">}</span><span class="inter-text"> -- both fields default</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="literal string token" data-binding="" data-verso-hover="1279">"--ascii"</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span><span class="inter-text"> </span><span class="unknown token" data-binding="">{</span><span class="const token" data-binding="const-DirTree.Config.useASCII" data-verso-hover="1015">useASCII</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="const token" data-binding="const-Bool.true" data-verso-hover="97">true</span><span class="unknown token" data-binding="">}</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">_</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span></code></div>
              <p>
                The <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Old.main" data-verso-hover="1280">main</span></code> function is a wrapper around an inner worker, called <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Old.dirTree" data-verso-hover="1281">dirTree</span></code>, that shows the contents of a directory using a configuration.
Before calling <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Old.dirTree" data-verso-hover="1281">dirTree</span></code>, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Old.main" data-verso-hover="1280">main</span></code> is responsible for processing command-line arguments.
It must also return the appropriate exit code to the operating system:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-2714">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Old.main" data-verso-hover="1280">main</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.3278" data-verso-hover="315">args</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span><span class="inter-text"> </span><span class="const token" data-binding="const-UInt32" data-verso-hover="314">UInt32</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-2759">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doMatch-2764">match</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.configFromArgs" data-verso-hover="1278">configFromArgs</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3278" data-verso-hover="315">args</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doMatch-2764">with</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3325" data-verso-hover="1282">config</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-DirTree.Old.dirTree" data-verso-hover="1281">dirTree</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3325" data-verso-hover="1282">config</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">‚Üê</span><span class="inter-text"> </span><span class="const token" data-binding="const-IO.currentDir" data-verso-hover="1283">IO.currentDir</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="313">0</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-IO.eprintln" data-verso-hover="1284">IO.eprintln</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-termS!_-2892">s!</span><span class="unknown token" data-binding="">"Didn't understand argument(s) {</span><span class="literal string token" data-binding="" data-verso-hover="30">" "</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-String.separate" data-verso-hover="1285">separate</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3278" data-verso-hover="315">args</span><span class="unknown token" data-binding="">}\n"</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-IO.eprintln" data-verso-hover="1284">IO.eprintln</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.usage" data-verso-hover="1276">usage</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="313">1</span></code><p>
                <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-IO.eprintln" data-verso-hover="1284">IO.eprintln</span></code> is a version of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-IO.println" data-verso-hover="250">IO.println</span></code> that outputs to standard error.</p>
              <p>
                Not all paths should be shown in the directory tree.
In particular, files named <code>.</code> or <code>..</code> should be skipped, as they are actually features used for navigation rather than files <em>per se</em>.
Of those files that should be shown, there are two kinds: ordinary files and directories:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.inductive-1271" data-verso-hover="96">inductive</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Entry" data-verso-hover="1286">Entry</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-1287">where</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Entry.file" data-verso-hover="1287">file</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="inter-text"> </span><span class="unknown token" data-binding="">‚Üí</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Entry" data-verso-hover="1286">Entry</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Entry.dir" data-verso-hover="1288">dir</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="inter-text"> </span><span class="unknown token" data-binding="">‚Üí</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Entry" data-verso-hover="1286">Entry</span></code><p>
                To determine whether a file should be shown, along with which kind of entry it is, <code>doug</code> uses <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.toEntry" data-verso-hover="1289">toEntry</span></code>:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-1390">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.toEntry" data-verso-hover="1289">toEntry</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.1567" data-verso-hover="303">path</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-System.FilePath" data-verso-hover="304">System.FilePath</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Option" data-verso-hover="142">Option</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Entry" data-verso-hover="1286">Entry</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-1450">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doMatch-1455">match</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1567" data-verso-hover="303">path</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-System.FilePath.components" data-verso-hover="1290">components</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-List.getLast?" data-verso-hover="696">getLast?</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doMatch-1455">with</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-DirTree.Entry.dir" data-verso-hover="1288">.dir</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="207">""</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1291">"."</span><span class="inter-text"> </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1292">".."</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1765" data-verso-hover="39">name</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-termIfThenElse-1596" data-verso-hover="16">if</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">‚Üê</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1567" data-verso-hover="303">path</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-System.FilePath.isDir" data-verso-hover="1293">isDir</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-termIfThenElse-1596" data-verso-hover="16">then</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Entry.dir" data-verso-hover="1288">.dir</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1765" data-verso-hover="39">name</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-termIfThenElse-1596" data-verso-hover="16">else</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Entry.file" data-verso-hover="1287">.file</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1765" data-verso-hover="39">name</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span></code><p>
                <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-System.FilePath.components" data-verso-hover="1290">System.FilePath.components</span></code> converts a path into a list of path components, splitting the name at directory separators.
If there is no last component, then the path is the root directory.
If the last component is a special navigation file (<code>.</code> or <code>..</code>), then the file should be excluded.
Otherwise, directories and files are wrapped in the corresponding constructors.</p>
              <p>
                Lean's logic has no way to know that directory trees are finite.
Indeed, some systems allow the construction of circular directory structures.
Thus, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Old.dirTree" data-verso-hover="1281">dirTree</span></code> is declared <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">partial</span></code>:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.partial-2294">partial</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-2302">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Old.dirTree" data-verso-hover="1281">dirTree</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.2819" data-verso-hover="1282">cfg</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Config" data-verso-hover="1275">Config</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.2821" data-verso-hover="303">path</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-System.FilePath" data-verso-hover="304">System.FilePath</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-2367">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doMatch-2372">match</span><span class="inter-text"> </span><span class="unknown token" data-binding="">‚Üê</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.toEntry" data-verso-hover="1289">toEntry</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2821" data-verso-hover="303">path</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doMatch-2372">with</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-DirTree.Entry.file" data-verso-hover="1287">.file</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2974" data-verso-hover="39">name</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Old.showFileName" data-verso-hover="1294">showFileName</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2819" data-verso-hover="1282">cfg</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2974" data-verso-hover="39">name</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-DirTree.Entry.dir" data-verso-hover="1288">.dir</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2990" data-verso-hover="39">name</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-DirTree.Old.showDirName" data-verso-hover="1295">showDirName</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2819" data-verso-hover="1282">cfg</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2990" data-verso-hover="39">name</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLetArrow-2520">let</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3074" data-verso-hover="1296">contents</span><span class="inter-text"> </span><span class="unknown token" data-binding="">‚Üê</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2821" data-verso-hover="303">path</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-System.FilePath.readDir" data-verso-hover="1297">readDir</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLet-2554">let</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3078" data-verso-hover="1282">newConfig</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2819" data-verso-hover="1282">cfg</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DirTree.Config.inDirectory" data-verso-hover="1298">inDirectory</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-DirTree.doList" data-verso-hover="1299">doList</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.3074" data-verso-hover="1296">contents</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Array.qsort" data-verso-hover="1300">qsort</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Old.dirLT" data-verso-hover="1301">dirLT</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Array.toList" data-verso-hover="1302">toList</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-2628">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3117" data-verso-hover="1303">d</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-DirTree.Old.dirTree" data-verso-hover="1281">dirTree</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3078" data-verso-hover="1282">newConfig</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3117" data-verso-hover="1303">d</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-IO.FS.DirEntry.path" data-verso-hover="1304">path</span></code><p>
                The call to <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.toEntry" data-verso-hover="1289">toEntry</span></code> is a <a href="Hello___-World___/Additional-Conveniences/#nested-actions">nested action</a>‚Äîthe parentheses are optional in positions where the arrow couldn't have any other meaning, such as <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">match</span></code>.
When the filename doesn't correspond to an entry in the tree (e.g. because it is <code>..</code>), <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Old.dirTree" data-verso-hover="1281">dirTree</span></code> does nothing.
When the filename points to an ordinary file, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Old.dirTree" data-verso-hover="1281">dirTree</span></code> calls a helper to show it with the current configuration.
When the filename points to a directory, it is shown with a helper, and then its contents are recursively shown in a new configuration in which the prefix has been extended to account for being in a new directory.
The contents of the directory are sorted in order to make the output deterministic, compared according to <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Readerish.dirLT" data-verso-hover="1305">dirLT</span></code></p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-4113">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Readerish.dirLT" data-verso-hover="1305">dirLT</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.4773" data-verso-hover="1303">e1</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-IO.FS.DirEntry" data-verso-hover="1306">IO.FS.DirEntry</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.4775" data-verso-hover="1303">e2</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="const token" data-binding="const-IO.FS.DirEntry" data-verso-hover="1306">IO.FS.DirEntry</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Bool" data-verso-hover="40">Bool</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="var token" data-binding="var-_uniq.4773" data-verso-hover="1303">e1</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-IO.FS.DirEntry.fileName" data-verso-hover="1307">fileName</span><span class="inter-text"> </span><span class="unknown token" data-binding="">&lt;</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4775" data-verso-hover="1303">e2</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-IO.FS.DirEntry.fileName" data-verso-hover="1307">fileName</span></code><p>
                Showing the names of files and directories is achieved with <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Old.showFileName" data-verso-hover="1294">showFileName</span></code> and <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Old.showDirName" data-verso-hover="1295">showDirName</span></code>:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-1903">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Old.showFileName" data-verso-hover="1294">showFileName</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.2638" data-verso-hover="1282">cfg</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Config" data-verso-hover="1275">Config</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.2640" data-verso-hover="39">file</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-1964">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-IO.println" data-verso-hover="250">IO.println</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.2638" data-verso-hover="1282">cfg</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DirTree.Config.fileName" data-verso-hover="1308">fileName</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2640" data-verso-hover="39">file</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">
</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-2001">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Old.showDirName" data-verso-hover="1295">showDirName</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.2704" data-verso-hover="1282">cfg</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Config" data-verso-hover="1275">Config</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.2706" data-verso-hover="39">dir</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-2060">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-IO.println" data-verso-hover="250">IO.println</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.2704" data-verso-hover="1282">cfg</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DirTree.Config.dirName" data-verso-hover="1309">dirName</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2706" data-verso-hover="39">dir</span><span class="unknown token" data-binding="">)</span></code><p>
                Both of these helpers delegate to functions on <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Config" data-verso-hover="1275">Config</span></code> that take the ASCII vs Unicode setting into account:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-306">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Config.preFile" data-verso-hover="1310">Config.preFile</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.346" data-verso-hover="1282">cfg</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Config" data-verso-hover="1275">Config</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-termIfThenElse-345" data-verso-hover="16">if</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.346" data-verso-hover="1282">cfg</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DirTree.Config.useASCII" data-verso-hover="1273">useASCII</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-termIfThenElse-345" data-verso-hover="16">then</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1311">"|--"</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-termIfThenElse-345" data-verso-hover="16">else</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1312">"‚îú‚îÄ‚îÄ"</span><span class="inter-text">
</span><span class="inter-text">
</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-390">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Config.preDir" data-verso-hover="1313">Config.preDir</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.447" data-verso-hover="1282">cfg</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Config" data-verso-hover="1275">Config</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-termIfThenElse-428" data-verso-hover="16">if</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.447" data-verso-hover="1282">cfg</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DirTree.Config.useASCII" data-verso-hover="1273">useASCII</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-termIfThenElse-428" data-verso-hover="16">then</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1314">"|  "</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-termIfThenElse-428" data-verso-hover="16">else</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1315">"‚îÇ  "</span><span class="inter-text">
</span><span class="inter-text">
</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-469">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Config.fileName" data-verso-hover="1308">Config.fileName</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.548" data-verso-hover="1282">cfg</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Config" data-verso-hover="1275">Config</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.550" data-verso-hover="39">file</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-termS!_-534">s!</span><span class="unknown token" data-binding="">"{</span><span class="var token" data-binding="var-_uniq.548" data-verso-hover="1282">cfg</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DirTree.Config.currentPrefix" data-verso-hover="1274">currentPrefix</span><span class="unknown token" data-binding="">}{</span><span class="var token" data-binding="var-_uniq.548" data-verso-hover="1282">cfg</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DirTree.Config.preFile" data-verso-hover="1310">preFile</span><span class="unknown token" data-binding="">} {</span><span class="var token" data-binding="var-_uniq.550" data-verso-hover="39">file</span><span class="unknown token" data-binding="">}"</span><span class="inter-text">
</span><span class="inter-text">
</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-579">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Config.dirName" data-verso-hover="1309">Config.dirName</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.727" data-verso-hover="1282">cfg</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Config" data-verso-hover="1275">Config</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.729" data-verso-hover="39">dir</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-termS!_-642">s!</span><span class="unknown token" data-binding="">"{</span><span class="var token" data-binding="var-_uniq.727" data-verso-hover="1282">cfg</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DirTree.Config.currentPrefix" data-verso-hover="1274">currentPrefix</span><span class="unknown token" data-binding="">}{</span><span class="var token" data-binding="var-_uniq.727" data-verso-hover="1282">cfg</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DirTree.Config.preFile" data-verso-hover="1310">preFile</span><span class="unknown token" data-binding="">} {</span><span class="var token" data-binding="var-_uniq.729" data-verso-hover="39">dir</span><span class="unknown token" data-binding="">}/"</span></code><p>
                Similarly, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Config.inDirectory" data-verso-hover="1298">Config.inDirectory</span></code> extends the prefix with a directory marker:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-736">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Config.inDirectory" data-verso-hover="1298">Config.inDirectory</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.906" data-verso-hover="1282">cfg</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Config" data-verso-hover="1275">Config</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Config" data-verso-hover="1275">Config</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">{</span><span class="var token" data-binding="var-_uniq.906" data-verso-hover="1282">cfg</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-789">with</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Config.currentPrefix" data-verso-hover="465">currentPrefix</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.906" data-verso-hover="1282">cfg</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DirTree.Config.preDir" data-verso-hover="1313">preDir</span><span class="inter-text"> </span><span class="unknown token" data-binding="">++</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="30">" "</span><span class="inter-text"> </span><span class="unknown token" data-binding="">++</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.906" data-verso-hover="1282">cfg</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DirTree.Config.currentPrefix" data-verso-hover="1274">currentPrefix</span><span class="unknown token" data-binding="">}</span></code><p>
                Iterating an IO action over a list of directory contents is achieved using <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.doList" data-verso-hover="1299">doList</span></code>.
Because <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.doList" data-verso-hover="1299">doList</span></code> carries out all the actions in a list and does not base control-flow decisions on the values returned by any of the actions, the full power of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monad" data-verso-hover="724">Monad</span></code> is not necessary, and it will work for any <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Applicative" data-verso-hover="1008">Applicative</span></code>:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-1692">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.doList" data-verso-hover="1299">doList</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="const token" data-binding="const-Applicative" data-verso-hover="1008">Applicative</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2164" data-verso-hover="868">f</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2175" data-verso-hover="759">Œ±</span><span class="inter-text"> </span><span class="unknown token" data-binding="">‚Üí</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.2175" data-verso-hover="759">Œ±</span><span class="inter-text"> </span><span class="unknown token" data-binding="">‚Üí</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2164" data-verso-hover="868">f</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">‚Üí</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2164" data-verso-hover="868">f</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="unknown token" data-binding="">_</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2300" data-verso-hover="121">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">::</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2301" data-verso-hover="137">xs</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2302" data-verso-hover="1316">action</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="var token" data-binding="var-_uniq.2302" data-verso-hover="1316">action</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2300" data-verso-hover="121">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">*&gt;</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-DirTree.doList" data-verso-hover="1299">doList</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2301" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2302" data-verso-hover="1316">action</span></code></section>
            <section>
              <h2 id="Functional-Programming-in-Lean--Monad-Transformers--Combining-IO-and-Reader--Using-a-Custom-Monad">
                6.1.2.¬†Using a Custom Monad</h2>
              <p>
                While this implementation of <code>doug</code> works, manually passing the configuration around is verbose and error-prone.
The type system will not catch it if the wrong configuration is passed downwards, for instance.
A reader effect ensures that the same configuration is passed to all recursive calls, unless it is manually overridden, and it helps make the code less verbose.</p>
              <p>
                To create a version of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span></code> that is also a reader of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Config" data-verso-hover="1275">Config</span></code>, first define the type and its <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monad" data-verso-hover="724">Monad</span></code> instance, following the recipe from <a href="Monads/Example___-Arithmetic-in-Monads/#custom-environments">the evaluator example</a>:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-3084">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Readerish.ConfigIO" data-verso-hover="1317">ConfigIO</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.3799" data-verso-hover="113">Œ±</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="sort token" data-binding="" data-verso-hover="50">Type</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="sort token" data-binding="" data-verso-hover="50">Type</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-DirTree.Config" data-verso-hover="1275">Config</span><span class="inter-text"> </span><span class="unknown token" data-binding="">‚Üí</span><span class="inter-text"> </span><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3799" data-verso-hover="113">Œ±</span><span class="inter-text">
</span><span class="inter-text">
</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.instance-3139">instance</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monad" data-verso-hover="724">Monad</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Readerish.ConfigIO" data-verso-hover="1317">ConfigIO</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.whereStructInst-3165">where</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="1318">pure</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3866" data-verso-hover="584">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-3183">fun</span><span class="inter-text"> </span><span class="unknown token" data-binding="">_</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3866" data-verso-hover="584">x</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Bind.bind" data-verso-hover="1319">bind</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4016" data-verso-hover="1320">result</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4019" data-verso-hover="1321">next</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-3221">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4024" data-verso-hover="1282">cfg</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-3232">do</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLetArrow-3239">let</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4080" data-verso-hover="584">v</span><span class="inter-text"> </span><span class="unknown token" data-binding="">‚Üê</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4016" data-verso-hover="1320">result</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4024" data-verso-hover="1282">cfg</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="var token" data-binding="var-_uniq.4019" data-verso-hover="1321">next</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4080" data-verso-hover="584">v</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4024" data-verso-hover="1282">cfg</span></code><p>
                The difference between this <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monad" data-verso-hover="724">Monad</span></code> instance and the one for <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Reader" data-verso-hover="936">Reader</span></code> is that this one uses <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code>-notation in the <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span></code> monad as the body of the function that <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Bind.bind" data-verso-hover="1319">bind</span></code> returns, rather than applying <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.4019" data-verso-hover="1321">next</span></code> directly to the value returned from <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.4016" data-verso-hover="1320">result</span></code>.
Any <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span></code> effects performed by <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.4016" data-verso-hover="1320">result</span></code> must occur before <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.4019" data-verso-hover="1321">next</span></code> is invoked, which is ensured by the <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span></code> monad's <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Bind.bind" data-verso-hover="1319">bind</span></code> operator.
<code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Readerish.ConfigIO" data-verso-hover="1317">ConfigIO</span></code> is not universe polymorphic because the underlying <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span></code> type is also not universe polymorphic.</p>
              <p>
                Running a <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Readerish.ConfigIO" data-verso-hover="1317">ConfigIO</span></code> action involves transforming it into an <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span></code> action by providing it with a configuration:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-3324">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Readerish.ConfigIO.run" data-verso-hover="1322">ConfigIO.run</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.4403" data-verso-hover="1323">action</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Readerish.ConfigIO" data-verso-hover="1317">ConfigIO</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4401" data-verso-hover="113">Œ±</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.4405" data-verso-hover="1282">cfg</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Config" data-verso-hover="1275">Config</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4401" data-verso-hover="113">Œ±</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="var token" data-binding="var-_uniq.4403" data-verso-hover="1323">action</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4405" data-verso-hover="1282">cfg</span></code><p>
                This function is not really necessary, as a caller could simply provide the configuration directly.
However, naming the operation can make it easier to see which parts of the code are intended to run in which monad.</p>
              <p>
                The next step is to define a means of accessing the current configuration as part of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Readerish.ConfigIO" data-verso-hover="1317">ConfigIO</span></code>:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-3456">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Readerish.currentConfig" data-verso-hover="1324">currentConfig</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Readerish.ConfigIO" data-verso-hover="1317">ConfigIO</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Config" data-verso-hover="1275">Config</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-3497">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4426" data-verso-hover="1282">cfg</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4426" data-verso-hover="1282">cfg</span></code><p>
                This is just like <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-read" data-verso-hover="937">read</span></code> from <a href="Monads/Example___-Arithmetic-in-Monads/#custom-environments">the evaluator example</a>, except it uses <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span></code>'s <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Pure.pure" data-verso-hover="1318">pure</span></code> to return its value rather than doing so directly.
Because entering a directory modifies the current configuration for the scope of a recursive call, it will be necessary to have a way to override a configuration:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-3567">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Readerish.locally" data-verso-hover="1325">locally</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.4499" data-verso-hover="1326">change</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Config" data-verso-hover="1275">Config</span><span class="inter-text"> </span><span class="unknown token" data-binding="">‚Üí</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Config" data-verso-hover="1275">Config</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.4501" data-verso-hover="1323">action</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Readerish.ConfigIO" data-verso-hover="1317">ConfigIO</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4495" data-verso-hover="113">Œ±</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Readerish.ConfigIO" data-verso-hover="1317">ConfigIO</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4495" data-verso-hover="113">Œ±</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-3650">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4512" data-verso-hover="1282">cfg</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4501" data-verso-hover="1323">action</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.4499" data-verso-hover="1326">change</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4512" data-verso-hover="1282">cfg</span><span class="unknown token" data-binding="">)</span></code><p>
                Much of the code used in <code>doug</code> has no need for configurations, and <code>doug</code> calls ordinary Lean <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span></code> actions from the standard library that certainly don't need a <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Config" data-verso-hover="1275">Config</span></code>.
Ordinary <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span></code> actions can be run using <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Readerish.runIO" data-verso-hover="1327">runIO</span></code>, which ignores the configuration argument:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-3723">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Readerish.runIO" data-verso-hover="1327">runIO</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.4530" data-verso-hover="1328">action</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4528" data-verso-hover="113">Œ±</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Readerish.ConfigIO" data-verso-hover="1317">ConfigIO</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4528" data-verso-hover="113">Œ±</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-3769">fun</span><span class="inter-text"> </span><span class="unknown token" data-binding="">_</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4530" data-verso-hover="1328">action</span></code><p>
                With these components, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Readerish.showFileName" data-verso-hover="1329">showFileName</span></code> and <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Readerish.showDirName" data-verso-hover="1330">showDirName</span></code> can be updated to take their configuration arguments implicitly through the <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Readerish.ConfigIO" data-verso-hover="1317">ConfigIO</span></code> monad.
They use <a href="Hello___-World___/Additional-Conveniences/#nested-actions">nested actions</a> to retrieve the configuration, and <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Readerish.runIO" data-verso-hover="1327">runIO</span></code> to actually execute the call to <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-IO.println" data-verso-hover="250">IO.println</span></code>:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-3834">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Readerish.showFileName" data-verso-hover="1329">showFileName</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.4549" data-verso-hover="39">file</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Readerish.ConfigIO" data-verso-hover="1317">ConfigIO</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-3886">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-DirTree.Readerish.runIO" data-verso-hover="1327">runIO</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-IO.println" data-verso-hover="250">IO.println</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">‚Üê</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Readerish.currentConfig" data-verso-hover="1324">currentConfig</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DirTree.Config.fileName" data-verso-hover="1308">fileName</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4549" data-verso-hover="39">file</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">
</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-3947">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Readerish.showDirName" data-verso-hover="1330">showDirName</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.4661" data-verso-hover="39">dir</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Readerish.ConfigIO" data-verso-hover="1317">ConfigIO</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-3997">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-DirTree.Readerish.runIO" data-verso-hover="1327">runIO</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-IO.println" data-verso-hover="250">IO.println</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">‚Üê</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Readerish.currentConfig" data-verso-hover="1324">currentConfig</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DirTree.Config.dirName" data-verso-hover="1309">dirName</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4661" data-verso-hover="39">dir</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span></code><p>
                In the new version of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Readerish.dirTree" data-verso-hover="1331">dirTree</span></code>, the calls to <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.toEntry" data-verso-hover="1289">toEntry</span></code> and <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-System.FilePath.readDir" data-verso-hover="1297">readDir</span></code> are wrapped in <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Readerish.runIO" data-verso-hover="1327">runIO</span></code>.
Additionally, instead of building a new configuration and then requiring the programmer to keep track of which one to pass to recursive calls, it uses <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Readerish.locally" data-verso-hover="1325">locally</span></code> to naturally delimit the modified configuration to only a small region of the program, in which it is the <em>only</em> valid configuration:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.partial-4257">partial</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-4265">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Readerish.dirTree" data-verso-hover="1331">dirTree</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.4822" data-verso-hover="303">path</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-System.FilePath" data-verso-hover="304">System.FilePath</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Readerish.ConfigIO" data-verso-hover="1317">ConfigIO</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-4321">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doMatch-4326">match</span><span class="inter-text"> </span><span class="unknown token" data-binding="">‚Üê</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Readerish.runIO" data-verso-hover="1327">runIO</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-DirTree.toEntry" data-verso-hover="1289">toEntry</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4822" data-verso-hover="303">path</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doMatch-4326">with</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-DirTree.Entry.file" data-verso-hover="1287">.file</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4975" data-verso-hover="39">name</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Readerish.showFileName" data-verso-hover="1329">showFileName</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4975" data-verso-hover="39">name</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-DirTree.Entry.dir" data-verso-hover="1288">.dir</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4993" data-verso-hover="39">name</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-DirTree.Readerish.showDirName" data-verso-hover="1330">showDirName</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4993" data-verso-hover="39">name</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLetArrow-4484">let</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.5082" data-verso-hover="1296">contents</span><span class="inter-text"> </span><span class="unknown token" data-binding="">‚Üê</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Readerish.runIO" data-verso-hover="1327">runIO</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4822" data-verso-hover="303">path</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-System.FilePath.readDir" data-verso-hover="1297">readDir</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-DirTree.Readerish.locally" data-verso-hover="1325">locally</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">¬∑</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DirTree.Config.inDirectory" data-verso-hover="1298">inDirectory</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">        </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-DirTree.doList" data-verso-hover="1299">doList</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.5082" data-verso-hover="1296">contents</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Array.qsort" data-verso-hover="1300">qsort</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Readerish.dirLT" data-verso-hover="1305">dirLT</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Array.toList" data-verso-hover="1302">toList</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-4597">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.5129" data-verso-hover="1303">d</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">          </span><span class="const token" data-binding="const-DirTree.Readerish.dirTree" data-verso-hover="1331">dirTree</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.5129" data-verso-hover="1303">d</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-IO.FS.DirEntry.path" data-verso-hover="1304">path</span><span class="unknown token" data-binding="">)</span></code><p>
                The new version of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Readerish.main" data-verso-hover="1332">main</span></code> uses <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Readerish.ConfigIO.run" data-verso-hover="1322">ConfigIO.run</span></code> to invoke <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Readerish.dirTree" data-verso-hover="1331">dirTree</span></code> with the initial configuration:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-4679">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Readerish.main" data-verso-hover="1332">main</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.5274" data-verso-hover="315">args</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span><span class="inter-text"> </span><span class="const token" data-binding="const-UInt32" data-verso-hover="314">UInt32</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-4724">do</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doMatch-4731">match</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.configFromArgs" data-verso-hover="1278">configFromArgs</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.5274" data-verso-hover="315">args</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doMatch-4731">with</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.5321" data-verso-hover="1282">config</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-DirTree.Readerish.dirTree" data-verso-hover="1331">dirTree</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">‚Üê</span><span class="inter-text"> </span><span class="const token" data-binding="const-IO.currentDir" data-verso-hover="1283">IO.currentDir</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DirTree.Readerish.ConfigIO.run" data-verso-hover="1322">run</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.5321" data-verso-hover="1282">config</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="313">0</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-IO.eprintln" data-verso-hover="1284">IO.eprintln</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-termS!_-4875">s!</span><span class="unknown token" data-binding="">"Didn't understand argument(s) {</span><span class="literal string token" data-binding="" data-verso-hover="30">" "</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-String.separate" data-verso-hover="1285">separate</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.5274" data-verso-hover="315">args</span><span class="unknown token" data-binding="">}\n"</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-IO.eprintln" data-verso-hover="1284">IO.eprintln</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.usage" data-verso-hover="1276">usage</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="313">1</span></code><p>
                This custom monad has a number of advantages over passing configurations manually:</p>
              <ol start="1">
                <li>
                  <p>
                    It is easier to ensure that configurations are passed down unchanged, except when changes are desired</p>
                  </li>
                <li>
                  <p>
                    The concern of passing the configuration onwards is more clearly separated from the concern of printing directory contents</p>
                  </li>
                <li>
                  <p>
                    As the program grows, there will be more and more intermediate layers that do nothing with configurations except propagate them, and these layers don't need to be rewritten as the configuration logic changes</p>
                  </li>
                </ol>
              <p>
                However, there are also some clear downsides:</p>
              <ol start="1">
                <li>
                  <p>
                    As the program evolves and the monad requires more features, each of the basic operators such as <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Readerish.locally" data-verso-hover="1325">locally</span></code> and <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Readerish.currentConfig" data-verso-hover="1324">currentConfig</span></code> will need to be updated</p>
                  </li>
                <li>
                  <p>
                    Wrapping ordinary <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span></code> actions in <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Readerish.runIO" data-verso-hover="1327">runIO</span></code> is noisy and distracts from the flow of the program</p>
                  </li>
                <li>
                  <p>
                    Writing monads instances by hand is repetitive, and the technique for adding a reader effect to another monad is a design pattern that requires documentation and communication overhead</p>
                  </li>
                </ol>
              <p>
                Using a technique called <em>monad transformers</em>, all of these downsides can be addressed.
A monad transformer takes a monad as an argument and returns a new monad.
Monad transformers consist of:</p>
              <ol start="1">
                <li>
                  <p>
                    A definition of the transformer itself, which is typically a function from types to types</p>
                  </li>
                <li>
                  <p>
                    A <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monad" data-verso-hover="724">Monad</span></code> instance that assumes the inner type is already a monad</p>
                  </li>
                <li>
                  <p>
                    An operator to ‚Äúlift‚Äù an action from the inner monad to the transformed monad, akin to <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Readerish.runIO" data-verso-hover="1327">runIO</span></code></p>
                  </li>
                </ol>
              </section>
            <section>
              <h2 id="Functional-Programming-in-Lean--Monad-Transformers--Combining-IO-and-Reader--Adding-a-Reader-to-Any-Monad">
                6.1.3.¬†Adding a Reader to Any Monad</h2>
              <p>
                Adding a reader effect to <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span></code> was accomplished in <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Readerish.ConfigIO" data-verso-hover="1317">ConfigIO</span></code> by wrapping <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3799" data-verso-hover="113">Œ±</span></code> in a function type.
The Lean standard library contains a function that can do this to <em>any</em> polymorphic type, called <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.T.ReaderT" data-verso-hover="1333">ReaderT</span></code>:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-5390">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.T.ReaderT" data-verso-hover="1333">ReaderT</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.5854" data-verso-hover="1219">œÅ</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.type-5408" data-verso-hover="50">Type</span><span class="inter-text"> </span><span class="unknown token" data-binding="">u</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.5858" data-verso-hover="1246">m</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.type-5421" data-verso-hover="50">Type</span><span class="inter-text"> </span><span class="unknown token" data-binding="">u</span><span class="inter-text"> </span><span class="unknown token" data-binding="">‚Üí</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.type-5432" data-verso-hover="50">Type</span><span class="inter-text"> </span><span class="unknown token" data-binding="">v</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.5860" data-verso-hover="1219">Œ±</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.type-5446" data-verso-hover="50">Type</span><span class="inter-text"> </span><span class="unknown token" data-binding="">u</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.type-5460" data-verso-hover="50">Type</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Level.max-5466">max</span><span class="inter-text"> </span><span class="unknown token" data-binding="">u</span><span class="inter-text"> </span><span class="unknown token" data-binding="">v</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="var token" data-binding="var-_uniq.5854" data-verso-hover="1219">œÅ</span><span class="inter-text"> </span><span class="unknown token" data-binding="">‚Üí</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.5858" data-verso-hover="1246">m</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.5860" data-verso-hover="1219">Œ±</span></code><p>
                Its arguments are as follows:</p>
              <ul>
                <li>
                  <p>
                    <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.5854" data-verso-hover="1219">œÅ</span></code> is the environment that is accessible to the reader</p>
                  </li>
                <li>
                  <p>
                    <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.5858" data-verso-hover="1246">m</span></code> is the monad that is being transformed, such as <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span></code></p>
                  </li>
                <li>
                  <p>
                    <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.5860" data-verso-hover="1219">Œ±</span></code> is the type of values being returned by the monadic computation
Both <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.5860" data-verso-hover="1219">Œ±</span></code> and <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.5854" data-verso-hover="1219">œÅ</span></code> are in the same universe because the operator that retrieves the environment in the monad will have type <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.6556" data-verso-hover="1125">m</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6567" data-verso-hover="369">œÅ</span></code>.</p>
                  </li>
                </ul>
              <div class="paragraph">
                <p>
                  With <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.T.ReaderT" data-verso-hover="1333">ReaderT</span></code>, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Readerish.ConfigIO" data-verso-hover="1317">ConfigIO</span></code> becomes:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.abbrev-6175">abbrev</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.T.ConfigIO" data-verso-hover="1334">ConfigIO</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.6823" data-verso-hover="113">Œ±</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="sort token" data-binding="" data-verso-hover="50">Type</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="sort token" data-binding="" data-verso-hover="50">Type</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.T.ReaderT" data-verso-hover="1333">ReaderT</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Config" data-verso-hover="1275">Config</span><span class="inter-text"> </span><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6823" data-verso-hover="113">Œ±</span></code><p>
                  It is an <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">abbrev</span></code> because <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.T.ReaderT" data-verso-hover="1333">ReaderT</span></code> has many useful features defined in the standard library that a non-reducible definition would hide.
Rather than taking responsibility for making these work directly for <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Readerish.ConfigIO" data-verso-hover="1317">ConfigIO</span></code>, it's easier to simply have <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.T.ConfigIO" data-verso-hover="1334">ConfigIO</span></code> behave identically to <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.T.ReaderT" data-verso-hover="1333">ReaderT</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Config" data-verso-hover="1275">Config</span><span class="inter-text"> </span><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span></code>.</p>
                </div>
              <div class="paragraph">
                <p>
                  The manually-written <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Readerish.currentConfig" data-verso-hover="1324">currentConfig</span></code> obtained the environment out of the reader.
This effect can be defined in a generic form for all uses of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.T.ReaderT" data-verso-hover="1333">ReaderT</span></code>, under the name <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.T.MonadReader.read" data-verso-hover="1335">read</span></code>:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-5765">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.T.R.read" data-verso-hover="1336">read</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="const token" data-binding="const-Monad" data-verso-hover="724">Monad</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6556" data-verso-hover="1125">m</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.T.ReaderT" data-verso-hover="1333">ReaderT</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6567" data-verso-hover="369">œÅ</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6556" data-verso-hover="1125">m</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6567" data-verso-hover="369">œÅ</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">   </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-5808">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6588" data-verso-hover="938">env</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6588" data-verso-hover="938">env</span></code><p>
                  However, not every monad that provides a reader effect is built with <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.T.ReaderT" data-verso-hover="1333">ReaderT</span></code>.
The type class <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.T.MonadReader" data-verso-hover="1337">MonadReader</span></code> allows any monad to provide a <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.T.MonadReader.read" data-verso-hover="1335">read</span></code> operator:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.classTk-5888">class</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.T.MonadReader" data-verso-hover="1337">MonadReader</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.6659" data-verso-hover="1338">œÅ</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-outParam" data-verso-hover="448">outParam</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.type-5922" data-verso-hover="50">Type</span><span class="inter-text"> </span><span class="unknown token" data-binding="">u</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.6663" data-verso-hover="1246">m</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.type-5936" data-verso-hover="50">Type</span><span class="inter-text"> </span><span class="unknown token" data-binding="">u</span><span class="inter-text"> </span><span class="unknown token" data-binding="">‚Üí</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.type-5947" data-verso-hover="50">Type</span><span class="inter-text"> </span><span class="unknown token" data-binding="">v</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.type-5961" data-verso-hover="50">Type</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Level.max-5967">max</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">u</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="unknown token" data-binding="">1</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">v</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-5982">where</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-DirTree.T.MonadReader.read" data-verso-hover="1335">read</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6663" data-verso-hover="1246">m</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6659" data-verso-hover="1338">œÅ</span><span class="inter-text">
</span><span class="inter-text">
</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.instance-6003">instance</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="const token" data-binding="const-Monad" data-verso-hover="724">Monad</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6698" data-verso-hover="1125">m</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.T.MonadReader" data-verso-hover="1337">MonadReader</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6709" data-verso-hover="369">œÅ</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-DirTree.T.ReaderT" data-verso-hover="1333">ReaderT</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6709" data-verso-hover="369">œÅ</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6698" data-verso-hover="1125">m</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.whereStructInst-6054">where</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-DirTree.T.MonadReader.read" data-verso-hover="1339">read</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-6070">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6742" data-verso-hover="938">env</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6742" data-verso-hover="938">env</span><span class="inter-text">
</span><span class="inter-text">
</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.export-6091" data-verso-hover="1340">export</span><span class="inter-text"> </span><span class="unknown token" data-binding="">MonadReader</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-DirTree.T.MonadReader.read" data-verso-hover="1335">read</span><span class="unknown token" data-binding="">)</span></code><p>
                  The type <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.6659" data-verso-hover="1338">œÅ</span></code> is an output parameter because any given monad typically only provides a single type of environment through a reader, so automatically selecting it when the monad is known makes programs more convenient to write.</p>
                </div>
              <p>
                The <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monad" data-verso-hover="724">Monad</span></code> instance for <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.T.ReaderT" data-verso-hover="1333">ReaderT</span></code> is essentially the same as the <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monad" data-verso-hover="724">Monad</span></code> instance for <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Readerish.ConfigIO" data-verso-hover="1317">ConfigIO</span></code>, except <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span></code> has been replaced by some arbitrary monad argument <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.5879" data-verso-hover="1125">m</span></code>:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.instance-5545">instance</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="const token" data-binding="const-Monad" data-verso-hover="724">Monad</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.5879" data-verso-hover="1125">m</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Monad" data-verso-hover="724">Monad</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-DirTree.T.ReaderT" data-verso-hover="1333">ReaderT</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.5894" data-verso-hover="369">œÅ</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.5879" data-verso-hover="1125">m</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.whereStructInst-5587">where</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="1341">pure</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.5970" data-verso-hover="584">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-5605">fun</span><span class="inter-text"> </span><span class="unknown token" data-binding="">_</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.5970" data-verso-hover="584">x</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Bind.bind" data-verso-hover="1342">bind</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6121" data-verso-hover="1343">result</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6124" data-verso-hover="1344">next</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-5643">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6129" data-verso-hover="938">env</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-5654">do</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLetArrow-5661">let</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6182" data-verso-hover="584">v</span><span class="inter-text"> </span><span class="unknown token" data-binding="">‚Üê</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6121" data-verso-hover="1343">result</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6129" data-verso-hover="938">env</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="var token" data-binding="var-_uniq.6124" data-verso-hover="1344">next</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6182" data-verso-hover="584">v</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6129" data-verso-hover="938">env</span></code><p>
                The next step is to eliminate uses of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Readerish.runIO" data-verso-hover="1327">runIO</span></code>.
When Lean encounters a mismatch in monad types, it automatically attempts to use a type class called <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.MyMonadLift.MonadLift" data-verso-hover="1345">MonadLift</span></code> to transform the actual monad into the expected monad.
This process is similar to the use of coercions.
<code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.MyMonadLift.MonadLift" data-verso-hover="1345">MonadLift</span></code> is defined as follows:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.classTk-5052">class</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.MyMonadLift.MonadLift" data-verso-hover="1345">MonadLift</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.5804" data-verso-hover="1246">m</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.type-5073" data-verso-hover="50">Type</span><span class="inter-text"> </span><span class="unknown token" data-binding="">u</span><span class="inter-text"> </span><span class="unknown token" data-binding="">‚Üí</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.type-5084" data-verso-hover="50">Type</span><span class="inter-text"> </span><span class="unknown token" data-binding="">v</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.5808" data-verso-hover="1346">n</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.type-5097" data-verso-hover="50">Type</span><span class="inter-text"> </span><span class="unknown token" data-binding="">u</span><span class="inter-text"> </span><span class="unknown token" data-binding="">‚Üí</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.type-5108" data-verso-hover="50">Type</span><span class="inter-text"> </span><span class="unknown token" data-binding="">w</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-5116">where</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-DirTree.MyMonadLift.MonadLift.monadLift" data-verso-hover="1347">monadLift</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="unknown token" data-binding="">{</span><span class="var token" data-binding="var-_uniq.5814" data-verso-hover="1219">Œ±</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.type-5142" data-verso-hover="50">Type</span><span class="inter-text"> </span><span class="unknown token" data-binding="">u</span><span class="unknown token" data-binding="">}</span><span class="inter-text"> </span><span class="unknown token" data-binding="">‚Üí</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.5804" data-verso-hover="1246">m</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.5814" data-verso-hover="1219">Œ±</span><span class="inter-text"> </span><span class="unknown token" data-binding="">‚Üí</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.5808" data-verso-hover="1346">n</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.5814" data-verso-hover="1219">Œ±</span></code><p>
                The method <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.MyMonadLift.MonadLift.monadLift" data-verso-hover="1347">monadLift</span></code> translates from the monad <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.5804" data-verso-hover="1246">m</span></code> to the monad <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.5808" data-verso-hover="1346">n</span></code>.
The process is called ‚Äúlifting‚Äù because it takes an action in the embedded monad and makes it into an action in the surrounding monad.
In this case, it will be used to ‚Äúlift‚Äù from <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span></code> to <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.T.ReaderT" data-verso-hover="1333">ReaderT</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.Config" data-verso-hover="1275">Config</span><span class="inter-text"> </span><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span></code>, though the instance works for <em>any</em> inner monad <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.6839" data-verso-hover="1125">m</span></code>:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.instance-6295">instance</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-MonadLift" data-verso-hover="1348">MonadLift</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6839" data-verso-hover="1125">m</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-DirTree.T.ReaderT" data-verso-hover="1333">ReaderT</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6851" data-verso-hover="369">œÅ</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6839" data-verso-hover="1125">m</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.whereStructInst-6333">where</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-MonadLift.monadLift" data-verso-hover="1349">monadLift</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6885" data-verso-hover="1269">action</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-6361">fun</span><span class="inter-text"> </span><span class="unknown token" data-binding="">_</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6885" data-verso-hover="1269">action</span></code><p>
                The implementation of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-MonadLift.monadLift" data-verso-hover="1349">monadLift</span></code> is very similar to that of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Readerish.runIO" data-verso-hover="1327">runIO</span></code>.
Indeed, it is enough to define <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.T.showFileName" data-verso-hover="1350">showFileName</span></code> and <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.T.showDirName" data-verso-hover="1351">showDirName</span></code> without using <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Readerish.runIO" data-verso-hover="1327">runIO</span></code>:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-6437">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.T.showFileName" data-verso-hover="1350">showFileName</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.6925" data-verso-hover="39">file</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.T.ConfigIO" data-verso-hover="1334">ConfigIO</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-6489">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-IO.println" data-verso-hover="250">IO.println</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-termS!_-6505">s!</span><span class="unknown token" data-binding="">"{</span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">‚Üê</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.T.MonadReader.read" data-verso-hover="1335">read</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DirTree.Config.currentPrefix" data-verso-hover="1274">currentPrefix</span><span class="unknown token" data-binding="">} {</span><span class="var token" data-binding="var-_uniq.6925" data-verso-hover="39">file</span><span class="unknown token" data-binding="">}"</span><span class="inter-text">
</span><span class="inter-text">
</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-6544">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.T.showDirName" data-verso-hover="1351">showDirName</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.7266" data-verso-hover="39">dir</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.T.ConfigIO" data-verso-hover="1334">ConfigIO</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-6594">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-IO.println" data-verso-hover="250">IO.println</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-termS!_-6610">s!</span><span class="unknown token" data-binding="">"{</span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">‚Üê</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.T.MonadReader.read" data-verso-hover="1335">read</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DirTree.Config.currentPrefix" data-verso-hover="1274">currentPrefix</span><span class="unknown token" data-binding="">} {</span><span class="var token" data-binding="var-_uniq.7266" data-verso-hover="39">dir</span><span class="unknown token" data-binding="">}/"</span></code><p>
                One final operation from the original <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Readerish.ConfigIO" data-verso-hover="1317">ConfigIO</span></code> remains to be translated to a use of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.T.ReaderT" data-verso-hover="1333">ReaderT</span></code>: <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Readerish.locally" data-verso-hover="1325">locally</span></code>.
The definition can be translated directly to <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.T.ReaderT" data-verso-hover="1333">ReaderT</span></code>, but the Lean standard library provides a more general version.
The standard version is called <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.T.MonadWithReader.withReader" data-verso-hover="1352">withReader</span></code>, and it is part of a type class called <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.T.MonadWithReader" data-verso-hover="1353">MonadWithReader</span></code>:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.classTk-6709">class</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.T.MonadWithReader" data-verso-hover="1353">MonadWithReader</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.7608" data-verso-hover="1338">œÅ</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-outParam" data-verso-hover="448">outParam</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.type-6747" data-verso-hover="50">Type</span><span class="inter-text"> </span><span class="unknown token" data-binding="">u</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.7612" data-verso-hover="1246">m</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.type-6761" data-verso-hover="50">Type</span><span class="inter-text"> </span><span class="unknown token" data-binding="">u</span><span class="inter-text"> </span><span class="unknown token" data-binding="">‚Üí</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.type-6772" data-verso-hover="50">Type</span><span class="inter-text"> </span><span class="unknown token" data-binding="">v</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-6780">where</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-DirTree.T.MonadWithReader.withReader" data-verso-hover="1352">withReader</span><span class="inter-text"> </span><span class="unknown token" data-binding="">{</span><span class="var token" data-binding="var-_uniq.7617" data-verso-hover="1219">Œ±</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.type-6805" data-verso-hover="50">Type</span><span class="inter-text"> </span><span class="unknown token" data-binding="">u</span><span class="unknown token" data-binding="">}</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.7608" data-verso-hover="1338">œÅ</span><span class="inter-text"> </span><span class="unknown token" data-binding="">‚Üí</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7608" data-verso-hover="1338">œÅ</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">‚Üí</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7612" data-verso-hover="1246">m</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7617" data-verso-hover="1219">Œ±</span><span class="inter-text"> </span><span class="unknown token" data-binding="">‚Üí</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7612" data-verso-hover="1246">m</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7617" data-verso-hover="1219">Œ±</span></code><p>
                Just as in <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.T.MonadReader" data-verso-hover="1337">MonadReader</span></code>, the environment <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.7608" data-verso-hover="1338">œÅ</span></code> is an <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-outParam" data-verso-hover="448">outParam</span></code>.
The <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.T.MonadWithReader.withReader" data-verso-hover="1352">withReader</span></code> operation is exported, so that it doesn't need to be written with the type class name before it:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.export-6908" data-verso-hover="1340">export</span><span class="inter-text"> </span><span class="unknown token" data-binding="">MonadWithReader</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-DirTree.T.MonadWithReader.withReader" data-verso-hover="1352">withReader</span><span class="unknown token" data-binding="">)</span></code><p>
                The instance for <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.T.ReaderT" data-verso-hover="1333">ReaderT</span></code> is essentially the same as the definition of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Readerish.locally" data-verso-hover="1325">locally</span></code>:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.instance-7007">instance</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.T.MonadWithReader" data-verso-hover="1353">MonadWithReader</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7671" data-verso-hover="369">œÅ</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-DirTree.T.ReaderT" data-verso-hover="1333">ReaderT</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7671" data-verso-hover="369">œÅ</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7681" data-verso-hover="1125">m</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.whereStructInst-7052">where</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-DirTree.T.MonadWithReader.withReader" data-verso-hover="1354">withReader</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7707" data-verso-hover="1355">change</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7711" data-verso-hover="1343">action</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-7092">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7714" data-verso-hover="938">cfg</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7711" data-verso-hover="1343">action</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.7707" data-verso-hover="1355">change</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7714" data-verso-hover="938">cfg</span><span class="unknown token" data-binding="">)</span></code><p>
                With these definitions in place, the new version of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.T.dirTree" data-verso-hover="1356">dirTree</span></code> can be written:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.partial-7335">partial</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-7343">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.T.dirTree" data-verso-hover="1356">dirTree</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.7806" data-verso-hover="303">path</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-System.FilePath" data-verso-hover="304">System.FilePath</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.T.ConfigIO" data-verso-hover="1334">ConfigIO</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-7399">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doMatch-7404">match</span><span class="inter-text"> </span><span class="unknown token" data-binding="">‚Üê</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.toEntry" data-verso-hover="1289">toEntry</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7806" data-verso-hover="303">path</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doMatch-7404">with</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.none" data-verso-hover="145">none</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-DirTree.Entry.file" data-verso-hover="1287">.file</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.8047" data-verso-hover="39">name</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.T.showFileName" data-verso-hover="1350">showFileName</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.8047" data-verso-hover="39">name</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.some" data-verso-hover="146">some</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-DirTree.Entry.dir" data-verso-hover="1288">.dir</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.8065" data-verso-hover="39">name</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-DirTree.T.showDirName" data-verso-hover="1351">showDirName</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.8065" data-verso-hover="39">name</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLetArrow-7554">let</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.8158" data-verso-hover="1296">contents</span><span class="inter-text"> </span><span class="unknown token" data-binding="">‚Üê</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7806" data-verso-hover="303">path</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-System.FilePath.readDir" data-verso-hover="1297">readDir</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-DirTree.T.MonadWithReader.withReader" data-verso-hover="1352">withReader</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">¬∑</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DirTree.Config.inDirectory" data-verso-hover="1298">inDirectory</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">        </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-DirTree.doList" data-verso-hover="1299">doList</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.8158" data-verso-hover="1296">contents</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Array.qsort" data-verso-hover="1300">qsort</span><span class="inter-text"> </span><span class="const token" data-binding="const-DirTree.T.dirLT" data-verso-hover="1357">dirLT</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Array.toList" data-verso-hover="1302">toList</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-7664">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.8219" data-verso-hover="1303">d</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">          </span><span class="const token" data-binding="const-DirTree.T.dirTree" data-verso-hover="1356">dirTree</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.8219" data-verso-hover="1303">d</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-IO.FS.DirEntry.path" data-verso-hover="1304">path</span><span class="unknown token" data-binding="">)</span></code><p>
                Aside from replacing <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Readerish.locally" data-verso-hover="1325">locally</span></code> with <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.T.MonadWithReader.withReader" data-verso-hover="1352">withReader</span></code>, it is the same as before.</p>
              <p>
                Replacing the custom <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Readerish.ConfigIO" data-verso-hover="1317">ConfigIO</span></code> type with <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.T.ReaderT" data-verso-hover="1333">ReaderT</span></code> did not save a large number of lines of code in this section.
However, rewriting the code using components from the standard library does have long-term benefits.
First, readers who know about <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.T.ReaderT" data-verso-hover="1333">ReaderT</span></code> don't need to take time to understand the <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monad" data-verso-hover="724">Monad</span></code> instance for <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.Readerish.ConfigIO" data-verso-hover="1317">ConfigIO</span></code>, working backwards to the meaning of monad itself.
Instead, they can be confident in their initial understanding.
Next, adding further effects to the monad (such as a state effect to count the files in each directory and display a count at the end) requires far fewer changes to the code, because the monad transformers and <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-MonadLift" data-verso-hover="1348">MonadLift</span></code> instances provided in the library work well together.
Finally, using a set of type classes included in the standard library, polymorphic code can be written in such a way that it can work with a variety of monads without having to care about details like the order in which the monad transformers were applied.
Just as some functions work in any monad, others can work in any monad that provides a certain type of state, or a certain type of exceptions, without having to specifically describe the <em>way</em> in which a particular concrete monad provides the state or exceptions.</p>
              </section>
            <section>
              <h2 id="Functional-Programming-in-Lean--Monad-Transformers--Combining-IO-and-Reader--Exercises">
                6.1.4.¬†Exercises</h2>
              <section>
                <h3 id="Functional-Programming-in-Lean--Monad-Transformers--Combining-IO-and-Reader--Exercises--Controlling-the-Display-of-Dotfiles">
                  6.1.4.1.¬†Controlling the Display of Dotfiles</h3>
                <p>
                  Files whose names begin with a dot character (<code>'.'</code>) typically represent files that should usually be hidden, such as source-control metadata and configuration files.
Modify <code>doug</code> with an option to show or hide filenames that begin with a dot.
This option should be controlled with a <code>-a</code> command-line option.</p>
                </section>
              <section>
                <h3 id="Functional-Programming-in-Lean--Monad-Transformers--Combining-IO-and-Reader--Exercises--Starting-Directory-as-Argument">
                  6.1.4.2.¬†Starting Directory as Argument</h3>
                <p>
                  Modify <code>doug</code> so that it takes a starting directory as an additional command-line argument.
</p>
                </section>
              </section>
            </section>
          <nav class="prev-next-buttons">
            <a class="local-button active" href="Monad-Transformers/#Functional-Programming-in-Lean--Monad-Transformers" rel="prev" title="6. Monad Transformers"><span class="arrow">‚Üê</span><span class="where">6. Monad Transformers</span></a><a class="local-button active" href="Monad-Transformers/A-Monad-Construction-Kit/#Functional-Programming-in-Lean--Monad-Transformers--A-Monad-Construction-Kit" rel="next" title="6.2. A Monad Construction Kit"><span class="where">6.2. A Monad Construction Kit</span><span class="arrow">‚Üí</span></a></nav>
          </div>
        </main></div>
    </body>
  </html>

