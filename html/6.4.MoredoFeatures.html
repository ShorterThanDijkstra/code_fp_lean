<!DOCTYPE html>
<html>
  <head>
    <script>
      (function(){
  const {protocol:proto, host:hostName, pathname:path, search:srch, hash:hsh} = window.location;
  if (!(path.endsWith("/") || path.endsWith(".html"))) {
    window.location.replace(`${proto}//${hostName}${path}/${srch}${hsh}`);
  }
})()</script>
    <base href="./../../"><meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <title>More do Features</title><link rel="stylesheet" href="book.css">
    <script>
      const __versoSiteRoot = document.baseURI;</script>
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js" integrity="sha384-zbcZAIxlvJtNE3Dp5nxLXdXtXyxwOdnILY1TDPVmKFhl4r4nSUG1r8bcFXGVa4Te" crossorigin="anonymous"></script>
    <script src="-verso-data/katex/katex.js"></script>
    <script src="-verso-data/katex/math.js"></script>
    <script src="-verso-data/popper.js"></script>
    <script src="-verso-data/tippy.js"></script>
    <link rel="stylesheet" href="static/theme.css">
    <link rel="stylesheet" href="static/fonts/source-serif/source-serif-text.css">
    <link rel="stylesheet" href="static/fonts/source-code-pro/source-code-pro.css">
    <link rel="stylesheet" href="static/fonts/source-sans/source-sans-3.css">
    <link rel="stylesheet" href="static/fonts/noto-sans-mono/noto-sans-mono.css">
    <link rel="stylesheet" href="-verso-data/katex/katex.css">
    <link rel="stylesheet" href="-verso-data/tippy-border.css">
    <style>
div.paragraph > .eval-steps:not(:first-child), div.paragraph > .eval-steps:not(:first-child) > * {
  margin-top: 0.5rem;
}

div.paragraph > .eval-steps:not(:last-child), div.paragraph > .eval-steps:not(:last-child) > * {
  margin-bottom: 0.5rem;
}

.eval-steps .hl.lean.block {
  margin-top: 0.25em;
  margin-bottom: 0.25em;
}
</style><style>
.shell-command {

}
.shell-command.inline > * {
  display: inline;
  white-space: pre;
}
.shell-command.inline .command::before {
  content: "$ ";
  font-weight: 600;
}
</style><style>
.shell-command {

}
.shell-command.block > * {
  display: block;
  white-space: pre;
}
.shell-command .command .prompt {
  font-weight: 600;
}

div.paragraph > .shell-command:not(:first-child) {
  margin-top: 0.5rem;
}

div.paragraph > .shell-command:not(:last-child) {
  margin-bottom: 0.5rem;
}
</style><style>

.hl.lean {
  white-space: pre;
  font-weight: normal;
  font-style: normal;
}

.hl.lean .keyword {
  font-weight : bold;
}

.hl.lean .var {
  font-style: italic;
  position: relative;
}

.hover-container {
  width: 0;
  height: 0;
  position: relative;
  display: inline;
}

.hl.lean a {
  color: inherit;
  text-decoration: currentcolor underline dotted;
}

.hl.lean a:hover {
  text-decoration: currentcolor underline solid;
}

.hl.lean .hover-info {
  white-space: normal;
}

.hl.lean .token .hover-info {
  display: none;
  position: absolute;
  background-color: #e5e5e5;
  border: 1px solid black;
  padding: 0.5rem;
  z-index: 300;
  font-size: inherit;
}

.hl.lean .hover-info.messages {
  max-height: 10rem;
  overflow-y: auto;
  overflow-x: hidden;
  scrollbar-gutter: stable;
  padding: 0 0.5rem 0 0;
  display: block;
}

.hl.lean .hover-info code {
  white-space: pre-wrap;
}

.hl.lean .hover-info.messages > code {
  padding: 0.5rem;
  display: block;
  width: fit-content;
}

.hl.lean .hover-info.messages > code:only-child {
  margin: 0;
}

.hl.lean .hover-info.messages > code {
  margin: 0.1rem;
}

.hl.lean .hover-info.messages > code:not(:first-child) {
  margin-top: 0rem;
}

/*
@media (hover: hover) {
  .hl.lean .has-info:hover > .hover-container > .hover-info:not(.tactic *),
  .hl.lean .tactic:has(> .tactic-toggle:checked) .has-info:hover > .hover-container > .hover-info,
  .hl.lean .token:hover > .hover-container > .hover-info:not(.has-info *):not(.tactic *),
  .hl.lean .tactic:has(> .tactic-toggle:checked) .token:hover > .hover-container > .hover-info:not(.has-info *) {
    display: inline-block;
    position: absolute;
    top: 1rem;
    font-weight: normal;
    font-style: normal;
    width: min-content;
  }
}
*/

.hl.lean.block {
  display: block;
}

.hl.lean.inline {
  display: inline;
  white-space: pre-wrap;
}

.hl.lean .token {
  transition: all 0.25s; /* Slight fade for highlights */
}

@media (hover: hover) {
  .hl.lean .token.binding-hl, .hl.lean .literal.string:hover, .hl.lean .token.typed:hover {
    background-color: #eee;
    border-radius: 2px;
    transition: none;
  }
}


.hl.lean .has-info .token:not(.tactic-state):not(.tactic-state *), .hl.lean .has-info .inter-text:not(.tactic-state):not(.tactic-state *) {
  text-decoration-style: wavy;
  text-decoration-line: underline;
  text-decoration-thickness: from-font;
}

.hl.lean .has-info .hover-info {
  display: none;
  position: absolute;
  transform: translate(0.25rem, 0.3rem);
  border: 1px solid black;
  padding: 0.5rem;
  z-index: 400;
  text-align: left;
}

.hl.lean .has-info.error :not(.tactic-state):not(.tactic-state *){
  text-decoration-color: red;
}

@media (hover: hover) {
  .hl.lean .has-info.error:hover {
    background-color: #ffb3b3;
  }
}

.hl.lean .hover-info.messages > code.error {
  background-color: #e5e5e5;
  border-left: 0.2rem solid #ffb3b3;
}

.tippy-box[data-theme~='error'] .hl.lean .hover-info.messages > code.error {
  background: none;
  border: none;
}

.error pre {
    color: red;
}

.hl.lean .has-info.warning :not(.tactic-state):not(.tactic-state *) {
  text-decoration-color: var(--verso-warning-color);
}

@media (hover: hover) {
  .hl.lean .has-info.warning:hover {
    background-color:var(--verso-warning-color);
  }
}

.hl.lean .hover-info.messages > code.warning {
  background-color: var(--verso-warning-color);
}

.hl.lean .hover-info.messages > code.error {
  background-color: #e5e5e5;
  border-left: 0.2rem solid var(--verso-warning-color);
}

.tippy-box[data-theme~='warning'] .hl.lean .hover-info.messages > code.warning {
  background: none;
  border: none;
}


.hl.lean .has-info.info :not(.tactic-state):not(.tactic-state *) {
  text-decoration-color: blue;
}

@media (hover: hover) {
  .hl.lean .has-info.info:hover {
    background-color: #4777ff;
  }
}


.hl.lean .hover-info.messages > code.info {
  background-color: #e5e5e5;
  border-left: 0.2rem solid #4777ff;
}

.tippy-box[data-theme~='info'] .hl.lean .hover-info.messages > code.info {
  background: none;
  border: none;
}

.hl.lean div.docstring {
  font-family: sans-serif;
  white-space: normal;
  max-width: 40rem;
  width: max-content;
}

.hl.lean div.docstring > :last-child {
  margin-bottom: 0;
}

.hl.lean div.docstring > :first-child {
  margin-top: 0;
}

.hl.lean .hover-info .sep {
  display: block;
  width: auto;
  margin-left: 1rem;
  margin-right: 1rem;
  margin-top: 0.5rem;
  margin-bottom: 0.5rem;
  padding: 0;
  height: 1px;
  border-top: 1px solid #ccc;
}

.hl.lean code {
  font-family: monospace;
}

.hl.lean .tactic-state {
  display: none;
  position: relative;
  left: 2rem;
  width: fit-content;
  border: 1px solid #888888;
  border-radius: 0.1rem;
  padding: 0.5rem;
  font-family: sans-serif;
  background-color: #ffffff;
  z-index: 200;
}

.hl.lean.popup .tactic-state {
  position: static;
  display: block;
  width: auto;
  border: none;
  padding: 0.5rem;
  font-family: sans-serif;
  background-color: #ffffff;
}


.hl.lean .tactic {
  position: relative;
}

.hl.lean .tactic-toggle:checked ~ .tactic-state {
  display: block;
}

/*
@media (hover: hover) {
  .hl.lean .tactic:hover > .tactic-toggle:not(:checked) ~ .tactic-state {
    display: block;
    position: absolute;
    left: 0;
    transform: translate(0.25rem, 0);
    z-index: 250;
  }
}
*/

.hl.lean .tactic > label {
  position: relative;
  transition: all 0.5s;
}

@media (hover: hover) {
  .hl.lean .tactic > label:hover {
    border-bottom: 1px dotted #bbbbbb;
  }
}

.hl.lean .tactic-toggle {
  position: absolute;
  top: 0;
  left: 0;
  opacity: 0;
  height: 0;
  width: 0;
  z-index: -10;
}

.hl.lean .tactic > label::after {
  content: "";
  border: 1px solid #bbbbbb;
  border-radius: 1rem;
  height: 0.25rem;
  vertical-align: middle;
  width: 0.6rem;
  margin-left: 0.1rem;
  margin-right: 0.1rem;
  display: inline-block;
  transition: all 0.5s;
}

/*
@media (hover: hover) {
  .hl.lean .tactic > label:hover::after {
    border: 1px solid #aaaaaa;
    background-color: #aaaaaa;
    transition: all 0.5s;
  }
}
*/

.hl.lean .tactic > label:has(+ .tactic-toggle:checked)::after {
  border: 1px solid #999999;
  background-color: #999999;
  transition: all 0.5s;
}

.hl.lean .tactic-state .goal + .goal {
  margin-top: 1.5rem;
}

.hl.lean .tactic-state summary {
  margin-left: -0.5rem;
}

.hl.lean .tactic-state details {
  padding-left: 0.5rem;
}

.hl.lean .case-label {
  display: block;
  position: relative;
}

.hl.lean .case-label input[type="checkbox"] {
  position: absolute;
  top: 0;
  left: 0;
  opacity: 0;
  height: 0;
  width: 0;
  z-index: -10;
}

.hl.lean .case-label:has(input[type="checkbox"])::before {
  width: 1rem;
  height: 1rem;
  display: inline-block;
  background-color: black;
  content: ' ';
  transition: ease 0.2s;
  margin-right: 0.7rem;
  clip-path: polygon(100% 0, 0 0, 50% 100%);
  width: 0.6rem;
  height: 0.6rem;
}

.hl.lean .case-label:has(input[type="checkbox"]:not(:checked))::before {
  transform: rotate(-90deg);
}

.hl.lean .case-label:has(input[type="checkbox"]) {

}

.hl.lean .case-label:has(input[type="checkbox"]:checked) {

}


.hl.lean .tactic-state .labeled-case > :not(:first-child) {
  max-height: 0px;
  display: block;
  overflow: hidden;
  transition: max-height 0.1s ease-in;
  margin-left: 0.5rem;
  margin-top: 0.1rem;
}

.hl.lean .labeled-case:has(.case-label input[type="checkbox"]:checked) > :not(:first-child) {
  max-height: 100%;
}


.hl.lean .tactic-state .goal-name::before {
  font-style: normal;
  content: "case ";
}

.hl.lean .tactic-state .goal-name {
  font-style: italic;
  font-family: monospace;
}

.hl.lean .tactic-state .hypotheses {
  display: table;
}

.hl.lean .tactic-state .hypothesis {
  display: table-row;
}

.hl.lean .tactic-state .hypothesis > * {
  display: table-cell;
}


.hl.lean .tactic-state .hypotheses .colon {
  text-align: center;
  min-width: 1rem;
}

.hl.lean .tactic-state .hypotheses .name {
  text-align: right;
}

.hl.lean .tactic-state .hypotheses .name,
.hl.lean .tactic-state .hypotheses .type,
.hl.lean .tactic-state .conclusion .type {
  font-family: monospace;
}

.tippy-box[data-theme~='lean'] {
  background-color: #e5e5e5;
  color: black;
  border: 1px solid black;
}
.tippy-box[data-theme~='lean'][data-placement^='top'] > .tippy-arrow::before {
  border-top-color: #e5e5e5;
}
.tippy-box[data-theme~='lean'][data-placement^='bottom'] > .tippy-arrow::before {
  border-bottom-color: #e5e5e5;
}
.tippy-box[data-theme~='lean'][data-placement^='left'] > .tippy-arrow::before {
  border-left-color: #e5e5e5;
}
.tippy-box[data-theme~='lean'][data-placement^='right'] > .tippy-arrow::before {
  border-right-color: #e5e5e5;
}

.tippy-box[data-theme~='message'][data-placement^='top'] > .tippy-arrow::before {
  border-top-color: #e5e5e5;
  border-width: 11px 11px 0;
}
.tippy-box[data-theme~='message'][data-placement^='top'] > .tippy-arrow::after {
  bottom: -11px;
  border-width: 11px 11px 0;
}
.tippy-box[data-theme~='message'][data-placement^='bottom'] > .tippy-arrow::before {
  border-width: 0 11px 11px;
}
.tippy-box[data-theme~='message'][data-placement^='bottom'] > .tippy-arrow::after {
  top: -11px;
  border-width: 0 11px 11px;
}
.tippy-box[data-theme~='message'][data-placement^='left'] > .tippy-arrow::before {
  border-left-color: #e5e5e5;
  border-width: 11px 0 11px 11px;
}
.tippy-box[data-theme~='message'][data-placement^='left'] > .tippy-arrow::after {
  right: -11px;
  border-width: 11px 0 11px 11px;
}

.tippy-box[data-theme~='message'][data-placement^='right'] > .tippy-arrow::before {
  border-right-color: #e5e5e5;
  border-width: 11px 11px 11px 0;
}
.tippy-box[data-theme~='message'][data-placement^='right'] > .tippy-arrow::after {
  left: -11px;
  border-width: 11px 11px 11px 0;
}



.tippy-box[data-theme~='warning'] {
  background-color: #e5e5e5;
  color: black;
  border: 3px solid var(--verso-warning-color);
}

.tippy-box[data-theme~='error'] {
  background-color: #e5e5e5;
  color: black;
  border: 3px solid #f7a7af;
}

.tippy-box[data-theme~='info'] {
  background-color: #e5e5e5;
  color: black;
  border: 3px solid #99b3c2;
}

.tippy-box[data-theme~='tactic'] {
  background-color: white;
  color: black;
  border: 1px solid black;
}
.tippy-box[data-theme~='tactic'][data-placement^='top'] > .tippy-arrow::before {
  border-top-color: white;
}
.tippy-box[data-theme~='tactic'][data-placement^='bottom'] > .tippy-arrow::before {
  border-bottom-color: white;
}
.tippy-box[data-theme~='tactic'][data-placement^='left'] > .tippy-arrow::before {
  border-left-color: white;
}
.tippy-box[data-theme~='tactic'][data-placement^='right'] > .tippy-arrow::before {
  border-right-color: white;
}

</style><style>
.example-file {
  white-space: normal;
  font-family: var(--verso-structure-font-family);
  margin: 1rem;
  width: fit-content;
  border: 1px solid #ddd;
  padding: 0.5rem;

  /* These are necessary for the container to behave nicely on mobile */
  overflow-x: auto;
  max-width: 100%;
  box-sizing: border-box;
}
.example-file::before {
  counter-reset: linenumber;
}
.example-file > .line {
  display: block;
  white-space: pre;
  counter-increment: linenumber;
  font-family: var(--verso-code-font-family);
}
.example-file > .line::before {
  -webkit-user-select: none;
  display: inline-block;
  content: counter(linenumber);
  border-right: 1px solid #ddd;
  width: 2em;
  padding-right: 0.25em;
  margin-right: 0.25em;
  font-family: var(--verso-code-font-family);
  text-align: right;
}
.example-file > .line::after {
  -webkit-user-select: none;
  display: inline-block;
  content: "⏎";
  opacity: 0;
}
.example-file > .line:hover::after {
  opacity: 1;
}
.example-file > .line:hover, .example-file > .line:hover::before {
  background-color: #eee;
}
.example-file > .empty {
  display: block;
  white-space: pre;
  font-family: var(--verso-code-font-family);
  font-style: italic;
}
.example-file > .empty::before {
  -webkit-user-select: none;
  display: inline-block;
  content: "";
  border-right: 1px solid #ddd;
  width: 2em;
  padding-right: 0.25em;
  margin-right: 0.25em;
  font-family: var(--verso-code-font-family);
  text-align: right;
}
</style><style>
table.tabular {
  margin: auto;
  border-spacing: 1rem;
}
table.tabular.left-align {
  margin-right: auto;
  margin-left: 0;
}
table.tabular.center-align {
  margin: auto;
}
table.tabular.right-align {
  margin-left auto;
  margin-right: 0;
}
table.tabular td, table.tabular th {
  text-align: left;
  vertical-align: top;
}
table.tabular td > p:first-child, table.tabular th > p:first-child {
  margin-top: 0;
}
table.tabular td > p:last-child, table.tabular th > p:first-child {
  margin-bottom: 0;
}
</style><style>
.shell-commands {

}
.shell-commands > * {
  display: block;
  white-space: pre;
}
.shell-commands .command::before {
  content: "$ ";
  font-weight: 600;
}

div.paragraph > .shell-commands:not(:first-child) {
  margin-top: 0.5rem;
}

div.paragraph > .shell-commands:not(:last-child) {
  margin-bottom: 0.5rem;
}
</style><style>
.eq-steps .hl.lean.block {
  background-color: #f6f7f6;
  padding: 1rem;
  margin-top: 0.25rem;
  margin-bottom: 0.25rem;
}
.eq-steps .reason {
  font-style: italic;
  margin-left: 2.5em;
  display: flex;
}
.eq-steps .reason::before {
  content: "={";
  font-family: var(--verso-code-font-family);
  font-style: normal;
  font-weight: 600;
  margin-right: 0.5em;
  align-self: center;
}
.eq-steps .reason > p {
  margin: 0;
  max-width: 25em;
  align-self: center;
}
.eq-steps .reason::after {
  content: "}=";
  font-family: var(--verso-code-font-family);
  font-style: normal;
  font-weight: 600;
  margin-left: 1em;
  align-self: center;
}
</style><style>
div.paragraph > .eq-steps:not(:first-child) {
  margin-top: 0.5rem;
}

div.paragraph > .eq-steps:not(:last-child) {
  margin-bottom: 0.5rem;
}
</style><script>
      
window.onload = () => {

    // Don't show hovers inside of closed tactic states
    function blockedByTactic(elem) {
      let parent = elem.parentNode;
      while (parent && "classList" in parent) {
        if (parent.classList.contains("tactic")) {
          const toggle = parent.querySelector("input.tactic-toggle");
          if (toggle) {
            return !toggle.checked;
          }
        }
        parent = parent.parentNode;
      }
      return false;
    }

    function blockedByTippy(elem) {
      // Don't show a new hover until the old ones are all closed.
      // Scoped to the nearest "top-level block" to avoid being O(n) in the size of the document.
      var block = elem;
      const topLevel = new Set(["section", "body", "html", "nav", "header"]);
      while (block.parentNode && !topLevel.has(block.parentNode.nodeName.toLowerCase())) {
        block = block.parentNode;
      }
      for (const child of block.querySelectorAll(".token, .has-info")) {
        if (child._tippy && child._tippy.state.isVisible) { return true };
      }
      return false;
    }

    for (const c of document.querySelectorAll(".hl.lean .token")) {
        if (c.dataset.binding != "") {
            c.addEventListener("mouseover", (event) => {
                if (blockedByTactic(c)) {return;}
                const context = c.closest(".hl.lean").dataset.leanContext;
                for (const example of document.querySelectorAll(".hl.lean")) {
                    if (example.dataset.leanContext == context) {
                        for (const tok of example.querySelectorAll(".token")) {
                            if (c.dataset.binding == tok.dataset.binding) {
                                tok.classList.add("binding-hl");
                            }
                        }
                    }
                }
            });
        }
        c.addEventListener("mouseout", (event) => {
            for (const tok of document.querySelectorAll(".hl.lean .token")) {
                tok.classList.remove("binding-hl");
            }
        });
    }
    /* Render docstrings */
    if ('undefined' !== typeof marked) {
        for (const d of document.querySelectorAll("code.docstring, pre.docstring")) {
            const str = d.innerText;
            const html = marked.parse(str);
            const rendered = document.createElement("div");
            rendered.classList.add("docstring");
            rendered.innerHTML = html;
            d.parentNode.replaceChild(rendered, d);
        }
    }
    // Add hovers
    let siteRoot = typeof __versoSiteRoot !== 'undefined' ? __versoSiteRoot : "/";
    let docsJson = siteRoot + "-verso-docs.json";
    fetch(docsJson).then((resp) => resp.json()).then((versoDocData) => {

      function hideParentTooltips(element) {
        let parent = element.parentElement;
        while (parent) {
          const tippyInstance = parent._tippy;
          if (tippyInstance) {
            tippyInstance.hide();
          }
          parent = parent.parentElement;
        }
      }



      const defaultTippyProps = {
        /* DEBUG -- remove the space: * /
        onHide(any) { return false; },
        trigger: "click",
        // */
        /* theme: "lean", */
        maxWidth: "none",
        appendTo: () => document.body,
        interactive: true,
        delay: [100, null],
        /* ignoreAttributes: true, */
        followCursor: 'initial',
        onShow(inst) {
          if (inst.reference.className == 'tactic') {

            const toggle = inst.reference.querySelector("input.tactic-toggle");
            if (toggle && toggle.checked) {
              return false;
            }
            hideParentTooltips(inst.reference);
            //if (blockedByTippy(inst.reference)) { return false; }

          } else if (inst.reference.querySelector(".hover-info") || "versoHover" in inst.reference.dataset) {
            if (blockedByTactic(inst.reference)) { return false };
            if (blockedByTippy(inst.reference)) { return false; }
          } else { // Nothing to show here!
            return false;
          }
        },
        content (tgt) {
          const content = document.createElement("span");
          if (tgt.className == 'tactic') {
            const state = tgt.querySelector(".tactic-state").cloneNode(true);
            state.style.display = "block";
            content.appendChild(state);
            content.style.display = "block";
            content.className = "hl lean popup";
          } else {
            content.className = "hl lean";
            content.style.display = "block";
            content.style.maxHeight = "300px";
            content.style.overflowY = "auto";
            content.style.overflowX = "hidden";
            const hoverId = tgt.dataset.versoHover;
            const hoverInfo = tgt.querySelector(".hover-info");
            if (hoverId) { // Docstrings from the table
              // TODO stop doing an implicit conversion from string to number here
              let data = versoDocData[hoverId];
              if (data) {
                const info = document.createElement("span");
                info.className = "hover-info";
                info.style.display = "block";
                info.innerHTML = data;
                content.appendChild(info);
                /* Render docstrings - TODO server-side */
                if ('undefined' !== typeof marked) {
                    for (const d of content.querySelectorAll("code.docstring, pre.docstring")) {
                        const str = d.innerText;
                        const html = marked.parse(str);
                        const rendered = document.createElement("div");
                        rendered.classList.add("docstring");
                        rendered.innerHTML = html;
                        d.parentNode.replaceChild(rendered, d);
                    }
                }
              } else {
                content.innerHTML = "Failed to load doc ID: " + hoverId;
              }
            } else if (hoverInfo) { // The inline info, still used for compiler messages
              content.appendChild(hoverInfo.cloneNode(true));
            }
          }
          return content;
        }
      };



      const addTippy = (selector, props) => {
        tippy(selector, Object.assign({}, defaultTippyProps, props));
      };
      document.querySelectorAll('.hl.lean .const.token, .hl.lean .keyword.token, .hl.lean .literal.token, .hl.lean .option.token, .hl.lean .var.token, .hl.lean .typed.token').forEach(element => {
        element.setAttribute('data-tippy-theme', 'lean');
      });
      document.querySelectorAll('.hl.lean .has-info.warning').forEach(element => {
        element.setAttribute('data-tippy-theme', 'warning message');
      });
      document.querySelectorAll('.hl.lean .has-info.info').forEach(element => {
        element.setAttribute('data-tippy-theme', 'info message');
      });
      document.querySelectorAll('.hl.lean .has-info.error').forEach(element => {
        element.setAttribute('data-tippy-theme', 'error message');
      });
      document.querySelectorAll('.hl.lean .tactic').forEach(element => {
        element.setAttribute('data-tippy-theme', 'tactic');
      });
      let insts = tippy('.hl.lean .const.token, .hl.lean .keyword.token, .hl.lean .literal.token, .hl.lean .option.token, .hl.lean .var.token, .hl.lean .typed.token, .hl.lean .has-info, .hl.lean .tactic', defaultTippyProps);



      /*
      tippy('.hl.lean .tactic', {
        allowHtml: true,

        onHide(any) { return false; },
        trigger: "click",

        maxWidth: "none",
        onShow(inst) {
          const toggle = inst.reference.querySelector("input.tactic-toggle");
          if (toggle && toggle.checked) {
            return false;
          }
          if (blockedByTippy(inst.reference)) { return false; }
        },
        content (tgt) {
          const content = document.createElement("span");
          const state = tgt.querySelector(".tactic-state").cloneNode(true);
          state.style.display = "block";
          content.appendChild(state);
          content.style.display = "block";
          content.className = "hl lean popup";
          return content;
        }
      });
      */
  });
}
</script>
    </head>
  <body>
    <header>
      <div class="header-logo-wrapper">
        <a href="" id="logo"><img src="static/lean_logo.svg"></a></div>
      <div class="header-title-wrapper">
        <a href="" class="header-title"><h1>
            Functional Programming in Lean</h1>
          </a></div>
      </header>
    <label for="toggle-toc" id="toggle-toc-click"><span class="line line1"></span><span class="line line2"></span><span class="line line3"></span></label><div class="with-toc">
      <div class="toc-backdrop" onclick="document.getElementById('toggle-toc-click')?.click()"></div>
      <nav id="toc">
        <input type="checkbox" id="toggle-toc"><div class="first">
          <a href="" class="toc-title"><h1>
              Functional Programming in Lean</h1>
            </a><div class="split-tocs">
            <div class="split-toc book">
              <div class="title">
                <label for="--verso-manual-toc-----bookRoot" class="toggle-split-toc"><input type="checkbox" class="toggle-split-toc" id="--verso-manual-toc-----bookRoot"></label><span class="">Table of Contents</span></div>
              <table><tr class="unnumbered"><td class="num"><td><a href="Introduction/#Functional-Programming-in-Lean--Introduction">Introduction</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="Acknowledgments/#Functional-Programming-in-Lean--Acknowledgments">Acknowledgments</a></td></tr><tr class="numbered"><td class="num">1.</td><td><a href="Getting-to-Know-Lean/#getting-to-know">Getting to Know Lean</a></td></tr><tr class="numbered"><td class="num">2.</td><td><a href="Hello___-World___/#hello-world">Hello, World!</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="Interlude___-Propositions___-Proofs___-and-Indexing/#props-proofs-indexing">Interlude: Propositions, Proofs, and Indexing</a></td></tr><tr class="numbered"><td class="num">3.</td><td><a href="Overloading-and-Type-Classes/#Functional-Programming-in-Lean--Overloading-and-Type-Classes">Overloading and Type Classes</a></td></tr><tr class="numbered"><td class="num">4.</td><td><a href="Monads/#Functional-Programming-in-Lean--Monads">Monads</a></td></tr><tr class="numbered"><td class="num">5.</td><td><a href="Functors___-Applicative-Functors___-and-Monads/#Functional-Programming-in-Lean--Functors___-Applicative-Functors___-and-Monads">Functors, Applicative Functors, and Monads</a></td></tr><tr class="current numbered"><td class="num">6.</td><td><a href="Monad-Transformers/#Functional-Programming-in-Lean--Monad-Transformers">Monad Transformers</a></td></tr><tr class="numbered"><td class="num">7.</td><td><a href="Programming-with-Dependent-Types/#Functional-Programming-in-Lean--Programming-with-Dependent-Types">Programming with Dependent Types</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="Interlude___-Tactics___-Induction___-and-Proofs/#Functional-Programming-in-Lean--Interlude___-Tactics___-Induction___-and-Proofs">Interlude: Tactics, Induction, and Proofs</a></td></tr><tr class="numbered"><td class="num">8.</td><td><a href="Programming___-Proving___-and-Performance/#Functional-Programming-in-Lean--Programming___-Proving___-and-Performance">Programming, Proving, and Performance</a></td></tr><tr class="numbered"><td class="num">9.</td><td><a href="Next-Steps/#next-steps">Next Steps</a></td></tr></table></div>
            <div class="split-toc">
              <div class="title">
                <label for="--verso-manual-toc-Functional-Programming-in-Lean--Monad-Transformers" class="toggle-split-toc"><input type="checkbox" class="toggle-split-toc" id="--verso-manual-toc-Functional-Programming-in-Lean--Monad-Transformers" checked="checked"></label><span class="number">6.</span> <span class=""><a href="Monad-Transformers/#Functional-Programming-in-Lean--Monad-Transformers">Monad Transformers</a></span></div>
              <table><tr class="numbered"><td class="num">6.1.</td><td><a href="Monad-Transformers/Combining-IO-and-Reader/#Functional-Programming-in-Lean--Monad-Transformers--Combining-IO-and-Reader">Combining IO and Reader</a></td></tr><tr class="numbered"><td class="num">6.2.</td><td><a href="Monad-Transformers/A-Monad-Construction-Kit/#Functional-Programming-in-Lean--Monad-Transformers--A-Monad-Construction-Kit">A Monad Construction Kit</a></td></tr><tr class="numbered"><td class="num">6.3.</td><td><a href="Monad-Transformers/Ordering-Monad-Transformers/#Functional-Programming-in-Lean--Monad-Transformers--Ordering-Monad-Transformers">Ordering Monad Transformers</a></td></tr><tr class="current numbered"><td class="num">6.4.</td><td><a href="Monad-Transformers/More-do-Features/#Functional-Programming-in-Lean--Monad-Transformers--More-do-Features">More do Features</a></td></tr><tr class="numbered"><td class="num">6.5.</td><td><a href="Monad-Transformers/Additional-Conveniences/#Functional-Programming-in-Lean--Monad-Transformers--Additional-Conveniences">Additional Conveniences</a></td></tr><tr class="numbered"><td class="num">6.6.</td><td><a href="Monad-Transformers/Summary/#Functional-Programming-in-Lean--Monad-Transformers--Summary">Summary</a></td></tr></table></div>
            <div class="split-toc">
              <div class="title">
                <label for="--verso-manual-toc-Functional-Programming-in-Lean--Monad-Transformers--More-do-Features" class="toggle-split-toc"><input type="checkbox" class="toggle-split-toc" id="--verso-manual-toc-Functional-Programming-in-Lean--Monad-Transformers--More-do-Features" checked="checked"></label><span class="number">6.4.</span> <span class="current"><a href="Monad-Transformers/More-do-Features/#Functional-Programming-in-Lean--Monad-Transformers--More-do-Features">More do Features</a></span></div>
              <table><tr class="numbered"><td class="num">6.4.1.</td><td><a href="Monad-Transformers/More-do-Features/#Functional-Programming-in-Lean--Monad-Transformers--More-do-Features--Single-Branched--if">Single-Branched <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">if</span></code></a></td></tr><tr class="numbered"><td class="num">6.4.2.</td><td><a href="Monad-Transformers/More-do-Features/#Functional-Programming-in-Lean--Monad-Transformers--More-do-Features--Early-Return">Early Return</a></td></tr><tr class="numbered"><td class="num">6.4.3.</td><td><a href="Monad-Transformers/More-do-Features/#Functional-Programming-in-Lean--Monad-Transformers--More-do-Features--Loops">Loops</a></td></tr><tr class="numbered"><td class="num">6.4.4.</td><td><a href="Monad-Transformers/More-do-Features/#Functional-Programming-in-Lean--Monad-Transformers--More-do-Features--Mutable-Variables">Mutable Variables</a></td></tr><tr class="numbered"><td class="num">6.4.5.</td><td><a href="Monad-Transformers/More-do-Features/#Functional-Programming-in-Lean--Monad-Transformers--More-do-Features--What-counts-as-a--do--block___">What counts as a <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code> block?</a></td></tr><tr class="numbered"><td class="num">6.4.6.</td><td><a href="Monad-Transformers/More-do-Features/#Functional-Programming-in-Lean--Monad-Transformers--More-do-Features--Imperative-or-Functional-Programming___">Imperative or Functional Programming?</a></td></tr><tr class="numbered"><td class="num">6.4.7.</td><td><a href="Monad-Transformers/More-do-Features/#Functional-Programming-in-Lean--Monad-Transformers--More-do-Features--Exercises">Exercises</a></td></tr></table></div>
            </div>
          </div>
        <div class="last">
          <ul id="meta-links">
            <li>
              <a href="https://github.com/leanprover/fp-lean">Source Code</a></li>
            <li>
              <a href="https://github.com/leanprover/fp-lean/issues">Report Issues</a></li>
            </ul>
          </div>
        </nav>
      <main><div class="content-wrapper">
          <nav class="prev-next-buttons">
            <a class="local-button active" href="Monad-Transformers/Ordering-Monad-Transformers/#Functional-Programming-in-Lean--Monad-Transformers--Ordering-Monad-Transformers" rel="prev" title="6.3. Ordering Monad Transformers"><span class="arrow">←</span><span class="where">6.3. Ordering Monad Transformers</span></a><a class="local-button active" href="Monad-Transformers/Additional-Conveniences/#Functional-Programming-in-Lean--Monad-Transformers--Additional-Conveniences" rel="next" title="6.5. Additional Conveniences"><span class="where">6.5. Additional Conveniences</span><span class="arrow">→</span></a></nav>
          <section>
            <h1>
              6.4. More do Features</h1>
            <p>
              Lean's <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code>-notation provides a syntax for writing programs with monads that resembles imperative programming languages.
In addition to providing a convenient syntax for programs with monads, <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code>-notation provides syntax for using certain monad transformers.</p>
            <section>
              <h2 id="Functional-Programming-in-Lean--Monad-Transformers--More-do-Features--Single-Branched--if">
                6.4.1. Single-Branched <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">if</span></code></h2>
              <p>
                When working in a monad, a common pattern is to carry out a side effect only if some condition is true.
For instance, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-StEx.Modify.countLetters" data-verso-hover="1451">countLetters</span></code> contains a check for vowels or consonants, and letters that are neither have no effect on the state.
This is captured by having the <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">else</span></code> branch evaluate to <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span></code>, which has no effects:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-10248">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-StEx.Modify.countLetters" data-verso-hover="1451">countLetters</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.19478" data-verso-hover="39">str</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-StateT" data-verso-hover="1443">StateT</span><span class="inter-text"> </span><span class="const token" data-binding="const-StEx.LetterCounts" data-verso-hover="1431">LetterCounts</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Except" data-verso-hover="745">Except</span><span class="inter-text"> </span><span class="const token" data-binding="const-StEx.Err" data-verso-hover="1434">Err</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-group-10325">let</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-group-10325">rec</span><span class="inter-text"> </span><span class="const token" data-binding="const-StEx.Modify.countLetters.loop" data-verso-hover="1452">loop</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.19494" data-verso-hover="1445">chars</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="const token" data-binding="const-Char" data-verso-hover="1209">Char</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-10361">do</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doMatch-10368">match</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.19494" data-verso-hover="1445">chars</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doMatch-10368">with</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.19644" data-verso-hover="262">c</span><span class="inter-text"> </span><span class="unknown token" data-binding="">::</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.19645" data-verso-hover="1445">cs</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-10428">if</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.19644" data-verso-hover="262">c</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Char.isAlpha" data-verso-hover="974">isAlpha</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-10428">then</span><span class="inter-text">
</span><span class="inter-text">        </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-10454">if</span><span class="inter-text"> </span><span class="const token" data-binding="const-StEx.vowels" data-verso-hover="1436">vowels</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-String.contains" data-verso-hover="674">contains</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.19644" data-verso-hover="262">c</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-10454">then</span><span class="inter-text">
</span><span class="inter-text">          </span><span class="const token" data-binding="const-modify" data-verso-hover="1450">modify</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-10497">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.19896" data-verso-hover="1446">st</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="unknown token" data-binding="">{</span><span class="var token" data-binding="var-_uniq.19896" data-verso-hover="1446">st</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-10508">with</span><span class="inter-text"> </span><span class="const token" data-binding="const-StEx.LetterCounts.vowels" data-verso-hover="117">vowels</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.19896" data-verso-hover="1446">st</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-StEx.LetterCounts.vowels" data-verso-hover="1432">vowels</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">1</span><span class="unknown token" data-binding="">}</span><span class="inter-text">
</span><span class="inter-text">        </span><span class="keyword token" data-binding="kw-occ-group-10549">else</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-group-10549">if</span><span class="inter-text"> </span><span class="const token" data-binding="const-StEx.consonants" data-verso-hover="1440">consonants</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-String.contains" data-verso-hover="674">contains</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.19644" data-verso-hover="262">c</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-group-10549">then</span><span class="inter-text">
</span><span class="inter-text">          </span><span class="const token" data-binding="const-modify" data-verso-hover="1450">modify</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-10601">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.20104" data-verso-hover="1446">st</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="unknown token" data-binding="">{</span><span class="var token" data-binding="var-_uniq.20104" data-verso-hover="1446">st</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-10612">with</span><span class="inter-text"> </span><span class="const token" data-binding="const-StEx.LetterCounts.consonants" data-verso-hover="117">consonants</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.20104" data-verso-hover="1446">st</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-StEx.LetterCounts.consonants" data-verso-hover="1433">consonants</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">1</span><span class="unknown token" data-binding="">}</span><span class="inter-text">
</span><span class="inter-text">        </span><span class="keyword token" data-binding="kw-occ-null-10661">else</span><span class="inter-text"> -- modified or non-English letter</span><span class="inter-text">
</span><span class="inter-text">          </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="keyword token" data-binding="kw-occ-null-10724">else</span><span class="inter-text"> </span><span class="const token" data-binding="const-MonadExcept.throw" data-verso-hover="1418">throw</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-StEx.Err.notALetter" data-verso-hover="1435">.notALetter</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.19644" data-verso-hover="262">c</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-StEx.Modify.countLetters.loop" data-verso-hover="1452">loop</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.19645" data-verso-hover="1445">cs</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-StEx.Modify.countLetters.loop" data-verso-hover="1452">loop</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.19478" data-verso-hover="39">str</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-String.toList" data-verso-hover="1449">toList</span></code><p>
                When an <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">if</span></code> is a statement in a <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code>-block, rather than being an expression, then <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-null-10661">else</span><span class="inter-text"> </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span></code> can simply be omitted, and Lean inserts it automatically.
The following definition of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-StEx.FancyDo.countLetters" data-verso-hover="1480">countLetters</span></code> is completely equivalent:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-236">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-StEx.FancyDo.countLetters" data-verso-hover="1480">countLetters</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.2" data-verso-hover="39">str</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-StateT" data-verso-hover="1443">StateT</span><span class="inter-text"> </span><span class="const token" data-binding="const-StEx.LetterCounts" data-verso-hover="1431">LetterCounts</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Except" data-verso-hover="745">Except</span><span class="inter-text"> </span><span class="const token" data-binding="const-StEx.Err" data-verso-hover="1434">Err</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-group-313">let</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-group-313">rec</span><span class="inter-text"> </span><span class="const token" data-binding="const-StEx.FancyDo.countLetters.loop" data-verso-hover="1481">loop</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.18" data-verso-hover="1445">chars</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="const token" data-binding="const-Char" data-verso-hover="1209">Char</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-349">do</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doMatch-356">match</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.18" data-verso-hover="1445">chars</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doMatch-356">with</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.177" data-verso-hover="262">c</span><span class="inter-text"> </span><span class="unknown token" data-binding="">::</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.178" data-verso-hover="1445">cs</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-416">if</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.177" data-verso-hover="262">c</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Char.isAlpha" data-verso-hover="974">isAlpha</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-416">then</span><span class="inter-text">
</span><span class="inter-text">        </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-442">if</span><span class="inter-text"> </span><span class="const token" data-binding="const-StEx.vowels" data-verso-hover="1436">vowels</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-String.contains" data-verso-hover="674">contains</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.177" data-verso-hover="262">c</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-442">then</span><span class="inter-text">
</span><span class="inter-text">          </span><span class="const token" data-binding="const-modify" data-verso-hover="1450">modify</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-485">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.433" data-verso-hover="1446">st</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="unknown token" data-binding="">{</span><span class="var token" data-binding="var-_uniq.433" data-verso-hover="1446">st</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-496">with</span><span class="inter-text"> </span><span class="const token" data-binding="const-StEx.LetterCounts.vowels" data-verso-hover="117">vowels</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.433" data-verso-hover="1446">st</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-StEx.LetterCounts.vowels" data-verso-hover="1432">vowels</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">1</span><span class="unknown token" data-binding="">}</span><span class="inter-text">
</span><span class="inter-text">        </span><span class="keyword token" data-binding="kw-occ-group-537">else</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-group-537">if</span><span class="inter-text"> </span><span class="const token" data-binding="const-StEx.consonants" data-verso-hover="1440">consonants</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-String.contains" data-verso-hover="674">contains</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.177" data-verso-hover="262">c</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-group-537">then</span><span class="inter-text">
</span><span class="inter-text">          </span><span class="const token" data-binding="const-modify" data-verso-hover="1450">modify</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-589">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.647" data-verso-hover="1446">st</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="unknown token" data-binding="">{</span><span class="var token" data-binding="var-_uniq.647" data-verso-hover="1446">st</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-600">with</span><span class="inter-text"> </span><span class="const token" data-binding="const-StEx.LetterCounts.consonants" data-verso-hover="117">consonants</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.647" data-verso-hover="1446">st</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-StEx.LetterCounts.consonants" data-verso-hover="1433">consonants</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">1</span><span class="unknown token" data-binding="">}</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="keyword token" data-binding="kw-occ-null-647">else</span><span class="inter-text"> </span><span class="const token" data-binding="const-MonadExcept.throw" data-verso-hover="1418">throw</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-StEx.Err.notALetter" data-verso-hover="1435">.notALetter</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.177" data-verso-hover="262">c</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-StEx.FancyDo.countLetters.loop" data-verso-hover="1481">loop</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.178" data-verso-hover="1445">cs</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-StEx.FancyDo.countLetters.loop" data-verso-hover="1481">loop</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2" data-verso-hover="39">str</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-String.toList" data-verso-hover="1449">toList</span></code><p>
                A program that uses a state monad to count the entries in a list that satisfy some monadic check can be written as follows:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-805">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-ThenDoUnless.count" data-verso-hover="1482">count</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="const token" data-binding="const-Monad" data-verso-hover="724">Monad</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1275" data-verso-hover="868">m</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="const token" data-binding="const-MonadState" data-verso-hover="1455">MonadState</span><span class="inter-text"> </span><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1275" data-verso-hover="868">m</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.1308" data-verso-hover="1483">p</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1292" data-verso-hover="759">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1275" data-verso-hover="868">m</span><span class="inter-text"> </span><span class="const token" data-binding="const-Bool" data-verso-hover="40">Bool</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1292" data-verso-hover="759">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1275" data-verso-hover="868">m</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1420" data-verso-hover="121">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">::</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1421" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-918">do</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-925">if</span><span class="inter-text"> </span><span class="unknown token" data-binding="">←</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1308" data-verso-hover="1483">p</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1420" data-verso-hover="121">x</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-925">then</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-modify" data-verso-hover="1450">modify</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">·</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">1</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-ThenDoUnless.count" data-verso-hover="1482">count</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1308" data-verso-hover="1483">p</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1421" data-verso-hover="137">xs</span></code><p>
                Similarly, <code>if not E1 then STMT...</code> can instead be written <code>unless E1 do STMT...</code>.
The converse of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-ThenDoUnless.count" data-verso-hover="1482">count</span></code> that counts entries that don't satisfy the monadic check can be written by replacing <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">if</span></code> with <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">unless</span></code>:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-1021">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-ThenDoUnless.countNot" data-verso-hover="1484">countNot</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="const token" data-binding="const-Monad" data-verso-hover="724">Monad</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2196" data-verso-hover="868">m</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="const token" data-binding="const-MonadState" data-verso-hover="1455">MonadState</span><span class="inter-text"> </span><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2196" data-verso-hover="868">m</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.2229" data-verso-hover="1483">p</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2213" data-verso-hover="759">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2196" data-verso-hover="868">m</span><span class="inter-text"> </span><span class="const token" data-binding="const-Bool" data-verso-hover="40">Bool</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2213" data-verso-hover="759">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2196" data-verso-hover="868">m</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2341" data-verso-hover="121">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">::</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2342" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-1137">do</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doUnless-1144">unless</span><span class="inter-text"> </span><span class="unknown token" data-binding="">←</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2229" data-verso-hover="1483">p</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2341" data-verso-hover="121">x</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doUnless-1144">do</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-modify" data-verso-hover="1450">modify</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">·</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">1</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-ThenDoUnless.countNot" data-verso-hover="1484">countNot</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2229" data-verso-hover="1483">p</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2342" data-verso-hover="137">xs</span></code><p>
                Understanding single-branched <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">if</span></code> and <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">unless</span></code> does not require thinking about monad transformers.
They simply replace the missing branch with <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span></code>.
The remaining extensions in this section, however, require Lean to automatically rewrite the <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code>-block to add a local transformer on top of the monad that the <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code>-block is written in.</p>
              </section>
            <section>
              <h2 id="Functional-Programming-in-Lean--Monad-Transformers--More-do-Features--Early-Return">
                6.4.2. Early Return</h2>
              <p>
                The standard library contains a function <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Loops.List.find?" data-verso-hover="1485">List.find?</span></code> that returns the first entry in a list that satisfies some check.
A simple implementation that doesn't make use of the fact that <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Option" data-verso-hover="142">Option</span></code> is a monad loops over the list using a recursive function, with an <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">if</span></code> to stop the loop when the desired entry is found:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-1310">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-EarlyReturn.Non.List.find?" data-verso-hover="1486">List.find?</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.3120" data-verso-hover="195">p</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3116" data-verso-hover="369">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Bool" data-verso-hover="40">Bool</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3116" data-verso-hover="369">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option" data-verso-hover="142">Option</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3116" data-verso-hover="369">α</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option.none" data-verso-hover="374">none</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3163" data-verso-hover="121">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">::</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3164" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-termIfThenElse-1401" data-verso-hover="16">if</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3120" data-verso-hover="195">p</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3163" data-verso-hover="121">x</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-termIfThenElse-1401" data-verso-hover="16">then</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-Option.some" data-verso-hover="373">some</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3163" data-verso-hover="121">x</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-termIfThenElse-1401" data-verso-hover="16">else</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-EarlyReturn.Non.List.find?" data-verso-hover="1486">find?</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3120" data-verso-hover="195">p</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3164" data-verso-hover="137">xs</span></code><p>
                Imperative languages typically sport the <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">return</span></code> keyword that aborts the execution of a function, immediately returning some value to the caller.
In Lean, this is available in <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code>-notation, and <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">return</span></code> halts the execution of a <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code>-block, with <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">return</span></code>'s argument being the value returned from the monad.
In other words, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-EarlyReturn.List.find?" data-verso-hover="1487">List.find?</span></code> could have been written like this:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-1515">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-EarlyReturn.List.find?" data-verso-hover="1487">List.find?</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.3428" data-verso-hover="195">p</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3424" data-verso-hover="369">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Bool" data-verso-hover="40">Bool</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3424" data-verso-hover="369">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option" data-verso-hover="142">Option</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3424" data-verso-hover="369">α</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Alternative.failure" data-verso-hover="1199">failure</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3494" data-verso-hover="121">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">::</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3495" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-1605">do</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-1612">if</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3428" data-verso-hover="195">p</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3494" data-verso-hover="121">x</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-1612">then</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doReturn-1624" data-verso-hover="1488">return</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3494" data-verso-hover="121">x</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-EarlyReturn.List.find?" data-verso-hover="1487">find?</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3428" data-verso-hover="195">p</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3495" data-verso-hover="137">xs</span></code><p>
                Early return in imperative languages is a bit like an exception that can only cause the current stack frame to be unwound.
Both early return and exceptions terminate execution of a block of code, effectively replacing the surrounding code with the thrown value.
Behind the scenes, early return in Lean is implemented using a version of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-ExceptT" data-verso-hover="1474">ExceptT</span></code>.
Each <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code>-block that uses early return is wrapped in an exception handler (in the sense of the function <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Ex.MyMonadExcept.MonadExcept.tryCatch" data-verso-hover="1412">tryCatch</span></code>).
Early returns are translated to throwing the value as an exception, and the handlers catch the thrown value and return it immediately.
In other words, the <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code>-block's original return value type is also used as the exception type.</p>
              <p>
                Making this more concrete, the helper function <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-EarlyReturn.runCatch" data-verso-hover="1489">runCatch</span></code> strips a layer of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-ExceptT" data-verso-hover="1474">ExceptT</span></code> from the top of a monad transformer stack when the exception type and return type are the same:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-1698">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-EarlyReturn.runCatch" data-verso-hover="1489">runCatch</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="const token" data-binding="const-Monad" data-verso-hover="724">Monad</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3951" data-verso-hover="1125">m</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.3974" data-verso-hover="1490">action</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-ExceptT" data-verso-hover="1474">ExceptT</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3962" data-verso-hover="369">α</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3951" data-verso-hover="1125">m</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3962" data-verso-hover="369">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3951" data-verso-hover="1125">m</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3962" data-verso-hover="369">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-1758">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doMatch-1763">match</span><span class="inter-text"> </span><span class="unknown token" data-binding="">←</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3974" data-verso-hover="1490">action</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doMatch-1763">with</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.ok" data-verso-hover="747">Except.ok</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4088" data-verso-hover="121">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4088" data-verso-hover="121">x</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Except.error" data-verso-hover="746">Except.error</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4164" data-verso-hover="121">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4164" data-verso-hover="121">x</span></code><p>
                The <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code>-block in <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Loops.List.find?" data-verso-hover="1485">List.find?</span></code> that uses early return is translated to a <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code>-block that does not use early return by wrapping it in a use of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-EarlyReturn.runCatch" data-verso-hover="1489">runCatch</span></code>, and replacing early returns with <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-MonadExcept.throw" data-verso-hover="1418">throw</span></code>:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-1914">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-EarlyReturn.Desugared.List.find?" data-verso-hover="1491">List.find?</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.4292" data-verso-hover="195">p</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4288" data-verso-hover="113">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Bool" data-verso-hover="40">Bool</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4288" data-verso-hover="113">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option" data-verso-hover="142">Option</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4288" data-verso-hover="113">α</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Alternative.failure" data-verso-hover="1199">failure</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4358" data-verso-hover="121">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">::</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4359" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-EarlyReturn.runCatch" data-verso-hover="1489">runCatch</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-2017">do</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-2026">if</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4292" data-verso-hover="195">p</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4358" data-verso-hover="121">x</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-2026">then</span><span class="inter-text"> </span><span class="const token" data-binding="const-MonadExcept.throw" data-verso-hover="1418">throw</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4358" data-verso-hover="121">x</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-2046">else</span><span class="inter-text"> </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-MonadLiftT.monadLift" data-verso-hover="1360">monadLift</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-EarlyReturn.Desugared.List.find?" data-verso-hover="1491">find?</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4292" data-verso-hover="195">p</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4359" data-verso-hover="137">xs</span><span class="unknown token" data-binding="">)</span></code><p>
                Another situation in which early return is useful is command-line applications that terminate early if the arguments or input are incorrect.
Many programs begin with a section that validates arguments and inputs before proceeding to the main body of the program.
The following version of <a href="Hello___-World___/Running-a-Program/#running-a-program">the greeting program <code>hello-name</code></a> checks that no command-line arguments were provided:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-16">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-main" data-verso-hover="1492">main</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.3" data-verso-hover="315">argv</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span><span class="inter-text"> </span><span class="const token" data-binding="const-UInt32" data-verso-hover="314">UInt32</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-61">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLetArrow-66">let</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.133" data-verso-hover="251">stdin</span><span class="inter-text"> </span><span class="unknown token" data-binding="">←</span><span class="inter-text"> </span><span class="const token" data-binding="const-IO.getStdin" data-verso-hover="252">IO.getStdin</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLetArrow-94">let</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.177" data-verso-hover="251">stdout</span><span class="inter-text"> </span><span class="unknown token" data-binding="">←</span><span class="inter-text"> </span><span class="const token" data-binding="const-IO.getStdout" data-verso-hover="253">IO.getStdout</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLetArrow-124">let</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.221" data-verso-hover="251">stderr</span><span class="inter-text"> </span><span class="unknown token" data-binding="">←</span><span class="inter-text"> </span><span class="const token" data-binding="const-IO.getStderr" data-verso-hover="307">IO.getStderr</span><span class="inter-text">
</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doUnless-155">unless</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3" data-verso-hover="315">argv</span><span class="inter-text"> </span><span class="unknown token" data-binding="">==</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doUnless-155">do</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="var token" data-binding="var-_uniq.221" data-verso-hover="251">stderr</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-IO.FS.Stream.putStrLn" data-verso-hover="254">putStrLn</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-termS!_-196">s!</span><span class="unknown token" data-binding="">"Expected no arguments, but got {</span><span class="var token" data-binding="var-_uniq.3" data-verso-hover="315">argv</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-List.length" data-verso-hover="140">length</span><span class="unknown token" data-binding="">}"</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doReturn-249" data-verso-hover="1488">return</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="313">1</span><span class="inter-text">
</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="var token" data-binding="var-_uniq.177" data-verso-hover="251">stdout</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-IO.FS.Stream.putStrLn" data-verso-hover="254">putStrLn</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="255">"How would you like to be addressed?"</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="var token" data-binding="var-_uniq.177" data-verso-hover="251">stdout</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-IO.FS.Stream.flush" data-verso-hover="594">flush</span><span class="inter-text">
</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLet-333">let</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.760" data-verso-hover="39">name</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">←</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.133" data-verso-hover="251">stdin</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-IO.FS.Stream.getLine" data-verso-hover="256">getLine</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-String.trim" data-verso-hover="325">trim</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-372">if</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.760" data-verso-hover="39">name</span><span class="inter-text"> </span><span class="unknown token" data-binding="">==</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="207">""</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-372">then</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="var token" data-binding="var-_uniq.221" data-verso-hover="251">stderr</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-IO.FS.Stream.putStrLn" data-verso-hover="254">putStrLn</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-termS!_-411">s!</span><span class="unknown token" data-binding="">"No name provided"</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doReturn-436" data-verso-hover="1488">return</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="313">1</span><span class="inter-text">
</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="var token" data-binding="var-_uniq.177" data-verso-hover="251">stdout</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-IO.FS.Stream.putStrLn" data-verso-hover="254">putStrLn</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-termS!_-464">s!</span><span class="unknown token" data-binding="">"Hello, {</span><span class="var token" data-binding="var-_uniq.760" data-verso-hover="39">name</span><span class="unknown token" data-binding="">}!"</span><span class="inter-text">
</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doReturn-486" data-verso-hover="1488">return</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="313">0</span></code><p>
                Running it with no arguments and typing the name <code>David</code> yields the same result as the previous version:</p>
              <div class="shell-commands">
                <code class="command">lean --run EarlyReturn.lean</code><code class="output">How would you like to be addressed?
David
Hello, David!
</code></div>
              <p>
                Providing the name as a command-line argument instead of an answer causes an error:</p>
              <div class="shell-commands">
                <code class="command">lean --run EarlyReturn.lean David</code><code class="output">Expected no arguments, but got 1
</code></div>
              <p>
                And providing no name causes the other error:</p>
              <div class="shell-commands">
                <code class="command">lean --run EarlyReturn.lean</code><code class="output">How would you like to be addressed?

No name provided
</code></div>
              <p>
                The program that uses early return avoids needing to nest the control flow, as is done in this version that does not use early return:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-555">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Nested.main" data-verso-hover="1493">main</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.1225" data-verso-hover="315">argv</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span><span class="inter-text"> </span><span class="const token" data-binding="const-UInt32" data-verso-hover="314">UInt32</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-600">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLetArrow-605">let</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1355" data-verso-hover="251">stdin</span><span class="inter-text"> </span><span class="unknown token" data-binding="">←</span><span class="inter-text"> </span><span class="const token" data-binding="const-IO.getStdin" data-verso-hover="252">IO.getStdin</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLetArrow-633">let</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1399" data-verso-hover="251">stdout</span><span class="inter-text"> </span><span class="unknown token" data-binding="">←</span><span class="inter-text"> </span><span class="const token" data-binding="const-IO.getStdout" data-verso-hover="253">IO.getStdout</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLetArrow-663">let</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1443" data-verso-hover="251">stderr</span><span class="inter-text"> </span><span class="unknown token" data-binding="">←</span><span class="inter-text"> </span><span class="const token" data-binding="const-IO.getStderr" data-verso-hover="307">IO.getStderr</span><span class="inter-text">
</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-694">if</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1225" data-verso-hover="315">argv</span><span class="inter-text"> </span><span class="unknown token" data-binding="">!=</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-694">then</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="var token" data-binding="var-_uniq.1443" data-verso-hover="251">stderr</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-IO.FS.Stream.putStrLn" data-verso-hover="254">putStrLn</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-termS!_-733">s!</span><span class="unknown token" data-binding="">"Expected no arguments, but got {</span><span class="var token" data-binding="var-_uniq.1225" data-verso-hover="315">argv</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-List.length" data-verso-hover="140">length</span><span class="unknown token" data-binding="">}"</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="313">1</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-null-795">else</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="var token" data-binding="var-_uniq.1399" data-verso-hover="251">stdout</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-IO.FS.Stream.putStrLn" data-verso-hover="254">putStrLn</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="255">"How would you like to be addressed?"</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="var token" data-binding="var-_uniq.1399" data-verso-hover="251">stdout</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-IO.FS.Stream.flush" data-verso-hover="594">flush</span><span class="inter-text">
</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLet-880">let</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1872" data-verso-hover="39">name</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">←</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1355" data-verso-hover="251">stdin</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-IO.FS.Stream.getLine" data-verso-hover="256">getLine</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-String.trim" data-verso-hover="325">trim</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-921">if</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1872" data-verso-hover="39">name</span><span class="inter-text"> </span><span class="unknown token" data-binding="">==</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="207">""</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-921">then</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="var token" data-binding="var-_uniq.1443" data-verso-hover="251">stderr</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-IO.FS.Stream.putStrLn" data-verso-hover="254">putStrLn</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-termS!_-962">s!</span><span class="unknown token" data-binding="">"No name provided"</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="313">1</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-null-1000">else</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="var token" data-binding="var-_uniq.1399" data-verso-hover="251">stdout</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-IO.FS.Stream.putStrLn" data-verso-hover="254">putStrLn</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-termS!_-1027">s!</span><span class="unknown token" data-binding="">"Hello, {</span><span class="var token" data-binding="var-_uniq.1872" data-verso-hover="39">name</span><span class="unknown token" data-binding="">}!"</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="313">0</span></code><p>
                One important difference between early return in Lean and early return in imperative languages is that Lean's early return applies only to the current <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code>-block.
When the entire definition of a function is in the same <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code> block, this difference doesn't matter.
But if <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code> occurs underneath some other structures, then the difference becomes apparent.
For example, given the following definition of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-EarlyReturn.greet" data-verso-hover="1494">greet</span></code>:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-2312">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-EarlyReturn.greet" data-verso-hover="1494">greet</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.5778" data-verso-hover="39">name</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="literal string token" data-binding="" data-verso-hover="10">"Hello, "</span><span class="inter-text"> </span><span class="unknown token" data-binding="">++</span><span class="inter-text"> </span><span class="const token" data-binding="const-Id.run" data-verso-hover="1495">Id.run</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-2372">do</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doReturn-2375" data-verso-hover="1488">return</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.5778" data-verso-hover="39">name</span></code><p>
                the expression <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-EarlyReturn.greet" data-verso-hover="1494">greet</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="264">"David"</span></code> evaluates to <code class="hl lean inline" data-lean-context="examples"><span class="literal string token" data-binding="" data-verso-hover="1496">"Hello, David"</span></code>, not just <code class="hl lean inline" data-lean-context="examples"><span class="literal string token" data-binding="" data-verso-hover="264">"David"</span></code>.</p>
              </section>
            <section>
              <h2 id="Functional-Programming-in-Lean--Monad-Transformers--More-do-Features--Loops">
                6.4.3. Loops</h2>
              <p>
                Just as every program with mutable state can be rewritten to a program that passes the state as arguments, every loop can be rewritten as a recursive function.
From one perspective, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Loops.List.find?" data-verso-hover="1485">List.find?</span></code> is most clear as a recursive function.
After all, its definition mirrors the structure of the list: if the head passes the check, then it should be returned; otherwise look in the tail.
When no more entries remain, the answer is <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Option.none" data-verso-hover="374">none</span></code>.
From another perspective, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Loops.List.find?" data-verso-hover="1485">List.find?</span></code> is most clear as a loop.
After all, the program consults the entries in order until a satisfactory one is found, at which point it terminates.
If the loop terminates without having returned, the answer is <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Option.none" data-verso-hover="374">none</span></code>.</p>
              <section>
                <h3 id="Functional-Programming-in-Lean--Monad-Transformers--More-do-Features--Loops--Looping-with-ForM">
                  6.4.3.1. Looping with ForM</h3>
                <p>
                  Lean includes a type class that describes looping over a container type in some monad.
This class is called <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Loops.Fake.ForM" data-verso-hover="1497">ForM</span></code>:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.classTk-2867">class</span><span class="inter-text"> </span><span class="const token" data-binding="const-Loops.Fake.ForM" data-verso-hover="1497">ForM</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.6648" data-verso-hover="1246">m</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.type-2883" data-verso-hover="50">Type</span><span class="inter-text"> </span><span class="unknown token" data-binding="">u</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.type-2894" data-verso-hover="50">Type</span><span class="inter-text"> </span><span class="unknown token" data-binding="">v</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.6650" data-verso-hover="1498">γ</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.type-2908" data-verso-hover="50">Type</span><span class="inter-text"> </span><span class="unknown token" data-binding="">w₁</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.6653" data-verso-hover="1499">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-outParam" data-verso-hover="448">outParam</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.type-2939" data-verso-hover="50">Type</span><span class="inter-text"> </span><span class="unknown token" data-binding="">w₂</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-2951">where</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Loops.Fake.ForM.forM" data-verso-hover="1500">forM</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="const token" data-binding="const-Monad" data-verso-hover="724">Monad</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6648" data-verso-hover="1246">m</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6650" data-verso-hover="1498">γ</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.6653" data-verso-hover="1499">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6648" data-verso-hover="1246">m</span><span class="inter-text"> </span><span class="const token" data-binding="const-PUnit" data-verso-hover="1458">PUnit</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6648" data-verso-hover="1246">m</span><span class="inter-text"> </span><span class="const token" data-binding="const-PUnit" data-verso-hover="1458">PUnit</span></code><p>
                  This class is quite general.
The parameter <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.6648" data-verso-hover="1246">m</span></code> is a monad with some desired effects, <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.6650" data-verso-hover="1498">γ</span></code> is the collection to be looped over, and <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.6653" data-verso-hover="1499">α</span></code> is the type of elements from the collection.
Typically, <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.6648" data-verso-hover="1246">m</span></code> is allowed to be any monad, but it is possible to have a data structure that e.g. only supports looping in <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span></code>.
The method <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Loops.Fake.ForM.forM" data-verso-hover="1500">forM</span></code> takes a collection, a monadic action to be run for its effects on each element from the collection, and is then responsible for running the actions.</p>
                <p>
                  The instance for <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-List" data-verso-hover="111">List</span></code> allows <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.6729" data-verso-hover="868">m</span></code> to be any monad, it sets <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.6650" data-verso-hover="1498">γ</span></code> to be <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6740" data-verso-hover="759">α</span></code>, and sets the class's <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.6653" data-verso-hover="1499">α</span></code> to be the same <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.6740" data-verso-hover="759">α</span></code> found in the list:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-3055">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Loops.Fake.List.forM" data-verso-hover="1501">List.forM</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="const token" data-binding="const-Monad" data-verso-hover="724">Monad</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6729" data-verso-hover="868">m</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6740" data-verso-hover="759">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.6740" data-verso-hover="759">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6729" data-verso-hover="868">m</span><span class="inter-text"> </span><span class="const token" data-binding="const-PUnit" data-verso-hover="1458">PUnit</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6729" data-verso-hover="868">m</span><span class="inter-text"> </span><span class="const token" data-binding="const-PUnit" data-verso-hover="1458">PUnit</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="unknown token" data-binding="">_</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6895" data-verso-hover="121">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">::</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6896" data-verso-hover="137">xs</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6897" data-verso-hover="1502">action</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-3166">do</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="var token" data-binding="var-_uniq.6897" data-verso-hover="1502">action</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6895" data-verso-hover="121">x</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-Loops.Fake.List.forM" data-verso-hover="1501">forM</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6896" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6897" data-verso-hover="1502">action</span><span class="inter-text">
</span><span class="inter-text">
</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.instance-3202">instance</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Loops.Fake.ForM" data-verso-hover="1497">ForM</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7300" data-verso-hover="868">m</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7310" data-verso-hover="759">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7310" data-verso-hover="759">α</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.whereStructInst-3233">where</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Loops.Fake.ForM.forM" data-verso-hover="1503">forM</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="const token" data-binding="const-Loops.Fake.List.forM" data-verso-hover="1501">List.forM</span></code><p>
                  The <a href="Monad-Transformers/Combining-IO-and-Reader/#reader-io-implementation">function <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.doList" data-verso-hover="1504">doList</span></code> from <code>doug</code></a> is <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Loops.Fake.ForM.forM" data-verso-hover="1500">forM</span></code> for lists.
Because <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-ForM.forM" data-verso-hover="1505">forM</span></code> is intended to be used in <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code>-blocks, it uses <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monad" data-verso-hover="724">Monad</span></code> rather than <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Applicative" data-verso-hover="1008">Applicative</span></code>.
<code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Loops.Fake.ForM.forM" data-verso-hover="1500">forM</span></code> can be used to make <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Loops.Fake.countLetters" data-verso-hover="1506">countLetters</span></code> much shorter:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-3363">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Loops.Fake.countLetters" data-verso-hover="1506">countLetters</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.7425" data-verso-hover="39">str</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-StateT" data-verso-hover="1443">StateT</span><span class="inter-text"> </span><span class="const token" data-binding="const-StEx.LetterCounts" data-verso-hover="1431">LetterCounts</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Except" data-verso-hover="745">Except</span><span class="inter-text"> </span><span class="const token" data-binding="const-StEx.Err" data-verso-hover="1434">Err</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-ForM.forM" data-verso-hover="1505">forM</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7425" data-verso-hover="39">str</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-String.toList" data-verso-hover="1449">toList</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-3456">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7558" data-verso-hover="262">c</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-3465">do</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-3472">if</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7558" data-verso-hover="262">c</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Char.isAlpha" data-verso-hover="974">isAlpha</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-3472">then</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-3496">if</span><span class="inter-text"> </span><span class="const token" data-binding="const-StEx.vowels" data-verso-hover="1436">vowels</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-String.contains" data-verso-hover="674">contains</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7558" data-verso-hover="262">c</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-3496">then</span><span class="inter-text">
</span><span class="inter-text">        </span><span class="const token" data-binding="const-modify" data-verso-hover="1450">modify</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-3537">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7835" data-verso-hover="1446">st</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="unknown token" data-binding="">{</span><span class="var token" data-binding="var-_uniq.7835" data-verso-hover="1446">st</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-3548">with</span><span class="inter-text"> </span><span class="const token" data-binding="const-StEx.LetterCounts.vowels" data-verso-hover="117">vowels</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7835" data-verso-hover="1446">st</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-StEx.LetterCounts.vowels" data-verso-hover="1432">vowels</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">1</span><span class="unknown token" data-binding="">}</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="keyword token" data-binding="kw-occ-group-3587">else</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-group-3587">if</span><span class="inter-text"> </span><span class="const token" data-binding="const-StEx.consonants" data-verso-hover="1440">consonants</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-String.contains" data-verso-hover="674">contains</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7558" data-verso-hover="262">c</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-group-3587">then</span><span class="inter-text">
</span><span class="inter-text">        </span><span class="const token" data-binding="const-modify" data-verso-hover="1450">modify</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-3637">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7982" data-verso-hover="1446">st</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="unknown token" data-binding="">{</span><span class="var token" data-binding="var-_uniq.7982" data-verso-hover="1446">st</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-3648">with</span><span class="inter-text"> </span><span class="const token" data-binding="const-StEx.LetterCounts.consonants" data-verso-hover="117">consonants</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7982" data-verso-hover="1446">st</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-StEx.LetterCounts.consonants" data-verso-hover="1433">consonants</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">1</span><span class="unknown token" data-binding="">}</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-null-3693">else</span><span class="inter-text"> </span><span class="const token" data-binding="const-MonadExcept.throw" data-verso-hover="1418">throw</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-StEx.Err.notALetter" data-verso-hover="1435">.notALetter</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7558" data-verso-hover="262">c</span><span class="unknown token" data-binding="">)</span></code><p>
                  The instance for <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Many" data-verso-hover="912">Many</span></code> is very similar:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-2556">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Many.forM" data-verso-hover="1507">Many.forM</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="const token" data-binding="const-Monad" data-verso-hover="724">Monad</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.5948" data-verso-hover="868">m</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Many" data-verso-hover="912">Many</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.5958" data-verso-hover="113">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.5958" data-verso-hover="113">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.5948" data-verso-hover="868">m</span><span class="inter-text"> </span><span class="const token" data-binding="const-PUnit" data-verso-hover="1458">PUnit</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.5948" data-verso-hover="868">m</span><span class="inter-text"> </span><span class="const token" data-binding="const-PUnit" data-verso-hover="1458">PUnit</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Many.none" data-verso-hover="913">Many.none</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="unknown token" data-binding="">_</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Many.more" data-verso-hover="914">Many.more</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6111" data-verso-hover="121">first</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6112" data-verso-hover="918">rest</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6113" data-verso-hover="1502">action</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-2687">do</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="var token" data-binding="var-_uniq.6113" data-verso-hover="1502">action</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6111" data-verso-hover="121">first</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-Many.forM" data-verso-hover="1507">forM</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.6112" data-verso-hover="918">rest</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6113" data-verso-hover="1502">action</span><span class="inter-text">
</span><span class="inter-text">
</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.instance-2734">instance</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-ForM" data-verso-hover="1508">ForM</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6524" data-verso-hover="868">m</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Many" data-verso-hover="912">Many</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6533" data-verso-hover="113">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.6533" data-verso-hover="113">α</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.whereStructInst-2765">where</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-ForM.forM" data-verso-hover="1509">forM</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="const token" data-binding="const-Many.forM" data-verso-hover="1507">Many.forM</span></code><p>
                  Because <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.6650" data-verso-hover="1498">γ</span></code> can be any type at all, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Loops.Fake.ForM" data-verso-hover="1497">ForM</span></code> can support non-polymorphic collections.
A very simple collection is one of the natural numbers less than some given number, in reverse order:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.structureTk-3789">structure</span><span class="inter-text"> </span><span class="const token" data-binding="const-Loops.AllLessThan" data-verso-hover="1510">AllLessThan</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-3811">where</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Loops.AllLessThan.num" data-verso-hover="1511">num</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span></code><p>
                  Its <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Loops.Fake.ForM" data-verso-hover="1497">ForM</span></code> operator applies the provided action to each smaller <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span></code>:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-3885">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Loops.AllLessThan.forM" data-verso-hover="1512">AllLessThan.forM</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="const token" data-binding="const-Monad" data-verso-hover="724">Monad</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.8492" data-verso-hover="868">m</span><span class="unknown token" data-binding="">]</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.8499" data-verso-hover="1513">coll</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Loops.AllLessThan" data-verso-hover="1510">AllLessThan</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.8503" data-verso-hover="1514">action</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.8492" data-verso-hover="868">m</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="var token" data-binding="var-_uniq.8492" data-verso-hover="868">m</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-group-3985">let</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-group-3985">rec</span><span class="inter-text"> </span><span class="const token" data-binding="const-Loops.AllLessThan.forM.countdown" data-verso-hover="1515">countdown</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.8512" data-verso-hover="868">m</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">0</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.8671" data-verso-hover="5">n</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="unknown token" data-binding="">1</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-4054">do</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="var token" data-binding="var-_uniq.8503" data-verso-hover="1514">action</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.8671" data-verso-hover="5">n</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-Loops.AllLessThan.forM.countdown" data-verso-hover="1515">countdown</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.8671" data-verso-hover="5">n</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Loops.AllLessThan.forM.countdown" data-verso-hover="1515">countdown</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.8499" data-verso-hover="1513">coll</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Loops.AllLessThan.num" data-verso-hover="1511">num</span><span class="inter-text">
</span><span class="inter-text">
</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.instance-4112">instance</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-ForM" data-verso-hover="1508">ForM</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.8961" data-verso-hover="868">m</span><span class="inter-text"> </span><span class="const token" data-binding="const-Loops.AllLessThan" data-verso-hover="1510">AllLessThan</span><span class="inter-text"> </span><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.whereStructInst-4146">where</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-ForM.forM" data-verso-hover="1516">forM</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="const token" data-binding="const-Loops.AllLessThan.forM" data-verso-hover="1512">AllLessThan.forM</span></code><p>
                  Running <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-IO.println" data-verso-hover="250">IO.println</span></code> on each number less than five can be accomplished with <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Loops.Fake.ForM" data-verso-hover="1497">ForM</span></code>:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="has-info info"><span class="hover-container"><span class="hover-info messages"><code class="message info">4
3
2
1
0
</code></span></span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.eval-4280" data-verso-hover="7">#eval</span></span><span class="inter-text"> </span><span class="const token" data-binding="const-ForM.forM" data-verso-hover="1517">forM</span><span class="inter-text"> </span><span class="unknown token" data-binding="">{</span><span class="inter-text"> </span><span class="const token" data-binding="const-Loops.AllLessThan.num" data-verso-hover="117">num</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">5</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Loops.AllLessThan" data-verso-hover="1510">AllLessThan</span><span class="inter-text"> </span><span class="unknown token" data-binding="">}</span><span class="inter-text"> </span><span class="const token" data-binding="const-IO.println" data-verso-hover="250">IO.println</span></code><div class="information">
                  <pre>4
3
2
1
0
</pre></div>
                <p>
                  An example <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Loops.Fake.ForM" data-verso-hover="1497">ForM</span></code> instance that works only in a particular monad is one that loops over the lines read from an IO stream, such as standard input:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.structureTk-19">structure</span><span class="inter-text"> </span><span class="const token" data-binding="const-LinesOf" data-verso-hover="1518">LinesOf</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-37">where</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-LinesOf.stream" data-verso-hover="1519">stream</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-IO.FS.Stream" data-verso-hover="259">IO.FS.Stream</span><span class="inter-text">
</span><span class="inter-text">
</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.partial-68">partial</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-76">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-LinesOf.forM" data-verso-hover="1520">LinesOf.forM</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.205" data-verso-hover="1521">readFrom</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-LinesOf" data-verso-hover="1518">LinesOf</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.209" data-verso-hover="1522">action</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-165">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLetArrow-170">let</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.280" data-verso-hover="39">line</span><span class="inter-text"> </span><span class="unknown token" data-binding="">←</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.205" data-verso-hover="1521">readFrom</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-LinesOf.stream" data-verso-hover="1519">stream</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-IO.FS.Stream.getLine" data-verso-hover="256">getLine</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-209">if</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.280" data-verso-hover="39">line</span><span class="inter-text"> </span><span class="unknown token" data-binding="">==</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="207">""</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-209">then</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doReturn-228" data-verso-hover="1488">return</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="var token" data-binding="var-_uniq.209" data-verso-hover="1522">action</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.280" data-verso-hover="39">line</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-LinesOf.forM" data-verso-hover="1520">forM</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.205" data-verso-hover="1521">readFrom</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.209" data-verso-hover="1522">action</span><span class="inter-text">
</span><span class="inter-text">
</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.instance-276">instance</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-ForM" data-verso-hover="1508">ForM</span><span class="inter-text"> </span><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span><span class="inter-text"> </span><span class="const token" data-binding="const-LinesOf" data-verso-hover="1518">LinesOf</span><span class="inter-text"> </span><span class="unknown token" data-binding="">String</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.whereStructInst-310">where</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-ForM.forM" data-verso-hover="1523">forM</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="const token" data-binding="const-LinesOf.forM" data-verso-hover="1520">LinesOf.forM</span></code><p>
                  The definition of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Loops.Fake.ForM" data-verso-hover="1497">ForM</span></code> is marked <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">partial</span></code> because there is no guarantee that the stream is finite.
In this case, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-IO.FS.Stream.getLine" data-verso-hover="256">IO.FS.Stream.getLine</span></code> works only in the <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span></code> monad, so no other monad can be used for looping.</p>
                <p>
                  This example program uses this looping construct to filter out lines that don't contain letters:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-379">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-main" data-verso-hover="1492">main</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.668" data-verso-hover="315">argv</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span><span class="inter-text"> </span><span class="const token" data-binding="const-UInt32" data-verso-hover="314">UInt32</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-424">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-429">if</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.668" data-verso-hover="315">argv</span><span class="inter-text"> </span><span class="unknown token" data-binding="">!=</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-429">then</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-IO.eprintln" data-verso-hover="1284">IO.eprintln</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1524">"Unexpected arguments"</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doReturn-491" data-verso-hover="1488">return</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="313">1</span><span class="inter-text">
</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-ForM.forM" data-verso-hover="1517">forM</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-LinesOf.mk" data-verso-hover="1525">LinesOf.mk</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">←</span><span class="inter-text"> </span><span class="const token" data-binding="const-IO.getStdin" data-verso-hover="252">IO.getStdin</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-539">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1223" data-verso-hover="39">line</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-551">do</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-558">if</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1223" data-verso-hover="39">line</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-String.any" data-verso-hover="1526">any</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">·</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Char.isAlpha" data-verso-hover="974">isAlpha</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-558">then</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-IO.print" data-verso-hover="1527">IO.print</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1223" data-verso-hover="39">line</span><span class="inter-text">
</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doReturn-611" data-verso-hover="1488">return</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="313">0</span></code><p>
                  The file <code>test-data</code> contains:</p>
                <div class="example-file">
                  File: <code>test-data</code><code class="line">Hello!</code><code class="line">!!!!!</code><code class="line">12345</code><code class="line">abc123</code><code class="line"></code><code class="line">Ok</code></div>
                <p>
                  Invoking this program, which is stored in <code>ForMIO.lean</code>, yields the following output:</p>
                <div class="shell-commands">
                  <code class="command">lean --run ForMIO.lean &lt; test-data</code><code class="output">Hello!
abc123
Ok
</code></div>
                </section>
              <section>
                <h3 id="Functional-Programming-in-Lean--Monad-Transformers--More-do-Features--Loops--Stopping-Iteration">
                  6.4.3.2. Stopping Iteration</h3>
                <p>
                  Terminating a loop early is difficult to do with <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Loops.Fake.ForM" data-verso-hover="1497">ForM</span></code>.
Writing a function that iterates over the <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span></code>s in an <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Loops.AllLessThan" data-verso-hover="1510">AllLessThan</span></code> only until <code class="hl lean inline" data-lean-context="examples"><span class="typed token" data-binding="" data-verso-hover="5">3</span></code> is reached requires a means of stopping the loop partway through.
One way to achieve this is to use <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Loops.Fake.ForM" data-verso-hover="1497">ForM</span></code> with the <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-OptionT" data-verso-hover="1528">OptionT</span></code> monad transformer.
The first step is to define <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Loops.Transformed.OptionT.exec" data-verso-hover="1529">OptionT.exec</span></code>, which discards information about both the return value and whether or not the transformed computation succeeded:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-4539">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Loops.Transformed.OptionT.exec" data-verso-hover="1529">OptionT.exec</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="const token" data-binding="const-Applicative" data-verso-hover="1008">Applicative</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.9880" data-verso-hover="868">m</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.9906" data-verso-hover="1388">action</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-OptionT" data-verso-hover="1528">OptionT</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.9880" data-verso-hover="868">m</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.9894" data-verso-hover="113">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.9880" data-verso-hover="868">m</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="var token" data-binding="var-_uniq.9906" data-verso-hover="1388">action</span><span class="inter-text"> </span><span class="unknown token" data-binding="">*&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span></code><p>
                  Then, failure in the <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-OptionT" data-verso-hover="1528">OptionT</span></code> instance of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Alternative" data-verso-hover="1192">Alternative</span></code> can be used to terminate looping early:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-4688">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Loops.Transformed.countToThree" data-verso-hover="1530">countToThree</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.10025" data-verso-hover="5">n</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.let-4730" data-verso-hover="212">let</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.10032" data-verso-hover="1513">nums</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Loops.AllLessThan" data-verso-hover="1510">AllLessThan</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="unknown token" data-binding="const-Loops.AllLessThan.mk" data-verso-hover="1531">⟨</span><span class="var token" data-binding="var-_uniq.10025" data-verso-hover="5">n</span><span class="unknown token" data-binding="const-Loops.AllLessThan.mk" data-verso-hover="1531">⟩</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Loops.Transformed.OptionT.exec" data-verso-hover="1529">OptionT.exec</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-ForM.forM" data-verso-hover="1517">forM</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.10032" data-verso-hover="1513">nums</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-4790">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.10170" data-verso-hover="5">i</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-4799">do</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-4806">if</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.10170" data-verso-hover="5">i</span><span class="inter-text"> </span><span class="unknown token" data-binding="">&lt;</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">3</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-4806">then</span><span class="inter-text"> </span><span class="const token" data-binding="const-Alternative.failure" data-verso-hover="1199">failure</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-4828">else</span><span class="inter-text"> </span><span class="const token" data-binding="const-IO.println" data-verso-hover="250">IO.println</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.10170" data-verso-hover="5">i</span><span class="unknown token" data-binding="">)</span></code><p>
                  A quick test demonstrates that this solution works:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="has-info info"><span class="hover-container"><span class="hover-info messages"><code class="message info">6
5
4
3
</code></span></span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.eval-4949" data-verso-hover="7">#eval</span></span><span class="inter-text"> </span><span class="const token" data-binding="const-Loops.Transformed.countToThree" data-verso-hover="1530">countToThree</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">7</span></code><div class="information">
                  <pre>6
5
4
3
</pre></div>
                <p>
                  However, this code is not so easy to read.
Terminating a loop early is a common task, and Lean provides more syntactic sugar to make this easier.
This same function can also be written as follows:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-5045">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Loops.countToThree" data-verso-hover="1532">countToThree</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.10912" data-verso-hover="5">n</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-5085">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLet-5090">let</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.10940" data-verso-hover="1513">nums</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Loops.AllLessThan" data-verso-hover="1510">AllLessThan</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="unknown token" data-binding="const-Loops.AllLessThan.mk" data-verso-hover="1531">⟨</span><span class="var token" data-binding="var-_uniq.10912" data-verso-hover="5">n</span><span class="unknown token" data-binding="const-Loops.AllLessThan.mk" data-verso-hover="1531">⟩</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-5126" data-verso-hover="1533">for</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.11049" data-verso-hover="5">i</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doForDecl-5130">in</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.10940" data-verso-hover="1513">nums</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-5126" data-verso-hover="1533">do</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-5147">if</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.11049" data-verso-hover="5">i</span><span class="inter-text"> </span><span class="unknown token" data-binding="">&lt;</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">3</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-5147">then</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doBreak-5161" data-verso-hover="1534">break</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-IO.println" data-verso-hover="250">IO.println</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.11049" data-verso-hover="5">i</span></code><p>
                  Testing it reveals that it works just like the prior version:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="has-info info"><span class="hover-container"><span class="hover-info messages"><code class="message info">6
5
4
3
</code></span></span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.eval-5275" data-verso-hover="7">#eval</span></span><span class="inter-text"> </span><span class="const token" data-binding="const-Loops.countToThree" data-verso-hover="1532">countToThree</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">7</span></code><div class="information">
                  <pre>6
5
4
3
</pre></div>
                <p>
                  The <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">for</span></code><code> ...</code><code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">in</span></code><code> ...</code><code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code><code> ...</code> syntax desugars to the use of a type class called <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-ForIn" data-verso-hover="1535">ForIn</span></code>, which is a somewhat more complicated version of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Loops.Fake.ForM" data-verso-hover="1497">ForM</span></code> that keeps track of state and early termination.
The standard library provides an adapter that converts a <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Loops.Fake.ForM" data-verso-hover="1497">ForM</span></code> instance into a <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-ForIn" data-verso-hover="1535">ForIn</span></code> instance, called <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-ForM.forIn" data-verso-hover="1536">ForM.forIn</span></code>.
To enable <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">for</span></code> loops based on a <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Loops.Fake.ForM" data-verso-hover="1497">ForM</span></code> instance, add something like the following, with appropriate replacements for <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Loops.AllLessThan" data-verso-hover="1510">AllLessThan</span></code> and <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span></code>:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.instance-4395">instance</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-ForIn" data-verso-hover="1535">ForIn</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.9647" data-verso-hover="868">m</span><span class="inter-text"> </span><span class="const token" data-binding="const-Loops.AllLessThan" data-verso-hover="1510">AllLessThan</span><span class="inter-text"> </span><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.whereStructInst-4430">where</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-ForIn.forIn" data-verso-hover="1537">forIn</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="const token" data-binding="const-ForM.forIn" data-verso-hover="1536">ForM.forIn</span></code><p>
                  Note, however, that this adapter only works for <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Loops.Fake.ForM" data-verso-hover="1497">ForM</span></code> instances that keep the monad unconstrained, as most of them do.
This is because the adapter uses <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-StateT" data-verso-hover="1443">StateT</span></code> and <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-ExceptT" data-verso-hover="1474">ExceptT</span></code>, rather than the underlying monad.</p>
                <p>
                  Early return is supported in <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">for</span></code> loops.
The translation of <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code> blocks with early return into a use of an exception monad transformer applies equally well underneath <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Loops.Fake.ForM" data-verso-hover="1497">ForM</span></code> as the earlier use of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-OptionT" data-verso-hover="1528">OptionT</span></code> to halt iteration does.
This version of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Loops.List.find?" data-verso-hover="1485">List.find?</span></code> makes use of both:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-5653">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Loops.List.find?" data-verso-hover="1485">List.find?</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.12971" data-verso-hover="195">p</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.12967" data-verso-hover="369">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Bool" data-verso-hover="40">Bool</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.12974" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.12967" data-verso-hover="369">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option" data-verso-hover="142">Option</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.12967" data-verso-hover="369">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-5716">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-5721" data-verso-hover="1533">for</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13155" data-verso-hover="121">x</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doForDecl-5725">in</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.12974" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-5721" data-verso-hover="1533">do</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-5740">if</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.12971" data-verso-hover="195">p</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13155" data-verso-hover="121">x</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-5740">then</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doReturn-5752" data-verso-hover="1488">return</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13155" data-verso-hover="121">x</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Alternative.failure" data-verso-hover="1199">failure</span></code><p>
                  In addition to <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">break</span></code>, <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">for</span></code> loops support <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">continue</span></code> to skip the rest of the loop body in an iteration.
An alternative (but confusing) formulation of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Loops.Cont.List.find?" data-verso-hover="1538">List.find?</span></code> skips elements that don't satisfy the check:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-5833">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Loops.Cont.List.find?" data-verso-hover="1538">List.find?</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.13760" data-verso-hover="195">p</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13756" data-verso-hover="369">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Bool" data-verso-hover="40">Bool</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.13763" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13756" data-verso-hover="369">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Option" data-verso-hover="142">Option</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13756" data-verso-hover="369">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-5896">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-5901" data-verso-hover="1533">for</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13944" data-verso-hover="121">x</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doForDecl-5905">in</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13763" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-5901" data-verso-hover="1533">do</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-5920">if</span><span class="inter-text"> </span><span class="const token" data-binding="const-Bool.not" data-verso-hover="105">not</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.13760" data-verso-hover="195">p</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13944" data-verso-hover="121">x</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-5920">then</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doContinue-5938" data-verso-hover="1539">continue</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doReturn-5951" data-verso-hover="1488">return</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.13944" data-verso-hover="121">x</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Alternative.failure" data-verso-hover="1199">failure</span></code><p>
                  A <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Std.Range" data-verso-hover="1540">Std.Range</span></code> is a structure that consists of a starting number, an ending number, and a step.
They represent a sequence of natural numbers, from the starting number to the ending number, increasing by the step each time.
Lean has special syntax to construct ranges, consisting of square brackets, numbers, and colons that comes in four varieties.
The stopping point must always be provided, while the start and the step are optional, defaulting to <code class="hl lean inline" data-lean-context="examples"><span class="typed token" data-binding="" data-verso-hover="5">0</span></code> and <code class="hl lean inline" data-lean-context="examples"><span class="typed token" data-binding="" data-verso-hover="5">1</span></code>, respectively:</p>
                <table class="tabular"><tr><th><p>
                        Expression</p>
                      </th><th><p>
                        Start</p>
                      </th><th><p>
                        Stop</p>
                      </th><th><p>
                        Step</p>
                      </th><th><p>
                        As List</p>
                      </th></tr><tr><td><p>
                        <code class="hl lean inline" data-lean-context="examples"><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">:</span><span class="typed token" data-binding="" data-verso-hover="5">10</span><span class="unknown token" data-binding="">]</span></code></p>
                      </td><td><p>
                        <code class="hl lean inline" data-lean-context="examples"><span class="typed token" data-binding="" data-verso-hover="5">0</span></code></p>
                      </td><td><p>
                        <code class="hl lean inline" data-lean-context="examples"><span class="typed token" data-binding="" data-verso-hover="5">10</span></code></p>
                      </td><td><p>
                        <code class="hl lean inline" data-lean-context="examples"><span class="typed token" data-binding="" data-verso-hover="5">1</span></code></p>
                      </td><td><p>
                        <code>[0, 1, 2, 3, 4, 5, 6, 7, 8, 9]</code></p>
                      </td></tr><tr><td><p>
                        <code class="hl lean inline" data-lean-context="examples"><span class="unknown token" data-binding="">[</span><span class="typed token" data-binding="" data-verso-hover="5">2</span><span class="unknown token" data-binding="">:</span><span class="typed token" data-binding="" data-verso-hover="5">10</span><span class="unknown token" data-binding="">]</span></code></p>
                      </td><td><p>
                        <code class="hl lean inline" data-lean-context="examples"><span class="typed token" data-binding="" data-verso-hover="5">2</span></code></p>
                      </td><td><p>
                        <code class="hl lean inline" data-lean-context="examples"><span class="typed token" data-binding="" data-verso-hover="5">10</span></code></p>
                      </td><td><p>
                        <code class="hl lean inline" data-lean-context="examples"><span class="typed token" data-binding="" data-verso-hover="5">1</span></code></p>
                      </td><td><p>
                        <code>[2, 3, 4, 5, 6, 7, 8, 9]</code></p>
                      </td></tr><tr><td><p>
                        <code class="hl lean inline" data-lean-context="examples"><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">:</span><span class="typed token" data-binding="" data-verso-hover="5">10</span><span class="unknown token" data-binding="">:</span><span class="typed token" data-binding="" data-verso-hover="5">3</span><span class="unknown token" data-binding="">]</span></code></p>
                      </td><td><p>
                        <code class="hl lean inline" data-lean-context="examples"><span class="typed token" data-binding="" data-verso-hover="5">0</span></code></p>
                      </td><td><p>
                        <code class="hl lean inline" data-lean-context="examples"><span class="typed token" data-binding="" data-verso-hover="5">10</span></code></p>
                      </td><td><p>
                        <code class="hl lean inline" data-lean-context="examples"><span class="typed token" data-binding="" data-verso-hover="5">3</span></code></p>
                      </td><td><p>
                        <code>[0, 3, 6, 9]</code></p>
                      </td></tr><tr><td><p>
                        <code class="hl lean inline" data-lean-context="examples"><span class="unknown token" data-binding="">[</span><span class="typed token" data-binding="" data-verso-hover="5">2</span><span class="unknown token" data-binding="">:</span><span class="typed token" data-binding="" data-verso-hover="5">10</span><span class="unknown token" data-binding="">:</span><span class="typed token" data-binding="" data-verso-hover="5">3</span><span class="unknown token" data-binding="">]</span></code></p>
                      </td><td><p>
                        <code class="hl lean inline" data-lean-context="examples"><span class="typed token" data-binding="" data-verso-hover="5">2</span></code></p>
                      </td><td><p>
                        <code class="hl lean inline" data-lean-context="examples"><span class="typed token" data-binding="" data-verso-hover="5">10</span></code></p>
                      </td><td><p>
                        <code class="hl lean inline" data-lean-context="examples"><span class="typed token" data-binding="" data-verso-hover="5">3</span></code></p>
                      </td><td><p>
                        <code>[2, 5, 8]</code></p>
                      </td></tr></table><p>
                  Note that the starting number <em>is</em> included in the range, while the stopping numbers is not.
All three arguments are <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span></code>s, which means that ranges cannot count down—a range where the starting number is greater than or equal to the stopping number simply contains no numbers.</p>
                <p>
                  Ranges can be used with <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">for</span></code> loops to draw numbers from the range.
This program counts even numbers from four to eight:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-9417">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Ranges.fourToEight" data-verso-hover="1541">fourToEight</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-9446">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-9451" data-verso-hover="1533">for</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.30894" data-verso-hover="5">i</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doForDecl-9455">in</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="typed token" data-binding="" data-verso-hover="5">4</span><span class="unknown token" data-binding="">:</span><span class="typed token" data-binding="" data-verso-hover="5">9</span><span class="unknown token" data-binding="">:</span><span class="typed token" data-binding="" data-verso-hover="5">2</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-9451" data-verso-hover="1533">do</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-IO.println" data-verso-hover="250">IO.println</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.30894" data-verso-hover="5">i</span></code><p>
                  Running it yields:</p>
                <div class="information">
                  <pre>4
6
8
</pre></div>
                <p>
                  Finally, <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">for</span></code> loops support iterating over multiple collections in parallel, by separating the <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">in</span></code> clauses with commas.
Looping halts when the first collection runs out of elements, so the declaration:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-5352">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Loops.parallelLoop" data-verso-hover="1542">parallelLoop</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-5372">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-5377" data-verso-hover="1533">for</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.12087" data-verso-hover="39">x</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doForDecl-5381">in</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="literal string token" data-binding="" data-verso-hover="1543">"currant"</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1544">"gooseberry"</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1545">"rowan"</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.12219" data-verso-hover="5">y</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doForDecl-5422">in</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="typed token" data-binding="" data-verso-hover="5">4</span><span class="unknown token" data-binding="">:</span><span class="typed token" data-binding="" data-verso-hover="5">8</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-5377" data-verso-hover="1533">do</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-IO.println" data-verso-hover="250">IO.println</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.12087" data-verso-hover="39">x</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.12219" data-verso-hover="5">y</span><span class="unknown token" data-binding="">)</span></code><p>
                  produces three lines of output:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="has-info info"><span class="hover-container"><span class="hover-info messages"><code class="message info">(currant, 4)
(gooseberry, 5)
(rowan, 6)
</code></span></span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.eval-5583" data-verso-hover="7">#eval</span></span><span class="inter-text"> </span><span class="const token" data-binding="const-Loops.parallelLoop" data-verso-hover="1542">parallelLoop</span></code><div class="information">
                  <pre>(currant, 4)
(gooseberry, 5)
(rowan, 6)
</pre></div>
                <p>
                  Many data structures implement an enhanced version of the <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-ForIn" data-verso-hover="1535">ForIn</span></code> type class that adds evidence that the element was drawn from the collection to the loop body.
These can be used by providing a name for the evidence prior to the name of the element.
This function prints all the elements of an array together with their indices, and the compiler is able to determine that the array lookups are all safe due to the evidence <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.31702" data-verso-hover="1546">h</span></code>:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-9659">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-printArray" data-verso-hover="1547">printArray</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="const token" data-binding="const-ToString" data-verso-hover="399">ToString</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.31528" data-verso-hover="369">α</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.31534" data-verso-hover="1548">xs</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Array" data-verso-hover="453">Array</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.31528" data-verso-hover="369">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-IO" data-verso-hover="2">IO</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-9717">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-9722" data-verso-hover="1533">for</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.31702" data-verso-hover="1546">h</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.31699" data-verso-hover="5">i</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doForDecl-9726">in</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="typed token" data-binding="" data-verso-hover="5">0</span><span class="unknown token" data-binding="">:</span><span class="var token" data-binding="var-_uniq.31534" data-verso-hover="1548">xs</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Array.size" data-verso-hover="459">size</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-9722" data-verso-hover="1533">do</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-IO.println" data-verso-hover="250">IO.println</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-termS!_-9765">s!</span><span class="unknown token" data-binding="">"{</span><span class="var token" data-binding="var-_uniq.31699" data-verso-hover="5">i</span><span class="unknown token" data-binding="">}:\t{</span><span class="var token" data-binding="var-_uniq.31534" data-verso-hover="1548">xs</span><span class="unknown token" data-binding="">[</span><span class="var token" data-binding="var-_uniq.31699" data-verso-hover="5">i</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">}"</span></code><p>
                  In this example, <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.31702" data-verso-hover="1546">h</span></code> is evidence that <code>i ∈ [0:xs.size]</code>, and the tactic that checks whether <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.31534" data-verso-hover="1548">xs</span><span class="unknown token" data-binding="">[</span><span class="var token" data-binding="var-_uniq.31699" data-verso-hover="5">i</span><span class="unknown token" data-binding="">]</span></code> is safe is able to transform this into evidence that <code>i &lt; xs.size</code>.</p>
                </section>
              </section>
            <section>
              <h2 id="Functional-Programming-in-Lean--Monad-Transformers--More-do-Features--Mutable-Variables">
                6.4.4. Mutable Variables</h2>
              <p>
                In addition to early <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">return</span></code>, <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">else</span></code>-less <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">if</span></code>, and <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">for</span></code> loops, Lean supports local mutable variables within a <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code> block.
Behind the scenes, these mutable variables desugar to code that's equivalent to <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-StateT" data-verso-hover="1443">StateT</span></code>, rather than being implemented by true mutable variables.
Once again, functional programming is used to simulate imperative programming.</p>
              <p>
                A local mutable variable is introduced with <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">let mut</span></code> instead of plain <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">let</span></code>.
The definition <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Mut.two" data-verso-hover="1549">two</span></code>, which uses the identity monad <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Id" data-verso-hover="863">Id</span></code> to enable <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code>-syntax without introducing any effects, counts to <code class="hl lean inline" data-lean-context="examples"><span class="typed token" data-binding="" data-verso-hover="5">2</span></code>:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-6368">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Mut.two" data-verso-hover="1549">two</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="const token" data-binding="const-Id.run" data-verso-hover="1495">Id.run</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-6392">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLet-6397">let</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-6401">mut</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.15495" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">0</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="var token" data-binding="var-_uniq.15495" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.15495" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">1</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="var token" data-binding="var-_uniq.15495" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.15495" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">1</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doReturn-6440" data-verso-hover="1488">return</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.15495" data-verso-hover="5">x</span></code><p>
                This code is equivalent to a definition that uses <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-StateT" data-verso-hover="1443">StateT</span></code> to add <code class="hl lean inline" data-lean-context="examples"><span class="typed token" data-binding="" data-verso-hover="5">1</span></code> twice:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-6533">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Mut.St.two" data-verso-hover="1550">two</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.let-6552" data-verso-hover="212">let</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.16315" data-verso-hover="1551">block</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-StateT" data-verso-hover="1443">StateT</span><span class="inter-text"> </span><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span><span class="inter-text"> </span><span class="const token" data-binding="const-Id" data-verso-hover="863">Id</span><span class="inter-text"> </span><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-6585">do</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-modify" data-verso-hover="1450">modify</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">·</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">1</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-modify" data-verso-hover="1450">modify</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">·</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">1</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doReturn-6632" data-verso-hover="1488">return</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">←</span><span class="inter-text"> </span><span class="const token" data-binding="const-MonadState.get" data-verso-hover="1447">get</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.let-6651" data-verso-hover="212">let</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.16351" data-verso-hover="5">result</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.16352" data-verso-hover="5">_finalState</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.16315" data-verso-hover="1551">block</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">0</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="var token" data-binding="var-_uniq.16351" data-verso-hover="5">result</span></code><p>
                Local mutable variables work well with all the other features of <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code>-notation that provide convenient syntax for monad transformers.
The definition <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Mut.three" data-verso-hover="1552">three</span></code> counts the number of entries in a three-entry list:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-6777">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Mut.three" data-verso-hover="1552">three</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="const token" data-binding="const-Id.run" data-verso-hover="1495">Id.run</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-6803">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLet-6808">let</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-6812">mut</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.16754" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">0</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-6825" data-verso-hover="1533">for</span><span class="inter-text"> </span><span class="unknown token" data-binding="">_</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doForDecl-6829">in</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="typed token" data-binding="" data-verso-hover="5">1</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">2</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">3</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-6825" data-verso-hover="1533">do</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="var token" data-binding="var-_uniq.16754" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.16754" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">1</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doReturn-6864" data-verso-hover="1488">return</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.16754" data-verso-hover="5">x</span></code><p>
                Similarly, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Mut.six" data-verso-hover="1553">six</span></code> adds the entries in a list:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-6941">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Mut.six" data-verso-hover="1553">six</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="const token" data-binding="const-Id.run" data-verso-hover="1495">Id.run</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-6965">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLet-6970">let</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-6974">mut</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.17429" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">0</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-6987" data-verso-hover="1533">for</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.17423" data-verso-hover="5">y</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doForDecl-6991">in</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="typed token" data-binding="" data-verso-hover="5">1</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">2</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">3</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-6987" data-verso-hover="1533">do</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="var token" data-binding="var-_uniq.17429" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.17429" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.17423" data-verso-hover="5">y</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doReturn-7026" data-verso-hover="1488">return</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.17429" data-verso-hover="5">x</span></code><p>
                <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Loops.List.count" data-verso-hover="1554">List.count</span></code> counts the number of entries in a list that satisfy some check:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-6145">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Loops.List.count" data-verso-hover="1554">List.count</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.14772" data-verso-hover="195">p</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.14768" data-verso-hover="369">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Bool" data-verso-hover="40">Bool</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.14775" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.14768" data-verso-hover="369">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="const token" data-binding="const-Id.run" data-verso-hover="1495">Id.run</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-6209">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLet-6214">let</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-6218">mut</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.14951" data-verso-hover="5">found</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">0</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-6235" data-verso-hover="1533">for</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.14945" data-verso-hover="121">x</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doForDecl-6239">in</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.14775" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-6235" data-verso-hover="1533">do</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-6254">if</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.14772" data-verso-hover="195">p</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.14945" data-verso-hover="121">x</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-6254">then</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.14951" data-verso-hover="5">found</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.14951" data-verso-hover="5">found</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">1</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doReturn-6287" data-verso-hover="1488">return</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.14951" data-verso-hover="5">found</span></code><p>
                Local mutable variables can be more convenient to use and easier to read than an explicit local use of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-StateT" data-verso-hover="1443">StateT</span></code>.
However, they don't have the full power of unrestricted mutable variables from imperative languages.
In particular, they can only be modified in the <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code>-block in which they are introduced.
This means, for instance, that <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">for</span></code>-loops can't be replaced by otherwise-equivalent recursive helper functions.
This version of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Mut.List.count" data-verso-hover="1555">List.count</span></code>:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-7307">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Mut.List.count" data-verso-hover="1555">List.count</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.17839" data-verso-hover="195">p</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.17835" data-verso-hover="369">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Bool" data-verso-hover="40">Bool</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.17842" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.17835" data-verso-hover="369">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="const token" data-binding="const-Id.run" data-verso-hover="1495">Id.run</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-7371">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLet-7376">let</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-7380">mut</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.17880" data-verso-hover="5">found</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">0</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-group-7397">let</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-group-7397">rec</span><span class="inter-text"> </span><span class="const token" data-binding="const-Mut.List.count.go" data-verso-hover="1556">go</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.17845" data-verso-hover="369">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Id" data-verso-hover="863">Id</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.17965" data-verso-hover="121">y</span><span class="inter-text"> </span><span class="unknown token" data-binding="">::</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.17966" data-verso-hover="137">ys</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-7467">do</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-7476">if</span><span class="inter-text"> </span><span class="unknown token" data-binding="">p</span><span class="inter-text"> </span><span class="unknown token" data-binding="">y</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-7476">then</span><span class="inter-text"> </span><span class="has-info error"><span class="hover-container"><span class="hover-info messages"><code class="message error">`found` cannot be mutated, only variables declared using `let mut` can be mutated. If you did not intend to mutate but define `found`, consider using `let found` instead</code></span></span><span class="unknown token" data-binding="">found</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="unknown token" data-binding="">found</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="unknown token" data-binding="">1</span></span><span class="inter-text">
</span><span class="inter-text">      </span><span class="unknown token" data-binding="">go</span><span class="inter-text"> </span><span class="unknown token" data-binding="">ys</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doReturn-7521" data-verso-hover="1488">return</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.17880" data-verso-hover="5">found</span></code><p>
                yields the following error on the attempted mutation of <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.17880" data-verso-hover="5">found</span></code>:</p>
              <div class="error">
                <pre>`found` cannot be mutated, only variables declared using `let mut` can be mutated. If you did not intend to mutate but define `found`, consider using `let found` instead</pre></div>
              <p>
                This is because the recursive function is written in the identity monad, and only the monad of the <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code>-block in which the variable is introduced is transformed with <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-StateT" data-verso-hover="1443">StateT</span></code>.</p>
              </section>
            <section>
              <h2 id="Functional-Programming-in-Lean--Monad-Transformers--More-do-Features--What-counts-as-a--do--block___">
                6.4.5. What counts as a <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code> block?</h2>
              <p>
                Many features of <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code>-notation apply only to a single <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code>-block.
Early return terminates the current block, and mutable variables can only be mutated in the block that they are defined in.
To use them effectively, it's important to know what counts as “the same block”.</p>
              <p>
                Generally speaking, the indented block following the <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code> keyword counts as a block, and the immediate sequence of statements underneath it are part of that block.
Statements in independent blocks that are nonetheless contained in a block are not considered part of the block.
However, the rules that govern what exactly counts as the same block are slightly subtle, so some examples are in order.
The precise nature of the rules can be tested by setting up a program with a mutable variable and seeing where the mutation is allowed.
This program has a mutation that is clearly in the same block as the mutable variable:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.example-9891">example</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Id" data-verso-hover="863">Id</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-9912">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLet-9917">let</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-9921">mut</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.32199" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">0</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="var token" data-binding="var-_uniq.32199" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.32199" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">1</span></code><p>
                When a mutation occurs in a <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code>-block that is part of a <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">let</span></code>-statement that defines a name using <code>:=</code>, then it is not considered to be part of the block:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.example-10301">example</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Id" data-verso-hover="863">Id</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-10322">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLet-10327">let</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-10331">mut</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.32585" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">0</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLet-10344">let</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.32589" data-verso-hover="1557">other</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-10357">do</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="has-info error"><span class="hover-container"><span class="hover-info messages"><code class="message error">`x` cannot be mutated, only variables declared using `let mut` can be mutated. If you did not intend to mutate but define `x`, consider using `let x` instead</code></span></span><span class="unknown token" data-binding="">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="unknown token" data-binding="">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="unknown token" data-binding="">1</span></span><span class="inter-text">
</span><span class="inter-text">  </span><span class="var token" data-binding="var-_uniq.32589" data-verso-hover="1557">other</span></code><div class="error">
                <pre>`x` cannot be mutated, only variables declared using `let mut` can be mutated. If you did not intend to mutate but define `x`, consider using `let x` instead</pre></div>
              <p>
                However, a <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code>-block that occurs under a <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">let</span></code>-statement that defines a name using <code>←</code> is considered part of the surrounding block.
The following program is accepted:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.example-10444">example</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Id" data-verso-hover="863">Id</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-10465">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLet-10470">let</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-10474">mut</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.32697" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">0</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLetArrow-10487">let</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.32655" data-verso-hover="1558">other</span><span class="inter-text"> </span><span class="unknown token" data-binding="">←</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doNested-10501">do</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="var token" data-binding="var-_uniq.32697" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.32697" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">1</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.32655" data-verso-hover="1558">other</span></code><p>
                Similarly, <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code>-blocks that occur as arguments to functions are independent of their surrounding blocks.
The following program is not accepted:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.example-10778">example</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Id" data-verso-hover="863">Id</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-10799">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLet-10804">let</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-10808">mut</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.32970" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">0</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLet-10821">let</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.33033" data-verso-hover="1559">addFour</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.32973" data-verso-hover="1560">y</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Id" data-verso-hover="863">Id</span><span class="inter-text"> </span><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="const token" data-binding="const-Id.run" data-verso-hover="1495">Id.run</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.32973" data-verso-hover="1560">y</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">4</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="var token" data-binding="var-_uniq.33033" data-verso-hover="1559">addFour</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-10872">do</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="has-info error"><span class="hover-container"><span class="hover-info messages"><code class="message error">`x` cannot be mutated, only variables declared using `let mut` can be mutated. If you did not intend to mutate but define `x`, consider using `let x` instead</code></span></span><span class="unknown token" data-binding="">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="unknown token" data-binding="">5</span></span></code><div class="error">
                <pre>`x` cannot be mutated, only variables declared using `let mut` can be mutated. If you did not intend to mutate but define `x`, consider using `let x` instead</pre></div>
              <p>
                If the <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code> keyword is completely redundant, then it does not introduce a new block.
This program is accepted, and is equivalent to the first one in this section:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.example-9998">example</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Id" data-verso-hover="863">Id</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-10019">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLet-10024">let</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-10028">mut</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.32392" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">0</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doNested-10041">do</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.32392" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.32392" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">1</span></code><p>
                The contents of branches under a <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code> (such as those introduced by <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">match</span></code> or <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">if</span></code>) are considered to be part of the surrounding block, whether or not a redundant <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code> is added.
The following programs are all accepted:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.example-10938">example</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Id" data-verso-hover="863">Id</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-10959">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLet-10964">let</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-10968">mut</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.33227" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">0</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-10981">if</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.33227" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">&gt;</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">2</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-10981">then</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="var token" data-binding="var-_uniq.33227" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.33227" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">1</span></code><code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.example-11058">example</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Id" data-verso-hover="863">Id</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-11079">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLet-11084">let</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-11088">mut</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.33590" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">0</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-11101">if</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.33590" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">&gt;</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">2</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doIf-11101">then</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doNested-11115">do</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="var token" data-binding="var-_uniq.33590" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.33590" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">1</span></code><code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.example-11184">example</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Id" data-verso-hover="863">Id</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-11205">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLet-11210">let</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-11214">mut</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.33953" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">0</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doMatch-11227">match</span><span class="inter-text"> </span><span class="const token" data-binding="const-Bool.true" data-verso-hover="97">true</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doMatch-11227">with</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Bool.true" data-verso-hover="97">true</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.33953" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.33953" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">1</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Bool.false" data-verso-hover="19">false</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.33953" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">17</span></code><code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.example-11340">example</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Id" data-verso-hover="863">Id</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-11361">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLet-11366">let</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-11370">mut</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.34223" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">0</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doMatch-11383">match</span><span class="inter-text"> </span><span class="const token" data-binding="const-Bool.true" data-verso-hover="97">true</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doMatch-11383">with</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Bool.true" data-verso-hover="97">true</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doNested-11411">do</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="var token" data-binding="var-_uniq.34223" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.34223" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">1</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Bool.false" data-verso-hover="19">false</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doNested-11442">do</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="var token" data-binding="var-_uniq.34223" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">17</span></code><p>
                Similarly, the <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code> that occurs as part of the <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">for</span></code> and <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">unless</span></code> syntax is just part of their syntax, and does not introduce a fresh <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code>-block.
These programs are also accepted:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.example-11510">example</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Id" data-verso-hover="863">Id</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-11531">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLet-11536">let</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-11540">mut</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.34649" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">0</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-11553" data-verso-hover="1533">for</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.34643" data-verso-hover="5">y</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doForDecl-11557">in</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="typed token" data-binding="" data-verso-hover="5">1</span><span class="unknown token" data-binding="">:</span><span class="typed token" data-binding="" data-verso-hover="5">5</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-11553" data-verso-hover="1533">do</span><span class="inter-text">
</span><span class="inter-text">   </span><span class="var token" data-binding="var-_uniq.34649" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.34649" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.34643" data-verso-hover="5">y</span></code><code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.example-11636">example</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Id" data-verso-hover="863">Id</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-11657">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLet-11662">let</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-11666">mut</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.34910" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">0</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doUnless-11679">unless</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">1</span><span class="inter-text"> </span><span class="unknown token" data-binding="">&lt;</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">5</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doUnless-11679">do</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="var token" data-binding="var-_uniq.34910" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.34910" data-verso-hover="5">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">+</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">1</span></code></section>
            <section>
              <h2 id="Functional-Programming-in-Lean--Monad-Transformers--More-do-Features--Imperative-or-Functional-Programming___">
                6.4.6. Imperative or Functional Programming?</h2>
              <p>
                The imperative features provided by Lean's <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code>-notation allow many programs to very closely resemble their counterparts in languages like Rust, Java, or C#.
This resemblance is very convenient when translating an imperative algorithm into Lean, and some tasks are just most naturally thought of imperatively.
The introduction of monads and monad transformers enables imperative programs to be written in purely functional languages, and <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">do</span></code>-notation as a specialized syntax for monads (potentially locally transformed) allows functional programmers to have the best of both worlds: the strong reasoning principles afforded by immutability and a tight control over available effects through the type system are combined with syntax and libraries that allow programs that use effects to look familiar and be easy to read.
Monads and monad transformers allow functional versus imperative programming to be a matter of perspective.</p>
              </section>
            <section>
              <h2 id="Functional-Programming-in-Lean--Monad-Transformers--More-do-Features--Exercises">
                6.4.7. Exercises</h2>
              <ul>
                <li>
                  <p>
                    Rewrite <code>doug</code> to use <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">for</span></code> instead of the <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DirTree.doList" data-verso-hover="1504">doList</span></code> function.</p>
                  </li>
                <li>
                  <p>
                    Are there other opportunities to use the features introduced in this section to improve the code? If so, use them!
</p>
                  </li>
                </ul>
              </section>
            </section>
          <nav class="prev-next-buttons">
            <a class="local-button active" href="Monad-Transformers/Ordering-Monad-Transformers/#Functional-Programming-in-Lean--Monad-Transformers--Ordering-Monad-Transformers" rel="prev" title="6.3. Ordering Monad Transformers"><span class="arrow">←</span><span class="where">6.3. Ordering Monad Transformers</span></a><a class="local-button active" href="Monad-Transformers/Additional-Conveniences/#Functional-Programming-in-Lean--Monad-Transformers--Additional-Conveniences" rel="next" title="6.5. Additional Conveniences"><span class="where">6.5. Additional Conveniences</span><span class="arrow">→</span></a></nav>
          </div>
        </main></div>
    </body>
  </html>

