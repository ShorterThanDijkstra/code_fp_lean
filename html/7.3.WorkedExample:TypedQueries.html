<!DOCTYPE html>
<html>
  <head>
    <script>
      (function(){
  const {protocol:proto, host:hostName, pathname:path, search:srch, hash:hsh} = window.location;
  if (!(path.endsWith("/") || path.endsWith(".html"))) {
    window.location.replace(`${proto}//${hostName}${path}/${srch}${hsh}`);
  }
})()</script>
    <base href="./../../"><meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1">
    <title>Worked Example: Typed Queries</title><link rel="stylesheet" href="book.css">
    <script>
      const __versoSiteRoot = document.baseURI;</script>
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js" integrity="sha384-zbcZAIxlvJtNE3Dp5nxLXdXtXyxwOdnILY1TDPVmKFhl4r4nSUG1r8bcFXGVa4Te" crossorigin="anonymous"></script>
    <script src="-verso-data/katex/katex.js"></script>
    <script src="-verso-data/katex/math.js"></script>
    <script src="-verso-data/popper.js"></script>
    <script src="-verso-data/tippy.js"></script>
    <link rel="stylesheet" href="static/theme.css">
    <link rel="stylesheet" href="static/fonts/source-serif/source-serif-text.css">
    <link rel="stylesheet" href="static/fonts/source-code-pro/source-code-pro.css">
    <link rel="stylesheet" href="static/fonts/source-sans/source-sans-3.css">
    <link rel="stylesheet" href="static/fonts/noto-sans-mono/noto-sans-mono.css">
    <link rel="stylesheet" href="-verso-data/katex/katex.css">
    <link rel="stylesheet" href="-verso-data/tippy-border.css">
    <style>
div.paragraph > .eval-steps:not(:first-child), div.paragraph > .eval-steps:not(:first-child) > * {
  margin-top: 0.5rem;
}

div.paragraph > .eval-steps:not(:last-child), div.paragraph > .eval-steps:not(:last-child) > * {
  margin-bottom: 0.5rem;
}

.eval-steps .hl.lean.block {
  margin-top: 0.25em;
  margin-bottom: 0.25em;
}
</style><style>
.shell-command {

}
.shell-command.inline > * {
  display: inline;
  white-space: pre;
}
.shell-command.inline .command::before {
  content: "$ ";
  font-weight: 600;
}
</style><style>
.shell-command {

}
.shell-command.block > * {
  display: block;
  white-space: pre;
}
.shell-command .command .prompt {
  font-weight: 600;
}

div.paragraph > .shell-command:not(:first-child) {
  margin-top: 0.5rem;
}

div.paragraph > .shell-command:not(:last-child) {
  margin-bottom: 0.5rem;
}
</style><style>

.hl.lean {
  white-space: pre;
  font-weight: normal;
  font-style: normal;
}

.hl.lean .keyword {
  font-weight : bold;
}

.hl.lean .var {
  font-style: italic;
  position: relative;
}

.hover-container {
  width: 0;
  height: 0;
  position: relative;
  display: inline;
}

.hl.lean a {
  color: inherit;
  text-decoration: currentcolor underline dotted;
}

.hl.lean a:hover {
  text-decoration: currentcolor underline solid;
}

.hl.lean .hover-info {
  white-space: normal;
}

.hl.lean .token .hover-info {
  display: none;
  position: absolute;
  background-color: #e5e5e5;
  border: 1px solid black;
  padding: 0.5rem;
  z-index: 300;
  font-size: inherit;
}

.hl.lean .hover-info.messages {
  max-height: 10rem;
  overflow-y: auto;
  overflow-x: hidden;
  scrollbar-gutter: stable;
  padding: 0 0.5rem 0 0;
  display: block;
}

.hl.lean .hover-info code {
  white-space: pre-wrap;
}

.hl.lean .hover-info.messages > code {
  padding: 0.5rem;
  display: block;
  width: fit-content;
}

.hl.lean .hover-info.messages > code:only-child {
  margin: 0;
}

.hl.lean .hover-info.messages > code {
  margin: 0.1rem;
}

.hl.lean .hover-info.messages > code:not(:first-child) {
  margin-top: 0rem;
}

/*
@media (hover: hover) {
  .hl.lean .has-info:hover > .hover-container > .hover-info:not(.tactic *),
  .hl.lean .tactic:has(> .tactic-toggle:checked) .has-info:hover > .hover-container > .hover-info,
  .hl.lean .token:hover > .hover-container > .hover-info:not(.has-info *):not(.tactic *),
  .hl.lean .tactic:has(> .tactic-toggle:checked) .token:hover > .hover-container > .hover-info:not(.has-info *) {
    display: inline-block;
    position: absolute;
    top: 1rem;
    font-weight: normal;
    font-style: normal;
    width: min-content;
  }
}
*/

.hl.lean.block {
  display: block;
}

.hl.lean.inline {
  display: inline;
  white-space: pre-wrap;
}

.hl.lean .token {
  transition: all 0.25s; /* Slight fade for highlights */
}

@media (hover: hover) {
  .hl.lean .token.binding-hl, .hl.lean .literal.string:hover, .hl.lean .token.typed:hover {
    background-color: #eee;
    border-radius: 2px;
    transition: none;
  }
}


.hl.lean .has-info .token:not(.tactic-state):not(.tactic-state *), .hl.lean .has-info .inter-text:not(.tactic-state):not(.tactic-state *) {
  text-decoration-style: wavy;
  text-decoration-line: underline;
  text-decoration-thickness: from-font;
}

.hl.lean .has-info .hover-info {
  display: none;
  position: absolute;
  transform: translate(0.25rem, 0.3rem);
  border: 1px solid black;
  padding: 0.5rem;
  z-index: 400;
  text-align: left;
}

.hl.lean .has-info.error :not(.tactic-state):not(.tactic-state *){
  text-decoration-color: red;
}

@media (hover: hover) {
  .hl.lean .has-info.error:hover {
    background-color: #ffb3b3;
  }
}

.hl.lean .hover-info.messages > code.error {
  background-color: #e5e5e5;
  border-left: 0.2rem solid #ffb3b3;
}

.tippy-box[data-theme~='error'] .hl.lean .hover-info.messages > code.error {
  background: none;
  border: none;
}

.error pre {
    color: red;
}

.hl.lean .has-info.warning :not(.tactic-state):not(.tactic-state *) {
  text-decoration-color: var(--verso-warning-color);
}

@media (hover: hover) {
  .hl.lean .has-info.warning:hover {
    background-color:var(--verso-warning-color);
  }
}

.hl.lean .hover-info.messages > code.warning {
  background-color: var(--verso-warning-color);
}

.hl.lean .hover-info.messages > code.error {
  background-color: #e5e5e5;
  border-left: 0.2rem solid var(--verso-warning-color);
}

.tippy-box[data-theme~='warning'] .hl.lean .hover-info.messages > code.warning {
  background: none;
  border: none;
}


.hl.lean .has-info.info :not(.tactic-state):not(.tactic-state *) {
  text-decoration-color: blue;
}

@media (hover: hover) {
  .hl.lean .has-info.info:hover {
    background-color: #4777ff;
  }
}


.hl.lean .hover-info.messages > code.info {
  background-color: #e5e5e5;
  border-left: 0.2rem solid #4777ff;
}

.tippy-box[data-theme~='info'] .hl.lean .hover-info.messages > code.info {
  background: none;
  border: none;
}

.hl.lean div.docstring {
  font-family: sans-serif;
  white-space: normal;
  max-width: 40rem;
  width: max-content;
}

.hl.lean div.docstring > :last-child {
  margin-bottom: 0;
}

.hl.lean div.docstring > :first-child {
  margin-top: 0;
}

.hl.lean .hover-info .sep {
  display: block;
  width: auto;
  margin-left: 1rem;
  margin-right: 1rem;
  margin-top: 0.5rem;
  margin-bottom: 0.5rem;
  padding: 0;
  height: 1px;
  border-top: 1px solid #ccc;
}

.hl.lean code {
  font-family: monospace;
}

.hl.lean .tactic-state {
  display: none;
  position: relative;
  left: 2rem;
  width: fit-content;
  border: 1px solid #888888;
  border-radius: 0.1rem;
  padding: 0.5rem;
  font-family: sans-serif;
  background-color: #ffffff;
  z-index: 200;
}

.hl.lean.popup .tactic-state {
  position: static;
  display: block;
  width: auto;
  border: none;
  padding: 0.5rem;
  font-family: sans-serif;
  background-color: #ffffff;
}


.hl.lean .tactic {
  position: relative;
}

.hl.lean .tactic-toggle:checked ~ .tactic-state {
  display: block;
}

/*
@media (hover: hover) {
  .hl.lean .tactic:hover > .tactic-toggle:not(:checked) ~ .tactic-state {
    display: block;
    position: absolute;
    left: 0;
    transform: translate(0.25rem, 0);
    z-index: 250;
  }
}
*/

.hl.lean .tactic > label {
  position: relative;
  transition: all 0.5s;
}

@media (hover: hover) {
  .hl.lean .tactic > label:hover {
    border-bottom: 1px dotted #bbbbbb;
  }
}

.hl.lean .tactic-toggle {
  position: absolute;
  top: 0;
  left: 0;
  opacity: 0;
  height: 0;
  width: 0;
  z-index: -10;
}

.hl.lean .tactic > label::after {
  content: "";
  border: 1px solid #bbbbbb;
  border-radius: 1rem;
  height: 0.25rem;
  vertical-align: middle;
  width: 0.6rem;
  margin-left: 0.1rem;
  margin-right: 0.1rem;
  display: inline-block;
  transition: all 0.5s;
}

/*
@media (hover: hover) {
  .hl.lean .tactic > label:hover::after {
    border: 1px solid #aaaaaa;
    background-color: #aaaaaa;
    transition: all 0.5s;
  }
}
*/

.hl.lean .tactic > label:has(+ .tactic-toggle:checked)::after {
  border: 1px solid #999999;
  background-color: #999999;
  transition: all 0.5s;
}

.hl.lean .tactic-state .goal + .goal {
  margin-top: 1.5rem;
}

.hl.lean .tactic-state summary {
  margin-left: -0.5rem;
}

.hl.lean .tactic-state details {
  padding-left: 0.5rem;
}

.hl.lean .case-label {
  display: block;
  position: relative;
}

.hl.lean .case-label input[type="checkbox"] {
  position: absolute;
  top: 0;
  left: 0;
  opacity: 0;
  height: 0;
  width: 0;
  z-index: -10;
}

.hl.lean .case-label:has(input[type="checkbox"])::before {
  width: 1rem;
  height: 1rem;
  display: inline-block;
  background-color: black;
  content: ' ';
  transition: ease 0.2s;
  margin-right: 0.7rem;
  clip-path: polygon(100% 0, 0 0, 50% 100%);
  width: 0.6rem;
  height: 0.6rem;
}

.hl.lean .case-label:has(input[type="checkbox"]:not(:checked))::before {
  transform: rotate(-90deg);
}

.hl.lean .case-label:has(input[type="checkbox"]) {

}

.hl.lean .case-label:has(input[type="checkbox"]:checked) {

}


.hl.lean .tactic-state .labeled-case > :not(:first-child) {
  max-height: 0px;
  display: block;
  overflow: hidden;
  transition: max-height 0.1s ease-in;
  margin-left: 0.5rem;
  margin-top: 0.1rem;
}

.hl.lean .labeled-case:has(.case-label input[type="checkbox"]:checked) > :not(:first-child) {
  max-height: 100%;
}


.hl.lean .tactic-state .goal-name::before {
  font-style: normal;
  content: "case ";
}

.hl.lean .tactic-state .goal-name {
  font-style: italic;
  font-family: monospace;
}

.hl.lean .tactic-state .hypotheses {
  display: table;
}

.hl.lean .tactic-state .hypothesis {
  display: table-row;
}

.hl.lean .tactic-state .hypothesis > * {
  display: table-cell;
}


.hl.lean .tactic-state .hypotheses .colon {
  text-align: center;
  min-width: 1rem;
}

.hl.lean .tactic-state .hypotheses .name {
  text-align: right;
}

.hl.lean .tactic-state .hypotheses .name,
.hl.lean .tactic-state .hypotheses .type,
.hl.lean .tactic-state .conclusion .type {
  font-family: monospace;
}

.tippy-box[data-theme~='lean'] {
  background-color: #e5e5e5;
  color: black;
  border: 1px solid black;
}
.tippy-box[data-theme~='lean'][data-placement^='top'] > .tippy-arrow::before {
  border-top-color: #e5e5e5;
}
.tippy-box[data-theme~='lean'][data-placement^='bottom'] > .tippy-arrow::before {
  border-bottom-color: #e5e5e5;
}
.tippy-box[data-theme~='lean'][data-placement^='left'] > .tippy-arrow::before {
  border-left-color: #e5e5e5;
}
.tippy-box[data-theme~='lean'][data-placement^='right'] > .tippy-arrow::before {
  border-right-color: #e5e5e5;
}

.tippy-box[data-theme~='message'][data-placement^='top'] > .tippy-arrow::before {
  border-top-color: #e5e5e5;
  border-width: 11px 11px 0;
}
.tippy-box[data-theme~='message'][data-placement^='top'] > .tippy-arrow::after {
  bottom: -11px;
  border-width: 11px 11px 0;
}
.tippy-box[data-theme~='message'][data-placement^='bottom'] > .tippy-arrow::before {
  border-width: 0 11px 11px;
}
.tippy-box[data-theme~='message'][data-placement^='bottom'] > .tippy-arrow::after {
  top: -11px;
  border-width: 0 11px 11px;
}
.tippy-box[data-theme~='message'][data-placement^='left'] > .tippy-arrow::before {
  border-left-color: #e5e5e5;
  border-width: 11px 0 11px 11px;
}
.tippy-box[data-theme~='message'][data-placement^='left'] > .tippy-arrow::after {
  right: -11px;
  border-width: 11px 0 11px 11px;
}

.tippy-box[data-theme~='message'][data-placement^='right'] > .tippy-arrow::before {
  border-right-color: #e5e5e5;
  border-width: 11px 11px 11px 0;
}
.tippy-box[data-theme~='message'][data-placement^='right'] > .tippy-arrow::after {
  left: -11px;
  border-width: 11px 11px 11px 0;
}



.tippy-box[data-theme~='warning'] {
  background-color: #e5e5e5;
  color: black;
  border: 3px solid var(--verso-warning-color);
}

.tippy-box[data-theme~='error'] {
  background-color: #e5e5e5;
  color: black;
  border: 3px solid #f7a7af;
}

.tippy-box[data-theme~='info'] {
  background-color: #e5e5e5;
  color: black;
  border: 3px solid #99b3c2;
}

.tippy-box[data-theme~='tactic'] {
  background-color: white;
  color: black;
  border: 1px solid black;
}
.tippy-box[data-theme~='tactic'][data-placement^='top'] > .tippy-arrow::before {
  border-top-color: white;
}
.tippy-box[data-theme~='tactic'][data-placement^='bottom'] > .tippy-arrow::before {
  border-bottom-color: white;
}
.tippy-box[data-theme~='tactic'][data-placement^='left'] > .tippy-arrow::before {
  border-left-color: white;
}
.tippy-box[data-theme~='tactic'][data-placement^='right'] > .tippy-arrow::before {
  border-right-color: white;
}

</style><style>
.example-file {
  white-space: normal;
  font-family: var(--verso-structure-font-family);
  margin: 1rem;
  width: fit-content;
  border: 1px solid #ddd;
  padding: 0.5rem;

  /* These are necessary for the container to behave nicely on mobile */
  overflow-x: auto;
  max-width: 100%;
  box-sizing: border-box;
}
.example-file::before {
  counter-reset: linenumber;
}
.example-file > .line {
  display: block;
  white-space: pre;
  counter-increment: linenumber;
  font-family: var(--verso-code-font-family);
}
.example-file > .line::before {
  -webkit-user-select: none;
  display: inline-block;
  content: counter(linenumber);
  border-right: 1px solid #ddd;
  width: 2em;
  padding-right: 0.25em;
  margin-right: 0.25em;
  font-family: var(--verso-code-font-family);
  text-align: right;
}
.example-file > .line::after {
  -webkit-user-select: none;
  display: inline-block;
  content: "⏎";
  opacity: 0;
}
.example-file > .line:hover::after {
  opacity: 1;
}
.example-file > .line:hover, .example-file > .line:hover::before {
  background-color: #eee;
}
.example-file > .empty {
  display: block;
  white-space: pre;
  font-family: var(--verso-code-font-family);
  font-style: italic;
}
.example-file > .empty::before {
  -webkit-user-select: none;
  display: inline-block;
  content: "";
  border-right: 1px solid #ddd;
  width: 2em;
  padding-right: 0.25em;
  margin-right: 0.25em;
  font-family: var(--verso-code-font-family);
  text-align: right;
}
</style><style>
table.tabular {
  margin: auto;
  border-spacing: 1rem;
}
table.tabular.left-align {
  margin-right: auto;
  margin-left: 0;
}
table.tabular.center-align {
  margin: auto;
}
table.tabular.right-align {
  margin-left auto;
  margin-right: 0;
}
table.tabular td, table.tabular th {
  text-align: left;
  vertical-align: top;
}
table.tabular td > p:first-child, table.tabular th > p:first-child {
  margin-top: 0;
}
table.tabular td > p:last-child, table.tabular th > p:first-child {
  margin-bottom: 0;
}
</style><style>
.shell-commands {

}
.shell-commands > * {
  display: block;
  white-space: pre;
}
.shell-commands .command::before {
  content: "$ ";
  font-weight: 600;
}

div.paragraph > .shell-commands:not(:first-child) {
  margin-top: 0.5rem;
}

div.paragraph > .shell-commands:not(:last-child) {
  margin-bottom: 0.5rem;
}
</style><style>
.eq-steps .hl.lean.block {
  background-color: #f6f7f6;
  padding: 1rem;
  margin-top: 0.25rem;
  margin-bottom: 0.25rem;
}
.eq-steps .reason {
  font-style: italic;
  margin-left: 2.5em;
  display: flex;
}
.eq-steps .reason::before {
  content: "={";
  font-family: var(--verso-code-font-family);
  font-style: normal;
  font-weight: 600;
  margin-right: 0.5em;
  align-self: center;
}
.eq-steps .reason > p {
  margin: 0;
  max-width: 25em;
  align-self: center;
}
.eq-steps .reason::after {
  content: "}=";
  font-family: var(--verso-code-font-family);
  font-style: normal;
  font-weight: 600;
  margin-left: 1em;
  align-self: center;
}
</style><style>
div.paragraph > .eq-steps:not(:first-child) {
  margin-top: 0.5rem;
}

div.paragraph > .eq-steps:not(:last-child) {
  margin-bottom: 0.5rem;
}
</style><script>
      
window.onload = () => {

    // Don't show hovers inside of closed tactic states
    function blockedByTactic(elem) {
      let parent = elem.parentNode;
      while (parent && "classList" in parent) {
        if (parent.classList.contains("tactic")) {
          const toggle = parent.querySelector("input.tactic-toggle");
          if (toggle) {
            return !toggle.checked;
          }
        }
        parent = parent.parentNode;
      }
      return false;
    }

    function blockedByTippy(elem) {
      // Don't show a new hover until the old ones are all closed.
      // Scoped to the nearest "top-level block" to avoid being O(n) in the size of the document.
      var block = elem;
      const topLevel = new Set(["section", "body", "html", "nav", "header"]);
      while (block.parentNode && !topLevel.has(block.parentNode.nodeName.toLowerCase())) {
        block = block.parentNode;
      }
      for (const child of block.querySelectorAll(".token, .has-info")) {
        if (child._tippy && child._tippy.state.isVisible) { return true };
      }
      return false;
    }

    for (const c of document.querySelectorAll(".hl.lean .token")) {
        if (c.dataset.binding != "") {
            c.addEventListener("mouseover", (event) => {
                if (blockedByTactic(c)) {return;}
                const context = c.closest(".hl.lean").dataset.leanContext;
                for (const example of document.querySelectorAll(".hl.lean")) {
                    if (example.dataset.leanContext == context) {
                        for (const tok of example.querySelectorAll(".token")) {
                            if (c.dataset.binding == tok.dataset.binding) {
                                tok.classList.add("binding-hl");
                            }
                        }
                    }
                }
            });
        }
        c.addEventListener("mouseout", (event) => {
            for (const tok of document.querySelectorAll(".hl.lean .token")) {
                tok.classList.remove("binding-hl");
            }
        });
    }
    /* Render docstrings */
    if ('undefined' !== typeof marked) {
        for (const d of document.querySelectorAll("code.docstring, pre.docstring")) {
            const str = d.innerText;
            const html = marked.parse(str);
            const rendered = document.createElement("div");
            rendered.classList.add("docstring");
            rendered.innerHTML = html;
            d.parentNode.replaceChild(rendered, d);
        }
    }
    // Add hovers
    let siteRoot = typeof __versoSiteRoot !== 'undefined' ? __versoSiteRoot : "/";
    let docsJson = siteRoot + "-verso-docs.json";
    fetch(docsJson).then((resp) => resp.json()).then((versoDocData) => {

      function hideParentTooltips(element) {
        let parent = element.parentElement;
        while (parent) {
          const tippyInstance = parent._tippy;
          if (tippyInstance) {
            tippyInstance.hide();
          }
          parent = parent.parentElement;
        }
      }



      const defaultTippyProps = {
        /* DEBUG -- remove the space: * /
        onHide(any) { return false; },
        trigger: "click",
        // */
        /* theme: "lean", */
        maxWidth: "none",
        appendTo: () => document.body,
        interactive: true,
        delay: [100, null],
        /* ignoreAttributes: true, */
        followCursor: 'initial',
        onShow(inst) {
          if (inst.reference.className == 'tactic') {

            const toggle = inst.reference.querySelector("input.tactic-toggle");
            if (toggle && toggle.checked) {
              return false;
            }
            hideParentTooltips(inst.reference);
            //if (blockedByTippy(inst.reference)) { return false; }

          } else if (inst.reference.querySelector(".hover-info") || "versoHover" in inst.reference.dataset) {
            if (blockedByTactic(inst.reference)) { return false };
            if (blockedByTippy(inst.reference)) { return false; }
          } else { // Nothing to show here!
            return false;
          }
        },
        content (tgt) {
          const content = document.createElement("span");
          if (tgt.className == 'tactic') {
            const state = tgt.querySelector(".tactic-state").cloneNode(true);
            state.style.display = "block";
            content.appendChild(state);
            content.style.display = "block";
            content.className = "hl lean popup";
          } else {
            content.className = "hl lean";
            content.style.display = "block";
            content.style.maxHeight = "300px";
            content.style.overflowY = "auto";
            content.style.overflowX = "hidden";
            const hoverId = tgt.dataset.versoHover;
            const hoverInfo = tgt.querySelector(".hover-info");
            if (hoverId) { // Docstrings from the table
              // TODO stop doing an implicit conversion from string to number here
              let data = versoDocData[hoverId];
              if (data) {
                const info = document.createElement("span");
                info.className = "hover-info";
                info.style.display = "block";
                info.innerHTML = data;
                content.appendChild(info);
                /* Render docstrings - TODO server-side */
                if ('undefined' !== typeof marked) {
                    for (const d of content.querySelectorAll("code.docstring, pre.docstring")) {
                        const str = d.innerText;
                        const html = marked.parse(str);
                        const rendered = document.createElement("div");
                        rendered.classList.add("docstring");
                        rendered.innerHTML = html;
                        d.parentNode.replaceChild(rendered, d);
                    }
                }
              } else {
                content.innerHTML = "Failed to load doc ID: " + hoverId;
              }
            } else if (hoverInfo) { // The inline info, still used for compiler messages
              content.appendChild(hoverInfo.cloneNode(true));
            }
          }
          return content;
        }
      };



      const addTippy = (selector, props) => {
        tippy(selector, Object.assign({}, defaultTippyProps, props));
      };
      document.querySelectorAll('.hl.lean .const.token, .hl.lean .keyword.token, .hl.lean .literal.token, .hl.lean .option.token, .hl.lean .var.token, .hl.lean .typed.token').forEach(element => {
        element.setAttribute('data-tippy-theme', 'lean');
      });
      document.querySelectorAll('.hl.lean .has-info.warning').forEach(element => {
        element.setAttribute('data-tippy-theme', 'warning message');
      });
      document.querySelectorAll('.hl.lean .has-info.info').forEach(element => {
        element.setAttribute('data-tippy-theme', 'info message');
      });
      document.querySelectorAll('.hl.lean .has-info.error').forEach(element => {
        element.setAttribute('data-tippy-theme', 'error message');
      });
      document.querySelectorAll('.hl.lean .tactic').forEach(element => {
        element.setAttribute('data-tippy-theme', 'tactic');
      });
      let insts = tippy('.hl.lean .const.token, .hl.lean .keyword.token, .hl.lean .literal.token, .hl.lean .option.token, .hl.lean .var.token, .hl.lean .typed.token, .hl.lean .has-info, .hl.lean .tactic', defaultTippyProps);



      /*
      tippy('.hl.lean .tactic', {
        allowHtml: true,

        onHide(any) { return false; },
        trigger: "click",

        maxWidth: "none",
        onShow(inst) {
          const toggle = inst.reference.querySelector("input.tactic-toggle");
          if (toggle && toggle.checked) {
            return false;
          }
          if (blockedByTippy(inst.reference)) { return false; }
        },
        content (tgt) {
          const content = document.createElement("span");
          const state = tgt.querySelector(".tactic-state").cloneNode(true);
          state.style.display = "block";
          content.appendChild(state);
          content.style.display = "block";
          content.className = "hl lean popup";
          return content;
        }
      });
      */
  });
}
</script>
    </head>
  <body>
    <header>
      <div class="header-logo-wrapper">
        <a href="" id="logo"><img src="static/lean_logo.svg"></a></div>
      <div class="header-title-wrapper">
        <a href="" class="header-title"><h1>
            Functional Programming in Lean</h1>
          </a></div>
      </header>
    <label for="toggle-toc" id="toggle-toc-click"><span class="line line1"></span><span class="line line2"></span><span class="line line3"></span></label><div class="with-toc">
      <div class="toc-backdrop" onclick="document.getElementById('toggle-toc-click')?.click()"></div>
      <nav id="toc">
        <input type="checkbox" id="toggle-toc"><div class="first">
          <a href="" class="toc-title"><h1>
              Functional Programming in Lean</h1>
            </a><div class="split-tocs">
            <div class="split-toc book">
              <div class="title">
                <label for="--verso-manual-toc-----bookRoot" class="toggle-split-toc"><input type="checkbox" class="toggle-split-toc" id="--verso-manual-toc-----bookRoot"></label><span class="">Table of Contents</span></div>
              <table><tr class="unnumbered"><td class="num"><td><a href="Introduction/#Functional-Programming-in-Lean--Introduction">Introduction</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="Acknowledgments/#Functional-Programming-in-Lean--Acknowledgments">Acknowledgments</a></td></tr><tr class="numbered"><td class="num">1.</td><td><a href="Getting-to-Know-Lean/#getting-to-know">Getting to Know Lean</a></td></tr><tr class="numbered"><td class="num">2.</td><td><a href="Hello___-World___/#hello-world">Hello, World!</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="Interlude___-Propositions___-Proofs___-and-Indexing/#props-proofs-indexing">Interlude: Propositions, Proofs, and Indexing</a></td></tr><tr class="numbered"><td class="num">3.</td><td><a href="Overloading-and-Type-Classes/#Functional-Programming-in-Lean--Overloading-and-Type-Classes">Overloading and Type Classes</a></td></tr><tr class="numbered"><td class="num">4.</td><td><a href="Monads/#Functional-Programming-in-Lean--Monads">Monads</a></td></tr><tr class="numbered"><td class="num">5.</td><td><a href="Functors___-Applicative-Functors___-and-Monads/#Functional-Programming-in-Lean--Functors___-Applicative-Functors___-and-Monads">Functors, Applicative Functors, and Monads</a></td></tr><tr class="numbered"><td class="num">6.</td><td><a href="Monad-Transformers/#Functional-Programming-in-Lean--Monad-Transformers">Monad Transformers</a></td></tr><tr class="current numbered"><td class="num">7.</td><td><a href="Programming-with-Dependent-Types/#Functional-Programming-in-Lean--Programming-with-Dependent-Types">Programming with Dependent Types</a></td></tr><tr class="unnumbered"><td class="num"><td><a href="Interlude___-Tactics___-Induction___-and-Proofs/#Functional-Programming-in-Lean--Interlude___-Tactics___-Induction___-and-Proofs">Interlude: Tactics, Induction, and Proofs</a></td></tr><tr class="numbered"><td class="num">8.</td><td><a href="Programming___-Proving___-and-Performance/#Functional-Programming-in-Lean--Programming___-Proving___-and-Performance">Programming, Proving, and Performance</a></td></tr><tr class="numbered"><td class="num">9.</td><td><a href="Next-Steps/#next-steps">Next Steps</a></td></tr></table></div>
            <div class="split-toc">
              <div class="title">
                <label for="--verso-manual-toc-Functional-Programming-in-Lean--Programming-with-Dependent-Types" class="toggle-split-toc"><input type="checkbox" class="toggle-split-toc" id="--verso-manual-toc-Functional-Programming-in-Lean--Programming-with-Dependent-Types" checked="checked"></label><span class="number">7.</span> <span class=""><a href="Programming-with-Dependent-Types/#Functional-Programming-in-Lean--Programming-with-Dependent-Types">Programming with Dependent Types</a></span></div>
              <table><tr class="numbered"><td class="num">7.1.</td><td><a href="Programming-with-Dependent-Types/Indexed-Families/#Functional-Programming-in-Lean--Programming-with-Dependent-Types--Indexed-Families">Indexed Families</a></td></tr><tr class="numbered"><td class="num">7.2.</td><td><a href="Programming-with-Dependent-Types/The-Universe-Design-Pattern/#Functional-Programming-in-Lean--Programming-with-Dependent-Types--The-Universe-Design-Pattern">The Universe Design Pattern</a></td></tr><tr class="current numbered"><td class="num">7.3.</td><td><a href="Programming-with-Dependent-Types/Worked-Example___-Typed-Queries/#Functional-Programming-in-Lean--Programming-with-Dependent-Types--Worked-Example___-Typed-Queries">Worked Example: Typed Queries</a></td></tr><tr class="numbered"><td class="num">7.4.</td><td><a href="Programming-with-Dependent-Types/Indices___-Parameters___-and-Universe-Levels/#Functional-Programming-in-Lean--Programming-with-Dependent-Types--Indices___-Parameters___-and-Universe-Levels">Indices, Parameters, and Universe Levels</a></td></tr><tr class="numbered"><td class="num">7.5.</td><td><a href="Programming-with-Dependent-Types/Pitfalls-of-Programming-with-Dependent-Types/#Functional-Programming-in-Lean--Programming-with-Dependent-Types--Pitfalls-of-Programming-with-Dependent-Types">Pitfalls of Programming with Dependent Types</a></td></tr><tr class="numbered"><td class="num">7.6.</td><td><a href="Programming-with-Dependent-Types/Summary/#Functional-Programming-in-Lean--Programming-with-Dependent-Types--Summary">Summary</a></td></tr></table></div>
            <div class="split-toc">
              <div class="title">
                <label for="--verso-manual-toc-Functional-Programming-in-Lean--Programming-with-Dependent-Types--Worked-Example___-Typed-Queries" class="toggle-split-toc"><input type="checkbox" class="toggle-split-toc" id="--verso-manual-toc-Functional-Programming-in-Lean--Programming-with-Dependent-Types--Worked-Example___-Typed-Queries" checked="checked"></label><span class="number">7.3.</span> <span class="current"><a href="Programming-with-Dependent-Types/Worked-Example___-Typed-Queries/#Functional-Programming-in-Lean--Programming-with-Dependent-Types--Worked-Example___-Typed-Queries">Worked Example: Typed Queries</a></span></div>
              <table><tr class="numbered"><td class="num">7.3.1.</td><td><a href="Programming-with-Dependent-Types/Worked-Example___-Typed-Queries/#Functional-Programming-in-Lean--Programming-with-Dependent-Types--Worked-Example___-Typed-Queries--A-Universe-of-Data">A Universe of Data</a></td></tr><tr class="numbered"><td class="num">7.3.2.</td><td><a href="Programming-with-Dependent-Types/Worked-Example___-Typed-Queries/#Functional-Programming-in-Lean--Programming-with-Dependent-Types--Worked-Example___-Typed-Queries--Schemas-and-Tables">Schemas and Tables</a></td></tr><tr class="numbered"><td class="num">7.3.3.</td><td><a href="Programming-with-Dependent-Types/Worked-Example___-Typed-Queries/#Functional-Programming-in-Lean--Programming-with-Dependent-Types--Worked-Example___-Typed-Queries--Conditions-and-Selection">Conditions and Selection</a></td></tr><tr class="numbered"><td class="num">7.3.4.</td><td><a href="Programming-with-Dependent-Types/Worked-Example___-Typed-Queries/#Functional-Programming-in-Lean--Programming-with-Dependent-Types--Worked-Example___-Typed-Queries--Queries">Queries</a></td></tr><tr class="numbered"><td class="num">7.3.5.</td><td><a href="Programming-with-Dependent-Types/Worked-Example___-Typed-Queries/#Functional-Programming-in-Lean--Programming-with-Dependent-Types--Worked-Example___-Typed-Queries--Executing-Queries">Executing Queries</a></td></tr><tr class="numbered"><td class="num">7.3.6.</td><td><a href="Programming-with-Dependent-Types/Worked-Example___-Typed-Queries/#Functional-Programming-in-Lean--Programming-with-Dependent-Types--Worked-Example___-Typed-Queries--Exercises">Exercises</a></td></tr></table></div>
            </div>
          </div>
        <div class="last">
          <ul id="meta-links">
            <li>
              <a href="https://github.com/leanprover/fp-lean">Source Code</a></li>
            <li>
              <a href="https://github.com/leanprover/fp-lean/issues">Report Issues</a></li>
            </ul>
          </div>
        </nav>
      <main><div class="content-wrapper">
          <nav class="prev-next-buttons">
            <a class="local-button active" href="Programming-with-Dependent-Types/The-Universe-Design-Pattern/#Functional-Programming-in-Lean--Programming-with-Dependent-Types--The-Universe-Design-Pattern" rel="prev" title="7.2. The Universe Design Pattern"><span class="arrow">←</span><span class="where">7.2. The Universe Design Pattern</span></a><a class="local-button active" href="Programming-with-Dependent-Types/Indices___-Parameters___-and-Universe-Levels/#Functional-Programming-in-Lean--Programming-with-Dependent-Types--Indices___-Parameters___-and-Universe-Levels" rel="next" title="7.4. Indices, Parameters, and Universe Levels"><span class="where">7.4. Indices, Parameters, and Universe Levels</span><span class="arrow">→</span></a></nav>
          <section>
            <h1>
              7.3. Worked Example: Typed Queries</h1>
            <p>
              Indexed families are very useful when building an API that is supposed to resemble some other language.
They can be used to write a library of HTML constructors that don't permit generating invalid HTML, to encode the specific rules of a configuration file format, or to model complicated business constraints.
This section describes an encoding of a subset of relational algebra in Lean using indexed families, as a simpler demonstration of techniques that can be used to build a more powerful database query language.</p>
            <p>
              This subset uses the type system to enforce requirements such as disjointness of field names, and it uses type-level computation to reflect the schema into the types of values that are returned from a query.
It is not a realistic system, however—databases are represented as linked lists of linked lists, the type system is much simpler than that of SQL, and the operators of relational algebra don't really match those of SQL.
However, it is large enough to demonstrate useful principles and techniques.</p>
            <section>
              <h2 id="Functional-Programming-in-Lean--Programming-with-Dependent-Types--Worked-Example___-Typed-Queries--A-Universe-of-Data">
                7.3.1. A Universe of Data</h2>
              <p>
                In this relational algebra, the base data that can be held in columns can have types <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Int" data-verso-hover="28">Int</span></code>, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-String" data-verso-hover="35">String</span></code>, and <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Bool" data-verso-hover="40">Bool</span></code> and are described by the universe <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DBType" data-verso-hover="1640">DBType</span></code>:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.inductive-113" data-verso-hover="96">inductive</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType" data-verso-hover="1640">DBType</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-130">where</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.int" data-verso-hover="1641">int</span><span class="inter-text"> </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">string</span><span class="inter-text"> </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.bool" data-verso-hover="1643">bool</span><span class="inter-text">
</span><span class="inter-text">
</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.abbrev-161">abbrev</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.asType" data-verso-hover="1644">DBType.asType</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType" data-verso-hover="1640">DBType</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="sort token" data-binding="" data-verso-hover="50">Type</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.int" data-verso-hover="1641">.int</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Int" data-verso-hover="28">Int</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">.string</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.bool" data-verso-hover="1643">.bool</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Bool" data-verso-hover="40">Bool</span></code><p>
                Using <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DBType.asType" data-verso-hover="1644">DBType.asType</span></code> allows these codes to be used for types.
For example:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="has-info info"><span class="hover-container"><span class="hover-info messages"><code class="message info">"Mount Hood"</code></span></span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.eval-345" data-verso-hover="7">#eval</span></span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="literal string token" data-binding="" data-verso-hover="1573">"Mount Hood"</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">DBType.string</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DBType.asType" data-verso-hover="1644">asType</span><span class="unknown token" data-binding="">)</span></code><div class="information">
                <pre>"Mount Hood"</pre></div>
              <p>
                It is possible to compare the values described by any of the three database types for equality.
Explaining this to Lean, however, requires a bit of work.
Simply using <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-BEq" data-verso-hover="516">BEq</span></code> directly fails:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-619">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.beq" data-verso-hover="1645">DBType.beq</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.258" data-verso-hover="1646">t</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType" data-verso-hover="1640">DBType</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.261" data-verso-hover="1609">x</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.275" data-verso-hover="1609">y</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.258" data-verso-hover="1646">t</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DBType.asType" data-verso-hover="1644">asType</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Bool" data-verso-hover="40">Bool</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="has-info error"><span class="hover-container"><span class="hover-info messages"><code class="message error">failed to synthesize
  BEq t.asType

Additional diagnostic information may be available using the `set_option diagnostics true` command.</code></span></span><span class="var token" data-binding="var-_uniq.261" data-verso-hover="1609">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">==</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.275" data-verso-hover="1609">y</span></span></code><div class="error">
                <pre>failed to synthesize
  BEq t.asType

Additional diagnostic information may be available using the `set_option diagnostics true` command.</pre></div>
              <p>
                Just as in the nested pairs universe, type class search doesn't automatically check each possibility for <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.258" data-verso-hover="1646">t</span></code>'s value
The solution is to use pattern matching to refine the types of <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.380" data-verso-hover="1609">x</span></code> and <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.394" data-verso-hover="1609">y</span></code>:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-743">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.beq" data-verso-hover="1645">DBType.beq</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.377" data-verso-hover="1646">t</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType" data-verso-hover="1640">DBType</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.380" data-verso-hover="1609">x</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.394" data-verso-hover="1609">y</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.377" data-verso-hover="1646">t</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DBType.asType" data-verso-hover="1644">asType</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Bool" data-verso-hover="40">Bool</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-800" data-verso-hover="100">match</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.377" data-verso-hover="1646">t</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-800" data-verso-hover="100">with</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.int" data-verso-hover="1641">.int</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.380" data-verso-hover="1647">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">==</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.394" data-verso-hover="1647">y</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">.string</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.380" data-verso-hover="1648">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">==</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.394" data-verso-hover="1648">y</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.bool" data-verso-hover="1643">.bool</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.380" data-verso-hover="1622">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">==</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.394" data-verso-hover="1622">y</span></code><p>
                In this version of the function, <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.380" data-verso-hover="1609">x</span></code> and <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.394" data-verso-hover="1609">y</span></code> have types <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Int" data-verso-hover="28">Int</span></code>, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-String" data-verso-hover="35">String</span></code>, and <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Bool" data-verso-hover="40">Bool</span></code> in the three respective cases, and these types all have <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-BEq" data-verso-hover="516">BEq</span></code> instances.
The definition of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DBType.beq" data-verso-hover="1645">DBType.beq</span></code> can be used to define a <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-BEq" data-verso-hover="516">BEq</span></code> instance for the types that are coded for by <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DBType" data-verso-hover="1640">DBType</span></code>:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.instance-917">instance</span><span class="inter-text"> </span><span class="unknown token" data-binding="">{</span><span class="var token" data-binding="var-_uniq.1027" data-verso-hover="1646">t</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType" data-verso-hover="1640">DBType</span><span class="unknown token" data-binding="">}</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-BEq" data-verso-hover="516">BEq</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1027" data-verso-hover="1646">t</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DBType.asType" data-verso-hover="1644">asType</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.whereStructInst-954">where</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-BEq.beq" data-verso-hover="1612">beq</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1027" data-verso-hover="1646">t</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DBType.beq" data-verso-hover="1645">beq</span></code><p>
                This is not the same as an instance for the codes:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.instance-1028">instance</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-BEq" data-verso-hover="516">BEq</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType" data-verso-hover="1640">DBType</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.whereStructInst-1050">where</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-BEq.beq" data-verso-hover="1649">beq</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.int" data-verso-hover="1641">.int</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.int" data-verso-hover="1641">.int</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Bool.true" data-verso-hover="97">true</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">.string</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">.string</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Bool.true" data-verso-hover="97">true</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.bool" data-verso-hover="1643">.bool</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.bool" data-verso-hover="1643">.bool</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Bool.true" data-verso-hover="97">true</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">_</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="unknown token" data-binding="">_</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Bool.false" data-verso-hover="19">false</span></code><p>
                The former instance allows comparison of values drawn from the types described by the codes, while the latter allows comparison of the codes themselves.</p>
              <p>
                A <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Repr" data-verso-hover="64">Repr</span></code> instance can be written using the same technique.
The method of the <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Repr" data-verso-hover="64">Repr</span></code> class is called <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Repr.reprPrec" data-verso-hover="1650">reprPrec</span></code> because it is designed to take things like operator precedence into account when displaying values.
Refining the type through dependent pattern matching allows the <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Repr.reprPrec" data-verso-hover="1650">reprPrec</span></code> methods from the <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Repr" data-verso-hover="64">Repr</span></code> instances for <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Int" data-verso-hover="28">Int</span></code>, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-String" data-verso-hover="35">String</span></code>, and <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Bool" data-verso-hover="40">Bool</span></code> to be used:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.instance-1219">instance</span><span class="inter-text"> </span><span class="unknown token" data-binding="">{</span><span class="var token" data-binding="var-_uniq.1304" data-verso-hover="1646">t</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType" data-verso-hover="1640">DBType</span><span class="unknown token" data-binding="">}</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Repr" data-verso-hover="64">Repr</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1304" data-verso-hover="1646">t</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DBType.asType" data-verso-hover="1644">asType</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.whereStructInst-1257">where</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Repr.reprPrec" data-verso-hover="1650">reprPrec</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-1281" data-verso-hover="100">match</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.1304" data-verso-hover="1646">t</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-1281" data-verso-hover="100">with</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.int" data-verso-hover="1641">.int</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Repr.reprPrec" data-verso-hover="1651">reprPrec</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">.string</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Repr.reprPrec" data-verso-hover="1651">reprPrec</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.bool" data-verso-hover="1643">.bool</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Repr.reprPrec" data-verso-hover="1651">reprPrec</span></code></section>
            <section>
              <h2 id="Functional-Programming-in-Lean--Programming-with-Dependent-Types--Worked-Example___-Typed-Queries--Schemas-and-Tables">
                7.3.2. Schemas and Tables</h2>
              <p>
                A schema describes the name and type of each column in a database:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.structureTk-1413">structure</span><span class="inter-text"> </span><span class="const token" data-binding="const-Column" data-verso-hover="1652">Column</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-1430">where</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Column.name" data-verso-hover="1653">name</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1654">contains</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType" data-verso-hover="1640">DBType</span><span class="inter-text">
</span><span class="inter-text">
</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.abbrev-1473">abbrev</span><span class="inter-text"> </span><span class="const token" data-binding="const-Schema" data-verso-hover="1655">Schema</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="const token" data-binding="const-Column" data-verso-hover="1652">Column</span></code><p>
                In fact, a schema can be seen as a universe that describes rows in a table.
The empty schema describes the unit type, a schema with a single column describes that value on its own, and a schema with at least two columns is represented by a tuple:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.abbrev-1542">abbrev</span><span class="inter-text"> </span><span class="const token" data-binding="const-Row" data-verso-hover="1656">Row</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Schema" data-verso-hover="1655">Schema</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="sort token" data-binding="" data-verso-hover="50">Type</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Unit" data-verso-hover="184">Unit</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="var token" data-binding="var-_uniq.2092" data-verso-hover="1657">col</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2092" data-verso-hover="1657">col</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1654">contains</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DBType.asType" data-verso-hover="1644">asType</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2122" data-verso-hover="1657">col1</span><span class="inter-text"> </span><span class="unknown token" data-binding="">::</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2123" data-verso-hover="1657">col2</span><span class="inter-text"> </span><span class="unknown token" data-binding="">::</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2124" data-verso-hover="1658">cols</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2122" data-verso-hover="1657">col1</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1654">contains</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DBType.asType" data-verso-hover="1644">asType</span><span class="inter-text"> </span><span class="unknown token" data-binding="">×</span><span class="inter-text"> </span><span class="const token" data-binding="const-Row" data-verso-hover="1656">Row</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.2123" data-verso-hover="1657">col2</span><span class="unknown token" data-binding="">::</span><span class="var token" data-binding="var-_uniq.2124" data-verso-hover="1658">cols</span><span class="unknown token" data-binding="">)</span></code><p>
                As described in <a href="Getting-to-Know-Lean/Polymorphism/#prod">the initial section on product types</a>, Lean's product type and tuples are right-associative.
This means that nested pairs are equivalent to ordinary flat tuples.</p>
              <p>
                A table is a list of rows that share a schema:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.abbrev-1915">abbrev</span><span class="inter-text"> </span><span class="const token" data-binding="const-Table" data-verso-hover="1659">Table</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.2350" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Schema" data-verso-hover="1655">Schema</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Row" data-verso-hover="1656">Row</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2350" data-verso-hover="1660">s</span><span class="unknown token" data-binding="">)</span></code><p>
                For example, a diary of visits to mountain peaks can be represented with the schema <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span></code>:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.abbrev-1996">abbrev</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Schema" data-verso-hover="1655">Schema</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟨</span><span class="literal string token" data-binding="" data-verso-hover="1098">"name"</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">.string</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟩</span><span class="unknown token" data-binding="">,</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟨</span><span class="literal string token" data-binding="" data-verso-hover="1663">"location"</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">.string</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟩</span><span class="unknown token" data-binding="">,</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟨</span><span class="literal string token" data-binding="" data-verso-hover="1664">"elevation"</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.int" data-verso-hover="1641">.int</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟩</span><span class="unknown token" data-binding="">,</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟨</span><span class="literal string token" data-binding="" data-verso-hover="1665">"lastVisited"</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.int" data-verso-hover="1641">.int</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟩</span><span class="inter-text">
</span><span class="unknown token" data-binding="">]</span></code><p>
                A selection of peaks visited by the author of this book appears as an ordinary list of tuples:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-2180">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-mountainDiary" data-verso-hover="1666">mountainDiary</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Table" data-verso-hover="1659">Table</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">(</span><span class="literal string token" data-binding="" data-verso-hover="1667">"Mount Nebo"</span><span class="unknown token" data-binding="">,</span><span class="inter-text">       </span><span class="literal string token" data-binding="" data-verso-hover="1668">"USA"</span><span class="unknown token" data-binding="">,</span><span class="inter-text">     </span><span class="typed token" data-binding="" data-verso-hover="1669">3637</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="1670">2013</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">,</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">(</span><span class="literal string token" data-binding="" data-verso-hover="1671">"Moscow Mountain"</span><span class="unknown token" data-binding="">,</span><span class="inter-text">  </span><span class="literal string token" data-binding="" data-verso-hover="1668">"USA"</span><span class="unknown token" data-binding="">,</span><span class="inter-text">     </span><span class="typed token" data-binding="" data-verso-hover="1669">1519</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="1670">2015</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">,</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">(</span><span class="literal string token" data-binding="" data-verso-hover="1672">"Himmelbjerget"</span><span class="unknown token" data-binding="">,</span><span class="inter-text">    </span><span class="literal string token" data-binding="" data-verso-hover="1673">"Denmark"</span><span class="unknown token" data-binding="">,</span><span class="inter-text">  </span><span class="typed token" data-binding="" data-verso-hover="1669">147</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="1670">2004</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">,</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">(</span><span class="literal string token" data-binding="" data-verso-hover="1674">"Mount St. Helens"</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1668">"USA"</span><span class="unknown token" data-binding="">,</span><span class="inter-text">     </span><span class="typed token" data-binding="" data-verso-hover="1669">2549</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="1670">2010</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="unknown token" data-binding="">]</span></code><p>
                Another example consists of waterfalls and a diary of visits to them:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.abbrev-2457">abbrev</span><span class="inter-text"> </span><span class="const token" data-binding="const-waterfall" data-verso-hover="1675">waterfall</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Schema" data-verso-hover="1655">Schema</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟨</span><span class="literal string token" data-binding="" data-verso-hover="1098">"name"</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">.string</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟩</span><span class="unknown token" data-binding="">,</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟨</span><span class="literal string token" data-binding="" data-verso-hover="1663">"location"</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">.string</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟩</span><span class="unknown token" data-binding="">,</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟨</span><span class="literal string token" data-binding="" data-verso-hover="1665">"lastVisited"</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.int" data-verso-hover="1641">.int</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟩</span><span class="inter-text">
</span><span class="unknown token" data-binding="">]</span></code><code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-2625">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-waterfallDiary" data-verso-hover="1676">waterfallDiary</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Table" data-verso-hover="1659">Table</span><span class="inter-text"> </span><span class="const token" data-binding="const-waterfall" data-verso-hover="1675">waterfall</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">(</span><span class="literal string token" data-binding="" data-verso-hover="1677">"Multnomah Falls"</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1668">"USA"</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="1670">2018</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">,</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">(</span><span class="literal string token" data-binding="" data-verso-hover="1678">"Shoshone Falls"</span><span class="unknown token" data-binding="">,</span><span class="inter-text">  </span><span class="literal string token" data-binding="" data-verso-hover="1668">"USA"</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="1670">2014</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="unknown token" data-binding="">]</span></code><section>
                <h3 id="Functional-Programming-in-Lean--Programming-with-Dependent-Types--Worked-Example___-Typed-Queries--Schemas-and-Tables--Recursion-and-Universes___-Revisited">
                  7.3.2.1. Recursion and Universes, Revisited</h3>
                <p>
                  The convenient structuring of rows as tuples comes at a cost: the fact that <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Row" data-verso-hover="1656">Row</span></code> treats its two base cases separately means that functions that use <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Row" data-verso-hover="1656">Row</span></code> in their types and are defined recursively over the codes (that, is the schema) need to make the same distinctions.
One example of a case where this matters is an equality check that uses recursion over the schema to define a function that checks rows for equality.
This example does not pass Lean's type checker:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-2979">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Row.bEq" data-verso-hover="1679">Row.bEq</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.3081" data-verso-hover="1680">r1</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3094" data-verso-hover="1680">r2</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Row" data-verso-hover="1656">Row</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3079" data-verso-hover="1660">s</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Bool" data-verso-hover="40">Bool</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-3019" data-verso-hover="100">match</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3103" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-3019" data-verso-hover="100">with</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Bool.true" data-verso-hover="97">true</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3247" data-verso-hover="1657">col</span><span class="unknown token" data-binding="">::</span><span class="var token" data-binding="var-_uniq.3248" data-verso-hover="1658">cols</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-3068" data-verso-hover="100">match</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3081" data-verso-hover="1681">r1</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3094" data-verso-hover="1681">r2</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-3068" data-verso-hover="100">with</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="has-info error"><span class="hover-container"><span class="hover-info messages"><code class="message error">type mismatch
  (v1, r1')
has type
  ?m.3306 × ?m.3309 : Type (max ?u.3318 ?u.3317)
but is expected to have type
  Row (col :: cols) : Type</code></span></span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">v1</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="unknown token" data-binding="">r1'</span></span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">v2</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="unknown token" data-binding="">r2'</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="unknown token" data-binding="">v1</span><span class="inter-text"> </span><span class="unknown token" data-binding="">==</span><span class="inter-text"> </span><span class="unknown token" data-binding="">v2</span><span class="inter-text"> </span><span class="unknown token" data-binding="">&&</span><span class="inter-text"> </span><span class="unknown token" data-binding="">bEq</span><span class="inter-text"> </span><span class="unknown token" data-binding="">r1'</span><span class="inter-text"> </span><span class="unknown token" data-binding="">r2'</span></code><div class="error">
                  <pre>type mismatch
  (v1, r1')
has type
  ?m.3306 × ?m.3309 : Type (max ?u.3318 ?u.3317)
but is expected to have type
  Row (col :: cols) : Type</pre></div>
                <p>
                  The problem is that the pattern <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.3247" data-verso-hover="1657">col</span><span class="inter-text"> </span><span class="unknown token" data-binding="">::</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.3248" data-verso-hover="1658">cols</span></code> does not sufficiently refine the type of the rows.
This is because Lean cannot yet tell whether the singleton pattern <code class="hl lean inline" data-lean-context="examples"><span class="unknown token" data-binding="">[</span><span class="var token" data-binding="var-_uniq.2092" data-verso-hover="1657">col</span><span class="unknown token" data-binding="">]</span></code> or the <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.2122" data-verso-hover="1657">col1</span><span class="inter-text"> </span><span class="unknown token" data-binding="">::</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2123" data-verso-hover="1657">col2</span><span class="inter-text"> </span><span class="unknown token" data-binding="">::</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2124" data-verso-hover="1658">cols</span></code> pattern in the definition of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Row" data-verso-hover="1656">Row</span></code> was matched, so the call to <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Row" data-verso-hover="1656">Row</span></code> does not compute down to a pair type.
The solution is to mirror the structure of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Row" data-verso-hover="1656">Row</span></code> in the definition of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Row.bEq" data-verso-hover="1679">Row.bEq</span></code>:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-3213">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Row.bEq" data-verso-hover="1679">Row.bEq</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.4255" data-verso-hover="1680">r1</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4268" data-verso-hover="1680">r2</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Row" data-verso-hover="1656">Row</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4253" data-verso-hover="1660">s</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Bool" data-verso-hover="40">Bool</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-3253" data-verso-hover="100">match</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4277" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-3253" data-verso-hover="100">with</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Bool.true" data-verso-hover="97">true</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">_</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4255" data-verso-hover="1682">r1</span><span class="inter-text"> </span><span class="unknown token" data-binding="">==</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4268" data-verso-hover="1682">r2</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">_</span><span class="unknown token" data-binding="">::</span><span class="unknown token" data-binding="">_</span><span class="unknown token" data-binding="">::</span><span class="unknown token" data-binding="">_</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-3320" data-verso-hover="100">match</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4255" data-verso-hover="1683">r1</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4268" data-verso-hover="1683">r2</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-3320" data-verso-hover="100">with</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.4750" data-verso-hover="1684">v1</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4757" data-verso-hover="1685">r1'</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.4764" data-verso-hover="1684">v2</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4771" data-verso-hover="1685">r2'</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="var token" data-binding="var-_uniq.4750" data-verso-hover="1684">v1</span><span class="inter-text"> </span><span class="unknown token" data-binding="">==</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4764" data-verso-hover="1684">v2</span><span class="inter-text"> </span><span class="unknown token" data-binding="">&&</span><span class="inter-text"> </span><span class="const token" data-binding="const-Row.bEq" data-verso-hover="1679">bEq</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4757" data-verso-hover="1685">r1'</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.4771" data-verso-hover="1685">r2'</span><span class="inter-text">
</span><span class="inter-text">
</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.instance-3399">instance</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-BEq" data-verso-hover="516">BEq</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Row" data-verso-hover="1656">Row</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7325" data-verso-hover="1660">s</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.whereStructInst-3422">where</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-BEq.beq" data-verso-hover="1686">beq</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="const token" data-binding="const-Row.bEq" data-verso-hover="1679">Row.bEq</span></code><p>
                  Unlike in other contexts, functions that occur in types cannot be considered only in terms of their input/output behavior.
Programs that use these types will find themselves forced to mirror the algorithm used in the type-level function so that their structure matches the pattern-matching and recursive behavior of the type.
A big part of the skill of programming with dependent types is the selection of appropriate type-level functions with the right computational behavior.</p>
                </section>
              <section>
                <h3 id="column-pointers">
                  7.3.2.2. Column Pointers<span class="permalink-widget inline"><a href="find/?domain=Verso.Genre.Manual.section&name=column-pointers" title="Permalink">🔗</a></span></h3>
                <p>
                  Some queries only make sense if a schema contains a particular column.
For example, a query that returns mountains with an elevation greater than 1000 meters only makes sense in the context of a schema with an <code class="hl lean inline" data-lean-context="examples"><span class="literal string token" data-binding="" data-verso-hover="1664">"elevation"</span></code> column that contains integers.
One way to indicate that a column is contained in a schema is to provide a pointer directly to it, and defining the pointer as an indexed family makes it possible to rule out invalid pointers.</p>
                <p>
                  There are two ways that a column can be present in a schema: either it is at the beginning of the schema, or it is somewhere later in the schema.
Eventually, if a column is later in a schema, then it will be the beginning of some tail of the schema.</p>
                <p>
                  The indexed family <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span></code> is a translation of the specification into Lean code:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.inductive-3487" data-verso-hover="96">inductive</span><span class="inter-text"> </span><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Schema" data-verso-hover="1655">Schema</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType" data-verso-hover="1640">DBType</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="sort token" data-binding="" data-verso-hover="50">Type</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-3544">where</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-HasCol.here" data-verso-hover="1688">here</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟨</span><span class="var token" data-binding="var-_uniq.7428" data-verso-hover="39">name</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7436" data-verso-hover="1646">t</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟩</span><span class="inter-text"> </span><span class="unknown token" data-binding="">::</span><span class="inter-text"> </span><span class="unknown token" data-binding="">_</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7428" data-verso-hover="39">name</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7436" data-verso-hover="1646">t</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-HasCol.there" data-verso-hover="1689">there</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7450" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7455" data-verso-hover="39">name</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7460" data-verso-hover="1646">t</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">_</span><span class="inter-text"> </span><span class="unknown token" data-binding="">::</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7450" data-verso-hover="1660">s</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7455" data-verso-hover="39">name</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7460" data-verso-hover="1646">t</span></code><p>
                  The family's three arguments are the schema, the column name, and its type.
All three are indices, but re-ordering the arguments to place the schema after the column name and type would allow the name and type to be parameters.
The constructor <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-HasCol.here" data-verso-hover="1688">here</span></code> can be used when the schema begins with the column <code class="hl lean inline" data-lean-context="examples"><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟨</span><span class="var token" data-binding="var-_uniq.7428" data-verso-hover="39">name</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.7436" data-verso-hover="1646">t</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟩</span></code>; it is thus a pointer to the first column in the schema that can only be used when the first column has the desired name and type.
The constructor <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-HasCol.there" data-verso-hover="1689">there</span></code> transforms a pointer into a smaller schema into a pointer into a schema with one more column on it.</p>
                <p>
                  Because <code class="hl lean inline" data-lean-context="examples"><span class="literal string token" data-binding="" data-verso-hover="1664">"elevation"</span></code> is the third column in <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span></code>, it can be found by looking past the first two columns with <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-HasCol.there" data-verso-hover="1689">there</span></code>, after which it is the first column.
In other words, to satisfy the type <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1664">"elevation"</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.int" data-verso-hover="1641">.int</span></code>, use the expression <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-HasCol.there" data-verso-hover="1689">.there</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-HasCol.there" data-verso-hover="1689">.there</span><span class="inter-text"> </span><span class="const token" data-binding="const-HasCol.here" data-verso-hover="1688">.here</span><span class="unknown token" data-binding="">)</span></code>.
One way to think about <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span></code> is as a kind of decorated <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span></code>—<code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Nat.zero" data-verso-hover="26">zero</span></code> corresponds to <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-HasCol.here" data-verso-hover="1688">here</span></code>, and <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Nat.succ" data-verso-hover="98">succ</span></code> corresponds to <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-HasCol.there" data-verso-hover="1689">there</span></code>.
The extra type information makes it impossible to have off-by-one errors.</p>
                <p>
                  A pointer to a particular column in a schema can be used to extract that column's value from a row:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-3818">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Row.get" data-verso-hover="1690">Row.get</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.8147" data-verso-hover="1680">row</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Row" data-verso-hover="1656">Row</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.8116" data-verso-hover="1660">s</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.8155" data-verso-hover="1691">col</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.8116" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.8133" data-verso-hover="39">n</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.8145" data-verso-hover="1646">t</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.8145" data-verso-hover="1646">t</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DBType.asType" data-verso-hover="1644">asType</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-3881" data-verso-hover="100">match</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.8181" data-verso-hover="1660">s</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.8155" data-verso-hover="1691">col</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.8147" data-verso-hover="1680">row</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-3881" data-verso-hover="100">with</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">_</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-HasCol.here" data-verso-hover="1688">.here</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.8264" data-verso-hover="1692">v</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.8264" data-verso-hover="1692">v</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">_</span><span class="unknown token" data-binding="">::</span><span class="unknown token" data-binding="">_</span><span class="unknown token" data-binding="">::</span><span class="unknown token" data-binding="">_</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-HasCol.here" data-verso-hover="1688">.here</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.8416" data-verso-hover="1693">v</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="unknown token" data-binding="">_</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.8416" data-verso-hover="1693">v</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">_</span><span class="unknown token" data-binding="">::</span><span class="unknown token" data-binding="">_</span><span class="unknown token" data-binding="">::</span><span class="unknown token" data-binding="">_</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-HasCol.there" data-verso-hover="1689">.there</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.8565" data-verso-hover="1694">next</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">_</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.8573" data-verso-hover="1685">r</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Row.get" data-verso-hover="1690">get</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.8573" data-verso-hover="1685">r</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.8565" data-verso-hover="1694">next</span></code><p>
                  The first step is to pattern match on the schema, because this determines whether the row is a tuple or a single value.
No case is needed for the empty schema because there is a <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span></code> available, and both constructors of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span></code> specify non-empty schemas.
If the schema has just a single column, then the pointer must point to it, so only the <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-HasCol.here" data-verso-hover="1688">here</span></code> constructor of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span></code> need be matched.
If the schema has two or more columns, then there must be a case for <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-HasCol.here" data-verso-hover="1688">here</span></code>, in which case the value is the first one in the row, and one for <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-HasCol.there" data-verso-hover="1689">there</span></code>, in which case a recursive call is used.
Because the <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span></code> type guarantees that the column exists in the row, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Row.get" data-verso-hover="1690">Row.get</span></code> does not need to return an <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Option" data-verso-hover="142">Option</span></code>.</p>
                <p>
                  <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span></code> plays two roles:</p>
                <ol start="1">
                  <li>
                    <p>
                      It serves as <em>evidence</em> that a column with a particular name and type exists in a schema.</p>
                    </li>
                  <li>
                    <p>
                      It serves as <em>data</em> that can be used to find the value associated with the column in a row.</p>
                    </li>
                  </ol>
                <p>
                  The first role, that of evidence, is similar to way that propositions are used.
The definition of the indexed family <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span></code> can be read as a specification of what counts as evidence that a given column exists.
Unlike propositions, however, it matters which constructor of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span></code> was used.
In the second role, the constructors are used like <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span></code>s to find data in a collection.
Programming with indexed families often requires the ability to switch fluently between both perspectives.</p>
                </section>
              <section>
                <h3 id="Functional-Programming-in-Lean--Programming-with-Dependent-Types--Worked-Example___-Typed-Queries--Schemas-and-Tables--Subschemas">
                  7.3.2.3. Subschemas</h3>
                <p>
                  One important operation in relational algebra is to <em>project</em> a table or row into a smaller schema.
Every column not present in the smaller schema is forgotten.
In order for projection to make sense, the smaller schema must be a subschema of the larger schema, which means that every column in the smaller schema must be present in the larger schema.
Just as <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span></code> makes it possible to write a single-column lookup in a row that cannot fail, a representation of the subschema relationship as an indexed family makes it possible to write a projection function that cannot fail.</p>
                <p>
                  The ways in which one schema can be a subschema of another can be defined as an indexed family.
The basic idea is that a smaller schema is a subschema of a bigger schema if every column in the smaller schema occurs in the bigger schema.
If the smaller schema is empty, then it's certainly a subschema of the bigger schema, represented by the constructor <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Subschema.nil" data-verso-hover="1695">nil</span></code>.
If the smaller schema has a column, then that column must be in the bigger schema, and all the rest of the columns in the subschema must also be a subschema of the bigger schema.
This is represented by the constructor <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Subschema.cons" data-verso-hover="1696">cons</span></code>.</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.inductive-4052" data-verso-hover="96">inductive</span><span class="inter-text"> </span><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Schema" data-verso-hover="1655">Schema</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Schema" data-verso-hover="1655">Schema</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="sort token" data-binding="" data-verso-hover="50">Type</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-4101">where</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Subschema.nil" data-verso-hover="1695">nil</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.18499" data-verso-hover="1660">bigger</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Subschema.cons" data-verso-hover="1696">cons</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.18508" data-verso-hover="1660">bigger</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.18513" data-verso-hover="39">n</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.18518" data-verso-hover="1646">t</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.18525" data-verso-hover="1660">smaller</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.18508" data-verso-hover="1660">bigger</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟨</span><span class="var token" data-binding="var-_uniq.18513" data-verso-hover="39">n</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.18518" data-verso-hover="1646">t</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟩</span><span class="inter-text"> </span><span class="unknown token" data-binding="">::</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.18525" data-verso-hover="1660">smaller</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.18508" data-verso-hover="1660">bigger</span></code><p>
                  In other words, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span></code> assigns each column of the smaller schema a <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span></code> that points to its location in the larger schema.</p>
                <p>
                  The schema <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-travelDiary" data-verso-hover="1698">travelDiary</span></code> represents the fields that are common to both <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span></code> and <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-waterfall" data-verso-hover="1675">waterfall</span></code>:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.abbrev-4543">abbrev</span><span class="inter-text"> </span><span class="const token" data-binding="const-travelDiary" data-verso-hover="1698">travelDiary</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Schema" data-verso-hover="1655">Schema</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟨</span><span class="literal string token" data-binding="" data-verso-hover="1098">"name"</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">.string</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟩</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟨</span><span class="literal string token" data-binding="" data-verso-hover="1663">"location"</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">.string</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟩</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟨</span><span class="literal string token" data-binding="" data-verso-hover="1665">"lastVisited"</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.int" data-verso-hover="1641">.int</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟩</span><span class="unknown token" data-binding="">]</span></code><p>
                  It is certainly a subschema of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span></code>, as shown by this example:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.example-4706">example</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="const token" data-binding="const-travelDiary" data-verso-hover="1698">travelDiary</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Subschema.cons" data-verso-hover="1696">.cons</span><span class="inter-text"> </span><span class="const token" data-binding="const-HasCol.here" data-verso-hover="1688">.here</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Subschema.cons" data-verso-hover="1696">.cons</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-HasCol.there" data-verso-hover="1689">.there</span><span class="inter-text"> </span><span class="const token" data-binding="const-HasCol.here" data-verso-hover="1688">.here</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Subschema.cons" data-verso-hover="1696">.cons</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-HasCol.there" data-verso-hover="1689">.there</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-HasCol.there" data-verso-hover="1689">.there</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-HasCol.there" data-verso-hover="1689">.there</span><span class="inter-text"> </span><span class="const token" data-binding="const-HasCol.here" data-verso-hover="1688">.here</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="const token" data-binding="const-Subschema.nil" data-verso-hover="1695">.nil</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span></code><p>
                  However, code like this is difficult to read and difficult to maintain.
One way to improve it is to instruct Lean to write the <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span></code> and <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span></code> constructors automatically.
This can be done using the tactic feature that was introduced in <a href="Interlude___-Propositions___-Proofs___-and-Indexing/#props-proofs-indexing">the Interlude on propositions and proofs</a>.
That interlude uses <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">by decide</span></code> and <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">by simp</span></code> to provide evidence of various propositions.</p>
                <p>
                  In this context, two tactics are useful:</p>
                <ul>
                  <li>
                    <p>
                      The <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">constructor</span></code> tactic instructs Lean to solve the problem using the constructor of a datatype.</p>
                    </li>
                  <li>
                    <p>
                      The <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">repeat</span></code> tactic instructs Lean to repeat a tactic over and over until it either fails or the proof is finished.</p>
                    </li>
                  </ul>
                <p>
                  In the next example, <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">by constructor</span></code> has the same effect as just writing <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Subschema.nil" data-verso-hover="1695">.nil</span></code> would have:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.example-4889">example</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="tactic"><label for="tactic-state-16484474922653270860-4920-4922"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.byTactic-4920" data-verso-hover="340">by</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-16484474922653270860-4920-4922"><span class="tactic-state"><span class="goal"><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="const token" data-binding="const-List.nil" data-verso-hover="133">[</span><span class="const token" data-binding="const-List.nil" data-verso-hover="133">]</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span></span></span></span></span></span><span class="inter-text"> </span><span class="tactic"><label for="tactic-state-7-4923-4934"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.constructor-4923" data-verso-hover="1699">constructor</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-7-4923-4934"><span class="tactic-state">All goals completed! 🐙</span></span></code><p>
                  However, attempting that same tactic with a slightly more complicated type fails:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.example-5102">example</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟨</span><span class="literal string token" data-binding="" data-verso-hover="1663">"location"</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">.string</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟩</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="has-info error"><span class="hover-container"><span class="hover-info messages"><code class="message error">unsolved goals
case a
⊢ HasCol peak "location" DBType.string

case a
⊢ Subschema [] peak</code></span></span><span class="tactic"><label for="tactic-state-7537893429188338782-5158-5160"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.byTactic-5158" data-verso-hover="340">by</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-7537893429188338782-5158-5160"><span class="tactic-state"><span class="goal"><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">[</span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1663">"location"</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">DBType.string</span><span class="inter-text"> }</span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">]</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span></span></span></span></span></span><span class="inter-text"> </span><span class="tactic"><label for="tactic-state-6956689999520705787-5161-5172"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.constructor-5161" data-verso-hover="1699">constructor</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-6956689999520705787-5161-5172"><span class="tactic-state"><span class="goal"><span class="labeled-case" checked="checked"><label class="case-label"><input type="checkbox" id="--verso-unique-22" checked="checked"><span for="--verso-unique-22" class="goal-name">a</span></label><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1663">"location"</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">DBType.string</span></span></span></span></span><span class="goal"><span class="labeled-case"><label class="case-label"><input type="checkbox" id="--verso-unique-23"><span for="--verso-unique-23" class="goal-name">a</span></label><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="const token" data-binding="const-List.nil" data-verso-hover="133">[</span><span class="const token" data-binding="const-List.nil" data-verso-hover="133">]</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span></span></span></span></span></span></span></span></code><div class="error">
                  <pre>unsolved goals
case a
⊢ HasCol peak "location" DBType.string

case a
⊢ Subschema [] peak</pre></div>
                <p>
                  Errors that begin with <code>unsolved goals</code> describe tactics that failed to completely build the expressions that they were supposed to.
In Lean's tactic language, a <em>goal</em> is a type that a tactic is to fulfill by constructing an appropriate expression behind the scenes.
In this case, <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">constructor</span></code> caused <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Subschema.cons" data-verso-hover="1696">Subschema.cons</span></code> to be applied, and the two goals represent the two arguments expected by <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Subschema.cons" data-verso-hover="1696">cons</span></code>.
Adding another instance of <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">constructor</span></code> causes the first goal (<code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1663">"location"</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">DBType.string</span></code>) to be addressed with <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-HasCol.there" data-verso-hover="1689">HasCol.there</span></code>, because <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span></code>'s first column is not <code class="hl lean inline" data-lean-context="examples"><span class="literal string token" data-binding="" data-verso-hover="1663">"location"</span></code>:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.example-5503">example</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟨</span><span class="literal string token" data-binding="" data-verso-hover="1663">"location"</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">.string</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟩</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="has-info error"><span class="hover-container"><span class="hover-info messages"><code class="message error">unsolved goals
case a.a
⊢ HasCol
    [{ name := "location", contains := DBType.string }, { name := "elevation", contains := DBType.int },
      { name := "lastVisited", contains := DBType.int }]
    "location" DBType.string

case a
⊢ Subschema [] peak</code></span></span><span class="tactic"><label for="tactic-state-7537893429188338782-5559-5561"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.byTactic-5559" data-verso-hover="340">by</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-7537893429188338782-5559-5561"><span class="tactic-state"><span class="goal"><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">[</span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1663">"location"</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">DBType.string</span><span class="inter-text"> }</span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">]</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span></span></span></span></span></span><span class="tactic"><label for="tactic-state-6956689999520705787-5564-5575"><span class="inter-text">
  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.constructor-5564" data-verso-hover="1699">constructor</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-6956689999520705787-5564-5575"><span class="tactic-state"><span class="goal"><span class="labeled-case" checked="checked"><label class="case-label"><input type="checkbox" id="--verso-unique-25" checked="checked"><span for="--verso-unique-25" class="goal-name">a</span></label><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1663">"location"</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">DBType.string</span></span></span></span></span><span class="goal"><span class="labeled-case"><label class="case-label"><input type="checkbox" id="--verso-unique-26"><span for="--verso-unique-26" class="goal-name">a</span></label><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="const token" data-binding="const-List.nil" data-verso-hover="133">[</span><span class="const token" data-binding="const-List.nil" data-verso-hover="133">]</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span></span></span></span></span></span></span><span class="tactic"><label for="tactic-state-11755221535707689965-5578-5589"><span class="inter-text">
  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.constructor-5578" data-verso-hover="1699">constructor</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-11755221535707689965-5578-5589"><span class="tactic-state"><span class="goal"><span class="labeled-case" checked="checked"><label class="case-label"><input type="checkbox" id="--verso-unique-27" checked="checked"><span for="--verso-unique-27" class="goal-name">a.a</span></label><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span><span class="inter-text">
  </span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">[</span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1663">"location"</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">DBType.string</span><span class="inter-text"> }</span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">, </span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1664">"elevation"</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="const token" data-binding="const-DBType.int" data-verso-hover="1641">DBType.int</span><span class="inter-text"> }</span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">,
    </span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1665">"lastVisited"</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="const token" data-binding="const-DBType.int" data-verso-hover="1641">DBType.int</span><span class="inter-text"> }</span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">]</span><span class="inter-text">
  </span><span class="literal string token" data-binding="" data-verso-hover="1663">"location"</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">DBType.string</span></span></span></span></span><span class="goal"><span class="labeled-case"><label class="case-label"><input type="checkbox" id="--verso-unique-28"><span for="--verso-unique-28" class="goal-name">a</span></label><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="const token" data-binding="const-List.nil" data-verso-hover="133">[</span><span class="const token" data-binding="const-List.nil" data-verso-hover="133">]</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span></span></span></span></span></span></span></span></code><div class="error">
                  <pre>unsolved goals
case a.a
⊢ HasCol
    [{ name := "location", contains := DBType.string }, { name := "elevation", contains := DBType.int },
      { name := "lastVisited", contains := DBType.int }]
    "location" DBType.string

case a
⊢ Subschema [] peak</pre></div>
                <p>
                  However, adding a third <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">constructor</span></code> results in the first goal being solved, because <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-HasCol.here" data-verso-hover="1688">HasCol.here</span></code> is applicable:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.example-5709">example</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟨</span><span class="literal string token" data-binding="" data-verso-hover="1663">"location"</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">.string</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟩</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="has-info error"><span class="hover-container"><span class="hover-info messages"><code class="message error">unsolved goals
case a
⊢ Subschema [] peak</code></span></span><span class="tactic"><label for="tactic-state-7537893429188338782-5765-5767"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.byTactic-5765" data-verso-hover="340">by</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-7537893429188338782-5765-5767"><span class="tactic-state"><span class="goal"><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">[</span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1663">"location"</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">DBType.string</span><span class="inter-text"> }</span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">]</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span></span></span></span></span></span><span class="tactic"><label for="tactic-state-6956689999520705787-5770-5781"><span class="inter-text">
  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.constructor-5770" data-verso-hover="1699">constructor</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-6956689999520705787-5770-5781"><span class="tactic-state"><span class="goal"><span class="labeled-case" checked="checked"><label class="case-label"><input type="checkbox" id="--verso-unique-30" checked="checked"><span for="--verso-unique-30" class="goal-name">a</span></label><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1663">"location"</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">DBType.string</span></span></span></span></span><span class="goal"><span class="labeled-case"><label class="case-label"><input type="checkbox" id="--verso-unique-31"><span for="--verso-unique-31" class="goal-name">a</span></label><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="const token" data-binding="const-List.nil" data-verso-hover="133">[</span><span class="const token" data-binding="const-List.nil" data-verso-hover="133">]</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span></span></span></span></span></span></span><span class="tactic"><label for="tactic-state-11755221535707689965-5784-5795"><span class="inter-text">
  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.constructor-5784" data-verso-hover="1699">constructor</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-11755221535707689965-5784-5795"><span class="tactic-state"><span class="goal"><span class="labeled-case" checked="checked"><label class="case-label"><input type="checkbox" id="--verso-unique-32" checked="checked"><span for="--verso-unique-32" class="goal-name">a.a</span></label><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span><span class="inter-text">
  </span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">[</span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1663">"location"</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">DBType.string</span><span class="inter-text"> }</span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">, </span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1664">"elevation"</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="const token" data-binding="const-DBType.int" data-verso-hover="1641">DBType.int</span><span class="inter-text"> }</span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">,
    </span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1665">"lastVisited"</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="const token" data-binding="const-DBType.int" data-verso-hover="1641">DBType.int</span><span class="inter-text"> }</span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">]</span><span class="inter-text">
  </span><span class="literal string token" data-binding="" data-verso-hover="1663">"location"</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">DBType.string</span></span></span></span></span><span class="goal"><span class="labeled-case"><label class="case-label"><input type="checkbox" id="--verso-unique-33"><span for="--verso-unique-33" class="goal-name">a</span></label><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="const token" data-binding="const-List.nil" data-verso-hover="133">[</span><span class="const token" data-binding="const-List.nil" data-verso-hover="133">]</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span></span></span></span></span></span></span><span class="tactic"><label for="tactic-state-12778675682753182687-5798-5809"><span class="inter-text">
  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.constructor-5798" data-verso-hover="1699">constructor</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-12778675682753182687-5798-5809"><span class="tactic-state"><span class="goal"><span class="labeled-case" checked="checked"><label class="case-label"><input type="checkbox" id="--verso-unique-34" checked="checked"><span for="--verso-unique-34" class="goal-name">a</span></label><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="const token" data-binding="const-List.nil" data-verso-hover="133">[</span><span class="const token" data-binding="const-List.nil" data-verso-hover="133">]</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span></span></span></span></span></span></span></span></code><div class="error">
                  <pre>unsolved goals
case a
⊢ Subschema [] peak</pre></div>
                <p>
                  A fourth instance of <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">constructor</span></code> solves the <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span></code> goal:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.example-5858">example</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟨</span><span class="literal string token" data-binding="" data-verso-hover="1663">"location"</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">.string</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟩</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="tactic"><label for="tactic-state-7537893429188338782-5914-5916"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.byTactic-5914" data-verso-hover="340">by</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-7537893429188338782-5914-5916"><span class="tactic-state"><span class="goal"><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">[</span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1663">"location"</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">DBType.string</span><span class="inter-text"> }</span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">]</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span></span></span></span></span></span><span class="tactic"><label for="tactic-state-6956689999520705787-5919-5930"><span class="inter-text">
  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.constructor-5919" data-verso-hover="1699">constructor</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-6956689999520705787-5919-5930"><span class="tactic-state"><span class="goal"><span class="labeled-case" checked="checked"><label class="case-label"><input type="checkbox" id="--verso-unique-36" checked="checked"><span for="--verso-unique-36" class="goal-name">a</span></label><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1663">"location"</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">DBType.string</span></span></span></span></span><span class="goal"><span class="labeled-case"><label class="case-label"><input type="checkbox" id="--verso-unique-37"><span for="--verso-unique-37" class="goal-name">a</span></label><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="const token" data-binding="const-List.nil" data-verso-hover="133">[</span><span class="const token" data-binding="const-List.nil" data-verso-hover="133">]</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span></span></span></span></span></span></span><span class="tactic"><label for="tactic-state-11755221535707689965-5933-5944"><span class="inter-text">
  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.constructor-5933" data-verso-hover="1699">constructor</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-11755221535707689965-5933-5944"><span class="tactic-state"><span class="goal"><span class="labeled-case" checked="checked"><label class="case-label"><input type="checkbox" id="--verso-unique-38" checked="checked"><span for="--verso-unique-38" class="goal-name">a.a</span></label><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span><span class="inter-text">
  </span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">[</span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1663">"location"</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">DBType.string</span><span class="inter-text"> }</span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">, </span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1664">"elevation"</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="const token" data-binding="const-DBType.int" data-verso-hover="1641">DBType.int</span><span class="inter-text"> }</span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">,
    </span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1665">"lastVisited"</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="const token" data-binding="const-DBType.int" data-verso-hover="1641">DBType.int</span><span class="inter-text"> }</span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">]</span><span class="inter-text">
  </span><span class="literal string token" data-binding="" data-verso-hover="1663">"location"</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">DBType.string</span></span></span></span></span><span class="goal"><span class="labeled-case"><label class="case-label"><input type="checkbox" id="--verso-unique-39"><span for="--verso-unique-39" class="goal-name">a</span></label><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="const token" data-binding="const-List.nil" data-verso-hover="133">[</span><span class="const token" data-binding="const-List.nil" data-verso-hover="133">]</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span></span></span></span></span></span></span><span class="tactic"><label for="tactic-state-12778675682753182687-5947-5958"><span class="inter-text">
  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.constructor-5947" data-verso-hover="1699">constructor</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-12778675682753182687-5947-5958"><span class="tactic-state"><span class="goal"><span class="labeled-case" checked="checked"><label class="case-label"><input type="checkbox" id="--verso-unique-40" checked="checked"><span for="--verso-unique-40" class="goal-name">a</span></label><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="const token" data-binding="const-List.nil" data-verso-hover="133">[</span><span class="const token" data-binding="const-List.nil" data-verso-hover="133">]</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span></span></span></span></span></span></span><span class="tactic"><label for="tactic-state-7-5961-5972"><span class="inter-text">
  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.constructor-5961" data-verso-hover="1699">constructor</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-7-5961-5972"><span class="tactic-state">All goals completed! 🐙</span></span></code><p>
                  Indeed, a version written without the use of tactics has four constructors:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.example-6019">example</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟨</span><span class="literal string token" data-binding="" data-verso-hover="1663">"location"</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">.string</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟩</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Subschema.cons" data-verso-hover="1696">.cons</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-HasCol.there" data-verso-hover="1689">.there</span><span class="inter-text"> </span><span class="const token" data-binding="const-HasCol.here" data-verso-hover="1688">.here</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="const token" data-binding="const-Subschema.nil" data-verso-hover="1695">.nil</span></code><p>
                  Instead of experimenting to find the right number of times to write <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">constructor</span></code>, the <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">repeat</span></code> tactic can be used to ask Lean to just keep trying <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">constructor</span></code> as long as it keeps making progress:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.example-6149">example</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟨</span><span class="literal string token" data-binding="" data-verso-hover="1663">"location"</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">.string</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟩</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="tactic"><label for="tactic-state-7537893429188338782-6205-6207"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.byTactic-6205" data-verso-hover="340">by</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-7537893429188338782-6205-6207"><span class="tactic-state"><span class="goal"><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">[</span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1663">"location"</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">DBType.string</span><span class="inter-text"> }</span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">]</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span></span></span></span></span></span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.tacticRepeat_-6208" data-verso-hover="1701">repeat</span><span class="inter-text"> </span><span class="tactic"><label for="tactic-state-7-6215-6226"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.constructor-6215" data-verso-hover="1699">constructor</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-7-6215-6226"><span class="tactic-state">All goals completed! 🐙</span></span></code><p>
                  This more flexible version also works for more interesting <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span></code> problems:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.example-6276">example</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="const token" data-binding="const-travelDiary" data-verso-hover="1698">travelDiary</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="tactic"><label for="tactic-state-8690082466875954049-6316-6318"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.byTactic-6316" data-verso-hover="340">by</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-8690082466875954049-6316-6318"><span class="tactic-state"><span class="goal"><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="const token" data-binding="const-travelDiary" data-verso-hover="1698">travelDiary</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span></span></span></span></span></span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.tacticRepeat_-6319" data-verso-hover="1701">repeat</span><span class="inter-text"> </span><span class="tactic"><label for="tactic-state-7-6326-6337"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.constructor-6326" data-verso-hover="1699">constructor</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-7-6326-6337"><span class="tactic-state">All goals completed! 🐙</span></span><span class="inter-text">
</span><span class="inter-text">
</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.example-6339">example</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="const token" data-binding="const-travelDiary" data-verso-hover="1698">travelDiary</span><span class="inter-text"> </span><span class="const token" data-binding="const-waterfall" data-verso-hover="1675">waterfall</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="tactic"><label for="tactic-state-7170384761098872047-6384-6386"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.byTactic-6384" data-verso-hover="340">by</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-7170384761098872047-6384-6386"><span class="tactic-state"><span class="goal"><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="const token" data-binding="const-travelDiary" data-verso-hover="1698">travelDiary</span><span class="inter-text"> </span><span class="const token" data-binding="const-waterfall" data-verso-hover="1675">waterfall</span></span></span></span></span></span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.tacticRepeat_-6387" data-verso-hover="1701">repeat</span><span class="inter-text"> </span><span class="tactic"><label for="tactic-state-7-6394-6405"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.constructor-6394" data-verso-hover="1699">constructor</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-7-6394-6405"><span class="tactic-state">All goals completed! 🐙</span></span></code><p>
                  The approach of blindly trying constructors until something works is not very useful for types like <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span></code> or <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="const token" data-binding="const-Bool" data-verso-hover="40">Bool</span></code>.
Just because an expression has type <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span></code> doesn't mean that it's the <em>correct</em> <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span></code>, after all.
But types like <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span></code> and <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span></code> are sufficiently constrained by their indices that only one constructor will ever be applicable, which means that the contents of the program itself are less interesting, and a computer can pick the correct one.</p>
                <p>
                  If one schema is a subschema of another, then it is also a subschema of the larger schema extended with an additional column.
This fact can be captured as a function definition.
<code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Subschema.addColumn" data-verso-hover="1702">Subschema.addColumn</span></code> takes evidence that <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.19934" data-verso-hover="1660">smaller</span></code> is a subschema of <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.19939" data-verso-hover="1660">bigger</span></code>, and then returns evidence that <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.19934" data-verso-hover="1660">smaller</span></code> is a subschema of <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.19948" data-verso-hover="1657">c</span><span class="inter-text"> </span><span class="unknown token" data-binding="">::</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.19939" data-verso-hover="1660">bigger</span></code>, that is, <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.19939" data-verso-hover="1660">bigger</span></code> with one additional column:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-6459">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Subschema.addColumn" data-verso-hover="1702">Subschema.addColumn</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.19934" data-verso-hover="1660">smaller</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.19939" data-verso-hover="1660">bigger</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.19934" data-verso-hover="1660">smaller</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.19948" data-verso-hover="1657">c</span><span class="inter-text"> </span><span class="unknown token" data-binding="">::</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.19939" data-verso-hover="1660">bigger</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Subschema.nil" data-verso-hover="1695">.nil</span><span class="inter-text">  </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Subschema.nil" data-verso-hover="1695">.nil</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Subschema.cons" data-verso-hover="1696">.cons</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.20154" data-verso-hover="1703">col</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.19955" data-verso-hover="1704">sub'</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Subschema.cons" data-verso-hover="1696">.cons</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-HasCol.there" data-verso-hover="1689">.there</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.20154" data-verso-hover="1703">col</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.19955" data-verso-hover="1704">sub'</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Subschema.addColumn" data-verso-hover="1702">addColumn</span></code><p>
                  A subschema describes where to find each column from the smaller schema in the larger schema.
<code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Subschema.addColumn" data-verso-hover="1702">Subschema.addColumn</span></code> must translate these descriptions from the original larger schema into the extended larger schema.
In the <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Subschema.nil" data-verso-hover="1695">nil</span></code> case, the smaller schema is <code>[]</code>, and <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Subschema.nil" data-verso-hover="1695">nil</span></code> is also evidence that <code>[]</code> is a subschema of <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.19948" data-verso-hover="1657">c</span><span class="inter-text"> </span><span class="unknown token" data-binding="">::</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.19939" data-verso-hover="1660">bigger</span></code>.
In the <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Subschema.cons" data-verso-hover="1696">cons</span></code> case, which describes how to place one column from <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.19934" data-verso-hover="1660">smaller</span></code> into <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.19939" data-verso-hover="1660">bigger</span></code>, the placement of the column needs to be adjusted with <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-HasCol.there" data-verso-hover="1689">there</span></code> to account for the new column <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.19948" data-verso-hover="1657">c</span></code>, and a recursive call adjusts the rest of the columns.</p>
                <p>
                  Another way to think about <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span></code> is that it defines a <em>relation</em> between two schemas—the existence of an expression  with type <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.69296" data-verso-hover="1660">smaller</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.69298" data-verso-hover="1660">bigger</span></code> means that <code class="hl lean inline" data-lean-context="examples"><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.69296" data-verso-hover="1660">smaller</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.69298" data-verso-hover="1660">bigger</span><span class="unknown token" data-binding="">)</span></code> is in the relation.
This relation is reflexive, meaning that every schema is a subschema of itself:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-6683">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Subschema.reflexive" data-verso-hover="1705">Subschema.reflexive</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.20672" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Schema" data-verso-hover="1655">Schema</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.20672" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.20672" data-verso-hover="1660">s</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Subschema.nil" data-verso-hover="1695">.nil</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">_</span><span class="inter-text"> </span><span class="unknown token" data-binding="">::</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.20711" data-verso-hover="1658">cs</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Subschema.cons" data-verso-hover="1696">.cons</span><span class="inter-text"> </span><span class="const token" data-binding="const-HasCol.here" data-verso-hover="1688">.here</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Subschema.reflexive" data-verso-hover="1705">reflexive</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.20711" data-verso-hover="1658">cs</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Subschema.addColumn" data-verso-hover="1702">addColumn</span></code></section>
              <section>
                <h3 id="Functional-Programming-in-Lean--Programming-with-Dependent-Types--Worked-Example___-Typed-Queries--Schemas-and-Tables--Projecting-Rows">
                  7.3.2.4. Projecting Rows</h3>
                <p>
                  Given evidence that <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.21434" data-verso-hover="1660">s'</span></code> is a subschema of <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.21418" data-verso-hover="1660">s</span></code>, a row in <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.21418" data-verso-hover="1660">s</span></code> can be projected into a row in <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.21434" data-verso-hover="1660">s'</span></code>.
This is done using the evidence that <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.21434" data-verso-hover="1660">s'</span></code> is a subschema of <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.21418" data-verso-hover="1660">s</span></code>, which explains where each column of <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.21434" data-verso-hover="1660">s'</span></code> is found in <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.21418" data-verso-hover="1660">s</span></code>.
The new row in <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.21434" data-verso-hover="1660">s'</span></code> is built up one column at a time by retrieving the value from the appropriate place in the old row.</p>
                <p>
                  The function that performs this projection, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Row.project" data-verso-hover="1706">Row.project</span></code>, has three cases, one for each case of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Row" data-verso-hover="1656">Row</span></code> itself.
It uses <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Row.get" data-verso-hover="1690">Row.get</span></code> together with each <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span></code> in the <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span></code> argument to construct the projected row:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-7029">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Row.project" data-verso-hover="1706">Row.project</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.21420" data-verso-hover="1680">row</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Row" data-verso-hover="1656">Row</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.21418" data-verso-hover="1660">s</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.21434" data-verso-hover="1660">s'</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Schema" data-verso-hover="1655">Schema</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.21434" data-verso-hover="1660">s'</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.21418" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Row" data-verso-hover="1656">Row</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.21434" data-verso-hover="1660">s'</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-Subschema.nil" data-verso-hover="1695">.nil</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">_</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-Subschema.cons" data-verso-hover="1696">.cons</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.21555" data-verso-hover="1707">c</span><span class="inter-text"> </span><span class="const token" data-binding="const-Subschema.nil" data-verso-hover="1695">.nil</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.21420" data-verso-hover="1680">row</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Row.get" data-verso-hover="1690">get</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.21555" data-verso-hover="1707">c</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">_</span><span class="unknown token" data-binding="">::</span><span class="unknown token" data-binding="">_</span><span class="unknown token" data-binding="">::</span><span class="unknown token" data-binding="">_</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-Subschema.cons" data-verso-hover="1696">.cons</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.21670" data-verso-hover="1707">c</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.21671" data-verso-hover="1708">cs</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.21420" data-verso-hover="1680">row</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Row.get" data-verso-hover="1690">get</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.21670" data-verso-hover="1707">c</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.21420" data-verso-hover="1680">row</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Row.project" data-verso-hover="1706">project</span><span class="inter-text"> </span><span class="unknown token" data-binding="">_</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.21671" data-verso-hover="1708">cs</span><span class="unknown token" data-binding="">)</span></code></section>
              </section>
            <section>
              <h2 id="Functional-Programming-in-Lean--Programming-with-Dependent-Types--Worked-Example___-Typed-Queries--Conditions-and-Selection">
                7.3.3. Conditions and Selection</h2>
              <p>
                Projection removes unwanted columns from a table, but queries must also be able to remove unwanted rows.
This operation is called <em>selection</em>.
Selection relies on having a means of expressing which rows are desired.</p>
              <p>
                The example query language contains expressions, which are analogous to what can be written in a <code>WHERE</code> clause in SQL.
Expressions are represented by the indexed family <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DBExpr" data-verso-hover="1709">DBExpr</span></code>.
Because expressions can refer to columns from the database, but different sub-expressions all have the same schema, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DBExpr" data-verso-hover="1709">DBExpr</span></code> takes the database schema as a parameter.
Additionally, each expression has a type, and these vary, making it an index:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.inductive-7258" data-verso-hover="96">inductive</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBExpr" data-verso-hover="1709">DBExpr</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.23064" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Schema" data-verso-hover="1655">Schema</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType" data-verso-hover="1640">DBType</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="sort token" data-binding="" data-verso-hover="50">Type</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-7306">where</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBExpr.col" data-verso-hover="1710">col</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.23078" data-verso-hover="39">n</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.23080" data-verso-hover="1691">loc</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23064" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23078" data-verso-hover="39">n</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23076" data-verso-hover="1646">t</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBExpr" data-verso-hover="1709">DBExpr</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23064" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23076" data-verso-hover="1646">t</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBExpr.eq" data-verso-hover="1711">eq</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.23090" data-verso-hover="1712">e1</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23092" data-verso-hover="1712">e2</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBExpr" data-verso-hover="1709">DBExpr</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23064" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23088" data-verso-hover="1646">t</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBExpr" data-verso-hover="1709">DBExpr</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23064" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.bool" data-verso-hover="1643">.bool</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBExpr.lt" data-verso-hover="1713">lt</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.23098" data-verso-hover="1714">e1</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23100" data-verso-hover="1714">e2</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBExpr" data-verso-hover="1709">DBExpr</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23064" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.int" data-verso-hover="1641">.int</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBExpr" data-verso-hover="1709">DBExpr</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23064" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.bool" data-verso-hover="1643">.bool</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBExpr.and" data-verso-hover="1715">and</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.23105" data-verso-hover="1716">e1</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23107" data-verso-hover="1716">e2</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBExpr" data-verso-hover="1709">DBExpr</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23064" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.bool" data-verso-hover="1643">.bool</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBExpr" data-verso-hover="1709">DBExpr</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23064" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.bool" data-verso-hover="1643">.bool</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBExpr.const" data-verso-hover="1717">const</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23117" data-verso-hover="1646">t</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DBType.asType" data-verso-hover="1644">asType</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBExpr" data-verso-hover="1709">DBExpr</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23064" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.23117" data-verso-hover="1646">t</span></code><p>
                The <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DBExpr.col" data-verso-hover="1710">col</span></code> constructor represents a reference to a column in the database.
The <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DBExpr.eq" data-verso-hover="1711">eq</span></code> constructor compares two expressions for equality, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DBExpr.lt" data-verso-hover="1713">lt</span></code> checks whether one is less than the other, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DBExpr.and" data-verso-hover="1715">and</span></code> is Boolean conjunction, and <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DBExpr.const" data-verso-hover="1717">const</span></code> is a constant value of some type.</p>
              <p>
                For example, an expression in <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span></code> that checks whether the <code>elevation</code> column is greater than 1000 and the location is <code class="hl lean inline" data-lean-context="examples"><span class="literal string token" data-binding="" data-verso-hover="1673">"Denmark"</span></code> can be written:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-7602">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Fake.tallInDenmark" data-verso-hover="1718">tallInDenmark</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBExpr" data-verso-hover="1709">DBExpr</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.bool" data-verso-hover="1643">.bool</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-DBExpr.and" data-verso-hover="1715">.and</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-DBExpr.lt" data-verso-hover="1713">.lt</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-DBExpr.const" data-verso-hover="1717">.const</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="1719">1000</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-DBExpr.col" data-verso-hover="1710">.col</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1664">"elevation"</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="tactic"><label for="tactic-state-100097071723690736-7688-7690"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.byTactic-7688" data-verso-hover="340">by</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-100097071723690736-7688-7690"><span class="tactic-state"><span class="goal"><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1664">"elevation"</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.int" data-verso-hover="1641">DBType.int</span></span></span></span></span></span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.tacticRepeat_-7691" data-verso-hover="1701">repeat</span><span class="inter-text"> </span><span class="tactic"><label for="tactic-state-7-7698-7709"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.constructor-7698" data-verso-hover="1699">constructor</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-7-7698-7709"><span class="tactic-state">All goals completed! 🐙</span></span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">       </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-DBExpr.eq" data-verso-hover="1711">.eq</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-DBExpr.col" data-verso-hover="1710">.col</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1663">"location"</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="tactic"><label for="tactic-state-17984227872746470710-7743-7745"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.byTactic-7743" data-verso-hover="340">by</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-17984227872746470710-7743-7745"><span class="tactic-state"><span class="goal"><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1663">"location"</span><span class="inter-text"> </span><span class="inter-text">?m.25323</span></span></span></span></span></span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.tacticRepeat_-7746" data-verso-hover="1701">repeat</span><span class="inter-text"> </span><span class="tactic"><label for="tactic-state-7-7753-7764"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.constructor-7753" data-verso-hover="1699">constructor</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-7-7753-7764"><span class="tactic-state">All goals completed! 🐙</span></span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-DBExpr.const" data-verso-hover="1717">.const</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1673">"Denmark"</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span></code><p>
                This is somewhat noisy.
In particular, references to columns contain boilerplate calls to <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.byTactic-7688" data-verso-hover="340">by</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.tacticRepeat_-7691" data-verso-hover="1701">repeat</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.constructor-7698" data-verso-hover="1699">constructor</span></code>.
A Lean feature called <em>macros</em> can help make expressions easier to read by eliminating this boilerplate:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.macro-7836">macro</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1720">"c!"</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.25532" data-verso-hover="1721">n</span><span class="unknown token" data-binding="">:</span><span class="const token" data-binding="const-Lean.Parser.Category.term" data-verso-hover="1722">term</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Lean.Parser.Category.term" data-verso-hover="1722">term</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="unknown token" data-binding="">`(</span><span class="unknown token" data-binding="">DBExpr.col</span><span class="inter-text"> </span><span class="unknown token" data-binding="">$</span><span class="var token" data-binding="var-_uniq.25532" data-verso-hover="1721">n</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.byTactic-7881" data-verso-hover="340">by</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.tacticRepeat_-7884" data-verso-hover="1701">repeat</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.constructor-7891" data-verso-hover="1699">constructor</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span></code><p>
                This declaration adds the <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">c!</span></code> keyword to Lean, and instructs Lean to replace any instance of <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">c!</span></code> followed by an expression with the corresponding <code class="hl lean inline" data-lean-context="examples"><span class="unknown token" data-binding="">DBExpr.col</span></code> construction.
Here, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Lean.Parser.Category.term" data-verso-hover="1722">term</span></code> stands for Lean expressions, rather than commands, tactics, or some other part of the language.
Lean macros are a bit like C preprocessor macros, except they are better integrated into the language and they automatically avoid some of the pitfalls of CPP.
In fact, they are very closely related to macros in Scheme and Racket.</p>
              <p>
                With this macro, the expression can be much easier to read:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-7951">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-tallInDenmark" data-verso-hover="1718">tallInDenmark</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBExpr" data-verso-hover="1709">DBExpr</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.bool" data-verso-hover="1643">.bool</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-DBExpr.and" data-verso-hover="1715">.and</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-DBExpr.lt" data-verso-hover="1713">.lt</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-DBExpr.const" data-verso-hover="1717">.const</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="1719">1000</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-termC!_-8019">c!</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1664">"elevation"</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">       </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-DBExpr.eq" data-verso-hover="1711">.eq</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-termC!_-8049">c!</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1663">"location"</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-DBExpr.const" data-verso-hover="1717">.const</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1673">"Denmark"</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span></code><p>
                Finding the value of an expression with respect to a given row uses <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Row.get" data-verso-hover="1690">Row.get</span></code> to extract column references, and it delegates to Lean's operations on values for every other expression:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-8136">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBExpr.evaluate" data-verso-hover="1723">DBExpr.evaluate</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.26310" data-verso-hover="1680">row</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Row" data-verso-hover="1656">Row</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26290" data-verso-hover="1660">s</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBExpr" data-verso-hover="1709">DBExpr</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26290" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26308" data-verso-hover="1646">t</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26308" data-verso-hover="1646">t</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DBType.asType" data-verso-hover="1644">asType</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBExpr.col" data-verso-hover="1710">.col</span><span class="inter-text"> </span><span class="unknown token" data-binding="">_</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26344" data-verso-hover="1724">loc</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26310" data-verso-hover="1680">row</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Row.get" data-verso-hover="1690">get</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26344" data-verso-hover="1724">loc</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBExpr.eq" data-verso-hover="1711">.eq</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26575" data-verso-hover="1725">e1</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26344" data-verso-hover="1725">e2</span><span class="inter-text">  </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBExpr.evaluate" data-verso-hover="1723">evaluate</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26310" data-verso-hover="1680">row</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26575" data-verso-hover="1725">e1</span><span class="inter-text"> </span><span class="unknown token" data-binding="">==</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBExpr.evaluate" data-verso-hover="1723">evaluate</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26310" data-verso-hover="1680">row</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26344" data-verso-hover="1725">e2</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBExpr.lt" data-verso-hover="1713">.lt</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26658" data-verso-hover="1714">e1</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26344" data-verso-hover="1714">e2</span><span class="inter-text">  </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBExpr.evaluate" data-verso-hover="1723">evaluate</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26310" data-verso-hover="1680">row</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26658" data-verso-hover="1714">e1</span><span class="inter-text"> </span><span class="unknown token" data-binding="">&lt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBExpr.evaluate" data-verso-hover="1723">evaluate</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26310" data-verso-hover="1680">row</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26344" data-verso-hover="1714">e2</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBExpr.and" data-verso-hover="1715">.and</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26825" data-verso-hover="1716">e1</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26344" data-verso-hover="1716">e2</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBExpr.evaluate" data-verso-hover="1723">evaluate</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26310" data-verso-hover="1680">row</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26825" data-verso-hover="1716">e1</span><span class="inter-text"> </span><span class="unknown token" data-binding="">&&</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBExpr.evaluate" data-verso-hover="1723">evaluate</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26310" data-verso-hover="1680">row</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26344" data-verso-hover="1716">e2</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBExpr.const" data-verso-hover="1717">.const</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26344" data-verso-hover="1609">v</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.26344" data-verso-hover="1609">v</span></code><p>
                Evaluating the expression for Valby Bakke, the tallest hill in the Copenhagen area, yields <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Bool.false" data-verso-hover="19">false</span></code> because Valby Bakke is much less than 1 km over sea level:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="has-info info"><span class="hover-container"><span class="hover-info messages"><code class="message info">false</code></span></span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.eval-8605" data-verso-hover="7">#eval</span></span><span class="inter-text"> </span><span class="const token" data-binding="const-tallInDenmark" data-verso-hover="1718">tallInDenmark</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DBExpr.evaluate" data-verso-hover="1723">evaluate</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="literal string token" data-binding="" data-verso-hover="1726">"Valby Bakke"</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1673">"Denmark"</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="1669">31</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="1670">2023</span><span class="unknown token" data-binding="">)</span></code><div class="information">
                <pre>false</pre></div>
              <p>
                Evaluating it for a fictional mountain of 1230m elevation yields <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Bool.true" data-verso-hover="97">true</span></code>:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="has-info info"><span class="hover-container"><span class="hover-info messages"><code class="message info">true</code></span></span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.eval-8755" data-verso-hover="7">#eval</span></span><span class="inter-text"> </span><span class="const token" data-binding="const-tallInDenmark" data-verso-hover="1718">tallInDenmark</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DBExpr.evaluate" data-verso-hover="1723">evaluate</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="literal string token" data-binding="" data-verso-hover="1727">"Fictional mountain"</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1673">"Denmark"</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="1669">1230</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="1670">2023</span><span class="unknown token" data-binding="">)</span></code><div class="information">
                <pre>true</pre></div>
              <p>
                Evaluating it for the highest peak in the US state of Idaho yields <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Bool.false" data-verso-hover="19">false</span></code>, as Idaho is not part of Denmark:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="has-info info"><span class="hover-container"><span class="hover-info messages"><code class="message info">false</code></span></span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.eval-8910" data-verso-hover="7">#eval</span></span><span class="inter-text"> </span><span class="const token" data-binding="const-tallInDenmark" data-verso-hover="1718">tallInDenmark</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DBExpr.evaluate" data-verso-hover="1723">evaluate</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="literal string token" data-binding="" data-verso-hover="1728">"Mount Borah"</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1668">"USA"</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="1669">3859</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="1670">1996</span><span class="unknown token" data-binding="">)</span></code><div class="information">
                <pre>false</pre></div>
              </section>
            <section>
              <h2 id="Functional-Programming-in-Lean--Programming-with-Dependent-Types--Worked-Example___-Typed-Queries--Queries">
                7.3.4. Queries</h2>
              <p>
                The query language is based on relational algebra.
In addition to tables, it includes the following operators:</p>
              <ol start="1">
                <li>
                  <p>
                    The union of two expressions that have the same schema combines the rows that result from two queries</p>
                  </li>
                <li>
                  <p>
                    The difference of two expressions that have the same schema removes rows found in the second result from the rows in the first result</p>
                  </li>
                <li>
                  <p>
                    Selection by some criterion filters the result of a query according to an expression</p>
                  </li>
                <li>
                  <p>
                    Projection into a subschema, removing columns from the result of a query</p>
                  </li>
                <li>
                  <p>
                    Cartesian product, combining every row from one query with every row from another</p>
                  </li>
                <li>
                  <p>
                    Renaming a column in the result of a query, which modifies its schema</p>
                  </li>
                <li>
                  <p>
                    Prefixing all columns in a query with a name</p>
                  </li>
                </ol>
              <p>
                The last operator is not strictly necessary, but it makes the language more convenient to use.</p>
              <p>
                Once again, queries are represented by an indexed family:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.inductive-9403" data-verso-hover="96">inductive</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Schema" data-verso-hover="1655">Schema</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="sort token" data-binding="" data-verso-hover="50">Type</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-9437">where</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query.table" data-verso-hover="1730">table</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Table" data-verso-hover="1659">Table</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.30373" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.30373" data-verso-hover="1660">s</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query.union" data-verso-hover="1731">union</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.30385" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.30385" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.30385" data-verso-hover="1660">s</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query.diff" data-verso-hover="1732">diff</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.30402" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.30402" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.30402" data-verso-hover="1660">s</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query.select" data-verso-hover="1733">select</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.30419" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBExpr" data-verso-hover="1709">DBExpr</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.30419" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.bool" data-verso-hover="1643">.bool</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.30419" data-verso-hover="1660">s</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query.project" data-verso-hover="1734">project</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.30436" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.30441" data-verso-hover="1660">s'</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Schema" data-verso-hover="1655">Schema</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.30441" data-verso-hover="1660">s'</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.30436" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.30441" data-verso-hover="1660">s'</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query.product" data-verso-hover="1735">product</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.30459" data-verso-hover="1660">s1</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.30466" data-verso-hover="1660">s2</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-disjoint" data-verso-hover="1736">disjoint</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.30459" data-verso-hover="1660">s1</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-List.map" data-verso-hover="231">map</span><span class="inter-text"> </span><span class="const token" data-binding="const-Column.name" data-verso-hover="1653">Column.name</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.30466" data-verso-hover="1660">s2</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-List.map" data-verso-hover="231">map</span><span class="inter-text"> </span><span class="const token" data-binding="const-Column.name" data-verso-hover="1653">Column.name</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.30459" data-verso-hover="1660">s1</span><span class="inter-text"> </span><span class="unknown token" data-binding="">++</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.30466" data-verso-hover="1660">s2</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query.renameColumn" data-verso-hover="1737">renameColumn</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.30611" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.30630" data-verso-hover="1691">c</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.30611" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.30618" data-verso-hover="39">n</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.30625" data-verso-hover="1646">t</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.30633" data-verso-hover="39">n'</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="unknown token" data-binding="">!</span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.30611" data-verso-hover="1660">s</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-List.map" data-verso-hover="231">map</span><span class="inter-text"> </span><span class="const token" data-binding="const-Column.name" data-verso-hover="1653">Column.name</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-List.contains" data-verso-hover="1738">contains</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.30633" data-verso-hover="39">n'</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.30611" data-verso-hover="1660">s</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Schema.renameColumn" data-verso-hover="1739">renameColumn</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.30630" data-verso-hover="1691">c</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.30633" data-verso-hover="39">n'</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query.prefixWith" data-verso-hover="1740">prefixWith</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.30699" data-verso-hover="39">n</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.30696" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.30696" data-verso-hover="1660">s</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-List.map" data-verso-hover="231">map</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-10038">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.30713" data-verso-hover="1657">c</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="unknown token" data-binding="">{</span><span class="var token" data-binding="var-_uniq.30713" data-verso-hover="1657">c</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-10048">with</span><span class="inter-text"> </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.30699" data-verso-hover="39">n</span><span class="inter-text"> </span><span class="unknown token" data-binding="">++</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1291">"."</span><span class="inter-text"> </span><span class="unknown token" data-binding="">++</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.30713" data-verso-hover="1657">c</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Column.name" data-verso-hover="1653">name</span><span class="unknown token" data-binding="">}</span><span class="unknown token" data-binding="">)</span></code><p>
                The <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Query.select" data-verso-hover="1733">select</span></code> constructor requires that the expression used for selection return a Boolean.
The <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Query.product" data-verso-hover="1735">product</span></code> constructor's type contains a call to <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-disjoint" data-verso-hover="1736">disjoint</span></code>, which ensures that the two schemas don't share any names:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-9017">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-disjoint" data-verso-hover="1736">disjoint</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="const token" data-binding="const-BEq" data-verso-hover="516">BEq</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.29004" data-verso-hover="369">α</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.29010" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.29013" data-verso-hover="137">ys</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.29004" data-verso-hover="369">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Bool" data-verso-hover="40">Bool</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Bool.not" data-verso-hover="105">not</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.29010" data-verso-hover="137">xs</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-List.any" data-verso-hover="1741">any</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.29013" data-verso-hover="137">ys</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-List.contains" data-verso-hover="1738">contains</span><span class="inter-text"> </span><span class="unknown token" data-binding="">||</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.29013" data-verso-hover="137">ys</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-List.any" data-verso-hover="1741">any</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.29010" data-verso-hover="137">xs</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-List.contains" data-verso-hover="1738">contains</span><span class="unknown token" data-binding="">)</span></code><p>
                The use of an expression of type <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Bool" data-verso-hover="40">Bool</span></code> where a type is expected triggers a coercion from <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Bool" data-verso-hover="40">Bool</span></code> to <code class="hl lean inline" data-lean-context="examples"><span class="sort token" data-binding="" data-verso-hover="3">Prop</span></code>.
Just as decidable propositions can be considered to be Booleans, where evidence for the proposition is coerced to <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Bool.true" data-verso-hover="97">true</span></code> and refutations of the proposition are coerced to <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Bool.false" data-verso-hover="19">false</span></code>, Booleans are coerced into the proposition that states that the expression is equal to <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Bool.true" data-verso-hover="97">true</span></code>.
Because all uses of the library are expected to occur in contexts where the schemas are known ahead of time, this proposition can be proved with <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">by simp</span></code>.
Similarly, the <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Schema.renameColumn" data-verso-hover="1739">renameColumn</span></code> constructor checks that the new name does not already exist in the schema.
It uses the helper <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Schema.renameColumn" data-verso-hover="1739">Schema.renameColumn</span></code> to change the name of the column pointed to by <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span></code>:</p>
              <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-9166">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Schema.renameColumn" data-verso-hover="1739">Schema.renameColumn</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.29076" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Schema" data-verso-hover="1655">Schema</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.29076" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.29065" data-verso-hover="39">n</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.29073" data-verso-hover="1646">t</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-String" data-verso-hover="35">String</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Schema" data-verso-hover="1655">Schema</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.29322" data-verso-hover="1657">c</span><span class="inter-text"> </span><span class="unknown token" data-binding="">::</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.29088" data-verso-hover="1658">cs</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-HasCol.here" data-verso-hover="1688">.here</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.29089" data-verso-hover="39">n'</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="unknown token" data-binding="">{</span><span class="var token" data-binding="var-_uniq.29322" data-verso-hover="1657">c</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-9271">with</span><span class="inter-text"> </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.29089" data-verso-hover="39">n'</span><span class="unknown token" data-binding="">}</span><span class="inter-text"> </span><span class="unknown token" data-binding="">::</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.29088" data-verso-hover="1658">cs</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.29384" data-verso-hover="1657">c</span><span class="inter-text"> </span><span class="unknown token" data-binding="">::</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.29385" data-verso-hover="1658">cs</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-HasCol.there" data-verso-hover="1689">.there</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.29088" data-verso-hover="1742">next</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.29089" data-verso-hover="39">n'</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.29384" data-verso-hover="1657">c</span><span class="inter-text"> </span><span class="unknown token" data-binding="">::</span><span class="inter-text"> </span><span class="const token" data-binding="const-Schema.renameColumn" data-verso-hover="1739">renameColumn</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.29385" data-verso-hover="1658">cs</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.29088" data-verso-hover="1742">next</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.29089" data-verso-hover="39">n'</span></code></section>
            <section>
              <h2 id="Functional-Programming-in-Lean--Programming-with-Dependent-Types--Worked-Example___-Typed-Queries--Executing-Queries">
                7.3.5. Executing Queries</h2>
              <p>
                Executing queries requires a number of helper functions.
The result of a query is a table; this means that each operation in the query language requires a corresponding implementation that works with tables.</p>
              <section>
                <h3 id="Functional-Programming-in-Lean--Programming-with-Dependent-Types--Worked-Example___-Typed-Queries--Executing-Queries--Cartesian-Product">
                  7.3.5.1. Cartesian Product</h3>
                <p>
                  Taking the Cartesian product of two tables is done by appending each row from the first table to each row from the second.
First off, due to the structure of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Row" data-verso-hover="1656">Row</span></code>, adding a single column to a row requires pattern matching on its schema in order to determine whether the result will be a bare value or a tuple.
Because this is a common operation, factoring the pattern matching out into a helper is convenient:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-6856">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-addVal" data-verso-hover="1743">addVal</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.20895" data-verso-hover="1744">v</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.20892" data-verso-hover="1657">c</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1654">contains</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DBType.asType" data-verso-hover="1644">asType</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.20897" data-verso-hover="1680">row</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Row" data-verso-hover="1656">Row</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.20869" data-verso-hover="1660">s</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Row" data-verso-hover="1656">Row</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.20892" data-verso-hover="1657">c</span><span class="inter-text"> </span><span class="unknown token" data-binding="">::</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.20869" data-verso-hover="1660">s</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-6925" data-verso-hover="100">match</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.20936" data-verso-hover="1660">s</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.20897" data-verso-hover="1680">row</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-6925" data-verso-hover="100">with</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.20895" data-verso-hover="1744">v</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.21041" data-verso-hover="1657">c'</span><span class="inter-text"> </span><span class="unknown token" data-binding="">::</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.21042" data-verso-hover="1658">cs</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.21043" data-verso-hover="1745">v'</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.20895" data-verso-hover="1744">v</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.21043" data-verso-hover="1745">v'</span><span class="unknown token" data-binding="">)</span></code><p>
                  Appending two rows is recursive on the structure of both the first schema and the first row, because the structure of the row proceeds in lock-step with the structure of the schema.
When the first row is empty, appending returns the second row.
When the first row is a singleton, the value is added to the second row.
When the first row contains multiple columns, the first column's value is added to the result of recursion on the remainder of the row.</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-10128">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Row.append" data-verso-hover="1746">Row.append</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.34857" data-verso-hover="1747">r1</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Row" data-verso-hover="1656">Row</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.34838" data-verso-hover="1660">s1</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.34865" data-verso-hover="1748">r2</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Row" data-verso-hover="1656">Row</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.34855" data-verso-hover="1660">s2</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Row" data-verso-hover="1656">Row</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.34838" data-verso-hover="1660">s1</span><span class="inter-text"> </span><span class="unknown token" data-binding="">++</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.34855" data-verso-hover="1660">s2</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-10193" data-verso-hover="100">match</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.34939" data-verso-hover="1660">s1</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.34857" data-verso-hover="1747">r1</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-10193" data-verso-hover="100">with</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.34865" data-verso-hover="1748">r2</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">_</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.35083" data-verso-hover="1682">v</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-addVal" data-verso-hover="1743">addVal</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.35083" data-verso-hover="1682">v</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.34865" data-verso-hover="1748">r2</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">_</span><span class="unknown token" data-binding="">::</span><span class="unknown token" data-binding="">_</span><span class="unknown token" data-binding="">::</span><span class="unknown token" data-binding="">_</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.35299" data-verso-hover="1684">v</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.35306" data-verso-hover="1685">r'</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.35299" data-verso-hover="1684">v</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.35306" data-verso-hover="1685">r'</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Row.append" data-verso-hover="1746">append</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.34865" data-verso-hover="1748">r2</span><span class="unknown token" data-binding="">)</span></code><p>
                  <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Mine.List.flatMap" data-verso-hover="1749">List.flatMap</span></code>, found in the standard library, applies a function that itself returns a list to every entry in an input list, returning the result of appending the resulting lists in order:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-10361">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Mine.List.flatMap" data-verso-hover="1749">List.flatMap</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.37033" data-verso-hover="1750">f</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37021" data-verso-hover="369">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37028" data-verso-hover="759">β</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.37037" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37021" data-verso-hover="369">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37028" data-verso-hover="759">β</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37078" data-verso-hover="121">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">::</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37079" data-verso-hover="137">xs</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37033" data-verso-hover="1750">f</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37078" data-verso-hover="121">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">++</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37079" data-verso-hover="137">xs</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-List.flatMap" data-verso-hover="1751">flatMap</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37033" data-verso-hover="1750">f</span></code><p>
                  The type signature suggests that <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Mine.List.flatMap" data-verso-hover="1749">List.flatMap</span></code> could be used to implement a <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monad" data-verso-hover="724">Monad</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span></code> instance.
Indeed, together with <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Pure.pure" data-verso-hover="1752">pure</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.69401" data-verso-hover="584">x</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="var token" data-binding="var-_uniq.69401" data-verso-hover="584">x</span><span class="unknown token" data-binding="">]</span></code>, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Mine.List.flatMap" data-verso-hover="1749">List.flatMap</span></code> does implement a monad.
However, it's not a very useful <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monad" data-verso-hover="724">Monad</span></code> instance.
The <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-List" data-verso-hover="111">List</span></code> monad is basically a version of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Many" data-verso-hover="912">Many</span></code> that explores <em>every</em> possible path through the search space in advance, before users have the chance to request some number of values.
Because of this performance trap, it's usually not a good idea to define a <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Monad" data-verso-hover="724">Monad</span></code> instance for <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-List" data-verso-hover="111">List</span></code>.
Here, however, the query language has no operator for restricting the number of results to be returned, so combining all possibilities is exactly what is desired:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-10538">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Table.cartesianProduct" data-verso-hover="1753">Table.cartesianProduct</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.37220" data-verso-hover="1754">table1</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Table" data-verso-hover="1659">Table</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37212" data-verso-hover="1660">s1</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.37222" data-verso-hover="1755">table2</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Table" data-verso-hover="1659">Table</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37218" data-verso-hover="1660">s2</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-Table" data-verso-hover="1659">Table</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.37212" data-verso-hover="1660">s1</span><span class="inter-text"> </span><span class="unknown token" data-binding="">++</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37218" data-verso-hover="1660">s2</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="var token" data-binding="var-_uniq.37220" data-verso-hover="1754">table1</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-List.flatMap" data-verso-hover="1756">flatMap</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-10648">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37287" data-verso-hover="1747">r1</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37222" data-verso-hover="1755">table2</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-List.map" data-verso-hover="231">map</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37287" data-verso-hover="1747">r1</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Row.append" data-verso-hover="1746">append</span></code><p>
                  Just as with <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-List.product" data-verso-hover="1627">List.product</span></code>, a loop with mutation in the identity monad can be used as an alternative implementation technique:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-10756">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-OrElse.Table.cartesianProduct" data-verso-hover="1753">Table.cartesianProduct</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.37408" data-verso-hover="1754">table1</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Table" data-verso-hover="1659">Table</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37400" data-verso-hover="1660">s1</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.37410" data-verso-hover="1755">table2</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Table" data-verso-hover="1659">Table</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37406" data-verso-hover="1660">s2</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-Table" data-verso-hover="1659">Table</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.37400" data-verso-hover="1660">s1</span><span class="inter-text"> </span><span class="unknown token" data-binding="">++</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37406" data-verso-hover="1660">s2</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="const token" data-binding="const-Id.run" data-verso-hover="1495">Id.run</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.do-10856">do</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doLet-10861">let</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-10865">mut</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.38014" data-verso-hover="1757">out</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Table" data-verso-hover="1659">Table</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.37460" data-verso-hover="1660">s1</span><span class="inter-text"> </span><span class="unknown token" data-binding="">++</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37461" data-verso-hover="1660">s2</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-10900" data-verso-hover="1533">for</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37640" data-verso-hover="1747">r1</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doForDecl-10904">in</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37408" data-verso-hover="1754">table1</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-10900" data-verso-hover="1533">do</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-10924" data-verso-hover="1533">for</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37758" data-verso-hover="1748">r2</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doForDecl-10928">in</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37410" data-verso-hover="1755">table2</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.doFor-10924" data-verso-hover="1533">do</span><span class="inter-text">
</span><span class="inter-text">      </span><span class="var token" data-binding="var-_uniq.38014" data-verso-hover="1757">out</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.37640" data-verso-hover="1747">r1</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Row.append" data-verso-hover="1746">append</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.37758" data-verso-hover="1748">r2</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">::</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.38014" data-verso-hover="1757">out</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Pure.pure" data-verso-hover="270">pure</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.38014" data-verso-hover="1757">out</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-List.reverse" data-verso-hover="569">reverse</span></code></section>
              <section>
                <h3 id="Functional-Programming-in-Lean--Programming-with-Dependent-Types--Worked-Example___-Typed-Queries--Executing-Queries--Difference">
                  7.3.5.2. Difference</h3>
                <p>
                  Removing undesired rows from a table can be done using <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-List.filter" data-verso-hover="1758">List.filter</span></code>, which takes a list and a function that returns a <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Bool" data-verso-hover="40">Bool</span></code>.
A new list is returned that contains only the entries for which the function returns <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Bool.true" data-verso-hover="97">true</span></code>.
For instance,</p>
                <code class="hl lean block" data-lean-context="examples"><span class="unknown token" data-binding="">[</span><span class="literal string token" data-binding="" data-verso-hover="1759">"Willamette"</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1760">"Columbia"</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1761">"Sandy"</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1762">"Deschutes"</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-List.filter" data-verso-hover="1758">filter</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">·</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-String.length" data-verso-hover="1763">length</span><span class="inter-text"> </span><span class="unknown token" data-binding="">&gt;</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">8</span><span class="unknown token" data-binding="">)</span></code><p>
                  evaluates to</p>
                <code class="hl lean block" data-lean-context="examples"><span class="unknown token" data-binding="">[</span><span class="literal string token" data-binding="" data-verso-hover="1759">"Willamette"</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1762">"Deschutes"</span><span class="unknown token" data-binding="">]</span></code><p>
                  because <code class="hl lean inline" data-lean-context="examples"><span class="literal string token" data-binding="" data-verso-hover="1760">"Columbia"</span></code> and <code class="hl lean inline" data-lean-context="examples"><span class="literal string token" data-binding="" data-verso-hover="1761">"Sandy"</span></code> have lengths less than or equal to <code class="hl lean inline" data-lean-context="examples"><span class="typed token" data-binding="" data-verso-hover="5">8</span></code>.
Removing the entries of a table can be done using the helper <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-List.without" data-verso-hover="1764">List.without</span></code>:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-11239">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-List.without" data-verso-hover="1764">List.without</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="const token" data-binding="const-BEq" data-verso-hover="516">BEq</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.38534" data-verso-hover="369">α</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.38540" data-verso-hover="137">source</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.38543" data-verso-hover="137">banned</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.38534" data-verso-hover="369">α</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.38534" data-verso-hover="369">α</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="var token" data-binding="var-_uniq.38540" data-verso-hover="137">source</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-List.filter" data-verso-hover="1758">filter</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-11320">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.38559" data-verso-hover="121">r</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="unknown token" data-binding="">!</span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.38543" data-verso-hover="137">banned</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-List.contains" data-verso-hover="1738">contains</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.38559" data-verso-hover="121">r</span><span class="unknown token" data-binding="">)</span></code><p>
                  This will be used with the <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-BEq" data-verso-hover="516">BEq</span></code> instance for <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Row" data-verso-hover="1656">Row</span></code> when interpreting queries.</p>
                </section>
              <section>
                <h3 id="Functional-Programming-in-Lean--Programming-with-Dependent-Types--Worked-Example___-Typed-Queries--Executing-Queries--Renaming-Columns">
                  7.3.5.3. Renaming Columns</h3>
                <p>
                  Renaming a column in a row is done with a recursive function that traverses the row until the column in question is found, at which point the column with the new name gets the same value as the column with the old name:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-11400">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Row.rename" data-verso-hover="1765">Row.rename</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.38619" data-verso-hover="1691">c</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.38580" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.38584" data-verso-hover="39">n</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.38588" data-verso-hover="1646">t</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.38621" data-verso-hover="1680">row</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Row" data-verso-hover="1656">Row</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.38580" data-verso-hover="1660">s</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-Row" data-verso-hover="1656">Row</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.38580" data-verso-hover="1660">s</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Schema.renameColumn" data-verso-hover="1739">renameColumn</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.38619" data-verso-hover="1691">c</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.38617" data-verso-hover="39">n'</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-11485" data-verso-hover="100">match</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.38655" data-verso-hover="1660">s</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.38621" data-verso-hover="1680">row</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.38619" data-verso-hover="1691">c</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-11485" data-verso-hover="100">with</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">_</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.38775" data-verso-hover="1692">v</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-HasCol.here" data-verso-hover="1688">.here</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.38775" data-verso-hover="1692">v</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">_</span><span class="unknown token" data-binding="">::</span><span class="unknown token" data-binding="">_</span><span class="unknown token" data-binding="">::</span><span class="unknown token" data-binding="">_</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.39008" data-verso-hover="1693">v</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.39015" data-verso-hover="1685">r</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-HasCol.here" data-verso-hover="1688">.here</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.39008" data-verso-hover="1693">v</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.39015" data-verso-hover="1685">r</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">_</span><span class="unknown token" data-binding="">::</span><span class="unknown token" data-binding="">_</span><span class="unknown token" data-binding="">::</span><span class="unknown token" data-binding="">_</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.39265" data-verso-hover="1684">v</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.39272" data-verso-hover="1685">r</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-HasCol.there" data-verso-hover="1689">.there</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.39279" data-verso-hover="1694">next</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-addVal" data-verso-hover="1743">addVal</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.39265" data-verso-hover="1684">v</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.39272" data-verso-hover="1685">r</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Row.rename" data-verso-hover="1765">rename</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.39279" data-verso-hover="1694">next</span><span class="unknown token" data-binding="">)</span></code><p>
                  While this function changes the <em>type</em> of its argument, the actual return value contains precisely the same data as the original argument.
From a run-time perspective, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Row.rename" data-verso-hover="1765">Row.rename</span></code> is nothing but a slow identity function.
One difficulty in programming with indexed families is that when performance matters, this kind of operation can get in the way.
It takes a very careful, often brittle, design to eliminate these kinds of “re-indexing” functions.</p>
                </section>
              <section>
                <h3 id="Functional-Programming-in-Lean--Programming-with-Dependent-Types--Worked-Example___-Typed-Queries--Executing-Queries--Prefixing-Column-Names">
                  7.3.5.4. Prefixing Column Names</h3>
                <p>
                  Adding a prefix to column names is very similar to renaming a column.
Instead of proceeding to a desired column and then returning, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-prefixRow" data-verso-hover="1766">prefixRow</span></code> must process all columns:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-11675">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-prefixRow" data-verso-hover="1766">prefixRow</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.49492" data-verso-hover="1680">row</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Row" data-verso-hover="1656">Row</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.49451" data-verso-hover="1660">s</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-Row" data-verso-hover="1656">Row</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.49451" data-verso-hover="1660">s</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-List.map" data-verso-hover="231">map</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.fun-11720">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.49510" data-verso-hover="1657">c</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="unknown token" data-binding="">{</span><span class="var token" data-binding="var-_uniq.49510" data-verso-hover="1657">c</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-11730">with</span><span class="inter-text"> </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.49490" data-verso-hover="39">n</span><span class="inter-text"> </span><span class="unknown token" data-binding="">++</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1291">"."</span><span class="inter-text"> </span><span class="unknown token" data-binding="">++</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.49510" data-verso-hover="1657">c</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Column.name" data-verso-hover="1653">name</span><span class="unknown token" data-binding="">}</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-11771" data-verso-hover="100">match</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.49590" data-verso-hover="1660">s</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.49492" data-verso-hover="1680">row</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.match-11771" data-verso-hover="100">with</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="unknown token" data-binding="">_</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">_</span><span class="unknown token" data-binding="">]</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.49728" data-verso-hover="1682">v</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.49728" data-verso-hover="1682">v</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="unknown token" data-binding="">_</span><span class="unknown token" data-binding="">::</span><span class="unknown token" data-binding="">_</span><span class="unknown token" data-binding="">::</span><span class="unknown token" data-binding="">_</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.49910" data-verso-hover="1684">v</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.49917" data-verso-hover="1685">r</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.49910" data-verso-hover="1684">v</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-prefixRow" data-verso-hover="1766">prefixRow</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.49917" data-verso-hover="1685">r</span><span class="unknown token" data-binding="">)</span></code><p>
                  This can be used with <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-List.map" data-verso-hover="231">List.map</span></code> in order to add a prefix to all rows in a table.
Once again, this function only exists to change the type of a value.</p>
                </section>
              <section>
                <h3 id="Functional-Programming-in-Lean--Programming-with-Dependent-Types--Worked-Example___-Typed-Queries--Executing-Queries--Putting-the-Pieces-Together">
                  7.3.5.5. Putting the Pieces Together</h3>
                <p>
                  With all of these helpers defined, executing a query requires only a short recursive function:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-11910">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query.exec" data-verso-hover="1767">Query.exec</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.51532" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-Table" data-verso-hover="1659">Table</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.51532" data-verso-hover="1660">s</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query.table" data-verso-hover="1730">.table</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.51539" data-verso-hover="1768">t</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.51539" data-verso-hover="1768">t</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query.union" data-verso-hover="1731">.union</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.52027" data-verso-hover="1769">q1</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.51539" data-verso-hover="1769">q2</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query.exec" data-verso-hover="1767">exec</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.52027" data-verso-hover="1769">q1</span><span class="inter-text"> </span><span class="unknown token" data-binding="">++</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query.exec" data-verso-hover="1767">exec</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.51539" data-verso-hover="1769">q2</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query.diff" data-verso-hover="1732">.diff</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.52088" data-verso-hover="1769">q1</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.51539" data-verso-hover="1769">q2</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query.exec" data-verso-hover="1767">exec</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.52088" data-verso-hover="1769">q1</span><span class="inter-text"> </span><span class="unknown token" data-binding="">|&gt;.</span><span class="const token" data-binding="const-List.without" data-verso-hover="1764">without</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Query.exec" data-verso-hover="1767">exec</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.51539" data-verso-hover="1769">q2</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query.select" data-verso-hover="1733">.select</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.52126" data-verso-hover="1769">q</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.51539" data-verso-hover="1716">e</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query.exec" data-verso-hover="1767">exec</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.52126" data-verso-hover="1769">q</span><span class="inter-text"> </span><span class="unknown token" data-binding="">|&gt;.</span><span class="const token" data-binding="const-List.filter" data-verso-hover="1758">filter</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.51539" data-verso-hover="1716">e</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DBExpr.evaluate" data-verso-hover="1723">evaluate</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query.project" data-verso-hover="1734">.project</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.52217" data-verso-hover="1770">q</span><span class="inter-text"> </span><span class="unknown token" data-binding="">_</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.51539" data-verso-hover="1771">sub</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query.exec" data-verso-hover="1767">exec</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.52217" data-verso-hover="1770">q</span><span class="inter-text"> </span><span class="unknown token" data-binding="">|&gt;.</span><span class="const token" data-binding="const-List.map" data-verso-hover="231">map</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">·</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Row.project" data-verso-hover="1706">project</span><span class="inter-text"> </span><span class="unknown token" data-binding="">_</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.51539" data-verso-hover="1771">sub</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query.product" data-verso-hover="1735">.product</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.52275" data-verso-hover="1772">q1</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.52276" data-verso-hover="1773">q2</span><span class="inter-text"> </span><span class="unknown token" data-binding="">_</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query.exec" data-verso-hover="1767">exec</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.52275" data-verso-hover="1772">q1</span><span class="inter-text"> </span><span class="unknown token" data-binding="">|&gt;.</span><span class="const token" data-binding="const-Table.cartesianProduct" data-verso-hover="1753">cartesianProduct</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-Query.exec" data-verso-hover="1767">exec</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.52276" data-verso-hover="1773">q2</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query.renameColumn" data-verso-hover="1737">.renameColumn</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.52355" data-verso-hover="1770">q</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.52356" data-verso-hover="1774">c</span><span class="inter-text"> </span><span class="unknown token" data-binding="">_</span><span class="inter-text"> </span><span class="unknown token" data-binding="">_</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query.exec" data-verso-hover="1767">exec</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.52355" data-verso-hover="1770">q</span><span class="inter-text"> </span><span class="unknown token" data-binding="">|&gt;.</span><span class="const token" data-binding="const-List.map" data-verso-hover="231">map</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="unknown token" data-binding="">·</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Row.rename" data-verso-hover="1765">rename</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.52356" data-verso-hover="1774">c</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">|</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query.prefixWith" data-verso-hover="1740">.prefixWith</span><span class="inter-text"> </span><span class="unknown token" data-binding="">_</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.51539" data-verso-hover="1770">q</span><span class="inter-text"> </span><span class="unknown token" data-binding="">=&gt;</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query.exec" data-verso-hover="1767">exec</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.51539" data-verso-hover="1770">q</span><span class="inter-text"> </span><span class="unknown token" data-binding="">|&gt;.</span><span class="const token" data-binding="const-List.map" data-verso-hover="231">map</span><span class="inter-text"> </span><span class="const token" data-binding="const-prefixRow" data-verso-hover="1766">prefixRow</span></code><p>
                  Some arguments to the constructors are not used during execution.
In particular, both the constructor <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Query.project" data-verso-hover="1734">project</span></code> and the function <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Row.project" data-verso-hover="1706">Row.project</span></code> take the smaller schema as explicit arguments, but the type of the <em>evidence</em> that this schema is a subschema of the larger schema contains enough information for Lean to fill out the argument automatically.
Similarly, the fact that the two tables have disjoint column names that is required by the <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Query.product" data-verso-hover="1735">product</span></code> constructor is not needed by <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Table.cartesianProduct" data-verso-hover="1753">Table.cartesianProduct</span></code>.
Generally speaking, dependent types provide many opportunities to have Lean fill out arguments on behalf of the programmer.</p>
                <p>
                  Dot notation is used with the results of queries to call functions defined both in the <code>Table</code> and <code>List</code> namespaces, such <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-List.map" data-verso-hover="231">List.map</span></code>, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-List.filter" data-verso-hover="1758">List.filter</span></code>, and <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Table.cartesianProduct" data-verso-hover="1753">Table.cartesianProduct</span></code>.
This works because <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Table" data-verso-hover="1659">Table</span></code> is defined using <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">abbrev</span></code>.
Just like type class search, dot notation can see through definitions created with <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">abbrev</span></code>.</p>
                <p>
                  The implementation of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Query.select" data-verso-hover="1733">select</span></code> is also quite concise.
After executing the query <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.52126" data-verso-hover="1769">q</span></code>, <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-List.filter" data-verso-hover="1758">List.filter</span></code> is used to remove the rows that do not satisfy the expression.
<code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-List.filter" data-verso-hover="1758">List.filter</span></code> expects a function from <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Row" data-verso-hover="1656">Row</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.2350" data-verso-hover="1660">s</span></code> to <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Bool" data-verso-hover="40">Bool</span></code>, but <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DBExpr.evaluate" data-verso-hover="1723">DBExpr.evaluate</span></code> has type <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Row" data-verso-hover="1656">Row</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.28082" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBExpr" data-verso-hover="1709">DBExpr</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.28082" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.28089" data-verso-hover="1646">t</span><span class="inter-text"> </span><span class="unknown token" data-binding="">→</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.28089" data-verso-hover="1646">t</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DBType.asType" data-verso-hover="1644">asType</span></code>.
Because the type of the <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Query.select" data-verso-hover="1733">select</span></code> constructor requires that the expression have type <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DBExpr" data-verso-hover="1709">DBExpr</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.30419" data-verso-hover="1660">s</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.bool" data-verso-hover="1643">.bool</span></code>, <code class="hl lean inline" data-lean-context="examples"><span class="var token" data-binding="var-_uniq.28089" data-verso-hover="1646">t</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DBType.asType" data-verso-hover="1644">asType</span></code> is actually <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Bool" data-verso-hover="40">Bool</span></code> in this context.</p>
                <p>
                  A query that finds the heights of all mountain peaks with an elevation greater than 500 meters can be written:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.open-12415" data-verso-hover="240">open</span><span class="inter-text"> </span><span class="unknown token" data-binding="">Query</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.in-12415">in</span><span class="inter-text">
</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-12429">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-example1" data-verso-hover="1775">example1</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-Query.table" data-verso-hover="1730">table</span><span class="inter-text"> </span><span class="const token" data-binding="const-mountainDiary" data-verso-hover="1666">mountainDiary</span><span class="inter-text"> </span><span class="unknown token" data-binding="">|&gt;.</span><span class="const token" data-binding="const-Query.select" data-verso-hover="1733">select</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-DBExpr.lt" data-verso-hover="1713">.lt</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-DBExpr.const" data-verso-hover="1717">.const</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="1719">500</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-termC!_-12498">c!</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1664">"elevation"</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">|&gt;.</span><span class="const token" data-binding="const-Query.project" data-verso-hover="1734">project</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟨</span><span class="literal string token" data-binding="" data-verso-hover="1664">"elevation"</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.int" data-verso-hover="1641">.int</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟩</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="tactic"><label for="tactic-state-7186909747568621695-12555-12557"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.byTactic-12555" data-verso-hover="340">by</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-7186909747568621695-12555-12557"><span class="tactic-state"><span class="goal"><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">[</span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1664">"elevation"</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="const token" data-binding="const-DBType.int" data-verso-hover="1641">DBType.int</span><span class="inter-text"> }</span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">]</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span></span></span></span></span></span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.tacticRepeat_-12558" data-verso-hover="1701">repeat</span><span class="inter-text"> </span><span class="tactic"><label for="tactic-state-7-12565-12576"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.constructor-12565" data-verso-hover="1699">constructor</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-7-12565-12576"><span class="tactic-state">All goals completed! 🐙</span></span><span class="unknown token" data-binding="">)</span></code><p>
                  Executing it returns the expected list of integers:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="has-info info"><span class="hover-container"><span class="hover-info messages"><code class="message info">[3637, 1519, 2549]</code></span></span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.eval-12671" data-verso-hover="7">#eval</span></span><span class="inter-text"> </span><span class="const token" data-binding="const-example1" data-verso-hover="1775">example1</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Query.exec" data-verso-hover="1767">exec</span></code><div class="information">
                  <pre>[3637, 1519, 2549]</pre></div>
                <p>
                  To plan a sightseeing tour, it may be relevant to match all pairs mountains and waterfalls in the same location.
This can be done by taking the Cartesian product of both tables, selecting only the rows in which they are equal, and then projecting out the names:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.open-12736" data-verso-hover="240">open</span><span class="inter-text"> </span><span class="unknown token" data-binding="">Query</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.in-12736">in</span><span class="inter-text">
</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-12750">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-example2" data-verso-hover="1776">example2</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.let-12768" data-verso-hover="212">let</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.56678" data-verso-hover="1777">mountain</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query.table" data-verso-hover="1730">table</span><span class="inter-text"> </span><span class="const token" data-binding="const-mountainDiary" data-verso-hover="1666">mountainDiary</span><span class="inter-text"> </span><span class="unknown token" data-binding="">|&gt;.</span><span class="const token" data-binding="const-Query.prefixWith" data-verso-hover="1740">prefixWith</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1778">"mountain"</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.let-12831" data-verso-hover="212">let</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.56686" data-verso-hover="1779">waterfall</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query.table" data-verso-hover="1730">table</span><span class="inter-text"> </span><span class="const token" data-binding="const-waterfallDiary" data-verso-hover="1676">waterfallDiary</span><span class="inter-text"> </span><span class="unknown token" data-binding="">|&gt;.</span><span class="const token" data-binding="const-Query.prefixWith" data-verso-hover="1740">prefixWith</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1780">"waterfall"</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="var token" data-binding="var-_uniq.56678" data-verso-hover="1777">mountain</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Query.product" data-verso-hover="1735">product</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.56686" data-verso-hover="1779">waterfall</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="tactic"><label for="tactic-state-18190952968128270006-12925-12927"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.byTactic-12925" data-verso-hover="340">by</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-18190952968128270006-12925-12927"><span class="tactic-state"><span class="goal"><span class="hypotheses"><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.56678" data-verso-hover="1777">mountain</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="const token" data-binding="const-List.map" data-verso-hover="231">List.map</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="keyword token" data-binding="">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.57858" data-verso-hover="1657">c</span><span class="inter-text"> =&gt; </span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1778">"mountain"</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="literal string token" data-binding="" data-verso-hover="1291">"."</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="var token" data-binding="var-_uniq.57858" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.name" data-verso-hover="1653">name</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="var token" data-binding="var-_uniq.57858" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1654">contains</span><span class="inter-text"> }</span><span class="inter-text">)</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text">)</span><span class="inter-text"> := </span><span class="const token" data-binding="const-Query.prefixWith" data-verso-hover="1740">prefixWith</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1778">"mountain"</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="const token" data-binding="const-Query.table" data-verso-hover="1730">table</span><span class="inter-text"> </span><span class="const token" data-binding="const-mountainDiary" data-verso-hover="1666">mountainDiary</span><span class="inter-text">)</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.56686" data-verso-hover="1779">waterfall</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="const token" data-binding="const-List.map" data-verso-hover="231">List.map</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="keyword token" data-binding="">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.57858" data-verso-hover="1657">c</span><span class="inter-text"> =&gt; </span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1780">"waterfall"</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="literal string token" data-binding="" data-verso-hover="1291">"."</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="var token" data-binding="var-_uniq.57858" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.name" data-verso-hover="1653">name</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="var token" data-binding="var-_uniq.57858" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1654">contains</span><span class="inter-text"> }</span><span class="inter-text">)</span><span class="inter-text"> </span><span class="const token" data-binding="const-waterfall" data-verso-hover="1675">_root_.waterfall</span><span class="inter-text">)</span><span class="inter-text"> := </span><span class="const token" data-binding="const-Query.prefixWith" data-verso-hover="1740">prefixWith</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1780">"waterfall"</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="const token" data-binding="const-Query.table" data-verso-hover="1730">table</span><span class="inter-text"> </span><span class="const token" data-binding="const-waterfallDiary" data-verso-hover="1676">waterfallDiary</span><span class="inter-text">)</span></span></span></span><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-disjoint" data-verso-hover="1736">disjoint</span><span class="inter-text">
    </span><span class="inter-text">(</span><span class="const token" data-binding="const-List.map" data-verso-hover="231">List.map</span><span class="inter-text"> </span><span class="const token" data-binding="const-Column.name" data-verso-hover="1653">Column.name</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="const token" data-binding="const-List.map" data-verso-hover="231">List.map</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="keyword token" data-binding="">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.57863" data-verso-hover="1657">c</span><span class="inter-text"> =&gt; </span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1778">"mountain"</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="literal string token" data-binding="" data-verso-hover="1291">"."</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="var token" data-binding="var-_uniq.57863" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.name" data-verso-hover="1653">name</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="var token" data-binding="var-_uniq.57863" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1654">contains</span><span class="inter-text"> }</span><span class="inter-text">)</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text">)</span><span class="inter-text">)</span><span class="inter-text">
    </span><span class="inter-text">(</span><span class="const token" data-binding="const-List.map" data-verso-hover="231">List.map</span><span class="inter-text"> </span><span class="const token" data-binding="const-Column.name" data-verso-hover="1653">Column.name</span><span class="inter-text">
      </span><span class="inter-text">(</span><span class="const token" data-binding="const-List.map" data-verso-hover="231">List.map</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="keyword token" data-binding="">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.57893" data-verso-hover="1657">c</span><span class="inter-text"> =&gt; </span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1780">"waterfall"</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="literal string token" data-binding="" data-verso-hover="1291">"."</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="var token" data-binding="var-_uniq.57893" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.name" data-verso-hover="1653">name</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="var token" data-binding="var-_uniq.57893" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1654">contains</span><span class="inter-text"> }</span><span class="inter-text">)</span><span class="inter-text"> </span><span class="const token" data-binding="const-waterfall" data-verso-hover="1675">_root_.waterfall</span><span class="inter-text">)</span><span class="inter-text">)</span><span class="const token" data-binding="const-Eq" data-verso-hover="342"> =
  </span><span class="const token" data-binding="const-Bool.true" data-verso-hover="97">true</span></span></span></span></span></span><span class="inter-text"> </span><span class="tactic"><label for="tactic-state-7-12928-12934"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.decide-12928" data-verso-hover="343">decide</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-7-12928-12934"><span class="tactic-state">All goals completed! 🐙</span></span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|&gt;.</span><span class="const token" data-binding="const-Query.select" data-verso-hover="1733">select</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-DBExpr.eq" data-verso-hover="1711">.eq</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-termC!_-12956">c!</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1781">"mountain.location"</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-termC!_-12981">c!</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1782">"waterfall.location"</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|&gt;.</span><span class="const token" data-binding="const-Query.project" data-verso-hover="1734">project</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟨</span><span class="literal string token" data-binding="" data-verso-hover="1783">"mountain.name"</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">.string</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟩</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟨</span><span class="literal string token" data-binding="" data-verso-hover="1784">"waterfall.name"</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">.string</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟩</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="tactic"><label for="tactic-state-6154817158408250372-13089-13091"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.byTactic-13089" data-verso-hover="340">by</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-6154817158408250372-13089-13091"><span class="tactic-state"><span class="goal"><span class="hypotheses"><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.56678" data-verso-hover="1777">mountain</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="const token" data-binding="const-List.map" data-verso-hover="231">List.map</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="keyword token" data-binding="">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.57858" data-verso-hover="1657">c</span><span class="inter-text"> =&gt; </span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1778">"mountain"</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="literal string token" data-binding="" data-verso-hover="1291">"."</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="var token" data-binding="var-_uniq.57858" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.name" data-verso-hover="1653">name</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="var token" data-binding="var-_uniq.57858" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1654">contains</span><span class="inter-text"> }</span><span class="inter-text">)</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text">)</span><span class="inter-text"> := </span><span class="const token" data-binding="const-Query.prefixWith" data-verso-hover="1740">prefixWith</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1778">"mountain"</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="const token" data-binding="const-Query.table" data-verso-hover="1730">table</span><span class="inter-text"> </span><span class="const token" data-binding="const-mountainDiary" data-verso-hover="1666">mountainDiary</span><span class="inter-text">)</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.56686" data-verso-hover="1779">waterfall</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="const token" data-binding="const-List.map" data-verso-hover="231">List.map</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="keyword token" data-binding="">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.57858" data-verso-hover="1657">c</span><span class="inter-text"> =&gt; </span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1780">"waterfall"</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="literal string token" data-binding="" data-verso-hover="1291">"."</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="var token" data-binding="var-_uniq.57858" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.name" data-verso-hover="1653">name</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="var token" data-binding="var-_uniq.57858" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1654">contains</span><span class="inter-text"> }</span><span class="inter-text">)</span><span class="inter-text"> </span><span class="const token" data-binding="const-waterfall" data-verso-hover="1675">_root_.waterfall</span><span class="inter-text">)</span><span class="inter-text"> := </span><span class="const token" data-binding="const-Query.prefixWith" data-verso-hover="1740">prefixWith</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1780">"waterfall"</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="const token" data-binding="const-Query.table" data-verso-hover="1730">table</span><span class="inter-text"> </span><span class="const token" data-binding="const-waterfallDiary" data-verso-hover="1676">waterfallDiary</span><span class="inter-text">)</span></span></span></span><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text">
  </span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">[</span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1783">"mountain.name"</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">DBType.string</span><span class="inter-text"> }</span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">, </span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1784">"waterfall.name"</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">DBType.string</span><span class="inter-text"> }</span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">]</span><span class="inter-text">
  </span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558">(</span><span class="const token" data-binding="const-List.map" data-verso-hover="231">List.map</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="keyword token" data-binding="">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.57881" data-verso-hover="1657">c</span><span class="inter-text"> =&gt; </span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1778">"mountain"</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="literal string token" data-binding="" data-verso-hover="1291">"."</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="var token" data-binding="var-_uniq.57881" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.name" data-verso-hover="1653">name</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="var token" data-binding="var-_uniq.57881" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1654">contains</span><span class="inter-text"> }</span><span class="inter-text">)</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++
    </span><span class="const token" data-binding="const-List.map" data-verso-hover="231">List.map</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="keyword token" data-binding="">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.57900" data-verso-hover="1657">c</span><span class="inter-text"> =&gt; </span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1780">"waterfall"</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="literal string token" data-binding="" data-verso-hover="1291">"."</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="var token" data-binding="var-_uniq.57900" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.name" data-verso-hover="1653">name</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="var token" data-binding="var-_uniq.57900" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1654">contains</span><span class="inter-text"> }</span><span class="inter-text">)</span><span class="inter-text"> </span><span class="const token" data-binding="const-waterfall" data-verso-hover="1675">_root_.waterfall</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558">)</span></span></span></span></span></span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.tacticRepeat_-13092" data-verso-hover="1701">repeat</span><span class="inter-text"> </span><span class="tactic"><label for="tactic-state-7-13099-13110"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.constructor-13099" data-verso-hover="1699">constructor</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-7-13099-13110"><span class="tactic-state">All goals completed! 🐙</span></span><span class="unknown token" data-binding="">)</span></code><p>
                  Because the example data includes only waterfalls in the USA, executing the query returns pairs of mountains and waterfalls in the US:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="has-info info"><span class="hover-container"><span class="hover-info messages"><code class="message info">[("Mount Nebo", "Multnomah Falls"), ("Mount Nebo", "Shoshone Falls"), ("Moscow Mountain", "Multnomah Falls"),
  ("Moscow Mountain", "Shoshone Falls"), ("Mount St. Helens", "Multnomah Falls"),
  ("Mount St. Helens", "Shoshone Falls")]</code></span></span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.eval-13420" data-verso-hover="7">#eval</span></span><span class="inter-text"> </span><span class="const token" data-binding="const-example2" data-verso-hover="1776">example2</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Query.exec" data-verso-hover="1767">exec</span></code><div class="information">
                  <pre>[("Mount Nebo", "Multnomah Falls"), ("Mount Nebo", "Shoshone Falls"), ("Moscow Mountain", "Multnomah Falls"),
  ("Moscow Mountain", "Shoshone Falls"), ("Mount St. Helens", "Multnomah Falls"),
  ("Mount St. Helens", "Shoshone Falls")]</pre></div>
                </section>
              <section>
                <h3 id="Functional-Programming-in-Lean--Programming-with-Dependent-Types--Worked-Example___-Typed-Queries--Executing-Queries--Errors-You-May-Meet">
                  7.3.5.6. Errors You May Meet</h3>
                <p>
                  Many potential errors are ruled out by the definition of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span></code>.
For instance, forgetting the added qualifier in <code class="hl lean inline" data-lean-context="examples"><span class="literal string token" data-binding="" data-verso-hover="1781">"mountain.location"</span></code> yields a compile-time error that highlights the column reference <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-termC!_-14780">c!</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1663">"location"</span></code>:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.open-14558" data-verso-hover="240">open</span><span class="inter-text"> </span><span class="unknown token" data-binding="">Query</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.in-14558">in</span><span class="inter-text">
</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-14572">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Ooops.example2" data-verso-hover="1776">example2</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.let-14590" data-verso-hover="212">let</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.60404" data-verso-hover="1777">mountains</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query.table" data-verso-hover="1730">table</span><span class="inter-text"> </span><span class="const token" data-binding="const-mountainDiary" data-verso-hover="1666">mountainDiary</span><span class="inter-text"> </span><span class="unknown token" data-binding="">|&gt;.</span><span class="const token" data-binding="const-Query.prefixWith" data-verso-hover="1740">prefixWith</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1778">"mountain"</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.let-14654" data-verso-hover="212">let</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.60412" data-verso-hover="1785">waterfalls</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query.table" data-verso-hover="1730">table</span><span class="inter-text"> </span><span class="const token" data-binding="const-waterfallDiary" data-verso-hover="1676">waterfallDiary</span><span class="inter-text"> </span><span class="unknown token" data-binding="">|&gt;.</span><span class="const token" data-binding="const-Query.prefixWith" data-verso-hover="1740">prefixWith</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1780">"waterfall"</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="var token" data-binding="var-_uniq.60404" data-verso-hover="1777">mountains</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Query.product" data-verso-hover="1735">product</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.60412" data-verso-hover="1785">waterfalls</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="has-info error"><span class="hover-container"><span class="hover-info messages"><code class="message error">unsolved goals
mountains : Query (List.map (fun c =&gt; { name := "mountain" ++ "." ++ c.name, contains := c.contains }) peak) :=
  prefixWith "mountain" (table mountainDiary)
waterfalls : Query (List.map (fun c =&gt; { name := "waterfall" ++ "." ++ c.name, contains := c.contains }) waterfall) :=
  prefixWith "waterfall" (table waterfallDiary)
⊢ disjoint ["mountain.name", "mountain.location", "mountain.elevation", "mountain.lastVisited"]
      ["waterfall.name", "waterfall.location", "waterfall.lastVisited"] =
    true</code></span></span><span class="tactic"><label for="tactic-state-934255940217812721-14751-14753"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.byTactic-14751" data-verso-hover="340">by</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-934255940217812721-14751-14753"><span class="tactic-state"><span class="goal"><span class="hypotheses"><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.60404" data-verso-hover="1777">mountains</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="const token" data-binding="const-List.map" data-verso-hover="231">List.map</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="keyword token" data-binding="">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.61528" data-verso-hover="1657">c</span><span class="inter-text"> =&gt; </span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1778">"mountain"</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="literal string token" data-binding="" data-verso-hover="1291">"."</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="var token" data-binding="var-_uniq.61528" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.name" data-verso-hover="1653">name</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="var token" data-binding="var-_uniq.61528" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1654">contains</span><span class="inter-text"> }</span><span class="inter-text">)</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text">)</span><span class="inter-text"> := </span><span class="const token" data-binding="const-Query.prefixWith" data-verso-hover="1740">prefixWith</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1778">"mountain"</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="const token" data-binding="const-Query.table" data-verso-hover="1730">table</span><span class="inter-text"> </span><span class="const token" data-binding="const-mountainDiary" data-verso-hover="1666">mountainDiary</span><span class="inter-text">)</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.60412" data-verso-hover="1785">waterfalls</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="const token" data-binding="const-List.map" data-verso-hover="231">List.map</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="keyword token" data-binding="">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.61528" data-verso-hover="1657">c</span><span class="inter-text"> =&gt; </span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1780">"waterfall"</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="literal string token" data-binding="" data-verso-hover="1291">"."</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="var token" data-binding="var-_uniq.61528" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.name" data-verso-hover="1653">name</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="var token" data-binding="var-_uniq.61528" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1654">contains</span><span class="inter-text"> }</span><span class="inter-text">)</span><span class="inter-text"> </span><span class="const token" data-binding="const-waterfall" data-verso-hover="1675">waterfall</span><span class="inter-text">)</span><span class="inter-text"> := </span><span class="const token" data-binding="const-Query.prefixWith" data-verso-hover="1740">prefixWith</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1780">"waterfall"</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="const token" data-binding="const-Query.table" data-verso-hover="1730">table</span><span class="inter-text"> </span><span class="const token" data-binding="const-waterfallDiary" data-verso-hover="1676">waterfallDiary</span><span class="inter-text">)</span></span></span></span><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-disjoint" data-verso-hover="1736">disjoint</span><span class="inter-text">
    </span><span class="inter-text">(</span><span class="const token" data-binding="const-List.map" data-verso-hover="231">List.map</span><span class="inter-text"> </span><span class="const token" data-binding="const-Column.name" data-verso-hover="1653">Column.name</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="const token" data-binding="const-List.map" data-verso-hover="231">List.map</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="keyword token" data-binding="">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.61533" data-verso-hover="1657">c</span><span class="inter-text"> =&gt; </span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1778">"mountain"</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="literal string token" data-binding="" data-verso-hover="1291">"."</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="var token" data-binding="var-_uniq.61533" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.name" data-verso-hover="1653">name</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="var token" data-binding="var-_uniq.61533" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1654">contains</span><span class="inter-text"> }</span><span class="inter-text">)</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text">)</span><span class="inter-text">)</span><span class="inter-text">
    </span><span class="inter-text">(</span><span class="const token" data-binding="const-List.map" data-verso-hover="231">List.map</span><span class="inter-text"> </span><span class="const token" data-binding="const-Column.name" data-verso-hover="1653">Column.name</span><span class="inter-text">
      </span><span class="inter-text">(</span><span class="const token" data-binding="const-List.map" data-verso-hover="231">List.map</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="keyword token" data-binding="">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.61563" data-verso-hover="1657">c</span><span class="inter-text"> =&gt; </span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1780">"waterfall"</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="literal string token" data-binding="" data-verso-hover="1291">"."</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="var token" data-binding="var-_uniq.61563" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.name" data-verso-hover="1653">name</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="var token" data-binding="var-_uniq.61563" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1654">contains</span><span class="inter-text"> }</span><span class="inter-text">)</span><span class="inter-text"> </span><span class="const token" data-binding="const-waterfall" data-verso-hover="1675">waterfall</span><span class="inter-text">)</span><span class="inter-text">)</span><span class="const token" data-binding="const-Eq" data-verso-hover="342"> =
  </span><span class="const token" data-binding="const-Bool.true" data-verso-hover="97">true</span></span></span></span></span></span><span class="inter-text"> </span><span class="tactic"><label for="tactic-state-18136339367013251904-14754-14758"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.simp-14754" data-verso-hover="379">simp</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-18136339367013251904-14754-14758"><span class="tactic-state"><span class="goal"><span class="hypotheses"><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.60404" data-verso-hover="1777">mountains</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="const token" data-binding="const-List.map" data-verso-hover="231">List.map</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="keyword token" data-binding="">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.61528" data-verso-hover="1657">c</span><span class="inter-text"> =&gt; </span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1778">"mountain"</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="literal string token" data-binding="" data-verso-hover="1291">"."</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="var token" data-binding="var-_uniq.61528" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.name" data-verso-hover="1653">name</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="var token" data-binding="var-_uniq.61528" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1654">contains</span><span class="inter-text"> }</span><span class="inter-text">)</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text">)</span><span class="inter-text"> := </span><span class="const token" data-binding="const-Query.prefixWith" data-verso-hover="1740">prefixWith</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1778">"mountain"</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="const token" data-binding="const-Query.table" data-verso-hover="1730">table</span><span class="inter-text"> </span><span class="const token" data-binding="const-mountainDiary" data-verso-hover="1666">mountainDiary</span><span class="inter-text">)</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.60412" data-verso-hover="1785">waterfalls</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="const token" data-binding="const-List.map" data-verso-hover="231">List.map</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="keyword token" data-binding="">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.61528" data-verso-hover="1657">c</span><span class="inter-text"> =&gt; </span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1780">"waterfall"</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="literal string token" data-binding="" data-verso-hover="1291">"."</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="var token" data-binding="var-_uniq.61528" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.name" data-verso-hover="1653">name</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="var token" data-binding="var-_uniq.61528" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1654">contains</span><span class="inter-text"> }</span><span class="inter-text">)</span><span class="inter-text"> </span><span class="const token" data-binding="const-waterfall" data-verso-hover="1675">waterfall</span><span class="inter-text">)</span><span class="inter-text"> := </span><span class="const token" data-binding="const-Query.prefixWith" data-verso-hover="1740">prefixWith</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1780">"waterfall"</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="const token" data-binding="const-Query.table" data-verso-hover="1730">table</span><span class="inter-text"> </span><span class="const token" data-binding="const-waterfallDiary" data-verso-hover="1676">waterfallDiary</span><span class="inter-text">)</span></span></span></span><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-disjoint" data-verso-hover="1736">disjoint</span><span class="inter-text"> </span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">[</span><span class="literal string token" data-binding="" data-verso-hover="1783">"mountain.name"</span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">, </span><span class="literal string token" data-binding="" data-verso-hover="1781">"mountain.location"</span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">, </span><span class="literal string token" data-binding="" data-verso-hover="1786">"mountain.elevation"</span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">, </span><span class="literal string token" data-binding="" data-verso-hover="1787">"mountain.lastVisited"</span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">]</span><span class="inter-text">
    </span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">[</span><span class="literal string token" data-binding="" data-verso-hover="1784">"waterfall.name"</span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">, </span><span class="literal string token" data-binding="" data-verso-hover="1782">"waterfall.location"</span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">, </span><span class="literal string token" data-binding="" data-verso-hover="1788">"waterfall.lastVisited"</span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">]</span><span class="const token" data-binding="const-Eq" data-verso-hover="342"> =
  </span><span class="const token" data-binding="const-Bool.true" data-verso-hover="97">true</span></span></span></span></span></span></span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|&gt;.</span><span class="const token" data-binding="const-Query.select" data-verso-hover="1733">select</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-DBExpr.eq" data-verso-hover="1711">.eq</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="has-info error"><span class="hover-container"><span class="hover-info messages"><code class="message error">unsolved goals
case a.a.a.a.a.a.a
mountains : Query (List.map (fun c =&gt; { name := "mountain" ++ "." ++ c.name, contains := c.contains }) peak) :=
  prefixWith "mountain" (table mountainDiary)
waterfalls : Query (List.map (fun c =&gt; { name := "waterfall" ++ "." ++ c.name, contains := c.contains }) waterfall) :=
  prefixWith "waterfall" (table waterfallDiary)
⊢ HasCol (List.map (fun c =&gt; { name := "waterfall" ++ "." ++ c.name, contains := c.contains }) []) "location" ?m.60459</code></span></span><span class="keyword token" data-binding="kw-occ-termC!_-14780">c!</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1663">"location"</span></span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="keyword token" data-binding="kw-occ-termC!_-14796">c!</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1782">"waterfall.location"</span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|&gt;.</span><span class="const token" data-binding="const-Query.project" data-verso-hover="1734">project</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟨</span><span class="literal string token" data-binding="" data-verso-hover="1783">"mountain.name"</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">.string</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟩</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟨</span><span class="literal string token" data-binding="" data-verso-hover="1784">"waterfall.name"</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">.string</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟩</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="tactic"><label for="tactic-state-4620866717771129608-14904-14906"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.byTactic-14904" data-verso-hover="340">by</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-4620866717771129608-14904-14906"><span class="tactic-state"><span class="goal"><span class="hypotheses"><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.60404" data-verso-hover="1777">mountains</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="const token" data-binding="const-List.map" data-verso-hover="231">List.map</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="keyword token" data-binding="">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.61528" data-verso-hover="1657">c</span><span class="inter-text"> =&gt; </span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1778">"mountain"</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="literal string token" data-binding="" data-verso-hover="1291">"."</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="var token" data-binding="var-_uniq.61528" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.name" data-verso-hover="1653">name</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="var token" data-binding="var-_uniq.61528" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1654">contains</span><span class="inter-text"> }</span><span class="inter-text">)</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text">)</span><span class="inter-text"> := </span><span class="const token" data-binding="const-Query.prefixWith" data-verso-hover="1740">prefixWith</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1778">"mountain"</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="const token" data-binding="const-Query.table" data-verso-hover="1730">table</span><span class="inter-text"> </span><span class="const token" data-binding="const-mountainDiary" data-verso-hover="1666">mountainDiary</span><span class="inter-text">)</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.60412" data-verso-hover="1785">waterfalls</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="const token" data-binding="const-List.map" data-verso-hover="231">List.map</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="keyword token" data-binding="">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.61528" data-verso-hover="1657">c</span><span class="inter-text"> =&gt; </span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1780">"waterfall"</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="literal string token" data-binding="" data-verso-hover="1291">"."</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="var token" data-binding="var-_uniq.61528" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.name" data-verso-hover="1653">name</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="var token" data-binding="var-_uniq.61528" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1654">contains</span><span class="inter-text"> }</span><span class="inter-text">)</span><span class="inter-text"> </span><span class="const token" data-binding="const-waterfall" data-verso-hover="1675">waterfall</span><span class="inter-text">)</span><span class="inter-text"> := </span><span class="const token" data-binding="const-Query.prefixWith" data-verso-hover="1740">prefixWith</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1780">"waterfall"</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="const token" data-binding="const-Query.table" data-verso-hover="1730">table</span><span class="inter-text"> </span><span class="const token" data-binding="const-waterfallDiary" data-verso-hover="1676">waterfallDiary</span><span class="inter-text">)</span></span></span></span><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text">
  </span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">[</span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1783">"mountain.name"</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">DBType.string</span><span class="inter-text"> }</span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">, </span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1784">"waterfall.name"</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">DBType.string</span><span class="inter-text"> }</span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">]</span><span class="inter-text">
  </span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558">(</span><span class="const token" data-binding="const-List.map" data-verso-hover="231">List.map</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="keyword token" data-binding="">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.61551" data-verso-hover="1657">c</span><span class="inter-text"> =&gt; </span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1778">"mountain"</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="literal string token" data-binding="" data-verso-hover="1291">"."</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="var token" data-binding="var-_uniq.61551" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.name" data-verso-hover="1653">name</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="var token" data-binding="var-_uniq.61551" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1654">contains</span><span class="inter-text"> }</span><span class="inter-text">)</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++
    </span><span class="const token" data-binding="const-List.map" data-verso-hover="231">List.map</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="keyword token" data-binding="">fun</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.61570" data-verso-hover="1657">c</span><span class="inter-text"> =&gt; </span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1780">"waterfall"</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="literal string token" data-binding="" data-verso-hover="1291">"."</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="var token" data-binding="var-_uniq.61570" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.name" data-verso-hover="1653">name</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="var token" data-binding="var-_uniq.61570" data-verso-hover="1657">c</span><span class="inter-text">.</span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1654">contains</span><span class="inter-text"> }</span><span class="inter-text">)</span><span class="inter-text"> </span><span class="const token" data-binding="const-waterfall" data-verso-hover="1675">waterfall</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558">)</span></span></span></span></span></span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.tacticRepeat_-14907" data-verso-hover="1701">repeat</span><span class="inter-text"> </span><span class="tactic"><label for="tactic-state-7-14914-14925"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.constructor-14914" data-verso-hover="1699">constructor</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-7-14914-14925"><span class="tactic-state">All goals completed! 🐙</span></span><span class="unknown token" data-binding="">)</span></code><p>
                  This is excellent feedback!
On the other hand, the text of the error message is quite difficult to act on:</p>
                <div class="error">
                  <pre>unsolved goals
case a.a.a.a.a.a.a
mountains : Query (List.map (fun c =&gt; { name := "mountain" ++ "." ++ c.name, contains := c.contains }) peak) :=
  prefixWith "mountain" (table mountainDiary)
waterfalls : Query (List.map (fun c =&gt; { name := "waterfall" ++ "." ++ c.name, contains := c.contains }) waterfall) :=
  prefixWith "waterfall" (table waterfallDiary)
⊢ HasCol (List.map (fun c =&gt; { name := "waterfall" ++ "." ++ c.name, contains := c.contains }) []) "location" ?m.60459</pre></div>
                <p>
                  Similarly, forgetting to add prefixes to the names of the two tables results in an error on <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">by decide</span></code>, which should provide evidence that the schemas are in fact disjoint;</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.open-15917" data-verso-hover="240">open</span><span class="inter-text"> </span><span class="unknown token" data-binding="">Query</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.in-15917">in</span><span class="inter-text">
</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.definition-15931">def</span><span class="inter-text"> </span><span class="const token" data-binding="const-Ooops.example2" data-verso-hover="1776">example2</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.let-15949" data-verso-hover="212">let</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.61532" data-verso-hover="1789">mountains</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query.table" data-verso-hover="1730">table</span><span class="inter-text"> </span><span class="const token" data-binding="const-mountainDiary" data-verso-hover="1666">mountainDiary</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.let-15988" data-verso-hover="212">let</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.61536" data-verso-hover="1790">waterfalls</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text"> </span><span class="const token" data-binding="const-Query.table" data-verso-hover="1730">table</span><span class="inter-text"> </span><span class="const token" data-binding="const-waterfallDiary" data-verso-hover="1676">waterfallDiary</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="var token" data-binding="var-_uniq.61532" data-verso-hover="1789">mountains</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-Query.product" data-verso-hover="1735">product</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.61536" data-verso-hover="1790">waterfalls</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="tactic"><label for="tactic-state-11484098308070334098-16059-16061"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.byTactic-16059" data-verso-hover="340">by</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-11484098308070334098-16059-16061"><span class="tactic-state"><span class="goal"><span class="hypotheses"><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.61532" data-verso-hover="1789">mountains</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text"> := </span><span class="const token" data-binding="const-Query.table" data-verso-hover="1730">table</span><span class="inter-text"> </span><span class="const token" data-binding="const-mountainDiary" data-verso-hover="1666">mountainDiary</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.61536" data-verso-hover="1790">waterfalls</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="const token" data-binding="const-waterfall" data-verso-hover="1675">waterfall</span><span class="inter-text"> := </span><span class="const token" data-binding="const-Query.table" data-verso-hover="1730">table</span><span class="inter-text"> </span><span class="const token" data-binding="const-waterfallDiary" data-verso-hover="1676">waterfallDiary</span></span></span></span><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-disjoint" data-verso-hover="1736">disjoint</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="const token" data-binding="const-List.map" data-verso-hover="231">List.map</span><span class="inter-text"> </span><span class="const token" data-binding="const-Column.name" data-verso-hover="1653">Column.name</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text">)</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="const token" data-binding="const-List.map" data-verso-hover="231">List.map</span><span class="inter-text"> </span><span class="const token" data-binding="const-Column.name" data-verso-hover="1653">Column.name</span><span class="inter-text"> </span><span class="const token" data-binding="const-waterfall" data-verso-hover="1675">waterfall</span><span class="inter-text">)</span><span class="const token" data-binding="const-Eq" data-verso-hover="342"> = </span><span class="const token" data-binding="const-Bool.true" data-verso-hover="97">true</span></span></span></span></span></span><span class="inter-text"> </span><span class="has-info error"><span class="hover-container"><span class="hover-info messages"><code class="message error">tactic 'decide' proved that the proposition
  disjoint (List.map Column.name peak) (List.map Column.name waterfall) = true
is false</code></span></span><span class="tactic"><label for="tactic-state-11484098308070334098-16062-16068"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.decide-16062" data-verso-hover="343">decide</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-11484098308070334098-16062-16068"><span class="tactic-state"><span class="goal"><span class="hypotheses"><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.61532" data-verso-hover="1789">mountains</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text"> := </span><span class="const token" data-binding="const-Query.table" data-verso-hover="1730">table</span><span class="inter-text"> </span><span class="const token" data-binding="const-mountainDiary" data-verso-hover="1666">mountainDiary</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.61536" data-verso-hover="1790">waterfalls</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="const token" data-binding="const-waterfall" data-verso-hover="1675">waterfall</span><span class="inter-text"> := </span><span class="const token" data-binding="const-Query.table" data-verso-hover="1730">table</span><span class="inter-text"> </span><span class="const token" data-binding="const-waterfallDiary" data-verso-hover="1676">waterfallDiary</span></span></span></span><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-disjoint" data-verso-hover="1736">disjoint</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="const token" data-binding="const-List.map" data-verso-hover="231">List.map</span><span class="inter-text"> </span><span class="const token" data-binding="const-Column.name" data-verso-hover="1653">Column.name</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text">)</span><span class="inter-text"> </span><span class="inter-text">(</span><span class="const token" data-binding="const-List.map" data-verso-hover="231">List.map</span><span class="inter-text"> </span><span class="const token" data-binding="const-Column.name" data-verso-hover="1653">Column.name</span><span class="inter-text"> </span><span class="const token" data-binding="const-waterfall" data-verso-hover="1675">waterfall</span><span class="inter-text">)</span><span class="const token" data-binding="const-Eq" data-verso-hover="342"> = </span><span class="const token" data-binding="const-Bool.true" data-verso-hover="97">true</span></span></span></span></span></span></span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|&gt;.</span><span class="const token" data-binding="const-Query.select" data-verso-hover="1733">select</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="const token" data-binding="const-DBExpr.eq" data-verso-hover="1711">.eq</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="has-info error"><span class="hover-container"><span class="hover-info messages"><code class="message error">unsolved goals
case a.a.a.a.a.a.a
mountains : Query peak := table mountainDiary
waterfalls : Query waterfall := table waterfallDiary
⊢ HasCol [] "mountain.location" ?m.61583</code></span></span><span class="keyword token" data-binding="kw-occ-termC!_-16090">c!</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1781">"mountain.location"</span></span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="has-info error"><span class="hover-container"><span class="hover-info messages"><code class="message error">unsolved goals
case a.a.a.a.a.a.a
mountains : Query peak := table mountainDiary
waterfalls : Query waterfall := table waterfallDiary
⊢ HasCol [] "waterfall.location" ?m.61583</code></span></span><span class="keyword token" data-binding="kw-occ-termC!_-16115">c!</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1782">"waterfall.location"</span></span><span class="unknown token" data-binding="">)</span><span class="unknown token" data-binding="">)</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="unknown token" data-binding="">|&gt;.</span><span class="const token" data-binding="const-Query.project" data-verso-hover="1734">project</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟨</span><span class="literal string token" data-binding="" data-verso-hover="1783">"mountain.name"</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">.string</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟩</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟨</span><span class="literal string token" data-binding="" data-verso-hover="1784">"waterfall.name"</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">.string</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟩</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="has-info error"><span class="hover-container"><span class="hover-info messages"><code class="message error">unsolved goals
case a.a.a.a.a.a.a.a
mountains : Query peak := table mountainDiary
waterfalls : Query waterfall := table waterfallDiary
⊢ HasCol [] "mountain.name" DBType.string

case a
mountains : Query peak := table mountainDiary
waterfalls : Query waterfall := table waterfallDiary
⊢ Subschema [{ name := "waterfall.name", contains := DBType.string }] (peak ++ waterfall)</code></span></span><span class="tactic"><label for="tactic-state-5600381259224547101-16223-16225"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Term.byTactic-16223" data-verso-hover="340">by</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-5600381259224547101-16223-16225"><span class="tactic-state"><span class="goal"><span class="hypotheses"><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.61532" data-verso-hover="1789">mountains</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text"> := </span><span class="const token" data-binding="const-Query.table" data-verso-hover="1730">table</span><span class="inter-text"> </span><span class="const token" data-binding="const-mountainDiary" data-verso-hover="1666">mountainDiary</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.61536" data-verso-hover="1790">waterfalls</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="const token" data-binding="const-waterfall" data-verso-hover="1675">waterfall</span><span class="inter-text"> := </span><span class="const token" data-binding="const-Query.table" data-verso-hover="1730">table</span><span class="inter-text"> </span><span class="const token" data-binding="const-waterfallDiary" data-verso-hover="1676">waterfallDiary</span></span></span></span><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text">
  </span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">[</span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1783">"mountain.name"</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">DBType.string</span><span class="inter-text"> }</span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">, </span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1784">"waterfall.name"</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">DBType.string</span><span class="inter-text"> }</span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">]</span><span class="inter-text">
  </span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558">(</span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="const token" data-binding="const-waterfall" data-verso-hover="1675">waterfall</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558">)</span></span></span></span></span></span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.tacticRepeat_-16226" data-verso-hover="1701">repeat</span><span class="inter-text"> </span><span class="tactic"><label for="tactic-state-13127115855883250736-16233-16244"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Tactic.constructor-16233" data-verso-hover="1699">constructor</span></label><input type="checkbox" class="tactic-toggle" id="tactic-state-13127115855883250736-16233-16244"><span class="tactic-state"><span class="goal"><span class="labeled-case" checked="checked"><label class="case-label"><input type="checkbox" id="--verso-unique-55" checked="checked"><span for="--verso-unique-55" class="goal-name">a.a.a.a.a.a.a.a</span></label><span class="hypotheses"><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.61532" data-verso-hover="1789">mountains</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text"> := </span><span class="const token" data-binding="const-Query.table" data-verso-hover="1730">table</span><span class="inter-text"> </span><span class="const token" data-binding="const-mountainDiary" data-verso-hover="1666">mountainDiary</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.61536" data-verso-hover="1790">waterfalls</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="const token" data-binding="const-waterfall" data-verso-hover="1675">waterfall</span><span class="inter-text"> := </span><span class="const token" data-binding="const-Query.table" data-verso-hover="1730">table</span><span class="inter-text"> </span><span class="const token" data-binding="const-waterfallDiary" data-verso-hover="1676">waterfallDiary</span></span></span></span><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span><span class="inter-text"> </span><span class="const token" data-binding="const-List.nil" data-verso-hover="133">[</span><span class="const token" data-binding="const-List.nil" data-verso-hover="133">]</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1783">"mountain.name"</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">DBType.string</span></span></span></span></span><span class="goal"><span class="labeled-case"><label class="case-label"><input type="checkbox" id="--verso-unique-56"><span for="--verso-unique-56" class="goal-name">a</span></label><span class="hypotheses"><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.61532" data-verso-hover="1789">mountains</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="inter-text"> := </span><span class="const token" data-binding="const-Query.table" data-verso-hover="1730">table</span><span class="inter-text"> </span><span class="const token" data-binding="const-mountainDiary" data-verso-hover="1666">mountainDiary</span></span></span><span class="hypothesis"><span class="name"><span class="var token" data-binding="var-_uniq.61536" data-verso-hover="1790">waterfalls</span></span><span class="colon">:</span><span class="type"><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span><span class="inter-text"> </span><span class="const token" data-binding="const-waterfall" data-verso-hover="1675">waterfall</span><span class="inter-text"> := </span><span class="const token" data-binding="const-Query.table" data-verso-hover="1730">table</span><span class="inter-text"> </span><span class="const token" data-binding="const-waterfallDiary" data-verso-hover="1676">waterfallDiary</span></span></span></span><span class="conclusion"><span class="prefix">⊢ </span><span class="type"><span class="const token" data-binding="const-Subschema" data-verso-hover="1697">Subschema</span><span class="inter-text"> </span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">[</span><span class="inter-text">{ </span><span class="const token" data-binding="const-Column.name" data-verso-hover="465">name</span><span class="inter-text"> := </span><span class="literal string token" data-binding="" data-verso-hover="1784">"waterfall.name"</span><span class="inter-text">, </span><span class="const token" data-binding="const-Column.contains" data-verso-hover="1700">contains</span><span class="inter-text"> := </span><span class="const token" data-binding="const-DBType.string" data-verso-hover="1642">DBType.string</span><span class="inter-text"> }</span><span class="const token" data-binding="const-List.cons" data-verso-hover="132">]</span><span class="inter-text"> </span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558">(</span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558"> ++ </span><span class="const token" data-binding="const-waterfall" data-verso-hover="1675">waterfall</span><span class="const token" data-binding="const-HAppend.hAppend" data-verso-hover="558">)</span></span></span></span></span></span></span></span><span class="unknown token" data-binding="">)</span></code><p>
                  This error message is more helpful:</p>
                <div class="error">
                  <pre>tactic 'decide' proved that the proposition
  disjoint (List.map Column.name peak) (List.map Column.name waterfall) = true
is false</pre></div>
                <p>
                  Lean's macro system contains everything needed not only to provide a convenient syntax for queries, but also to arrange for the error messages to be helpful.
Unfortunately, it is beyond the scope of this book to provide a description of implementing languages with Lean macros.
An indexed family such as <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Query" data-verso-hover="1729">Query</span></code> is probably best as the core of a typed database interaction library, rather than its user interface.</p>
                </section>
              </section>
            <section>
              <h2 id="Functional-Programming-in-Lean--Programming-with-Dependent-Types--Worked-Example___-Typed-Queries--Exercises">
                7.3.6. Exercises</h2>
              <section>
                <h3 id="Functional-Programming-in-Lean--Programming-with-Dependent-Types--Worked-Example___-Typed-Queries--Exercises--Dates">
                  7.3.6.1. Dates</h3>
                <p>
                  Define a structure to represent dates. Add it to the <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DBType" data-verso-hover="1640">DBType</span></code> universe and update the rest of the code accordingly. Provide the extra <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DBExpr" data-verso-hover="1709">DBExpr</span></code> constructors that seem to be necessary.</p>
                </section>
              <section>
                <h3 id="Functional-Programming-in-Lean--Programming-with-Dependent-Types--Worked-Example___-Typed-Queries--Exercises--Nullable-Types">
                  7.3.6.2. Nullable Types</h3>
                <p>
                  Add support for nullable columns to the query language by representing database types with the following structure:</p>
                <code class="hl lean block" data-lean-context="examples"><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.structureTk-16653">structure</span><span class="inter-text"> </span><span class="const token" data-binding="const-NDBType" data-verso-hover="1791">NDBType</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-null-16671">where</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-NDBType.underlying" data-verso-hover="1792">underlying</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType" data-verso-hover="1640">DBType</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="const token" data-binding="const-NDBType.nullable" data-verso-hover="1793">nullable</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-Bool" data-verso-hover="40">Bool</span><span class="inter-text">
</span><span class="inter-text">
</span><span class="keyword token" data-binding="kw-occ-Lean.Parser.Command.abbrev-16718">abbrev</span><span class="inter-text"> </span><span class="const token" data-binding="const-NDBType.asType" data-verso-hover="1794">NDBType.asType</span><span class="inter-text"> </span><span class="unknown token" data-binding="">(</span><span class="var token" data-binding="var-_uniq.69161" data-verso-hover="1795">t</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="const token" data-binding="const-NDBType" data-verso-hover="1791">NDBType</span><span class="unknown token" data-binding="">)</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:</span><span class="inter-text"> </span><span class="sort token" data-binding="" data-verso-hover="50">Type</span><span class="inter-text"> </span><span class="unknown token" data-binding="">:=</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-termIfThenElse-16766" data-verso-hover="16">if</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.69161" data-verso-hover="1795">t</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-NDBType.nullable" data-verso-hover="1793">nullable</span><span class="inter-text"> </span><span class="keyword token" data-binding="kw-occ-termIfThenElse-16766" data-verso-hover="16">then</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="const token" data-binding="const-Option" data-verso-hover="142">Option</span><span class="inter-text"> </span><span class="var token" data-binding="var-_uniq.69161" data-verso-hover="1795">t</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-NDBType.underlying" data-verso-hover="1792">underlying</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DBType.asType" data-verso-hover="1644">asType</span><span class="inter-text">
</span><span class="inter-text">  </span><span class="keyword token" data-binding="kw-occ-termIfThenElse-16766" data-verso-hover="16">else</span><span class="inter-text">
</span><span class="inter-text">    </span><span class="var token" data-binding="var-_uniq.69161" data-verso-hover="1795">t</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-NDBType.underlying" data-verso-hover="1792">underlying</span><span class="unknown token" data-binding="">.</span><span class="const token" data-binding="const-DBType.asType" data-verso-hover="1644">asType</span></code><p>
                  Use this type in place of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DBType" data-verso-hover="1640">DBType</span></code> in <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Column" data-verso-hover="1652">Column</span></code> and <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DBExpr" data-verso-hover="1709">DBExpr</span></code>, and look up SQL's rules for <code>NULL</code> and comparison operators to determine the types of <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-DBExpr" data-verso-hover="1709">DBExpr</span></code>'s constructors.</p>
                </section>
              <section>
                <h3 id="Functional-Programming-in-Lean--Programming-with-Dependent-Types--Worked-Example___-Typed-Queries--Exercises--Experimenting-with-Tactics">
                  7.3.6.3. Experimenting with Tactics</h3>
                <p>
                  What is the result of asking Lean to find values of the following types using <code class="hl lean inline" data-lean-context="examples"><span class="keyword token" data-binding="">by repeat constructor</span></code>? Explain why each gives the result that it does.</p>
                <ul>
                  <li>
                    <p>
                      <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span></code></p>
                    </li>
                  <li>
                    <p>
                      <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-List" data-verso-hover="111">List</span><span class="inter-text"> </span><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span></code></p>
                    </li>
                  <li>
                    <p>
                      <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Vect" data-verso-hover="1567">Vect</span><span class="inter-text"> </span><span class="const token" data-binding="const-Nat" data-verso-hover="6">Nat</span><span class="inter-text"> </span><span class="typed token" data-binding="" data-verso-hover="5">4</span></code></p>
                    </li>
                  <li>
                    <p>
                      <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Row" data-verso-hover="1656">Row</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="">]</span></code></p>
                    </li>
                  <li>
                    <p>
                      <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Row" data-verso-hover="1656">Row</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟨</span><span class="literal string token" data-binding="" data-verso-hover="1796">"price"</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.int" data-verso-hover="1641">.int</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟩</span><span class="unknown token" data-binding="">]</span></code></p>
                    </li>
                  <li>
                    <p>
                      <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-Row" data-verso-hover="1656">Row</span><span class="inter-text"> </span><span class="const token" data-binding="const-peak" data-verso-hover="1661">peak</span></code></p>
                    </li>
                  <li>
                    <p>
                      <code class="hl lean inline" data-lean-context="examples"><span class="const token" data-binding="const-HasCol" data-verso-hover="1687">HasCol</span><span class="inter-text"> </span><span class="unknown token" data-binding="">[</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟨</span><span class="literal string token" data-binding="" data-verso-hover="1796">"price"</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.int" data-verso-hover="1641">.int</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟩</span><span class="unknown token" data-binding="">,</span><span class="inter-text"> </span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟨</span><span class="literal string token" data-binding="" data-verso-hover="1796">"price"</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">,</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.int" data-verso-hover="1641">.int</span><span class="unknown token" data-binding="const-Column.mk" data-verso-hover="1662">⟩</span><span class="unknown token" data-binding="">]</span><span class="inter-text"> </span><span class="literal string token" data-binding="" data-verso-hover="1796">"price"</span><span class="inter-text"> </span><span class="const token" data-binding="const-DBType.int" data-verso-hover="1641">.int</span></code>
</p>
                    </li>
                  </ul>
                </section>
              </section>
            </section>
          <nav class="prev-next-buttons">
            <a class="local-button active" href="Programming-with-Dependent-Types/The-Universe-Design-Pattern/#Functional-Programming-in-Lean--Programming-with-Dependent-Types--The-Universe-Design-Pattern" rel="prev" title="7.2. The Universe Design Pattern"><span class="arrow">←</span><span class="where">7.2. The Universe Design Pattern</span></a><a class="local-button active" href="Programming-with-Dependent-Types/Indices___-Parameters___-and-Universe-Levels/#Functional-Programming-in-Lean--Programming-with-Dependent-Types--Indices___-Parameters___-and-Universe-Levels" rel="next" title="7.4. Indices, Parameters, and Universe Levels"><span class="where">7.4. Indices, Parameters, and Universe Levels</span><span class="arrow">→</span></a></nav>
          </div>
        </main></div>
    </body>
  </html>

